/**
   Zwibbler

   Copyright 2019 Hanov Solutions Inc. All Rights Reserved. This software is
   NOT open source. For licensing information, contact the author.

   steve.hanov@gmail.com

   @license
 */
;(function(){var __extends = (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function () { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function () { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __values = (this && this.__values) || function (o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(){ca=function(){};ba.Symbol||(ba.Symbol=da)}var da=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function ea(){ca();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return fa(this)}});ea=function(){}}function fa(c){var a=0;return ha(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function ha(c){ea();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function ia(c,a){ea();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}function ja(c,a){if(a){var b=ba;c=c.split(".");for(var d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&aa(b,c,{configurable:!0,writable:!0,value:a})}}
ja("Array.prototype.values",function(c){return c?c:function(){return ia(this,function(a,b){return b})}});function ka(c){ea();var a=c[Symbol.iterator];return a?a.call(c):fa(c)}
ja("Promise",function(c){function a(a){this.Ij=0;this.bp=void 0;this.Ch=[];var b=this.cn();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}}function b(){this.qf=null}function d(b){return b instanceof a?b:new a(function(a){a(b)})}if(c)return c;b.prototype.Wq=function(a){null==this.qf&&(this.qf=[],this.iv());this.qf.push(a)};b.prototype.iv=function(){var a=this;this.Xq(function(){a.uw()})};var e=ba.setTimeout;b.prototype.Xq=function(a){e(a,0)};b.prototype.uw=function(){for(;this.qf&&this.qf.length;){var a=
this.qf;this.qf=[];for(var b=0;b<a.length;++b){var d=a[b];a[b]=null;try{d()}catch(n){this.jv(n)}}}this.qf=null};b.prototype.jv=function(a){this.Xq(function(){throw a;})};a.prototype.cn=function(){function a(a){return function(e){d||(d=!0,a.call(b,e))}}var b=this,d=!1;return{resolve:a(this.xz),reject:a(this.Uo)}};a.prototype.xz=function(b){if(b===this)this.Uo(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof a)this.hA(b);else{a:switch(typeof b){case "object":var d=null!=b;break a;
case "function":d=!0;break a;default:d=!1}d?this.wz(b):this.Qr(b)}};a.prototype.wz=function(a){var b=void 0;try{b=a.then}catch(l){this.Uo(l);return}"function"==typeof b?this.iA(b,a):this.Qr(a)};a.prototype.Uo=function(a){this.Rt(2,a)};a.prototype.Qr=function(a){this.Rt(1,a)};a.prototype.Rt=function(a,b){if(0!=this.Ij)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.Ij);this.Ij=a;this.bp=b;this.vw()};a.prototype.vw=function(){if(null!=this.Ch){for(var a=0;a<this.Ch.length;++a)f.Wq(this.Ch[a]);
this.Ch=null}};var f=new b;a.prototype.hA=function(a){var b=this.cn();a.rk(b.resolve,b.reject)};a.prototype.iA=function(a,b){var d=this.cn();try{a.call(b,d.resolve,d.reject)}catch(n){d.reject(n)}};a.prototype.then=function(b,d){function e(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(B){f(B)}}:b}var c,f,h=new a(function(a,b){c=a;f=b});this.rk(e(b,c),e(d,f));return h};a.prototype.catch=function(a){return this.then(void 0,a)};a.prototype.rk=function(a,b){function d(){switch(e.Ij){case 1:a(e.bp);
break;case 2:b(e.bp);break;default:throw Error("Unexpected state: "+e.Ij);}}var e=this;null==this.Ch?f.Wq(d):this.Ch.push(d)};a.resolve=d;a.reject=function(b){return new a(function(a,d){d(b)})};a.race=function(b){return new a(function(a,e){for(var c=ka(b),f=c.next();!f.done;f=c.next())d(f.value).rk(a,e)})};a.all=function(b){var e=ka(b),c=e.next();return c.done?d([]):new a(function(a,b){function f(b){return function(d){h[b]=d;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,d(c.value).rk(f(h.length-
1),b),c=e.next();while(!c.done)})};return a});ja("Array.prototype.keys",function(c){return c?c:function(){return ia(this,function(a){return a})}});
ja("String.prototype.startsWith",function(c){return c?c:function(a,b){if(null==this)throw new TypeError("The 'this' value for String.prototype.startsWith must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype.startsWith must not be a regular expression");var d=this+"";a+="";var e=d.length,c=a.length;b=Math.max(0,Math.min(b|0,d.length));for(var h=0;h<c&&b<e;)if(d[b++]!=a[h++])return!1;return h>=c}});
ja("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});ja("Math.sign",function(c){return c?c:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}});ja("Array.prototype.entries",function(c){return c?c:function(){return ia(this,function(a,b){return[a,b]})}});
ja("Array.from",function(c){return c?c:function(a,b,d){ea();b=null!=b?b:function(a){return a};var e=[],c=a[Symbol.iterator];if("function"==typeof c){a=c.call(a);for(var h=0;!(c=a.next()).done;)e.push(b.call(d,c.value,h++))}else for(c=a.length,h=0;h<c;h++)e.push(b.call(d,a[h],h));return e}});function la(c,a){return Object.prototype.hasOwnProperty.call(c,a)}
ja("WeakMap",function(c){function a(a){this.Vi=(f+=Math.random()+1).toString();if(a){ca();ea();a=ka(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}}function b(a){la(a,e)||aa(a,e,{value:{}})}function d(a){var d=Object[a];d&&(Object[a]=function(a){b(a);return d(a)})}if(function(){if(!c||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),d=new c([[a,2],[b,3]]);if(2!=d.get(a)||3!=d.get(b))return!1;d.delete(a);d.set(b,4);return!d.has(a)&&4==d.get(b)}catch(n){return!1}}())return c;
var e="$jscomp_hidden_"+Math.random();d("freeze");d("preventExtensions");d("seal");var f=0;a.prototype.set=function(a,d){b(a);if(!la(a,e))throw Error("WeakMap key fail: "+a);a[e][this.Vi]=d;return this};a.prototype.get=function(a){return la(a,e)?a[e][this.Vi]:void 0};a.prototype.has=function(a){return la(a,e)&&la(a[e],this.Vi)};a.prototype.delete=function(a){return la(a,e)&&la(a[e],this.Vi)?delete a[e][this.Vi]:!1};return a});
ja("Map",function(c){function a(){var a={};return a.oa=a.next=a.head=a}function b(a,b){var d=a.Pe;return ha(function(){if(d){for(;d.head!=a.Pe;)d=d.oa;for(;d.next!=d.head;)return d=d.next,{done:!1,value:b(d)};d=null}return{done:!0,value:void 0}})}function d(a,b){var d=b&&typeof b;"object"==d||"function"==d?f.has(b)?d=f.get(b):(d=""+ ++h,f.set(b,d)):d="p_"+b;var e=a.vi[d];if(e&&la(a.vi,d))for(a=0;a<e.length;a++){var c=e[a];if(b!==b&&c.key!==c.key||b===c.key)return{id:d,list:e,index:a,yc:c}}return{id:d,
list:e,index:-1,yc:void 0}}function e(b){this.vi={};this.Pe=a();this.size=0;if(b){b=ka(b);for(var d;!(d=b.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),b=new c(ka([[a,"s"]]));if("s"!=b.get(a)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var d=b.entries(),e=d.next();if(e.done||e.value[0]!=a||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||
"t"!=e.value[1]||!d.next().done?!1:!0}catch(v){return!1}}())return c;ca();ea();var f=new WeakMap;e.prototype.set=function(a,b){a=0===a?0:a;var e=d(this,a);e.list||(e.list=this.vi[e.id]=[]);e.yc?e.yc.value=b:(e.yc={next:this.Pe,oa:this.Pe.oa,head:this.Pe,key:a,value:b},e.list.push(e.yc),this.Pe.oa.next=e.yc,this.Pe.oa=e.yc,this.size++);return this};e.prototype.delete=function(a){a=d(this,a);return a.yc&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.vi[a.id],a.yc.oa.next=a.yc.next,a.yc.next.oa=
a.yc.oa,a.yc.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.vi={};this.Pe=this.Pe.oa=a();this.size=0};e.prototype.has=function(a){return!!d(this,a).yc};e.prototype.get=function(a){return(a=d(this,a).yc)&&a.value};e.prototype.entries=function(){return b(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return b(this,function(a){return a.key})};e.prototype.values=function(){return b(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var d=this.entries(),
e;!(e=d.next()).done;)e=e.value,a.call(b,e[1],e[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var h=0;return e});
ja("Set",function(c){function a(a){this.ue=new Map;if(a){a=ka(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.ue.size}if(function(){if(!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),d=new c(ka([a]));if(!d.has(a)||1!=d.size||d.add(a)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=a||f.value[1]!=a)return!1;f=e.next();return f.done||f.value[0]==a||4!=f.value[0].x||
f.value[1]!=f.value[0]?!1:e.next().done}catch(h){return!1}}())return c;ca();ea();a.prototype.add=function(a){a=0===a?0:a;this.ue.set(a,a);this.size=this.ue.size;return this};a.prototype.delete=function(a){a=this.ue.delete(a);this.size=this.ue.size;return a};a.prototype.clear=function(){this.ue.clear();this.size=0};a.prototype.has=function(a){return this.ue.has(a)};a.prototype.entries=function(){return this.ue.entries()};a.prototype.values=function(){return this.ue.values()};a.prototype.keys=a.prototype.values;
a.prototype[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(a,d){var b=this;this.ue.forEach(function(e){return a.call(d,e,e,b)})};return a});
var r=function(){function c(a,b){this.type=a;this.values=b}c.Gi=function(a){a.toLowerCase()in c.jq&&(a=c.jq[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/,f=/hsl\( *([0-9]+) *, *([0-9]+)% *, *([0-9]+)% *\)/;var h=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i.exec(a);if(null!==h)a=parseInt(h[1],16)/255,b=parseInt(h[2],16)/255,d=parseInt(h[3],16)/255,h=1;else if(h=
e.exec(a),null!==h)a=parseFloat(h[1])/255,b=parseFloat(h[2])/255,d=parseFloat(h[3])/255,h=parseFloat(h[4]);else if(h=d.exec(a),null!==h)a=parseFloat(h[1])/255,b=parseFloat(h[2])/255,d=parseFloat(h[3])/255,h=1;else if(h=b.exec(a),null!==h)a=parseInt(h[1],16),a=(16*a+a)/255,b=parseInt(h[2],16),b=(16*b+b)/255,d=parseInt(h[2],16),d=(16*d+d)/255,h=1;else if(h=f.exec(a),null!==h)a=parseFloat(h[1])/360,b=parseFloat(h[2])/100,h=parseFloat(h[3])/100,0==b?b=h=d=h:(d=.5>h?h*(1+b):h+b-h*b,e=2*h-d,b=ma(e,d,a+
1/3),h=ma(e,d,a),d=ma(e,d,a-1/3)),a=b,b=h,h=1;else return null;return new c(c.RGBA,[a,b,d,h])};c.me=function(a){return c.Gi(a)||new c(c.RGBA,[1,0,1,1])};c.RB=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};c.prototype.toString=function(){function a(a){a=na(a);return 16>a?"0"+a.toString(16):a.toString(16)}var b=this.ih(c.RGBA);return 1===b.values[3]?"#"+a(b.values[0])+a(b.values[1])+a(b.values[2]):"rgba("+na(b.values[0])+","+na(b.values[1])+
","+na(b.values[2])+","+b.values[3]+")"};c.prototype.ih=function(a){return c.Qv[this.type][a](this)};c.prototype.Wb=function(a){a.type!==this.type&&(a=a.ih(this.type));if(this.type===c.Ug){var b=this.values[0],d=a.values[0];b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*(this.values[0]-a.values[0])+(this.values[1]-
a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.prototype.cw=function(a){var b=a;var d=this.ih(r.Dm);b=b.ih(r.Dm);a=d.values[0];var e=d.values[1],c=d.values[2],h=b.values[0],k=b.values[1],l=b.values[2];b=oa(pa(e,2)+pa(c,2));d=oa(pa(k,2)+pa(l,2));var n=(b+d)/2;n=.5*(1-oa(pa(n,7)/(pa(n,7)+pa(25,7))));e*=1+n;var q=(1+n)*k;k=oa(pa(e,2)+pa(c,2));n=oa(pa(q,2)+pa(l,2));var v=qa(c,e);q=qa(l,q);c=h-a;l=n-k;if(0===b*d)e=0;else if(180>=ra(q-v))e=q-v;
else if(180<q-v)e=q-v-360;else if(-180>q-v)e=q-v+360;else throw Error();e=2*oa(k*n)*sa(ta/180*e/2);a=(a+h)/2;h=(k+n)/2;if(0===b*d)d=v+q;else if(180>=ra(v-q))d=(v+q)/2;else if(180<ra(v-q)&&360>v+q)d=(v+q+360)/2;else if(180<ra(v-q)&&360<=v+q)d=(v+q-360)/2;else throw Error();b=1-.17*ua(ta/180*(d-30))+.24*ua(ta/180*d*2)+.32*ua(ta/180*(3*d+6))-.2*ua(ta/180*(4*d-63));d=30*va(-pa((d-275)/25,2));k=oa(pa(h,7)/(pa(h,7)+pa(25,7)));a=1+.015*pa(a-50,2)/oa(20+pa(a-50,2));n=1+.045*h;b=1+.015*h*b;d=-2*k*sa(ta/180*
d*2);return oa(pa(c/(1*a),2)+pa(l/(1*n),2)+pa(e/(1*b),2)+l/(1*n)*d*(e/(1*b)))};c.RGBA=0;c.tq=1;c.Ug=2;c.Dm=3;c.uB=3;c.Qv=[[xa,ya,za,Aa],[Ba,xa,Ca,Da],[Ea,Fa,xa,Ga],[Ha,Ia,Ja,xa]];c.jq={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",
cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",
dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",
lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",
midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",
salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),Ka=.9505,Ma=1,Na=1.089;
function Ea(c){var a=c.values[0],b=c.values[1],d=c.values[2];0>a&&(a+=360);var e=a/60-Math.floor(a/60),f=d*(1-b),h=d*(1-e*b);b=d*(1-(1-e)*b);var k=e=0,l=0;switch(Math.floor(a/60)%6){case 0:e=d;k=b;l=f;break;case 1:e=h;k=d;l=f;break;case 2:e=f;k=d;l=b;break;case 3:e=f;k=h;l=d;break;case 4:e=b;k=f;l=d;break;case 5:e=d,k=f,l=h}return new r(r.RGBA,[e,k,l,c.values[3]])}
function za(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),f=Math.min(a,b,d);return new r(r.Ug,[e===f?0:e===a?(60*(b-d)/(e-f)+360)%360:e===b?60*(d-a)/(e-f)+120:60*(a-b)/(e-f)+240,0===e?0:1-f/e,e,c.values[3]])}function Da(c){function a(a){return a>6/29*(6/29)*(6/29)?Math.pow(a,1/3):1/3*(29/6)*(29/6)*a+4/29}var b=a(c.values[1]/Ma);return new r(r.Dm,[116*b-16,500*(a(c.values[0]/Ka)-b),200*(b-a(c.values[2]/Na)),c.values[3]])}
function Ia(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new r(r.tq,[b>e?Ka*b*b*b:3*(b-16/116)*e*e*Ka,a>e?Ma*a*a*a:3*(a-16/116)*e*e*Ma,d>e?Na*d*d*d:3*(d-16/116)*e*e*Na,c.values[3]])}function ya(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new r(r.tq,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function Ba(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new r(r.RGBA,b)}function xa(c){return new r(c.type,c.values.concat())}function Aa(c){return Da(ya(c))}function Ha(c){return Ba(Ia(c))}function Ca(c){return za(Ba(c))}
function Fa(c){return ya(Ea(c))}function Ga(c){return Aa(Ea(c))}function Ja(c){return Ca(Ia(c))}var oa=Math.sqrt,pa=Math.pow,ua=Math.cos,Oa=Math.atan2,sa=Math.sin,ra=Math.abs,va=Math.exp,ta=Math.PI;function qa(c,a){if(0===c&&0===a)return 0;c=Oa(c,a)*(180/ta);return 0<=c?c:c+360}function na(c){return Math.min(Math.floor(256*c),255)}function ma(c,a,b){0>b&&(b+=1);1<b&&--b;return b<1/6?c+6*(a-c)*b:.5>b?a:b<2/3?c+(a-c)*(2/3-b)*6:c};function Pa(c,a){void 0===a&&(a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");for(var b="",d,e,f,h,k,l,n=0;n<c.length;)d=c[n++],e=c[n++],f=c[n++],h=d>>2,d=(d&3)<<4|e>>4,k=(e&15)<<2|f>>6,l=f&63,isNaN(e)?k=l=64:isNaN(f)&&(l=64),b=b+a.charAt(h)+a.charAt(d)+a.charAt(k)+a.charAt(l);return b}
function Qa(c){for(var a=c.length,b=0,d,e,f=0;f!==a;){d=c.charCodeAt(f);f+=1;if(55296<=d&&56319>=d)if(f===a&&(b+=3),e=c.charCodeAt(f),56320<=e&&57343>=e){if(d=1024*(d-55296)+e-56320+65536,f+=1,65535<d){b+=4;continue}}else b+=3;b=127>=d?b+1:2047>=d?b+2:b+3}b=new Uint8Array(b);var h=-1;for(f=0;f!==a;){d=c.charCodeAt(f);f+=1;if(55296<=d&&56319>=d){if(f===a){b[h+=1]=239;b[h+=1]=191;b[h+=1]=189;break}e=c.charCodeAt(f);if(56320<=e&&57343>=e){if(d=1024*(d-55296)+e-56320+65536,f+=1,65535<d){b[h+=1]=240|d>>>
18;b[h+=1]=128|d>>>12&63;b[h+=1]=128|d>>>6&63;b[h+=1]=128|d&63;continue}}else{b[h+=1]=239;b[h+=1]=191;b[h+=1]=189;continue}}127>=d?b[h+=1]=0|d:(2047>=d?b[h+=1]=192|d>>>6:(b[h+=1]=224|d>>>12,b[h+=1]=128|d>>>6&63),b[h+=1]=128|d&63)}return b};var Ra=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.Mq(a,"");return a.join("")};c.prototype.Mq=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.Aq(""+this.attributes[d])),
a.push('"')));if(this.children.length||""!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].Mq(a,b+"  ");""!==this.text&&a.push(b+"  "+this.Aq(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;return!1};c.prototype.Cj=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.Ge=function(a){this.children.push(a)};
c.prototype.Aq=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var u=new (function(){function c(){this.disabled={};this.te=[];this.lr=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.ky(a,arguments)}};c.prototype.addListener=function(a){this.te.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.te.length;b++)if(this.te[b]===a){this.te.splice(b,1);break}};c.prototype.qw=
function(){this.lr||(this.lr=!0,this.addListener(function(a,b){console.log(a+": "+b)}))};c.prototype.ky=function(a,b){var d=[],e;if(0!==this.te.length){var c=b[0].split("%s");d.push(c[0]);for(e=1;e<c.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(c[e]);b=
d.join("");d=0;for(e=this.te;d<e.length;d++)(0,e[d])(a,b)}};return c}());u.create("HTML");function Sa(c){return parseFloat(c||"")||0}
var Ua=function(){function c(a){this.da=a}c.prototype.Va=function(a){for(var b in a){if(0<=b.indexOf("-"))throw Error("setStyle: styles must be camelcase; not "+b);this.da.style[b]=""+a[b]}return this};c.prototype.Cj=function(a){for(var b in a)this.da.setAttribute(b,a[b]);return this};c.prototype.wd=function(a){a.appendChild(this.da);return this};c.prototype.eo=function(a){a.parentNode&&a.parentNode.insertBefore(this.da,a.nextSibling)};c.prototype.insertBefore=function(a){a.parentNode&&a.parentNode.insertBefore(this.da,
a);return this};c.prototype.remove=function(){this.da.parentNode&&this.da.parentNode.removeChild(this.da);return this};c.prototype.qe=function(a){return window.getComputedStyle(this.da)[a]||""};c.prototype.Yb=function(){var a=this.da.getBoundingClientRect();return{top:a.top+window.pageYOffset,left:a.left+window.pageXOffset,width:a.width,height:a.height}};c.prototype.em=function(a){var b=(b=this.Fx())?b.Yb():{left:0,top:0};this.da.style.left=a.left-b.left+"px";this.da.style.top=a.top-b.top+"px"};c.prototype.Fx=
function(){if(!(this.da instanceof HTMLElement)||"fixed"===this.qe("position"))return Ta(document.body);for(var a=this.da.parentElement;a&&"static"===Ta(a).qe("position");)a=a.parentElement;return a?Ta(a):null};c.prototype.dl=function(){var a=window.getComputedStyle(this.da),b={left:Sa(a.marginLeft),top:Sa(a.marginTop),right:Sa(a.marginRight),bottom:Sa(a.marginBottom),ro:0,ep:0,Tp:0,Tm:0};"content-box"===a.boxSizing&&(b.ro+=Sa(a.borderLeftWidth)+Sa(a.paddingLeft),b.Tp+=Sa(a.borderTopWidth)+Sa(a.paddingTop),
b.ep+=Sa(a.borderRightWidth)+Sa(a.paddingRight),b.Tm+=Sa(a.borderBottomWidth)+Sa(a.paddingBottom));return b};c.prototype.Qd=function(a){this.da.classList.add(a);return this};c.prototype.Pp=function(a,b){b?this.da.classList.add(a):this.da.classList.remove(a)};c.prototype.addEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<a.length;e++)this.da.addEventListener(a[e],b,d);return this};c.prototype.removeEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<
a.length;e++)this.da.removeEventListener(a[e],b,d);return this};c.prototype.matches=function(a){var b=this.da;if(this.da.matches)return this.da.matches(a);if(b.msMatchesSelector)return b.msMatchesSelector(a);b=0;for(a=a.split(",");b<a.length;b++){var d=a[b];d=d.trim();if(0!=d.length)return"["==d[0]?this.da.hasAttribute(d.substr(1,d.length-2)):this.da.tagName===d.toUpperCase()}return!1};c.prototype.query=function(a,b){this.matches(a)&&b(this.da);Array.prototype.forEach.call(this.da.querySelectorAll(a),
b)};c.prototype.clear=function(){for(;null!==this.da.firstChild;)this.da.removeChild(this.da.firstChild);return this};c.prototype.Nf=function(a){this.da.innerText=a;return this};return c}();function Ta(c,a){if("string"===typeof c){if("<"==c[0])return a=Ta.Ar(c),new Ua(a[0]);c=new Ua(document.createElement(c));a&&c.Cj(a);return c}return new Ua(c)}var Va=null;
(function(c){c.ic=function(a){return"jQuery"in window&&a instanceof window.jQuery?a[0]:a instanceof HTMLElement?a:"string"===typeof a?document.querySelector(a):null};c.nl=function(){var a=document.documentElement,b=a.scrollWidth>a.clientWidth;a=a.scrollHeight>a.clientHeight?c.ng():0;b=b?c.ng():0;return{width:window.innerWidth-a,height:window.innerHeight-b,x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}};c.ng=function(){if(null===
Va){var a=document.createElement("div");a.style.visibility="hidden";a.style.width="100px";document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var d=document.createElement("div");d.style.width="100%";a.appendChild(d);d=d.offsetWidth;a.parentNode.removeChild(a);Va=b-d}return Va};c.Yr=function(){for(var a=document.getElementsByTagName("*"),b=0,d=0;d<a.length;d++){var e=parseInt(c(a[d]).qe("z-index"),10)||0;e>b&&(b=e)}return b};c.Ar=function(a){var b=document.createElement("div");
b.innerHTML=a;a=[];for(var d=b.firstChild;d;)d instanceof HTMLElement&&a.push(d),d=d.nextSibling;for(d=0;d<a.length;d++)b.removeChild(a[d]);return a};c.Df=function(a){if(!(a instanceof HTMLElement))return!1;switch(a.tagName){case "INPUT":case "TEXTAREA":case "BUTTON":case "OPTION":case "SELECT":return!0}return a.isContentEditable?!0:!1}})(Ta||(Ta={}));
function Wa(c){return new Promise(function(a,b){var d=new XMLHttpRequest;c.mimeType&&d.overrideMimeType(c.mimeType);c.withCredentials&&(d.withCredentials=!0);c.responseType&&(d.responseType=c.responseType);var e=c.method||"GET",f=c.ft||{},h=c.url,k="",l=!0,n;for(n in f)l||(k+="&"),l=!1,k+=n+"="+encodeURIComponent(f[n]);"GET"===e&&0<k.length&&(h+="?"+k,k="");d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status)a(d);else{var e=d.statusText;0===d.status?e="Could not contact server.":
d.getResponseHeader("status")&&(e=d.getResponseHeader("status"));b(Error(d.status+" "+e))}};d.open(e,h,!0);if(c.headers)for(var q in c.headers)d.setRequestHeader(q,c.headers[q]);"string"===typeof c.data&&(k=c.data);c.contentType?d.setRequestHeader("Content-type","application/json"):"POST"===e&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.cancel&&c.cancel.then(function(){d.abort()});c.qr?setTimeout(function(){d.send(k)},c.qr):d.send(k)})}
var Ya=function(){function c(){this.fo=[];this.Kb=null}c.prototype.bo=function(a){for(var b=0,d=this.fo;b<d.length;b++)if(d[b]===a)return;this.fo.push(a);this.Kb||(this.Kb=document.createElement("style"),document.head&&document.head.insertBefore(this.Kb,document.head.firstChild));this.Kb.appendChild(document.createTextNode(a))};c.prototype.Ta=function(){this.Kb&&(Ta(this.Kb).remove(),this.Kb=null);this.fo.length=0};return c}(),Za=function(){function c(){this.input=null}c.prototype.Ta=function(){this.input&&
this.input.parentNode&&this.input.parentNode.removeChild(this.input)};c.prototype.open=function(a){var b=this;return new Promise(function(d){b.input&&b.input.parentNode&&b.input.parentNode.removeChild(b.input);b.input=document.createElement("input");b.input.style.display="none";b.input.setAttribute("id","ZwibblerFileInput");b.input.setAttribute("type","file");"string"===typeof a.capture&&b.input.setAttribute("capture",a.capture);document.body.appendChild(b.input);a.accept&&b.input.setAttribute("accept",
a.accept);var e=new FileReader,c="";b.input.addEventListener("change",function(){var b=this.files;b&&0<b.length&&(c=b[0].type,"data-uri"===a.format?e.readAsDataURL(b[0]):"text"===a.format?e.readAsText(b[0]):"ArrayBuffer"===a.format?e.readAsArrayBuffer(b[0]):"File"===a.format&&d({contentType:c,data:b[0]}))});e.addEventListener("load",function(){d({contentType:c,data:e.result})});b.input.value="";b.input.click()})};return c}(),$a=function(){function c(){this.oj="";this.anchor=null}c.prototype.Ta=function(){this.anchor&&
this.anchor.parentNode&&this.anchor.parentNode.removeChild(this.anchor);""!==this.oj&&window.URL.revokeObjectURL(this.oj)};c.prototype.Dz=function(a,b){var d=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var e=new ArrayBuffer(d.length),c=new Uint8Array(e),h=0;h<d.length;h++)c[h]=d.charCodeAt(h);d=[e];a={type:a};try{var k=new File(d,b,a)}catch(l){k=new Blob(d,a)}this.Cz(k,b)};c.prototype.Cz=function(a,b){var d=this;this.Ta();if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,
b);else{this.oj=window.URL.createObjectURL(a);var e=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,c=navigator.userAgent.toLowerCase().match(/(iphone|ipad)/);a="application/pdf"===a.type;c||e&&a?window.open(this.oj,"_blank"):(this.anchor=document.createElement("a"),this.anchor.innerHTML="download",this.anchor.setAttribute("href",this.oj),this.anchor.setAttribute("download",b),this.anchor.style.display="none",document.body.appendChild(this.anchor),this.anchor.click(),setTimeout(function(){d.anchor&&
document.body.removeChild(d.anchor)},1E3))}};return c}(),ab=function(){function c(a,b){this.element=a;this.Ff=null;"ResizeObserver"in window&&(this.Ff=new window.ResizeObserver(function(){b()}),this.Ff.observe(a))}c.prototype.Ta=function(){this.Ff&&this.Ff.unobserve(this.element)};c.Bu=function(){return"ResizeObserver"in window};return c}(),A=Ta;var bb=function(){function c(a,b,d,e,c){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===c&&(c=0);this.vc=a;this.left=b;this.top=d;this.right=e;this.bottom=c;this.zIndex=1;this.insertBefore=null;this.ta=document.createElement("div")}c.prototype.Qe=function(){this.ta&&A(this.ta).remove()};c.prototype.show=function(a){A(this.ta).Va({position:"fixed",background:this.vc,left:this.left+"px",top:this.top+"px",right:this.right+"px",bottom:this.bottom+"px",display:"block"}).Qd("zwibbler-popup-overlay");
this.ta.addEventListener("click",a);this.ta.style.zIndex=this.zIndex.toString();this.insertBefore?this.insertBefore.parentNode&&this.insertBefore.parentNode.insertBefore(this.ta,this.insertBefore):document.body.appendChild(this.ta)};return c}();var cb=u.create("DRAGSORT");
function db(c){function a(a){"dragover"!==a.type&&cb(a.type);for(var b=a.target;b.parentNode!==c.parent&&b.parentNode;)b=b.parentNode;if(1===b.nodeType&&b.getAttribute("draggable")&&"false"!==b.getAttribute("draggable").toLowerCase()&&b.parentNode===c.parent)if("dragstart"===a.type){for(var d=c.parent.children,e=0;e<d.length;e++)null!==d[e].getAttribute(c.ar)&&d[e].setAttribute("sort-index",e.toString());a.dataTransfer.setData("text",b.id);a.dataTransfer.dropEffect="move";h=f=b;a.stopPropagation()}else"dragover"===
a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.Ko),h=b,h.classList.add(c.Ko),a.preventDefault()):"dragend"===a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.Ko),b=parseInt(h.getAttribute("sort-index")||"0"),d=parseInt(f.getAttribute("sort-index")||"0"),c.Oy(d,b),a.preventDefault(),a.stopPropagation()):"drop"===a.type&&(a.preventDefault(),a.stopPropagation())}var b=c.parent.Eu;c.parent.Eu=!0;for(var d=c.parent.children,e=0;e<d.length;e++)null!==d[e].getAttribute(c.ar)&&d[e].setAttribute("draggable",
"true");if(b)return function(){};A(c.parent).addEventListener("dragstart dragover dragend drop",a);var f,h;return function(){A(c.parent).removeEventListener("dragstart dragover dragend drop",a)}};var eb=function(){function c(a,b){this.name=b;this.ta=A("div").Va({borderTop:"1px solid #888",padding:"5px",cursor:"default"}).wd(a);this.update(0)}c.prototype.update=function(a){this.ta.da.innerText=this.name+"... "+Math.round(100*a)+"%"};c.prototype.error=function(a){var b=this,d=document.createElement("input");d.setAttribute("type","button");d.value="OK";d.addEventListener("click",function(){b.done()});this.ta.da.innerText=this.name+"... "+a+" ";this.ta.da.appendChild(d)};c.prototype.done=function(){this.ta.remove()};
c.all=[];return c}();var fb=function(){function c(a,b,d){this.parentElement=a;this.stack=[];this.Jg=!1;this.cf=[];this.oA=!1;this.first=A("CANVAS",{width:b,height:d}).wd(a).da;this.stack.push({canvas:this.first,ra:this.first.getContext("2d"),mi:{}});this.Td=this.Ii();this.width=this.first.width;this.height=this.first.height;this.ck(this.first)}c.prototype.Qu=function(){if(void 0===a)var a=this.stack.length;var b=A("CANVAS").Va({position:"absolute",left:this.first.offsetLeft+"px",top:this.first.offsetTop+"px",pointerEvents:"none",
outline:"4px solid red"}).Qd("zwibbler-overlay").da;this.ck(b);this.stack.splice(a,0,{canvas:b,ra:b.getContext("2d"),mi:{}});a===this.stack.length-1?this.parentElement.insertBefore(b,null):this.parentElement.insertBefore(b,this.stack[a+1].canvas);b.getContext("2d")};c.prototype.rd=function(a,b,d){var e=this;this.stack[a].mi[b]=d;if(!this.Jg){var c=(new Date).getTime();this.Jg=!0;requestAnimationFrame(function(){var a=(new Date).getTime(),b=e.Fn();e.Jg=!1;for(var d=0,f=e.stack;d<f.length;d++){var q=
f[d],v=!0,x;for(x in q.mi){var w=q.ra;v&&(w.setTransform(b,0,0,b,0,0),w.clearRect(0,0,e.width,e.height),v=!1);q.mi[x](w,b)}q.mi={}}if(e.oA){e.cf.push({Ab:a,latency:a-c,ow:(new Date).getTime()-a});25<e.cf.length&&e.cf.shift();w=f=d=0;for(q=e.cf;w<q.length;w++)v=q[w],d+=v.latency,f+=v.ow;d=Math.round(d/e.cf.length*10)/10;f=Math.round(f/e.cf.length*10)/10;a=1<e.cf.length?Math.round(e.cf.length/((a-e.cf[0].Ab)/1E3)*100)/100:0;w=e.get(0);w.setTransform(b,0,0,b,0,0);w.fillStyle="white";b="latency="+d+"ms drawTime="+
f+"ms fps="+a;w.fillRect(0,0,w.measureText("latency=MM.MMms drawTime=MM.MMms fps=MM").width,13);w.textBaseline="top";w.font="10px arial";w.fillStyle="red";w.fillText(b,2,2)}})}};c.prototype.get=function(a){return this.stack[a].ra};c.prototype.Fn=function(){var a=this.Ii();if(a!==this.Td){this.Td=a;a=0;for(var b=this.stack;a<b.length;a++)this.ck(b[a].canvas)}return this.Td};c.prototype.Mf=function(a,b){this.width=a;this.height=b;a=0;for(b=this.stack;a<b.length;a++)this.ck(b[a].canvas)};c.prototype.Ii=
function(){var a=this.stack[0].ra;return(window.devicePixelRatio||1)/(a.fB||a.wy||a.zy||a.Ey||a.mv||1)};c.prototype.ck=function(a){a.width=this.width*this.Td;a.height=this.height*this.Td;a.style.width=this.width+"px";a.style.height=this.height+"px";a.getContext("2d").setTransform(this.Td,0,0,this.Td,0,0)};return c}();u.create("EVALJS");
var gb=function(){function c(a,b){this.ge=a;this.key=b}c.prototype.toString=function(){return"LValue("+this.key+")"};return c}(),ib=function(){function c(a,b,d){this.id=a;this.Bl=b;d&&(this.Ve=d)}c.prototype.Ve=function(){return this};c.prototype.Cs=function(a){return a};c.prototype.toString=function(){return"Token(id='"+this.id+"', lbp="+this.Bl+")"};return c}(),jb=function(){function c(a,b){return a[b]}function a(a,b,d){a[b]=d}function b(a){if(a instanceof gb){if(a.ge===B)return E(B,a.key);if(a.ge)return a.ge[a.key]}else return a}
function d(a,b){void 0===b&&(b=0);var d=H[a];d?d.Bl=Math.max(d.Bl,b):d=H[a]=new ib(a,b);return d}function e(a,b){a=d(a);a.Ve=function(){return b};return a}function f(a){return new ib("(literal)",0,function(){return a})}function h(a){var b=new ib("(name)",0,function(){return new gb(B,a)});b.toString=function(){return"Token(name: "+a+")"};return b}function k(a,d,e){l(a,d,function(a){return e(b(a),b(y(d-1)))})}function l(a,b,e){d(a,b).Cs=e}function n(a,e,c){d(a,e).Ve=function(){return c(b(y(e)))}}function q(a,
b,e){d(a,b).Ve=e}function v(a){return" "===a||"\t"===a||"\n"===a||"\r"===a}function x(){return La<U.length?U[La++]:H["(end)"]}function w(a){if(a&&Y.id!==a)throw Error("Error: expected "+a+" but got "+Y.id);return Y=x()}function y(a){var b=Y;Y=x();for(var d=b.Ve();a<Y.Bl;)b=Y,Y=x(),d=b.Cs(d);return d}var B={},E=c,L=a,H={},z=0,K,W;e("true",!0);e("false",!1);e("null",null);e("undefined",void 0);d("(end)");(function(a,d,e){l(a,d,function(a){return e(b(a),b(y(d)))})})(",",K=++z,function(a,b){return b});
l("=",W=++z,function(a){var d=y(W);if(!(a instanceof gb))throw Error("Error: lhs of = must be assignable");d=b(d);if(a.ge===B)L(B,a.key,d);else if(a.ge instanceof Object)a.ge[a.key]=d;else throw Error(a.ge+"["+a.key+"] cannot be assigned to.");return d});k("&&",++z,function(a,b){return a&&b});k("||",++z,function(a,b){return a||b});k("|",++z,function(a,b){return a|b});k("^",++z,function(a,b){return a^b});k("&",++z,function(a,b){return a&b});k("===",++z,function(a,b){return a===b});k("!==",z,function(a,
b){return a!==b});k("==",z,function(a,b){return a==b});k("!=",z,function(a,b){return a!=b});k(">",++z,function(a,b){return a>b});k(">=",z,function(a,b){return a>=b});k("<",z,function(a,b){return a<b});k("<=",z,function(a,b){return a<=b});k("in",z,function(a,b){return a in b});k("<<",++z,function(a,b){return a<<b});k(">>",z,function(a,b){return a>>b});k(">>>",z,function(a,b){return a>>>b});k("+",++z,function(a,b){return a+b});k("-",z,function(a,b){return a-b});k("*",++z,function(a,b){return a*b});
k("/",z,function(a,b){return a/b});k("%",z,function(a,b){return a%b});n("!",++z,function(a){return!a});n("~",z,function(a){return~a});n("+",z,function(a){return+a});n("-",z,function(a){return-a});n("typeof",z,function(a){return typeof a});l(".",++z,function(a){var d=Y;if("(name)"!==d.id)throw Error("Error: '.' expects a name, not "+Y.id);if(a instanceof gb)a.ge=b(a),a.key=d.Ve().key;else if(a instanceof Object)a=new gb(b(a),d.Ve().key);else throw Error("Error: '.' must be preceded by object");w();
return a});q("(",++z,function(){var a=y(0);w(")");return a});d(")");l("(",++z,function(a){var d=[];if(")"!==Y.id)for(;;){d.push(b(y(K+1)));if(","!==Y.id)break;w(",")}w(")");var e=null;a instanceof gb&&(e=a.ge);a=b(a);if("function"!==typeof a)throw Error("Tried to call a non-function; type was "+typeof a);return a.apply(e,d)});d(",");l("[",z,function(a){var d=y(0);if(!(a instanceof gb))throw Error("Error: '[]' must be preceded by lvalue");w("]");a.ge=b(a);a.key=b(d);return a});d("]");q("{",++z,function(){for(var a=
{};"}"!==Y.id;){if("(literal)"===Y.id)var d=Y.Ve();else if("(name)"===Y.id)d=Y.Ve().key;else throw Error("Bad {}; expecting name or string constant");w();w(":");a[d]=b(y(K+1));if(","!==Y.id)break;Y=w(",")}w("}");return a});q("[",z,function(){for(var a=[];"]"!==Y.id;){a.push(b(y(K+1)));if(","!==Y.id)break;Y=w(",")}w("]");return a});d(",");d(":");d("}");var wa=/(\d+(\.\d+)?)|(===|!==|==|!=|\+=|-=|&&|\|\||<=|>=|<<|>>>|>>|&&|\|\||[{}\(\)\[\]\+\-\.\*\/=!,\?&\|:%~<>])|([a-zA-Z\$_][\$_a-zA-Z0-9]*)|("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g,
U=[],La=0,Y;return{parse:function(a){for(var b=[],d=0;d<a.length;){for(;v(a.charAt(d));)d++;wa.lastIndex=d;var e=wa.exec(a);if(e&&e.index===d)if(d+=e[0].length,e[1])b.push(f(parseFloat(e[1])));else if(e[3]&&e[3]in H)b.push(H[e[3]]);else if(e[4])switch(e[4]){case "true":case "false":case "null":case "in":case "typeof":case "undefined":b.push(H[e[4]]);break;default:b.push(h(e[4]))}else{if(e[5]){e=e[5].substr(1,e[5].length-2);for(var c="",k=!1,l=0;l<e.length;l++){var n=e[l];if(k){switch(n){case "n":n=
"\n";break;case "r":n="\r";break;case "t":n="\t"}c+=n;k=!1}else"\\"===n?k=!0:c+=n}b.push(f(c))}}else throw Error("Parse error: Expected stuff in "+a+" near: "+a.substr(d));}b.push(H["(end)"]);return b},evaluate:function(d,e,f,h){La=0;U=e;B=d;E=f||function(a,b){return a[b]};L=h||function(a,b,d){a[b]=d};Y=x();d=b(y(0));B={};E=c;L=a;return d}}}(),kb=jb.parse,lb=jb.evaluate;function mb(c,a,b){try{return lb(c,kb(a),b)}catch(d){console.log("When evaluating: %s on scope ",a,c),console.log(d)}}
function nb(c,a){if(c===a)return!0;if(!(c instanceof Object&&a instanceof Object)||c.constructor!==a.constructor)return!1;for(var b in c)if(c.hasOwnProperty(b)&&(!a.hasOwnProperty(b)||c[b]!==a[b]&&("object"!==typeof c[b]||!nb(c[b],a[b]))))return!1;for(b in a)if(a.hasOwnProperty(b)&&!c.hasOwnProperty(b))return!1;return!0}
var ob=function(){function c(){this.kf={};this.Vl=!1;this.length=0;this.Pm=[];this.timeout=0}c.prototype.Jc=function(a,b,d){a={scope:a,parsed:kb(b),Qs:void 0,Ns:d};b in this.kf?this.kf[b].push(a):this.kf[b]=[a];this.length+=1;this.check()};c.prototype.NA=function(a,b){if(a in this.kf){for(var d=this.kf[a],e=0;e<d.length;e++)if(d[e].Ns===b){d.splice(e,1);break}0===d.length&&delete this.kf[a];--this.length}};c.prototype.check=function(a){var b=this;this.Vl=!0;a&&this.Pm.push(a);0===this.timeout&&(this.timeout=
setTimeout(function(){for(var a=0;10>a&&b.Vl;a++){b.Vl=!1;for(var e in b.kf)for(var c=null,h=void 0,k=0;k<b.kf[e].length;k++){var l=b.kf[e][k];try{l.scope!==c&&(h=lb(l.scope,l.parsed),c=l.scope),nb(l.Qs,h)||(l.Qs=h,l.Ns(h),b.Vl=!0)}catch(n){console.log("Error when evaluating %s: ",e,n),console.log("Context was: %o",l.scope)}}h=b.Pm;b.Pm=[];for(c=0;c<h.length;c++)(0,h[c])()}b.timeout=0},0))};return c}();var pb=u.create("Zeact"),rb=function(){function c(a,b,d,e,c){this.sm=a;this.scope=b;this.element=d;this.name=e;this.value=c}c.prototype.emit=function(a,b){this.sm.sa(this.element,a,b)};c.prototype.listen=function(a,b){this.sm.Xa(this.element,a,b)};c.prototype.watch=function(a,b){this.sm.Jc(this.scope,this.element,a,b)};c.prototype.eval=function(a){return qb.tn(this.scope,a,this.element)};c.prototype.destructor=function(a){this.sm.ya(this.element,a)};return c}(),sb=function(){function c(){this.gq=
new ob;this.Ik={};this.Ie={};this.Kb=new Ya;this.xu=1}c.prototype.jk=function(a){return a};c.prototype.Ta=function(){this.Kb.Ta()};c.prototype.Ib=function(a,b,d){void 0===d&&(d=2);this.Ik[a]={name:a,link:b,Vt:d}};c.prototype.xk=function(a,b){this.Ie[a.toUpperCase()]=b;"string"===typeof b.template&&(b.template=b.template.trim())};c.prototype.de=function(a,b){var d=this;this.Ib(a,function(a,c,h,k){d.up(a,function(){d.Jc(a,c,k,function(d){b(c,d,a)})})})};c.prototype.Jc=function(a,b,d,e){var c=this;this.gq.Jc(a,
d,e);this.ya(b,function(){c.gq.NA(d,e)})};c.prototype.up=function(a,b){a.hasOwnProperty("$settled")?(b(),this.digest()):a.hasOwnProperty("$settledWaiters")?a.$settledWaiters.push(b):a.$settledWaiters=[b]};c.prototype.oy=function(a){if(!a.hasOwnProperty("$settled")&&(a.$settled=!0,a.$settledWaiters)){for(var b=0,d=a.$settledWaiters;b<d.length;b++)(0,d[b])();delete a.$settledWaiters;this.digest()}};c.prototype.Xa=function(a,b,d){a.addEventListener(b,d);this.ya(a,function(){a.removeEventListener(b,d)});
a.zwibblerListeners||(a.zwibblerListeners={});a.zwibblerListeners[b]||(a.zwibblerListeners[b]=[]);a.zwibblerListeners[b].push(d)};c.prototype.sa=function(a,b,d){var e=this;setTimeout(function(){e.Pc(a,b,d)},0)};c.prototype.Pc=function(a,b,d){if(a.zwibblerListeners&&b in a.zwibblerListeners)for(var e=0,c=a.zwibblerListeners[b];e<c.length;e++){var h=c[e];try{h.call(a,d)}catch(k){console.log("Error while handling event "+b+": ",k)}}};c.prototype.ya=function(a,b){a.zwibblerWatchers?a.zwibblerWatchers.push(b):
a.zwibblerWatchers=[b]};c.prototype.detach=function(a){for(var b=a.firstChild;b;)this.detach(b),b=b.nextSibling;if(a.zwibblerWatchers){b=0;for(var d=a.zwibblerWatchers;b<d.length;b++)(0,d[b])();delete a.zwibblerWatchers}a.zwibblerListeners&&delete a.zwibblerListeners;a.Du&&delete a.Du;a.ei&&delete a.ei;delete a.fi};c.prototype.digest=function(a){this.gq.check(a)};c.prototype.Aw=function(a,b){if(a=/^z-([a-z0-9@\-]+)/.exec(a.toLowerCase()))if(a=a[1],a in this.Ik&&this.Ik[a].Vt===b)return this.Ik[a]};
c.prototype.Uq=function(a,b,d,e){void 0===e&&(e=b);for(var c=b.parentNode,h=[],k=0;k<e.attributes.length;k++)h.push({name:e.attributes[k].name,value:e.attributes[k].value});for(k=0;k<h.length&&b.parentNode===c;k++){e=h[k].name;var l=h[k].value,n=this.Aw(e,d);if(n&&n.Vt===d&&(e=n.link(a,b,e,l))&&e!==b)return{da:e,Zo:!0}}return{da:b,Zo:b.parentNode!==c}};c.prototype.Ak=function(a,b,d,e){b=document.createElement(b);for(var c in d)b.setAttribute(c,d[c]);e&&(b.vm=e);a=this.Kc(a,b);delete b.vm;return a};
c.prototype.ev=function(a,b){var d=this,e=this.Ie[b.tagName];if(!e)return null;pb("Attaching component %s",b.tagName);var c=e.template;if(c instanceof HTMLElement)var h=c.cloneNode(!0);else if("string"===typeof c)if("<"===c[0]){pb("Using elementsFromString to instantiate component");var k=A.Ar(c);if(0===k.length)throw Error("Component "+b.tagName+": Could not interpret as HTML: "+c);if(1<k.length)throw Error("Component "+b.tagName+": Should render as a single element, but got "+k.length);h=k[0]}else{pb("Using querySelector to instantiate component");
h=document.querySelector(c);if(null===h)throw Error("Component "+b.tagName+': querySelector("'+c+'") returned null');h=h.cloneNode(!0)}else throw Error("Component "+b.tagName+": Could not interpret template "+c);c=null!==b.parentNode;null!==b.parentNode&&b.parentNode.replaceChild(h,b);var l=this,n={$emit:function(a,b){l.sa(h,a,b)},$emitNow:function(a,b){l.Pc(h,a,b)},$listen:function(a,b){var d=this;l.Xa(h,a,function(a){b.call(d,a);l.digest()})},$watch:function(a,b){l.Jc(n,h,a,b)},$element:h,$parent:a};
this.jk(n);if(b.vm){k=b.vm;for(var q in n)k[q]=n[q];n=k}q=e.properties;var v={};q&&q.forEach(function(e){v[e]=1;var c=b.getAttribute(e);c&&d.up(a,function(){pb("Bind prop %s to %s",e,c);n[e]=mb(a,c);d.Jc(a,h,c,function(a){n[e]=a})})});h.wu=1;for(q=b.firstChild;q;)k=q.nextSibling,h.appendChild(q),q=k;e.style&&this.Kb.bo(e.style);for(q=0;q<b.attributes.length;q++){var x=b.attributes[q].name;k=b.attributes[q].value;if(!v[x]&&0!==x.indexOf("z-"))if("class"===x)for(x=0,k=k.split(" ");x<k.length;x++)h.classList.add(k[x]);
else{if("style"===x){var w=h.getAttribute("style");w&&(k=w+";"+k)}h.setAttribute(x,k)}}pb("apply directives from parent");for(q=1;2>=q;q++)if(k=this.Uq(a,h,q,b),c&&k.Zo)return{scope:n,node:k.da};pb("apply directives from child");pb("done applying");if(e.controller)try{e.controller(n,new rb(this,n,h,"","")),this.digest()}catch(y){console.log(y),console.log("When running controller for %s",b.tagName)}this.Kc(n,h);return{scope:n,node:h}};c.prototype.Kc=function(a,b){var d=this;b=this.wq(a,b);this.digest(function(){d.oy(a)});
return b};c.prototype.wq=function(a,b){if(1===b.nodeType){if(b.ei)return{node:b,scope:a};b.ei=this.xu++;b.fi=a;for(var d=0;2>=d;d++){var e=this.Uq(a,b,d);if(e.Zo)return{node:e.da,scope:a};if(0===d&&(e=this.ev(a,b)))return e}for(d=b.firstChild;d;)e=d.nextSibling,d.wu||this.wq(a,d),d=e}return{node:b,scope:a}};return c}(),qb;
(function(c){function a(a,b,d){var e=b.type?b.type.toLowerCase():"",c=d;if("zwibblerValue"in b)var f="zwibblerValue";else f="value",c=""+c;if("radio"===e)b.checked=b[f]===c;else if("checkbox"===e)b.checked=!!d;else{if("SELECT"===b.tagName){e=0;for(var h=b.querySelectorAll("option");e<h.length;e++){var v=h[e],x=v.getAttribute("z-value");if(x&&mb(v.fi?v.fi:a,x)===d){v.selected=!0;return}}}else"DIV"===b.tagName&&"value"in a&&(a.value=c);b[f]=c}}function b(a,b){var d=b.type?b.type.toLowerCase():"";if("checkbox"===
d)return"zwibblerValue"in b?b.zwibblerValue:b.checked;if("radio"===d)(a=b.getAttribute("name"))&&(a=document.querySelector('input[name="'+a+'"]:checked'))&&(b=a);else if("SELECT"===b.tagName){d=0;for(var e=b.querySelectorAll("option");d<e.length;d++){var c=e[d];if(c.selected){var f=c.getAttribute("z-value");if(f)return mb(c.fi?c.fi:a,f)}}}else if("value"in a)return a.value;return"zwibblerValue"in b?b.zwibblerValue:b.value}function d(a,b,d,c,l){d&&(a["this"]=d);a.$event=c;return mb(a,b,l)}c.TB=a;c.gx=
b;c.tn=d;c.Vf=function(e){function c(a,b){var d=a.indexOf(b);return-1===d?"":a.substr(d+b.length+1)}var h=new sb;e&&(h.jk=e);h.Ib("init",function(a,b,e,c){d(a,c,b)});h.de("text",function(a,b){a.textContent=b});h.de("json",function(a,b){a.textContent=JSON.stringify(b)});h.de("html",function(a,b){a.innerHTML=b});h.Ib("model",function(d,e,c,f){function k(){l=b(d,e);pb("input -> model: New value for %s: %s",f,l);d.anjnwjewaq=l;mb(d,f+"=anjnwjewaq");delete d.anjnwjewaq;h.digest()}var l=null;"checkbox"===
e.type||"radio"===e.type?h.Xa(e,"change",k):h.Xa(e,"input",k);setTimeout(function(){var b=e.getAttribute("z-value");b&&(h.Jc(d,e,b,function(c){pb("z-value for %s[%s] is %s",e.tagName,b,c);e.zwibblerValue=c;a(d,e,l)}),h.ya(e,function(){delete e.zwibblerValue}));h.Jc(d,e,f,function(b){pb("model(%s) -> %s[%s] : new value is %s",f,e.tagName,e.type,b);l=b;a(d,e,b)})},0)});h.Ib("on",function(a,b,e,f){var k=c(e,"on");pb("Bind %s for %s",e,b.ei);""!==k&&h.Xa(b,k,function(e){pb("Got %s, execute %s",k,f);var c=
d(a,f,b,e);h.digest();e&&e.preventDefault&&!1===c&&e.preventDefault()})});var k={disabled:1,readonly:1};h.Ib("bind",function(a,b,d,e){var f=c(d,"bind").toLowerCase();""!==f&&h.Jc(a,b,e,function(a){f in k?a?b.setAttribute(f,"TRUE"):b.removeAttribute(f):b.setAttribute(f,a);"value"===f&&"SELECT"===b.tagName&&(b.value=a)})},1);h.Ib("for",function(a,b,d,e){d=e.indexOf(" in ");if(-1!==d){var c=e.substr(0,d),f=e.substr(d+4),k=[];pb("z-for '%s' in '%s'",c,f);var l=b.parentNode,n=b.nextSibling;b.parentNode.removeChild(b);
h.Jc(a,l,f,function(d){if("number"===typeof d){for(var e=[],q=0;q<d;q++)e.push(q);d=e}for(q=0;q<k.length;q++)e=k[q],e.parentNode&&e.parentNode.removeChild(e),h.detach(e);k.length=0;if("object"===typeof d&&"length"in d)for(q=0;q<d.length;q++){e=document.createComment("z-for "+f+"["+q+"] = "+d[q]);l.insertBefore(e,n);k.push(e);e=Object.create(a);e.$parent=a;e[c]=d[q];var x=b.cloneNode(!0);x.removeAttribute("z-for");l.insertBefore(x,n);e=h.Kc(e,x).node;k.push(e)}})}},0);h.Ib("if",function(a,b,d,e){var c=
document.createComment(d+" "+e),f=b.parentElement,k=null;f.replaceChild(c,b);h.Jc(a,f,e,function(e){e&&!k?(k=b.cloneNode(!0),k.removeAttribute(d),f.replaceChild(k,c),k=h.Kc(a,k).node):!e&&k&&(h.detach(k),f.replaceChild(c,k),k=null)});h.ya(f,function(){k?(h.detach(k),f.replaceChild(b,k)):c.parentNode&&f.replaceChild(b,c)})},0);h.de("class",function(a,b){for(var d in b)A(a).Pp(d,b[d])});h.de("style",function(a,b){for(var d in b)a.style[d]=b[d]});h.de("selected",function(a,b){A(a).Pp("selected",b)});
h.de("disabled",function(a,b){b?a.setAttribute("disabled","true"):a.removeAttribute("disabled")});h.de("enabled",function(a,b){b?a.removeAttribute("disabled"):a.setAttribute("disabled","true")});h.de("hide",function(a,b){a.style.display=b?"none":""});h.de("checked",function(a,b){a.checked=b?!0:!1});return h}})(qb||(qb={}));var tb=qb;var vb=function(){function c(){this.items=[];this.next=0;this.uf=!1;this.log=u.create("UNDOSTACK")}c.prototype.wa=function(a,b,d){void 0===b&&(b=!1);a=a instanceof ub?[a]:a;if(0!==a.length){this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].Ac(d);for(d=this.top();d;)if(d[d.length-1].tg(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.uf=!0;this.next=this.items.length}};c.prototype.Hc=function(a){this.log("Undo index %s of %s",
this.next,this.items.length);if(this.Fe()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].Hc(a);return this.uf=!0}return!1};c.prototype.ae=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.Ee()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].Ac(a);return this.uf=!0}return!1};c.prototype.Fe=function(){return 0<this.next};c.prototype.Ee=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.uf=
!1};c.prototype.top=function(){return this.items.length?this.items[this.items.length-1]:null};return c}(),ub=function(){function c(){}c.prototype.Ac=function(){};c.prototype.Hc=function(){};c.prototype.tg=function(){return!1};return c}();var wb=function(){function c(a){this.next=a}c.prototype.ku=function(a){for(var b=0;b<a.length;b++)this.rb(a.charCodeAt(b))};c.prototype.rb=function(a){this.next.rb(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.ph=function(){return this.next.ph()};return c}(),yb=function(){function c(){this.data="";this.log=u.create("BYTESTREAM")}c.prototype.ku=function(a){for(var b=0;b<a.length;b++)this.rb(a.charCodeAt(b))};c.prototype.ph=function(){return this};c.prototype.rb=function(a){if(255<
a||0>a)throw"Bad data written to byte buffer";this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.ac=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.rq=function(a,b){c.lq[a]=b};c.Vf=function(a){var b=new c;a=a.split(",");a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.lq[e](b))}return b};c.lq={};return c}();var zb=function(c){function a(a){a=c.call(this,a)||this;a.ni=0;a.total=0;a.size=0;a.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a}__extends(a,c);a.prototype.rb=function(a){this.ni=this.ni<<8|a;this.size+=8;for(this.total+=1;6<=this.size;)this.next.rb(this.keys.charCodeAt(this.ni>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var a=(3-this.total%3)%3;this.size&&(this.next.rb(this.keys.charCodeAt(this.ni>>this.size-6&63)),this.ni=this.size=0);for(;a--;)this.next.rb(61);
this.next.flush()};return a}(wb);yb.rq("Base64Encoder",function(c){return new zb(c)});var Ab=function(c){function a(a){a=c.call(this,a)||this;a.yg=0;a.we=0;a.Gs=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];a.log=u.create("BITWRITER");return a}__extends(a,c);a.prototype.rb=function(a){this.ju(a,8)};a.prototype.ju=function(a,d){this.yg=this.yg<<d|a&this.Gs[d];for(this.we+=d;8<=this.we;)this.next.rb(this.yg>>>this.we-8&255),this.we-=8,this.yg&=this.Gs[this.we]};a.prototype.flush=function(){this.we&&(this.next.rb(this.yg<<8-this.we),this.yg=this.we=0);this.next.flush()};return a}(wb);var Bb=function(c){function a(a){var b=c.call(this,a)||this;b.Ah=258;b.FB=0;b.Sg=0;b.first=!0;b.ri=[];b.Oo=[];b.Rm=[];b.NB=0;b.an=9;b.log=u.create("LZWEncoder");b.pv=new Ab(a);b.xq();return b}__extends(a,c);a.prototype.rb=function(a){if(this.first)this.Sg=a,this.first=!1;else{var b=this.Gu(this.Sg,a);void 0!==this.ri[b]?this.Sg=this.ri[b]:(this.bk(this.Sg),this.ri[b]=this.Ah,this.Oo[b]=this.Sg,this.Sg=this.Rm[b]=a,4095>this.Ah?(this.Ah+=1,this.an=Math.ceil(Math.log(this.Ah)/Math.log(2))):this.xq())}};
a.prototype.Gu=function(a,d){var b;var c=d<<4^a;for(b=0===c?1:18041-c;;){if(void 0===this.ri[c]||this.Oo[c]===a&&this.Rm[c]===d)return c;c-=b;0>c&&(c+=18041)}};a.prototype.xq=function(){this.bk(a.pu);this.Ah=258;this.an=9;this.ri.length=0;this.Oo.length=0;this.Rm.length=0};a.prototype.flush=function(){this.first||(this.bk(this.Sg),this.bk(a.tu))};a.prototype.bk=function(a){this.pv.ju(a,this.an)};a.pu=256;a.tu=257;return a}(wb);yb.rq("LZWEncoder",function(c){return new Bb(c)});function Cb(c,a,b){this.Qa=c;this.gm=a;this.fn=b;this.jm=0}
var Db=0,Eb=new (function(){function c(){this.Jb=[];this.Mp=!1;this.log=u.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.Jb.length);for(var b=0;b<this.Jb.length;b++)this.Jb[b].Qa.complete?this.Jb[b].fn(this.Jb[b].Qa,this.Jb[b].gm):5E3>this.Jb[b].jm?(this.Jb[b].jm+=250,a.push(this.Jb[b])):this.Jb[b].fn(this.Jb[b].Qa,this.Jb[b].gm);this.Jb=a;this.Jb.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.Mp=!1)};c.prototype.load=
function(a,b,d){var e=this;void 0===d&&(d=!1);if(0==Db)return this.Fq(a,b,d);setTimeout(function(){e.Fq(a,b,d)},Db)};c.prototype.Fq=function(a,b,d){function e(a){for(var b=0;b<c.Jb.length;b++){var d=c.Jb[b];if(d.Qa===a)return c.Jb.splice(b,1),d}return null}var c=this,h=document.createElement("img"),k=new Cb(h,a,b);this.Jb.push(k);var l=0<=a.indexOf("://"),n="://"+window.location.host,q=0!==a.indexOf("data:")&&l&&-1===a.indexOf(n);q&&!d&&(this.log("Using cross origin request for img"),h.crossOrigin=
"");h.addEventListener("load",function(){c.log("LoadFn called. complete=%s",h.complete);if(h.complete){var a=e(h);a&&b(h,a.gm)}else c.Mp||(c.Mp=!0,setTimeout(c.timeout,250),k.jm=250)},!1);h.addEventListener("error",function(){c.log("Error loading %s; useCors=%s disableCors=%s",a,q,d);e(h);!q||d?b(null,k.gm):c.load(a,b,!0)},!1);h.src=a;return h};c.prototype.Oz=function(a){Db=a};return c}());var Fb=function(){function c(){this.images={}}c.prototype.add=function(a,b){var d=this.images[a];d||(d={Qa:null,Wl:0},Eb.load(b,function(a){d.Qa=a}),this.images[a]=d);d.Wl+=1};c.prototype.release=function(a){var b=this.images[a];b&&(--b.Wl,0>=b.Wl&&delete this.images[a])};c.prototype.get=function(a){return(a=this.images[a])&&a.Qa?a.Qa:null};return c}();var Gb=function(){function c(a){this.code="en";this.data={};this.log=u.create("LANGUAGE");this.data=this.gt(a,{})}c.prototype.Nt=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.Nm=function(a){this.gt(a,this.data)};c.prototype.gt=function(a,b){a=a.split("\n");for(var d=/^([ \t]*)([^:]+):([^:]+):(.*)/,
e=0;e<a.length;e++){var c=d.exec(a[e]);if(c){var h=c[2],k=c[3];c=c[4];h in b||(b[h]={});k in b[h]&&this.log("Warning: Replacing %s:%s",h,k);b[h][k]=c}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.Cq(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.Cq(a,b)};c.prototype.Cq=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(a=0;a<b.length;a++)d=d.replace("^"+a,b[a]);return d};return c}();u.create("ANIM");var Hb=function(){function c(){this.af=0;this.fn=null}c.prototype.request=function(a,b){var d=this;this.fv=a;this.fn=b;0===this.af&&(this.af=window.requestAnimationFrame(function(a){d.af=0;d.fn&&d.fn(d.fv,a)}))};c.prototype.cancel=function(){0!==this.af&&(window.cancelAnimationFrame(this.af),this.af=0)};return c}();var Ib=function(){function c(){this.xi=[];this.log=u.create("DESTRUCTOR")}c.prototype.add=function(a){this.xi.push(a)};c.prototype.addEventListener=function(a,b,d,e){function c(b){a.addEventListener(b,d,e);h.add(function(){a.removeEventListener(b,d,e)})}var h=this;void 0===e&&(e=!1);var k=0;for(b=b.split(" ");k<b.length;k++)c(b[k])};c.prototype.pa=function(a,b,d){a.pa(b,d);this.add(function(){a.removeListener(b,d)})};c.prototype.Ta=function(){this.log("Running %s destructors",this.xi.length);for(var a=
this.xi.length-1;0<=a;a--)this.xi[a]();this.xi.length=0};return c}();var Jb=function(){function c(a,b,d){var e=this;void 0===d&&(d=!1);this.ta=a;this.bC=d;this.Ao=0;this.oo={};this.zb=!1;this.timeout=null;this.lines=[];this.filter=null;this.Gv="#5da700 #ed81ff #02ab34 #f92798 #59ff91 #ff6b80 #3cffe4 #ffd32b #5e8caa #ffdb7f #e5cdff #00c17e #f6f6f5 #9a861e #daff9d #808d40".split(" ");this.Hv="#2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #805221 #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.hh=[];var c=new Ya;c.bo('\n\n.z-inner-debug.black {\n    background: #000;\n    white-space: pre-wrap;\n}\n\n.z-inner-debug.white {\n    background: #fff;\n}\n\n.z-debug-panel {\n    font-family: "monospace";\n    font-size: 12px;\n    display: flex;\n    flex-flow: column nowrap;\n    text-align: left;\n}\n\n.z-inner-debug {\n    flex: 1 1 auto;\n    overflow: scroll;\n}\n\n.z-inner-debug.black div {\n    border-bottom: 1px solid #222;\n    margin-bottom: 3px;\n}\n\n.z-inner-debug.white div {\n    border-bottom: 1px solid #eee;\n    margin-bottom: 3px;\n}\n');
a.classList.add("z-debug-panel");var h=0;A("input").Cj({type:"text",placeholder:"regexp...",onclick:"this.select()"}).wd(a).addEventListener("input",function(a){h&&window.clearTimeout(h);h=setTimeout(function(){e.Tz(a.target.value);h=0},200)});this.Fd=A("div").Qd("z-inner-debug").wd(a).da;A("button").wd(this.ta).Va({flex:"0 0 auto"}).Nf("Scroll to bottom/top").addEventListener("click",function(){e.Fd.scrollTop=e.Yq()?0:e.Fd.scrollHeight});this.hy=u.addListener(function(a,b){return e.Pq(a,b)});b.add(function(){u.removeListener(e.hy);
c.Ta()});this.Pq("DEBUG","Debug window starting");A(this.Fd).Qd(d?"white":"black");this.hh=d?this.Hv:this.Gv}c.prototype.show=function(){this.ta.style.display="flex";this.zb=!0;this.uq();this.Fd.scrollTop=this.Fd.scrollHeight};c.prototype.Qe=function(){this.ta.style.display="none";this.zb=!1};c.prototype.Uw=function(a){a in this.oo||(this.oo[a]=this.hh[this.Ao],this.Ao=(this.Ao+1)%this.hh.length);return this.oo[a]};c.prototype.Pq=function(a,b){var d=this,e=0;for(b=b.split("\n");e<b.length;e++)this.lines.push({key:a,
line:b[e]});this.zb&&null===this.timeout&&(this.timeout=setTimeout(function(){d.timeout=null;d.uq()},100))};c.prototype.Tz=function(a){if(2>a.length)this.filter=null;else try{this.filter=new RegExp(a,"i")}catch(d){}for(a=this.Fd.firstChild;a;){var b=a;1===b.nodeType&&"DIV"===b.tagName&&(!this.filter||this.filter.exec(b.textContent)?b.style.display="block":b.style.display="none");a=a.nextSibling}};c.prototype.Yq=function(){return this.Fd.scrollTop>=this.Fd.scrollHeight-this.Fd.clientHeight};c.prototype.uq=
function(){for(var a=this.Yq(),b=0,d=this.lines;b<d.length;b++){var e=d[b],c=this.Uw(e.key),h=document.createElement("div");h.style.color=c;e=e.key+": "+e.line;this.filter&&!this.filter.exec(e)&&(h.style.display="none");h.appendChild(document.createTextNode(e));this.Fd.appendChild(h)}a&&(this.Fd.scrollTop=this.Fd.scrollHeight);this.lines.length=0};return c}();var Kb=u.create("EventEmitter"),Lb=function(){function c(){this.jj=!1;this.gb={};this.ke=[];this.Qk={}}c.prototype.sa=function(a){for(var b=this,d=1;d<arguments.length;d++);this.ke.push(Array.prototype.slice.apply(arguments));1===this.ke.length&&setTimeout(function(){for(var a=0;a<b.ke.length;a++)b.hn.apply(b,b.ke[a]);b.ke.length=0},0)};c.prototype.Pc=function(a){for(var b=1;b<arguments.length;b++);this.ke.push(Array.prototype.slice.apply(arguments));if(1===this.ke.length){for(b=0;b<this.ke.length;b++)this.hn.apply(this,
this.ke[b]);this.ke.length=0}};c.prototype.oh=function(a){for(var b=this,d=1;d<arguments.length;d++);d=Array.prototype.slice.apply(arguments);var e=d[0];e in this.Qk||setTimeout(function(){var a=b.Qk[e];delete b.Qk[e];b.hn.apply(b,a)},0);this.Qk[e]=d};c.prototype.hn=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(a in this.gb){d=this.gb[a];this.jj||Kb("Emit %s",a);for(var e=0;e<d.length;e++)d[e].apply(null,b)}};c.prototype.pa=function(a,b){this.gb||(this.gb={});var d=0;
for(a=a.split(" ");d<a.length;d++)this.bind(a[d],b)};c.prototype.once=function(a,b){function d(){e.du(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.gb?this.gb[a].push(b):this.gb[a]=[b];return b};c.prototype.removeListener=function(a,b){return this.du(a,b)};c.prototype.du=function(a,b){var d,e;if(a in this.gb){var c=this.gb[a];var h=d=0;for(e=c.length-1;d<=e;h=d+=1)if(c[h]===b){c.splice(h,1);break}0===c.length&&delete this.gb[a]}};c.prototype.oi=function(){this.gb=
{}};return c}();var Mb=function(c){function a(){var a=c.call(this)||this;a.keys={};a.jj=!0;a.tA=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(a,b){return b.length-a.length}).join("|"),"g");a.log=u.create("KEYMAP");a.hs=function(b){a.Px(b)};return a}__extends(a,c);a.prototype.map=function(a,d,e){void 0===e&&(e=!0);a=a.toLowerCase().split(",");var b;if("string"===typeof d)for(d=d.split(","),
b=0;b<a.length;b++)for(var c=0;c<d.length;c++)this.vq(a[b],d[c],!e);else for(b=0;b<a.length;b++)this.vq(a[b],d,!e)};a.prototype.MA=function(a,d){this.map(a,d,!1)};a.prototype.vq=function(a,d,e){if(0!==a.length){var b=a.match(this.tA)||[],c=!1,k=!1,l=!1,n=!1,q=[],v;for(v=0;v<b.length;v++)switch(b[v]){case "alt":l=!0;break;case "control":case "ctrl":k=!0;break;case "shift":c=!0;break;case "home":q.push(36);break;case "end":q.push(35);break;case "pageup":q.push(33);break;case "pagedown":q.push(34);break;
case "delete":case "del":q.push(46);break;case "backspace":q.push(8);break;case "up":q.push(38);break;case "right":q.push(39);break;case "down":q.push(40);break;case "left":q.push(37);break;case "escape":case "esc":q.push(27);break;case "enter":q.push(13);break;case "ins":case "insert":q.push(45);break;case "f4":q.push(115);break;case "meta":case "command":case "cmd":case "\u2318":n=!0;break;default:alert("key entry not found: "+b[v])}var x=this;b=function(a){c&&-1===a.indexOf("-shift")&&(a+="-shift");
k&&-1===a.indexOf("-control")&&(a+="-control");l&&-1===a.indexOf("-alt")&&(a+="-alt");n&&-1===a.indexOf("-meta")&&(a+="-meta");"string"===typeof d?x.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,d):x.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,"function()");if(e){if(a in x.keys){for(var b=[],f=0,h=x.keys[a];f<h.length;f++){var q=h[f];q!==d&&b.push(q)}x.keys[a]=b}}else if(a in x.keys){f=x.keys[a];for(b=0;b<f.length&&f[b]!==d;b++);b===f.length&&x.keys[a].push(d)}else x.keys[a]=[d]};if(0===
q.length)switch(a=a.toUpperCase().charAt(a.length-1),a){case "=":b("107-shift");b("187");b("61");break;case "+":b("107");b("61-shift");break;case "-":b("109");b("189");b("173");break;default:q.push(a.charCodeAt(0))}for(v=0;v<q.length;v++)b(""+q[v])}};a.prototype.sx=function(a){var b="";a.keyCode&&(b+=a.keyCode);a.shiftKey&&(b+="-shift");a.ctrlKey&&(b+="-control");a.altKey&&(b+="-alt");a.metaKey&&(b+="-meta");return b};a.prototype.translate=function(a){var b=[],e=this.sx(a);e in this.keys&&(b=this.keys[e]);
(32>a.keyCode||126<=a.keyCode)&&this.log("%s",e);return b};a.prototype.Px=function(a){for(var b=0,e=this.translate(a);b<e.length;b++){var c=e[b];"string"===typeof c?(this.log("action: %s",c),this.Pc("*",c,a)):c(a)}};a.prototype.Zq=function(a){var b;void 0===b&&(b=!1);a.addEventListener("keydown",this.hs,b)};a.prototype.detach=function(a,d){void 0===d&&(d=!1);a.removeEventListener("keydown",this.hs,d)};return a}(Lb);var Nb={1:"INITIAL CONNECTION",2:"APPEND",3:"SET-KEY",4:"BROADCAST",128:"ERROR",129:"ACK/NACK",130:"KEY-INFORMATION",131:"SET-KEY-ACK",255:"CONTINUATION"},Ob={0:"No",1:"Yes"},Sb={0:"NACK",1:"ACK"};function C(c,a,b,d){return{length:c,type:a,name:b,IB:d}}
var Tb={1:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(2,0,"protocolVersion"),C(4,0,"maxSize"),C(1,0,"creationMode",{0:"POSSIBLY_CREATE",1:"NEVER_CREATE",2:"ALWAYS_CREATE"}),C(8,0,"offset"),C(1,0,"docIDLength"),C(-1,1,"docID"),C(-2,1,"data")],2:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(8,0,"offset"),C(-2,1,"data")],3:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(2,0,"requestID"),C(1,0,"lifetime",{0:"CLIENT-LIFETIME",1:"SESSION-LIFETIME"}),C(4,0,"oldVersion"),C(4,0,"newVersion"),C(4,0,"nameLength"),
C(-1,1,"name"),C(4,0,"valueLength"),C(-1,1,"value")],4:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(4,0,"dataLength"),C(-1,1,"data")],128:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(2,0,"errorCode",{0:"UNSPECIFIED",1:"DOES_NOT_EXIST",2:"ALREADY_EXISTS",3:"INVALID_OFFSET"}),C(-2,1,"description")],129:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(2,0,"ack",Sb),C(8,0,"offset")],130:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(0,2,"keys"),C(4,0,"version"),C(4,0,"nameLength"),C(-1,1,"name"),C(4,0,"valueLength"),
C(-1,1,"value")],131:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(2,0,"ack",Sb),C(2,0,"requestID")],255:[C(1,0,"messageType",Nb),C(1,0,"more",Ob),C(-2,1,"data")]};
function Ub(c){var a=Tb[c.messageType];if(!a)throw Error("no encoder for message type "+c.messageType);for(var b=[],d=0;d<a.length;d++){var e=a[d];if(!(e.name in c))throw Error("missing field "+e.name);var f=c[e.name];if(0===e.type){var h=b;e=e.length;do--e,h.push(Math.floor(f/Math.pow(2,8*e)%256));while(0<e)}else if(f instanceof Uint8Array)for(h=0;h<f.length;h++)b.push(f[h]);else for(h=b,f=Qa(f),e=0;e<f.length;e++)h.push(f[e])}return new Uint8Array(b)}
function Vb(c){var a=Tb[c[0]];if(!a)return null;for(var b={},d=b,e=0,f=0,h="",k=0,l=0;l<a.length;l++){var n=a[l],q;if(2===n.type)h=n.name,b={},d[h]=[b],k=l;else{if(0===n.type){e=f;var v=n.length;for(q=0;v;)q=256*q+c[e],--v,e+=1;q=e=q;f+=n.length}else{v=e;-2===n.length&&(v=c.length-f,b[n.name+"_length"]=v);q=v;void 0===q&&(q=c.length-f);q=Wb(c,f,f+q);for(var x="",w=0;w<q.length;w++){var y=q[w];if(0===(y&128))x+=String.fromCharCode(y);else if(192===(y&224)){var B=q[++w]&63;x+=String.fromCharCode((y&
31)<<6|B)}else if(224===(y&240)){B=q[++w]&63;var E=q[++w]&63;x+=String.fromCharCode((y&31)<<12|B<<6|E)}else if(240===(y&248)){B=q[++w]&63;E=q[++w]&63;var L=q[++w]&63;y=(y&7)<<18|B<<12|E<<6|L;65535<y&&(y-=65536,x+=String.fromCharCode(y>>>10&1023|55296),y=56320|y&1023);x+=String.fromCharCode(y)}}q=x;f+=v}b[n.name]=q;f<c.length&&l+1==a.length&&h.length&&(b={},d[h].push(b),l=k)}}return d}function Wb(c,a,b){return c.slice?c.slice(a,b):new Uint8Array(Array.prototype.slice.call(c,a,b))}
var Xb=function(c){function a(a,d){var b=c.call(this)||this;b.bc=a;b.El=d;a.binaryType="arraybuffer";a.onopen=function(){b.sa({type:"open"})};a.onerror=function(){b.sa({type:"error"});a.onerror=a.onclose=null};a.onclose=function(){b.sa({type:"close"});a.onerror=a.onclose=null};a.onmessage=function(a){b.sa({type:"message",message:new Uint8Array(a.data)})};return b}__extends(a,c);a.prototype.close=function(){this.bc.close()};a.prototype.read=function(){return __awaiter(this,void 0,void 0,function(){var a,
d,e,c,h;return __generator(this,function(b){switch(b.label){case 0:a=[],b.label=1;case 1:return[4,this.Ls()];case 2:d=b.sent();if("message"!==d.type||0===a.length&&!d.message[1])return[2,d];e=0;c=d.message;a.length&&(e=2);for(h=e;h<c.length;h++)a.push(c[h]);return d.message[1]?[3,1]:[2,{type:"message",message:new Uint8Array(a)}];case 3:return[2]}})})};a.prototype.send=function(a){var b=this.bc,e=0,c=a.length;c>this.El&&(c=this.El,a[1]=1);b.send(Wb(a,e,e+c));for(e+=c;e<a.length;){c=a.length-e;c>this.El-
2&&(c=this.El-2);var h={messageType:255,more:e+c<a.length?1:0,data:Wb(a,e,e+c)};b.send(Ub(h));e+=c}};return a}(function(){function c(){this.fq=[];this.gb=[]}c.prototype.Ls=function(){var a=this;return(new Promise(function(b){a.gb.length?b(a.gb.shift()):a.fq.push(b)})).then(null,function(a){throw a;})};c.prototype.sa=function(a){this.fq.length?this.fq.shift()(a):this.gb.push(a)};return c}()),Yb=function(){function c(){var a=this;this.timeout=0;this.Io=function(){a.cancel();a.resolve&&(a.resolve(),
a.resolve=null)};this.resolve=null}c.prototype.wait=function(a){var b=this;return new Promise(function(d){b.resolve=d;b.timeout=setTimeout(function(){return b.Io()},a);window.addEventListener("online",b.Io)})};c.prototype.cancel=function(){clearTimeout(this.timeout);window.removeEventListener("online",this.Io)};return c}(),Zb=function(c){function a(a,d,e){var b=c.call(this)||this;b.ra=a;b.Kz=d;b.latency=e;b.log=u.create("Sharing");b.keys={};b.ss="";b.bt=function(){b.ag()};b.Ol=function(){};b.Rg=!1;
b.connected=!1;b.bc=null;b.xc=0;b.om=!1;b.bd="";b.Qo=[];b.uj=[];b.$l=[];b.Cy=1;b.aj=0;return b}__extends(a,c);a.prototype.Yz=function(a){this.latency=a};a.prototype.start=function(a,d){var b=this;return new Promise(function(e,c){b.log("Start shared session: createMode=%s",d);b.Ol=e;b.ra.pa("local-changes",b.bt);if(1===d)b.kr(a,d,"").then(null,c);else{e=b.ra.Qn();if(""===e)throw Error("getLocalChanges() returned null on first batch");b.ss=e;b.kr(a,d,e).then(null,c)}})};a.prototype.stop=function(){this.log("stop() -- shut down session");
this.Rg=!1;this.bc&&this.bc.close();this.ra.removeListener("local-changes",this.bt);this.aj&&clearTimeout(this.aj)};a.prototype.ip=function(a){this.Qo.push(a);this.ag()};a.prototype.Xz=function(a,d,e){d=JSON.stringify(d);for(var b=null,c=0,k=this.uj;c<k.length;c++){var l=k[c];l.name===a&&(b=l)}c=0;k=1;a in this.keys&&(c=this.keys[a].version,k=c+1);e||(k=c=0);b?b.value=d:(b={name:a,value:d,oldVersion:c,newVersion:k,fz:e,af:this.Cy++},this.uj.push(b));this.ag()};a.prototype.kr=function(a,d,e){return __awaiter(this,
void 0,void 0,function(){var b,c,k;return __generator(this,function(f){switch(f.label){case 0:this.Rg=!0,b=0,f.label=1;case 1:if(!this.Rg)return[3,10];this.connected=!1;if(!b)return[3,3];this.log("Waiting %sms before reconnecting",b);c=new Yb;return[4,c.wait(b)];case 2:f.sent(),f.label=3;case 3:return b=Math.max(Math.min(2*b,3E5),1E3),[4,this.connect()];case 4:return f.sent()?[4,this.Ux(a,d,e)]:[3,1];case 5:if(!f.sent())return[3,1];this.Ol&&(this.Ol(),this.Ol=function(){});this.sa("connected");d=
1;this.bd=this.ss=e="";this.connected=!0;this.ag();f.label=6;case 6:return f.trys.push([6,8,,9]),[4,this.dv()];case 7:return f.sent(),[3,9];case 8:return k=f.sent(),this.log("Synchronization error: "+k.message),console.log("Synchronization error: ",k),[3,9];case 9:return this.connected=!1,b=0,this.sa("connect-error"),[3,1];case 10:return[2]}})})};a.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(b){switch(b.label){case 0:return a=
this.Kz,this.bc&&this.bc.close(),this.bc=d=new Xb(new WebSocket(a),102400),this.log("Connect to %s; wait for event",a),[4,d.Ls()];case 1:e=b.sent();if("open"!==e.type)return this.log("Received unexpected event: %s",e.type),[2,!1];this.log("Connected to %s",a);return[2,!0]}})})};a.prototype.Ux=function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:this.log("Send INIT message docLen=%s changes=%s",this.xc,e.toString().length);
if(!this.bc)throw Error("ws is null");try{this.bc.send(Ub({messageType:1,more:0,maxSize:102400,protocolVersion:2,creationMode:d,offset:this.xc,docIDLength:a.length,docID:a,data:e}))}catch(l){throw console.log("Got error ",l),l;}return[4,this.bc.read()];case 1:b=f.sent();if("message"!=b.type)return this.log("Expected message; got "+b.type),[2,!1];c=Vb(b.message);if(128===c.messageType)throw this.log("Got error response: %s",c.description),Error(c.description);2===c.messageType&&(0<c.offset&&e.length&&
this.ra.ej(e),this.log("Got initial changes at offset %s=>%s",c.offset,c.offset+c.data_length),(c.data.length||0===c.offset)&&this.ra.Zf(c.data,0===c.offset),0===c.offset&&(this.bd=""),this.xc=c.offset+c.data_length);this.log("Connected and initialized.");return[2,!0]}})})};a.prototype.cA=function(a){(this.om=a)||this.ag()};a.prototype.ag=function(){var a=this;this.log("Check changes; changesSent=%s; paused=%s",this.bd,this.om);this.aj||this.om||(this.aj=setTimeout(function(){var b;a.aj=0;a.log("inner checkChanges: connected=%s ws=%s",
!!a.connected,!!a.bc);if(a.connected&&a.bc){""===a.bd&&(a.bd=a.ra.Qn(),a.log("getLocalChanges: %s",a.bd),a.bd&&(a.log("Sent changes %s->%s",a.xc,a.xc+a.bd.length),a.bc.send(Ub({messageType:2,offset:a.xc,more:0,data:a.bd}))));for(var e=0,c=a.Qo;e<c.length;e++){var h=c[e];a.bc.send(Ub({messageType:4,more:0,dataLength:h.length,data:h}))}e=a.Qo.length=0;for(c=a.uj;e<c.length;e++)h=c[e],a.bc.send(Ub({messageType:3,more:0,requestID:h.af,lifetime:h.fz?1:0,oldVersion:h.oldVersion,newVersion:h.newVersion,
nameLength:h.name.length,name:h.name,valueLength:h.value.length,value:h.value}));(b=a.$l).push.apply(b,a.uj);a.uj.length=0}},this.latency))};a.prototype.dv=function(){return __awaiter(this,void 0,void 0,function(){var a,d,e,c,h,k,l,n;return __generator(this,function(b){switch(b.label){case 0:return[4,this.bc.read()];case 1:a=b.sent();if("message"!==a.type)return this.log("Expected message; got "+a.type),[2];d=Vb(a.message);if(2===d.messageType){if(this.xc!==d.offset)throw Error("Error: docLength ="+
this.xc+" but got offset "+d.offset);this.ra.Zf(d.data,!1);this.log("From server: APPEND "+this.xc+"->"+(this.xc+d.data_length));this.xc+=d.data_length;this.ag()}else if(129===d.messageType)d.ack?(this.log("Received ACK "+this.xc+"=>"+d.offset),this.ra.ej(this.bd),this.bd="",this.xc=d.offset):(this.log("Received NACK "+this.xc+"!="+d.offset+" "+this.bd.substr(0,22)),this.bd="",this.ag());else if(4===d.messageType)this.sa("broadcast",d.data);else if(130===d.messageType){e=[];c=0;for(h=d.keys;c<h.length;c++)k=
h[c],k.value=""===k.value?null:JSON.parse(k.value),l={name:k.name,value:k.value,version:k.version},e.push(k),null===l.value?delete this.keys[l.name]:this.keys[l.name]=l;this.sa("set-keys",e)}else if(131===d.messageType)for(n=0;n<this.$l.length;n++){if(k=this.$l[n],k.af===d.requestID){this.log("key %s ACKED:%s",k.name,d.ack);d.ack&&(this.keys[k.name]={name:k.name,value:k.value,version:k.newVersion});this.$l.splice(n,1);break}}else throw Error("Unexpected message type "+d.messageType);b.label=2;case 2:return[3,
0];case 3:return[2]}})})};return a}(Lb);function $b(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)}function ac(c,a){var b;var d={};a=c.indexOf(a||"?");0<=a&&(c=c.substr(a+1));a=c.indexOf("#");0<=a&&(c=c.substr(0,a));c=c.split("&");a=0;for(b=c.length;a<b;a++){var e=c[a];var f=e.split("=");e=$b(f[0]);"/"==e[0]&&-1===e.indexOf(".")&&(e=e.substr(1));f=1<f.length?$b(f[1]):"";e.length&&(d[e]=f)}return d}function bc(){if(void 0===c)var c=window.location.hash;return ac(c,"#")};var cc=u.create("CONFIG"),dc=function(c){function a(a,d,e){var b=c.call(this)||this;b.Fi={};for(var h in d)b.Fi[h.toLowerCase()]=h;b.options=JSON.parse(JSON.stringify(d));for(var k in e)k.toLowerCase()in b.Fi||alert("Zwibbler: Unknown option '"+k+"'"),b.set(k,e[k],!0);a.addEventListener(window,"hashchange",function(){cc("Reload parameters from url hash");b.so()});a.add(function(){b.gb={}});b.so();for(var l in b.options)cc("%s=%s",l,b.options[l]);return b}__extends(a,c);a.prototype.so=function(){var a=
bc(),d;for(d in a)this.set(d,a[d])};a.prototype.has=function(a){return a.toLowerCase()in this.Fi};a.prototype.set=function(a,d,e){void 0===e&&(e=!1);a.toLowerCase()in this.Fi&&(a=this.Fi[a.toLowerCase()]);if(a=this.Kr(a,d))cc("Set config %s=%s",a.name,a.value),a.name in this.options?(d=this.options[a.name],this.options[a.name]=a.value,e||(this.Pc("update",a.name,a.value,d),this.Pc(a.name,a.value,!1))):console.warn("Warning: %s is not a configuration option.",a.name)};a.prototype.Kr=function(a,d){if("string"===
typeof d&&"number"===typeof this.options[a]&&(d=parseFloat(d),isNaN(d))){console.log(Error("Config option "+a+" expects a number"));return}return{name:a,value:d}};a.prototype.pa=function(a,d){if("update"!==a&&!(a in this.options))throw Error(a+" is not a valid config setting.");"update"!==a&&d(this.options[a],!0,null);return c.prototype.pa.call(this,a,d)};a.prototype.get=function(a){if(!(a in this.options))throw Error(a+" is not a valid config setting.");return this.options[a]};return a}(Lb);u.create("ColourPanel");
var fc={style:"\n.zwibbler-colour-panel {\n    overflow:hidden;\n    border-top: 1px solid black;\n    white-space: nowrap;\n    font-size: 0;\n}\n\n.zwibbler-colour-panel div { \n    display: inline-block;\n}",ul:'<div class="zwibbler-colour-panel" z-style="{height:ColourPanelWidth()+\'px\'}">\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'clear\'}"\n        z-on:click="setColour(\'rgba(0,0,0,0.0)\', true)"\n        z-on:contextmenu="setColour(\'rgba(0,0,0,0.0)\', false)">\n    </canvas>\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'transparent\'}"\n        z-on:click="setOpacity(0.5, true)"\n        z-on:contextmenu="setOpacity(0.5, false)">\n    </canvas>\n    <div z-for="colour in ColourPanelColours"\n        z-style="{width: ColourPanelWidth()+\'px\', height: ColourPanelWidth()+\'px\', background: colour}"\n        z-on:click="setColour(colour, true)"\n        z-on:contextmenu="setColour(colour, false)">\n    </div>\n</div>\n',controller:function(c){var a=
ec(),b=c.ra||c;a.shift();a.shift();c.ColourPanelColours=a;c.ColourPanelWidth=function(){return b.kd("useTouch")?40:20}}};function ec(){function c(b){for(var d=30;100>d;d+=20)b.values[2]=d/100,a.push(b.toString())}var a="rgba(0,0,0,0.0) rgba(0,0,0,0.5) #000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");c(new r(r.Ug,[0,0,0,1]));for(var b=0;720>b;b+=35){var d=new r(r.Ug,[b,.5,0,1]);c(d)}return a};var gc=u.create("MouseTrails"),hc=function(){function c(a){var b=this;this.ra=a;this.Te=[];this.Jg=!1;this.label=this.Ic="";this.enabled=!1;this.hh="#ff0000 #00ff00 #0000ff #ff00ff #805221 #2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.listener=function(a){b.ra.Re(a.pageX,a.pageY)?b.move(b.Ic,1,a.pageX,a.pageY,""):b.move(b.Ic,0,a.pageX,a.pageY,"")};this.ey=function(a){for(var d=0;d<a.length;d++){var c=a[d];if(c.name.startsWith("pointer."))if(null===
c.value||"delete"===c.value)b.rr(c.name.substr(8));else if(1===c.value.rel){var h=b.ra.ds(c.value.x,c.value.y);b.ra.Re(h.x,h.y)?b.move(c.value.id,1,h.x,h.y,c.value.label):b.move(c.value.id,-1,h.x,h.y,c.value.label)}else b.move(c.value.id,0,c.value.x,c.value.y,c.value.label)}};a.pa("set-keys",this.ey);this.Cr="onpointerdown"in window?"pointermove":"mousemove";a.pa("destroy",function(){b.Lt(!1,b.Ic);for(var a=0,e=b.Te;a<e.length;a++){var c=e[a];c.da.parentNode&&c.da.parentNode.removeChild(c.da)}})}
c.prototype.Lt=function(a,b){this.Ic=b;(a=!1!==a)&&!this.enabled?document.addEventListener(this.Cr,this.listener,!0):!a&&this.enabled&&(document.removeEventListener(this.Cr,this.listener,!0),this.ra.tp("pointer."+this.Ic,"delete",!1),this.rr(this.Ic));if(this.enabled=a)a=this.ra.kd("broadcastMouse"),this.label="string"!==typeof a?"":a,gc("Label now %s",this.label)};c.prototype.rr=function(a){for(var b=0;b<this.Te.length;b++)if(this.Te[b].Ic===a){a=this.Te[b];a.da.parentNode&&a.da.parentNode.removeChild(a.da);
a.label&&a.label.parentNode&&a.label.parentNode.removeChild(a.label);this.Te.splice(b,1);break}};c.prototype.Tw=function(){return this.hh[this.Te.length%this.hh.length]};c.prototype.move=function(a,b,d,e,c){for(var f=this,k=null,l=0,n=this.Te;l<n.length;l++){var q=n[l];if(q.Ic==a){k=q;break}}k?(k.xo=!0,k.rel=b,k.x=d,k.y=e,k.text!==c&&(k.label.innerText=c,k.text=c,gc("Marker text changed to %s",c))):(l=this.Tw(),k=document.createElement("div"),k.style.width="40px",k.style.height="40px",k.style.background=
"radial-gradient("+l+", transparent 50%)",k.style.position="absolute",k.style.pointerEvents="none",l=document.createElement("div"),l.style.background="rgba(255,255,255,0.5)",l.style.fontFamily="sans-serif",l.style.fontSize="10px",l.style.position="absolute",l.style.opacity="0.5",l.style.pointerEvents="none",l.innerText=c,document.body.appendChild(k),document.body.appendChild(l),k={Ic:a,rel:b,x:d,y:e,xo:!0,da:k,label:l,text:c},this.Te.push(k));this.Jg||(this.Jg=!0,requestAnimationFrame(function(){f.Jg=
!1;for(var a=0,b=f.Te;a<b.length;a++){var d=b[a];if(d.xo){var e=d.x-d.da.offsetWidth/2,c=d.y-d.da.offsetHeight/2;d.da.style.display=-1===d.rel||e>document.documentElement.scrollWidth||c>document.documentElement.scrollHeight?"none":"block";d.da.style.left=e+"px";d.da.style.top=c+"px";e=d.x-d.label.offsetWidth/2;c=d.y-20;d.label.style.left=e+"px";d.label.style.top=c+"px";d.xo=!1;d.Ic===f.Ic&&(e=0,f.ra.Re(d.x,d.y)&&(d=f.ra.Zk(d.x,d.y),e=1),f.ra.tp("pointer."+f.Ic,{rel:e,x:d.x,y:d.y,id:f.Ic,label:f.label},
!1))}}}))};return c}();var ic=u.create("MISC");function jc(c){var a=document.createElement("canvas");c&&c.appendChild(a);a.style.background="transparent";return a}function kc(){return 0<=navigator.userAgent.search("Safari")&&0>navigator.userAgent.search("Chrome")}function lc(c,a){c=r.me(c);c.values[3]=a;return c.toString()}function mc(c){var a=A.nl(),b=A(c).Yb();b.left=Math.min(b.left,a.x+a.width-c.offsetWidth);b.top=Math.min(b.top,a.y+a.height-c.offsetHeight);A(c).em(b)}
function nc(c){var a=c.getContext("2d");if(null===a)return"error";var b=a.getImageData(0,0,c.width,c.height);c=b.width;var d=b.height;a=c*d*3;var e=a+54,f=[66,77,e&255,e>>8&255,e>>16&255,e>>24&255,0,0,0,0,54,0,0,0],h=[40,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,d&255,d>>8&255,d>>16&255,d>>24&255,1,0,24,0,0,0,0,0,a&255,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];a=(4-3*c%4)%4;b=b.data;e=c<<2;for(var k=yb.Vf("Base64Encoder"),l=0;l<f.length;l++)k.rb(f[l]);for(l=0;l<h.length;l++)k.rb(h[l]);
do{f=e*(d-1);for(h=0;h<c;h++)l=h<<2,k.rb(b[f+l+2]),k.rb(b[f+l+1]),k.rb(b[f+l]);for(f=0;f<a;f++)k.rb(0)}while(--d);k.flush();return"data:image/bmp;base64,"+k.ph().toString()}
function oc(c,a){"erase"===a?c.Pd?(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.strokeStyle=c.Pd,c.lineWidth+=2,c.stroke(),--c.lineWidth):(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())}
function pc(){for(var c=0;c<arguments.length;c++);c=arguments[0];for(var a=1;a<arguments.length;a++){var b=arguments[a],d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d])}return c}function qc(c,a){"string"===typeof a&&"number"===typeof c&&(a=parseFloat(a));return a};u.create("Graphics",!0);
var D=function(){function c(a,b){this.x=a;this.y=b}c.prototype.Wb=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.hd=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.Ip=function(a){return new c(this.x-a.x,this.y-a.y)};c.prototype.tr=function(a,b){var d=a.x,e=a.y,c=this.x,h=this.y,k=b.x-d;b=b.y-e;var l=k*k+b*b;if(0===l)return this.Wb(a);
a=((c-d)*k+(h-e)*b)/l;1<a?a=1:0>a&&(a=0);d=d+a*k-c;e=e+a*b-h;return Math.sqrt(d*d+e*e)};return c}(),rc=function(){function c(a,b){this.width=a;this.height=b}c.prototype.FA=function(){return new F(0,0,this.width,this.height)};return c}();function G(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function sc(c,a,b,d){var e=G(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}function tc(c){c.x*=-1;c.y*=-1;return c}
var F=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.wt()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.$h=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,f=a[0].y,h=1;h<a.length;h++)a[h].x<b&&(b=a[h].x),a[h].x>d&&(d=a[h].x),a[h].y<e&&(e=a[h].y),a[h].y>f&&(f=a[h].y);return new c(b,e,d-b,f-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.hd=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.Uh=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.Wp=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&
(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>a.y+a.height};c.prototype.Wy=function(a){return this.x>a.x+a.width||a.x>this.x+this.width||this.y>a.y+a.height||a.y>this.y+this.height?!1:!0};c.prototype.ji=function(){return this.width*this.height};c.prototype.et=function(a){return this.Wy(a)?(Math.min(this.right(),a.right())-
Math.max(this.x,a.x))*(Math.min(this.bottom(),a.bottom())-Math.max(this.y,a.y)):0};c.prototype.cd=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.wt=function(){0>this.width&&(this.x+=this.width,this.width=-this.width);0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.Ed=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,
this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.Sd=function(){return new D(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=
function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};return c}(),I=function(){function c(){this.log=u.create("MATRIX");if(0===arguments.length)this.m11=1,this.m21=this.m12=0,this.m22=1,this.Fa=this.Ea=0;else if(1===arguments.length)if("string"===typeof arguments[0]){var a=arguments[0].match(/-?\d+\.?[\de\-]*/g);if(!a||6!=a.length)throw Error("Bad initializer for matrix: "+arguments[0]);this.m11=parseFloat(a[0]);this.m21=parseFloat(a[1]);this.m12=parseFloat(a[2]);
this.m22=parseFloat(a[3]);this.Ea=parseFloat(a[4]);this.Fa=parseFloat(a[5])}else{if(6!==arguments[0].length)throw"Bad array initializer for Matrix.";this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Ea=arguments[0][4];this.Fa=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Ea=arguments[4],this.Fa=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+
this.Ea+"    "+this.m21+" "+this.m22+" "+this.Fa+"    0 0 1 ]"};c.prototype.ac=function(){return[this.m11,this.m12,this.m21,this.m22,this.Ea,this.Fa]};c.prototype.xs=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Ea&&0===this.Fa};c.prototype.hd=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Ea===a.Ea&&this.Fa===a.Fa};c.prototype.multiply=function(a){var b=new c;b.m11=this.m11*a.m11+this.m12*a.m21;b.m21=this.m21*a.m11+
this.m22*a.m21;b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=this.m21*a.m12+this.m22*a.m22;b.Ea=this.m11*a.Ea+this.m12*a.Fa+this.Ea;b.Fa=this.m21*a.Ea+this.m22*a.Fa+this.Fa;if(!b.isFinite())throw Error("Multiplied matrix has NaN values: "+this.Rf());return b};c.prototype.isFinite=function(){function a(a){return isFinite(a)&&"number"===typeof a}return a(this.m11)||a(this.m12)||a(this.m21)||a(this.m22)||a(this.Ea)||a(this.Fa)};c.prototype.apply=function(a,b){return new D(this.m11*a+this.m12*b+this.Ea,this.m21*
a+this.m22*b+this.Fa)};c.prototype.jf=function(a){var b;void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,this.m12,this.m22,this.Ea,this.Fa):a.transform(this.m11,this.m21,this.m12,this.m22,this.Ea,this.Fa)};c.prototype.clone=function(){return new c(this.m11,this.m12,this.m21,this.m22,this.Ea,this.Fa)};c.prototype.inverse=function(){var a=this.m11*this.m22-this.m12*this.m21;return new c(this.m22/a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Fa-this.Ea*this.m22)/a,(this.Ea*this.m21-this.m11*
this.Fa)/a)};c.prototype.mm=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,f=Math.sqrt(a*a+b*b),h=Math.sqrt(d*d+e*e);return new c(a/f,d/h,b/f,e/h,this.Ea,this.Fa)};c.prototype.sb=function(){return new D(Math.sqrt(this.m11*this.m11+this.m21*this.m21),Math.sqrt(this.m12*this.m12+this.m22*this.m22))};c.prototype.ys=function(){return 1===this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new uc(a,b))};c.prototype.rotate=function(a,
b,d){return this.multiply(new vc(a,b,d))};c.prototype.Rf=function(){return"matrix("+this.m11+", "+this.m21+", "+this.m12+", "+this.m22+", "+this.Ea+", "+this.Fa+")"};c.prototype.toJSON=function(){if(!this.isFinite())throw Error("Tried to encode matrix with NaN/Inf values: "+this.Rf());return this.Rf()};return c}(),vc=function(c){function a(a,d,e){var b=Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}__extends(a,c);return a}(I),uc=function(c){function a(a,d){return c.call(this,
1,0,0,1,a,d)||this}__extends(a,c);return a}(I),wc=function(c){function a(a,d,e,f){return void 0===e||void 0===f?c.call(this,a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,f-d*f)||this}__extends(a,c);return a}(I),xc=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}__extends(a,c);return a}(I);
function yc(c,a,b,d,e,f,h,k,l,n){if(!(8<++yc.depth)){var q=(a+d)/2,v=(b+e)/2,x=(d+f)/2,w=(e+h)/2,y=(f+k)/2,B=(h+l)/2,E=(q+x)/2,L=(v+w)/2;x=(x+y)/2;w=(w+B)/2;var H=(E+x)/2,z=(L+w)/2,K=k-a,W=l-b;d=Math.abs((d-k)*W-(e-l)*K);f=Math.abs((f-k)*W-(h-l)*K);(d+f)*(d+f)<n*(K*K+W*W)?c.push(new D(H,z)):(yc(c,a,b,q,v,E,L,H,z,n),yc(c,H,z,x,w,y,B,k,l,n))}--yc.depth}(yc||(yc={})).depth=0;
function zc(c,a,b,d,e,f,h,k){if(!(8<++yc.depth)){var l=(a+d)/2,n=(b+e)/2,q=(d+f)/2,v=(e+h)/2,x=(l+q)/2,w=(n+v)/2,y=f-a,B=h-b;d=Math.abs((d-f)*B-(e-h)*y);d*d<=k*(y*y+B*B)?c.push(new D(x,w)):(zc(c,a,b,l,n,x,w,k),zc(c,x,w,q,v,f,h,k))}--yc.depth}
function Ac(c,a,b){var d,e=!1,f=c.length;1<f&&c[f-1].x===c[0].x&&c[f-1].y===c[0].y&&--f;if(3>f)return!1;var h=c[f-1].x;var k=c[f-1].y;for(d=0;d<f;d++){var l=c[d].x;var n=c[d].y;if(l>h){var q=h;var v=l;var x=k;k=n}else q=l,v=h,x=n;l<a===a<=h&&(b-x)*(v-q)<(k-x)*(a-q)&&(e=!e);h=l;k=n}return e}function Bc(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var f=c[e-1].x,h=c[e-1].y,k=c[e].x-f,l=c[e].y-h,n=((a-f)*k+(b-h)*l)/(k*k+l*l);1<n?n=1:0>n&&(n=0);f=f+n*k-a;h=h+n*l-b;if(f*f+h*h<=d)return!0}return!1}
(function(){function c(a){this.image=a}c.prototype.clear=function(){for(var a=0;a<this.image.width*this.image.height*4;a++)this.image.data[a]=0};c.prototype.getImageData=function(){return this.image};c.prototype.width=function(){return this.image.width};c.prototype.height=function(){return this.image.height};c.prototype.get=function(a,b){a=this.image.width*b*4+4*a;return this.image.data[a]|this.image.data[a+1]<<8|this.image.data[a+2]<<16|this.image.data[a+3]<<24};c.prototype.set=function(a,b,d){a=
this.image.width*b*4+4*a;this.image.data[a]=d&255;this.image.data[a+1]=d>>8&255;this.image.data[a+2]=d>>16&255;this.image.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.bh=a;this.Yj=b;this.data=[]}c.prototype.width=function(){return this.bh};c.prototype.height=function(){return this.Yj};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.bh;a.height=this.Yj;a=a.getContext("2d").getImageData(0,0,this.bh,this.Yj);for(var b=this.bh*this.Yj,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.bh*b+a]};c.prototype.set=function(a,b,d){this.data[this.bh*b+a]=d};return c})();
var Cc=function(){function c(a){this.closed=!1;this.fa=[];a instanceof F&&(this.moveTo(a.x,a.y),this.lineTo(a.x+a.width,a.y),this.lineTo(a.x+a.width,a.y+a.height),this.lineTo(a.x,a.y+a.height),this.lineTo(a.x,a.y),this.closePath())}c.prototype.clear=function(){this.closed=!1;this.fa=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(){};c.prototype.moveTo=function(a,b){this.fa.push(c.Yc,a,b)};c.prototype.lineTo=function(a,b){this.fa.push(c.Xc,a,b)};c.prototype.bezierCurveTo=function(a,
b,d,e,f,h){this.fa.push(c.lf,a,b,d,e,f,h)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.fa.push(c.nf,a,b,d,e)};c.prototype.arc=function(){};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.fa.push(c.Wc)};c.prototype.la=function(a){for(var b=0;b<this.fa.length;){switch(this.fa[b]){case c.Yc:a.moveTo&&a.moveTo(this.fa[b+1],this.fa[b+2]);break;case c.Xc:a.lineTo&&a.lineTo(this.fa[b+1],this.fa[b+2]);break;case c.lf:a.bezierCurveTo&&a.bezierCurveTo(this.fa[b+1],this.fa[b+2],
this.fa[b+3],this.fa[b+4],this.fa[b+5],this.fa[b+6]);break;case c.nf:a.quadraticCurveTo&&a.quadraticCurveTo(this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4]);break;case c.Wc:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.$c[this.fa[b]]}};c.prototype.yz=function(){for(var a=0,b=0,d=0,e=[];a<this.fa.length;){switch(this.fa[a]){case c.Wc:e.push([c.Wc]);break;case c.Yc:b=this.fa[a+1];d=this.fa[a+2];break;case c.Xc:e.push([c.Xc,b,d]);b=this.fa[a+1];d=this.fa[a+2];break;case c.lf:e.push([c.lf,
this.fa[a+3],this.fa[a+4],this.fa[a+1],this.fa[a+2],b,d]);b=this.fa[a+5];d=this.fa[a+6];break;case c.nf:e.push([c.nf,this.fa[a+1],this.fa[a+2],b,d]),b=this.fa[a+3],d=this.fa[a+4]}a+=c.$c[this.fa[a]]}this.fa.length&&e.push([c.Yc,b,d]);a=new c;for(b=e.length-1;0<=b;b--)Array.prototype.push.apply(a.fa,e[b]);a.closed=this.closed;return a};c.prototype.gf=function(){for(var a=0,b,d=[];a<this.fa.length;){var e=c.pq[this.fa[a]];for(b=0;b<e;b++)d.push(new D(this.fa[a+1+2*b],this.fa[a+1+2*b+1]));a+=c.$c[this.fa[a]]}return d};
c.prototype.transform=function(a){for(var b=0,d,e;b<this.fa.length;){e=c.pq[this.fa[b]];for(d=0;d<e;d++){var f=a.apply(this.fa[b+1+2*d],this.fa[b+1+2*d+1]);this.fa[b+1+2*d]=f.x;this.fa[b+1+2*d+1]=f.y}b+=c.$c[this.fa[b]]}};c.prototype.clone=function(){var a=new c;a.fa=this.fa.concat();return a};c.prototype.qk=function(a){for(var b=0,d,e=d=0,f=new F(this.fa[1]||0,this.fa[2]||0,0,0),h;b<this.fa.length;){switch(this.fa[b]){case c.Yc:case c.Xc:d=this.fa[b+1];e=this.fa[b+2];f.Wp(d,e);break;case c.lf:var k=
h=[],l=this.fa[b+5],n=this.fa[b+6];yc(k,d,e,this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4],l,n,a*a);k.push(new D(l,n));for(d=0;d<h.length;d++)f.Wp(h[d].x,h[d].y);d=this.fa[b+5];e=this.fa[b+6];break;case c.nf:k=h=[];l=this.fa[b+3];n=this.fa[b+4];zc(k,d,e,this.fa[b+1],this.fa[b+2],l,n,a*a);k.push(new D(l,n));for(d=0;d<h.length;d++)f.Wp(h[d].x,h[d].y);d=this.fa[b+3];e=this.fa[b+4]}b+=c.$c[this.fa[b]]}return f};c.prototype.append=function(a){this.fa=this.fa.concat(a.fa)};c.prototype.Op=function(a){for(var b=
0,d=0,e=0,f=new c,h;b<this.fa.length;){switch(this.fa[b]){case c.Yc:d=this.fa[b+1];e=this.fa[b+2];f.moveTo(d,e);break;case c.Xc:d=this.fa[b+1];e=this.fa[b+2];f.lineTo(d,e);break;case c.lf:var k=h=[],l=this.fa[b+5],n=this.fa[b+6];yc(k,d,e,this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4],l,n,a*a);k.push(new D(l,n));2===h.length&&1E-4>d*(h[0].y-h[1].y)+h[0].x*(h[1].y-e)+h[1].x*(e-h[0].y)&&(h[0]=h[1],h.length=1);for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.fa[b+5];e=this.fa[b+6];break;case c.nf:k=
h=[];l=this.fa[b+3];n=this.fa[b+4];zc(k,d,e,this.fa[b+1],this.fa[b+2],l,n,a*a);k.push(new D(l,n));for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.fa[b+3];e=this.fa[b+4];break;case c.Wc:f.closePath()}b+=c.$c[this.fa[b]]}return f};c.prototype.gz=function(a,b,d){void 0===d&&(d=0);return Ac(this.gf(),a,b)||0<d&&this.kt(a,b,d)};c.prototype.kt=function(a,b,d){var e=0,f=0,h=0;for(d*=d;h<this.fa.length;){switch(this.fa[h]){case c.Yc:e=this.fa[h+1];f=this.fa[h+2];break;case c.Xc:var k=this.fa[h+1];var l=
this.fa[h+2];var n=k-e;var q=l-f;var v=n*n+q*q;v=((a-e)*n+(b-f)*q)/v;1<v?v=1:0>v&&(v=0);e+=v*n;q=f+v*q;f=e-a;q-=b;f=f*f+q*q;if(f<=d)return!0;e=k;f=l}h+=c.$c[this.fa[h]]}return!1};c.prototype.Kk=function(a,b){for(var d=0,e=0,f=b[0],h,k=new D(0,0),l;d<this.fa.length;){switch(this.fa[d]){case c.Yc:l=this.fa[d+1];h=this.fa[d+2];a.moveTo(l,h);k=new D(l,h);break;case c.Xc:l=this.fa[d+1];var n=h=this.fa[d+2],q=new D(l,n);h=k.Wb(q);if(!(0>=h||0>f)){for(;h>f;)k.x+=(q.x-k.x)*f/h,k.y+=(q.y-k.y)*f/h,e&1?a.moveTo(k.x,
k.y):a.lineTo(k.x,k.y),h-=f,e=(e+1)%b.length,f=b[e];h<=f&&(k=new D(l,n),e&1?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),f-=h)}}d+=c.$c[this.fa[d]]}};c.prototype.ji=function(){function a(a,b){f-=(a-d)*(b+e);d=a;e=b}for(var b=0,d,e,f=0;b<this.fa.length;){switch(this.fa[b]){case c.Yc:d=this.fa[b+1];e=this.fa[b+2];break;case c.Xc:a(this.fa[b+1],this.fa[b+2]);break;case c.lf:a(this.fa[b+5],this.fa[b+6]);break;case c.nf:a(this.fa[b+3],this.fa[b+4])}b+=c.$c[this.fa[b]]}return f/2};c.prototype.zr=function(a){for(var b=
0,d=0,e=0,f=!1;b<this.fa.length;){switch(this.fa[b]){case c.Yc:d=this.fa[b+1];e=this.fa[b+2];f=!0;break;case c.Xc:a(d,e,this.fa[b+1],this.fa[b+2],f),d=this.fa[b+1],e=this.fa[b+2],f=!1}b+=c.$c[this.fa[b]]}};c.prototype.tv=function(){var a=0;this.zr(function(b,d,e,c){a+=G(b,d,e,c)});return a};c.prototype.wv=function(a){var b=new c,d=0;this.zr(function(e,c,h,k,l){if(d<=a){l&&b.moveTo(e,c);l=G(e,c,h,k);if(d+l>=a){var f=a-d;h=e+(h-e)*f/l;k=c+(k-c)*f/l}d+=l;b.lineTo(h,k)}});return b};c.Yc=0;c.Xc=1;c.lf=
2;c.nf=3;c.Wc=4;c.$c=[3,3,7,5,1];c.pq=[1,1,3,2,0];return c}();function Dc(c,a,b,d,e,f,h){void 0===h&&(h=f);0===f&&0===h?c.rect(a,b,d,e):(d=a+d,e=b+e,c.moveTo(a+f,b),c.lineTo(d-f,b),c.quadraticCurveTo(d,b,d,b+h),c.lineTo(d,e-h),c.quadraticCurveTo(d,e,d-f,e),c.lineTo(a+f,e),c.quadraticCurveTo(a,e,a,e-h),c.lineTo(a,b+h),c.quadraticCurveTo(a,b,a+f,b),c.closePath())}
function Ec(c,a,b,d,e){var f;if(2>=d-b)e.push(c[b]);else{var h=c[b],k=c[d-1],l=0,n=0;for(f=b+1;f<d;f++){var q=c[f].tr(h,k);q>l&&(l=q,n=f)}0<n&&l>a?(Ec(c,a,b,n,e),Ec(c,a,n,d,e)):e.push(h)}}function Fc(c,a){var b=[];Ec(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].hd(b[b.length-1])&&b.push(c[c.length-1]);return b}
var Gc=function(){function c(){this.ma=[];if(1===arguments.length){var a=arguments[0];if(a instanceof F)this.ma.push(new D(a.x,a.y)),this.ma.push(new D(a.right(),a.y)),this.ma.push(new D(a.right(),a.bottom())),this.ma.push(new D(a.x,a.bottom()));else if(a instanceof Array)this.ma=a;else throw alert("Bad parameter passed to Polygon() constructor."),"Error";}}c.prototype.Wx=function(a){var b=this.gf();a=a.gf();for(var d=0;d<b.length;d++){var e=b[d];if(!Ac(a,e.x,e.y))return!1}return!0};c.prototype.transform=
function(a){for(var b=0;b<this.ma.length;b++)this.ma[b]=a.apply(this.ma[b].x,this.ma[b].y)};c.prototype.add=function(a,b){this.ma.push(new D(a,b))};c.prototype.cd=function(a,b,d){void 0===d&&(d=0);return Ac(this.ma,a,b)||d&&Bc(this.ma,a,b,d)};c.prototype.dr=function(){return F.$h(this.ma)};c.prototype.clone=function(){return new c(this.ma.slice(0))};c.prototype.hd=function(a){if(this.ma.length!==a.ma.length)return!1;for(var b=0;b<this.ma.length;b++){var d=this.ma[b],e=a.ma[b];if(d.x!==e.x||d.y!==
e.y)return!1}return!0};c.prototype.Ed=function(a){for(var b=[],d=0;d<this.ma.length;d++){var e=this.ma[0===d?this.ma.length-1:d-1],c=this.ma[d],h=this.ma[d===this.ma.length-1?0:d+1],k=G(e.x,e.y,c.x,c.y),l=G(h.x,h.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/k+(c.x-h.x)/l)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/k+(c.y-h.y)/l)/Math.sqrt(2)*a})}this.ma=b};c.prototype.la=function(a){if(!(1>this.ma.length)){a.moveTo(this.ma[0].x,this.ma[0].y);for(var b=1;b<this.ma.length;b++)a.lineTo(this.ma[b].x,this.ma[b].y);a.closePath()}};
c.prototype.gf=function(){return this.ma};c.sB=function(a,b){for(var d=0,e=0,c=!1,h=[],k=[],l=0;l<b.length;l++)k.push(0);for(;;){var n=0,q=-1;for(l=0;l<b.length;l++)if(k[l]<b[l].length){var v=b[l][k[l]];if(0===l||v<n){n=v;q=l;var x=1-k[l]%2}}if(-1===q)return h;k[q]+=1;"intersection"===a?x?(e+=1,e===b.length&&(d=n)):(e===b.length&&(h.push(d),h.push(n)),--e):x?(e+=1,0===q?(c=!0,1===e)&&(d=n):c&&2===e&&(h.push(d),h.push(n))):(c&&1===e&&(h.push(d),h.push(n)),--e,0===q&&(c=!1),c&&1===e&&(d=n))}};return c}();
function Hc(c){var a=[],b=0;for(c=c.split(",");b<c.length;b++){var d=parseFloat(c[b]);isNaN(d)||a.push(d)}return a}function Ic(c,a,b){if(0!==a.length)if(c.moveTo(a[0].x,a[0].y),0===b.length)for(b=1;b<a.length;b++)c.lineTo(a[b].x,a[b].y);else for(var d=0,e=1,f=b[0],h=a[0].clone(),k;e<a.length;)k=h.Wb(a[e]),0===k?e+=1:k<=f?(h=a[e].clone(),d&1?c.moveTo(h.x,h.y):c.lineTo(h.x,h.y),f-=k,e+=1):(h.x+=(a[e].x-h.x)*f/k,h.y+=(a[e].y-h.y)*f/k,d&1?c.moveTo(h.x,h.y):c.lineTo(h.x,h.y),d=(d+1)%b.length,f=b[d])}
function Jc(c,a,b,d,e,f,h,k){b-=c;d-=a;h-=e;k-=f;var l=-h*d+b*k;if(0===l)return null;e=(h*(a-f)-k*(c-e))/l;return new D(c+e*b,a+e*d)}
function Kc(c,a){function b(a){var b,e;var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];a[b+1]&&(c[b]=d(n,a[b+1]));b+=1}return c}function d(a,b){return new D(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Kc(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];c[2*b]=n;a[b+1]&&(c[2*b+1]=d(n,a[b+1]));b+=1}return c}(c))),a-1):c}
function Lc(c,a){var b=0,d=0,e=0,f=0,h=0,k=0;Mc(a,function(a,n){switch(a){case "M":for(var l=0;l<n.length;l+=2)b=n[l],d=n[l+1],0==l?(c.moveTo(b,d),h=b,k=d):c.lineTo(b,d);break;case "m":for(l=0;l<n.length;l+=2)b+=n[l],d+=n[l+1],0==l?(c.moveTo(b,d),h=b,k=d):c.lineTo(b,d);break;case "L":for(l=0;l<n.length;l+=2)b=n[l],d=n[l+1],c.lineTo(n[l],n[l+1]);break;case "l":for(l=0;l<n.length;l+=2)b+=n[l],d+=n[l+1],c.lineTo(b,d);break;case "H":for(l=0;l<n.length;l++)b=n[l],c.lineTo(b,d);break;case "h":for(l=0;l<
n.length;l++)b+=n[l],c.lineTo(b,d);break;case "V":for(l=0;l<n.length;l++)d=n[l],c.lineTo(b,d);break;case "v":for(l=0;l<n.length;l++)d+=n[l],c.lineTo(b,d);break;case "Q":for(l=0;l<n.length;l+=4)e=n[l],f=n[l+1],b=n[l+2],d=n[l+3],c.quadraticCurveTo(e,f,b,d);break;case "C":for(l=0;l<n.length;l+=6)e=n[l+2],f=n[l+3],b=n[l+4],d=n[l+5],c.bezierCurveTo(n[l],n[l+1],e,f,b,d);break;case "c":for(l=0;l<n.length;l+=6){var v=n[l]+b,x=n[l+1]+d;e=n[l+2]+b;f=n[l+3]+d;b=n[l+4]+b;d=n[l+5]+d;c.bezierCurveTo(v,x,e,f,b,
d)}break;case "S":for(l=0;l<n.length;l+=4)v=b+b-e,x=d+d-f,c.bezierCurveTo(v,x,n[l],n[l+1],n[l+2],n[l+3]),e=n[l],f=n[l+1],b=n[l+2],d=n[l+3];break;case "s":for(l=0;l<n.length;l+=4)v=b+b-e,x=d+d-f,c.bezierCurveTo(v,x,n[l]+b,n[l+1]+d,n[l+2]+b,n[l+3]+d),e=n[l]+b,f=n[l+1]+d,b=n[l+2]+b,d=n[l+3]+d;break;case "A":case "a":for(l=0;l<n.length;l+=7){var w=n[l+1];v=n[l+2]/Math.PI;var y=1===n[l+3];var B=1===n[l+4];x=n[l+5];var E=n[l+6];"a"==a&&(x+=b,E+=d);var L=Math.abs(w);var H=(b-x)/2;var z=(d-E)/2;var K=Math.cos(v)*
H+Math.sin(v)*z;H=-Math.sin(v)*H+Math.cos(v)*z;z=L*L;var W=w*w,wa=K*K,U=H*H,La=wa/z+U/W;1<La&&(z=Math.sqrt(La),L*=z,w*=z,z=L*L,W=w*w);wa=z*U+W*wa;z=Math.sqrt(Math.max(0,(z*W-wa)/wa));y==B&&(z=-z);W=z*L*H/w;U=-z*w*K/L;wa=Math.cos(v)*W-Math.sin(v)*U+(b+x)/2;z=Math.sin(v)*W+Math.cos(v)*U+(d+E)/2;y=Nc(1,0,(K-W)/L,(H-U)/w);H=Nc((K-W)/L,(H-U)/w,(-K-W)/L,(-H-U)/w);B||(H-=2*Math.PI);H%=2*Math.PI;B=wa;K=z;c.translate(B,K);c.scale(L,w);c.rotate(v);c.arc(0,0,1,y,y+H,0>H);c.rotate(-v);c.scale(1/L,1/w);c.translate(-B,
-K);b=x;d=E}break;case "Z":case "z":c.closePath();b=h;d=k;break;default:throw Error("Unknown draw command: "+a);}switch(a){case "C":case "c":case "S":case "s":break;default:e=b,f=d}})}
function Mc(c,a){function b(){if(0<=h){var a=parseFloat(c.substr(h,h+f));if(isNaN(a))throw Error("Error parsing number: "+c.substr(h,h+f)+" in "+c);e.push(a);h=-1;k=!1}}for(var d="",e=[],f=0,h=-1,k=!1;f<c.length;f++){var l=c[f];0<h&&"-"==l||k&&"."==l?(b(),h=f):"0"<=l&&"9">=l||"-"==l||"+"==l||0<=h&&("E"==l||"e"==l)||"."==l?(-1==h&&(h=f),"."==l&&(k=!0)):"A"<=l&&"Z">=l||"a"<=l&&"z">=l?(b(),""!=d&&(a(d,e),e=[],d=""),d=l):b()}b();""!=d&&a(d,e)}
function Nc(c,a,b,d){var e=(c*b+a*d)/(G(0,0,c,a)*G(0,0,b,d));e=Math.acos(-1>e?-1:1<e?1:e);0>c*d-a*b&&(e=-e);return e}
(function(){function c(){this.items=[];this.ua=new I}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){a=this.ua.apply(a,b);this.items.push("M",a.x,a.y)};c.prototype.lineTo=function(a,b){a=this.ua.apply(a,b);this.items.push("L",a.x,a.y)};c.prototype.transform=function(a,b,d,e,c,h){a=new I(a,
d,b,e,c,h);this.ua=this.ua.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){a=this.ua.apply(a,b);d=this.ua.apply(d,e);c=this.ua.apply(c,h);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c})();
function Oc(c,a,b,d,e){if(!(2>a.length)){void 0===d&&(d=!0);void 0===e&&(e=!0);var f=a[0].x===a[a.length-1].x&&a[0].y===a[a.length-1].y,h=[],k=[],l=new D(0,0),n=l,q=l,v=l,x=l,w=[];b/=2;var y;for(y=1;y<a.length;y++){q=a[y-1];x=a[y];v=sc(q.x,q.y,x.x,x.y);l=new D(v.y,-v.x);n=new D(q.x-v.x*b-l.x*b,q.y-v.y*b-l.y*b);q=new D(q.x-v.x*b+l.x*b,q.y-v.y*b+l.y*b);if(k.length){var B=k[k.length-1];var E=w[w.length-1];n=Jc(B.x,B.y,B.x+E.x,B.y+E.y,n.x,n.y,n.x+v.x,n.y+v.y)||n;B=h[h.length-1];q=Jc(B.x,B.y,B.x+E.x,B.y+
E.y,q.x,q.y,q.x+v.x,q.y+v.y)||q}k.push(n);h.push(q);w.push(v)}f?(B=k[0],E=w[0],n=Jc(B.x,B.y,B.x+E.x,B.y+E.y,n.x,n.y,n.x+v.x,n.y+v.y)||n,B=h[0],q=Jc(B.x,B.y,B.x+E.x,B.y+E.y,q.x,q.y,q.x+v.x,q.y+v.y)||q,k[0].x=n.x,k[0].y=n.y,h[0].x=q.x,h[0].y=q.y,k.push(n),h.push(q)):(k.push(new D(x.x+v.x*b-l.x*b,x.y+v.y*b-l.y*b)),h.push(new D(x.x+v.x*b+l.x*b,x.y+v.y*b+l.y*b)));if(e){c.moveTo(k[0].x,k[0].y);for(y=1;y<k.length;y++)c.lineTo(k[y].x,k[y].y);f&&(c.closePath(),c.moveTo(h[h.length-1].x,h[h.length-1].y))}else d&&
c.moveTo(h[h.length-1].x,h[h.length-1].y);if(d){for(y=h.length-1;0<=y;y--)c.lineTo(h[y].x,h[y].y);!f&&e&&c.lineTo(k[0].x,k[0].y)}}}
(function(){function c(a){this.ma=a;this.n=0;this.xb=new D(0,0)}c.prototype.next=function(a){if(0===this.ma.length)return null;if(0===this.n)return this.xb=this.ma[0].clone(),this.n+=1,this.xb.clone();for(;this.n<this.ma.length;){var b=this.xb.Wb(this.ma[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.xb.x+=(this.ma[this.n].x-this.xb.x)*a/b,this.xb.y+=(this.ma[this.n].y-this.xb.y)*a/b,this.xb.clone()}return null};return c})();
var Pc=function(){function c(){this.path=[]}c.prototype.Yf=function(a,b){0<this.path.length&&a===this.path[this.path.length-1].x&&b===this.path[this.path.length-1].y||this.path.push(new D(a,b))};c.prototype.Wn=function(){return this.path};return c}();function Qc(c,a){c.length>a&&(c=c.slice(c.length-a));return c}
var Rc=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.Gj=[];a.order=3;a.Jp=3;a.Gt=Math.pow(2,a.order);a.sampleSize=a.Jp+1;return a}__extends(a,c);a.prototype.Wn=function(){return this.Gj};a.prototype.Yf=function(a,d){c.prototype.Yf.call(this,a,d);this.path.length<this.sampleSize?this.Gj=Kc(this.path,this.order):(a=Qc(Kc(Qc(this.path,this.sampleSize),this.order),this.Gt*this.Jp),this.Gj=this.Gj.slice(0,this.Gj.length-this.Gt*(this.Jp-1)).concat(a))};return a}(Pc);
function Sc(c){var a,b,d,e,f,h,k;return __generator(this,function(l){switch(l.label){case 0:return 2>c.length?[2]:[4,{Hh:c[0],length:0}];case 1:a=l.sent(),b=c[0],d=1,l.label=2;case 2:if(!(d<c.length))return[3,7];e=c[d];f=G(b.x,b.y,e.x,e.y);if(1E-5>f)return d++,[3,2];h=(e.x-b.x)/f;k=(e.y-b.y)/f;l.label=3;case 3:if(!(f>a))return[3,5];b={x:b.x+h*a,y:b.y+k*a};f-=a;return[4,{Hh:b,length:a}];case 4:return a=l.sent(),[3,3];case 5:return[4,{Hh:{x:e.x,y:e.y},length:f}];case 6:return a=l.sent(),b=e,d++,[3,
2];case 7:return[2]}})};var Tc=function(){function c(a){this.pd=a;this.tk=[];this.$o=!0;this.log=u.create("cloudAddon");this.$e=a.ja("cloudRadius")}c.prototype.format=function(){var a=this.pd.Hd.gf();this.log("Format cloud; %s points",a.length);this.tk=this.Fv(a,this.$e)};c.prototype.Fv=function(a,b){var d=[],e=5/6*b*2,c,h=a[a.length-1];for(c=0;c<a.length;c++){var k=a[c];var l=k.x-h.x,n=k.y-h.y,q=Math.sqrt(l*l+n*n);l/=q;n/=q;var v=q/e+.5|0;1>v&&(v=1);v=q/v;for(var x=0;x+.1*v<q;x+=v)d.push({x:h.x+x*l,y:h.y+x*n,$a:0,end:0});
h=k}e=d[d.length-1];for(c=0;c<d.length;c++)a=d[c],h=a.x-e.x,l=a.y-e.y,k=.5*Math.sqrt(h*h+l*l)/b,-1>k&&(k=-1),1<k&&(k=1),h=Math.atan2(l,h),k=Math.acos(k),k=[h-k,Math.PI+h+k],e.end=k[0],a.$a=k[1],e=a;return d};c.prototype.la=function(a){this.log("Drawing cloud with %s circles",this.tk.length);var b=15*Math.PI/180,d=this.$e;a.beginPath();for(var e=0;e<this.tk.length;e++){var c=this.tk[e];a.arc(c.x,c.y,d,c.$a,c.end+b)}a.stroke()};return c}();function Uc(c){return 0!=(c.Gb&1)}function Vc(c){return 0!=(c.Gb&4)}function Wc(c){return 5===(c.Gb&5)&&c.da};var Xc=u.create("WrappedNode");function Yc(c,a){var b=0;return function(){return{next:function(){return b>=c.Ua()?{done:!0}:{value:c.Cb(b++).Ni(a)}}}}}
function Zc(c,a){var b={};b.ctx=c.ctx;b.id=a.id;var d=a.type();"CustomNode"===a.type()&&(d=a.ja("nodeType"));b.type=d;"undefined"!==typeof Proxy?(b.children=new Proxy({},{get:function(b,d){ca();ea();if(d===Symbol.iterator)return Yc(a,c);if("length"===d)return a.Ua();b=a.Cb(d);return b instanceof $c?b.Ni(c):b}}),b.props=ad(a.ba,"",function(b,d){a.Ny(b,d)})):(Object.defineProperty(b,"children",{get:function(){throw Error("Not supported in this browser");}}),Object.defineProperty(b,"props",{get:function(){throw Error("Not supported in this browser");
}}));Object.defineProperty(b,"parent",{configurable:!0,get:function(){return a.parent?a.parent.Ni(c):null},set:function(b){Xc("Warning; replacing parent property");a.parent=b}});Vc(a)&&Object.defineProperty(b,"element",{configurable:!0,get:function(){return a.da}});return b}
function ad(c,a,b){function d(d){if("string"===typeof d)for(var e in c)if(e.startsWith(""+a+d+"."))return ad(c,""+a+d+".",b);return null}void 0===a&&(a="");return new Proxy(c,{get:function(b,f){return"hasOwnProperty"===f?function(b){return a+b in c}:"string"===typeof f?(b=d(f))?b:c[a+f]:c[f]},has:function(b,f){return"string"===typeof f?(b=d(f))?b:a+f in c:b.hasOwnProperty(f)},set:function(d,f,h){"string"===typeof f?(c[a+f]=h,b(a+f,h)):c[f]=h;return!0}})};var bd=u.create("BaseNode"),$c=function(){function c(a,b){this.id=a;this.aa=b;this.Gb=0;this.parent=null;this.ba={};this.scope=null}c.prototype.type=function(){return"BaseNode"};c.prototype.toString=function(){return this.type()+":"+this.id};c.prototype.Ny=function(a,b){this.aa.Ec([this.id],a,b)};c.prototype.Ni=function(a){this.scope||(this.scope=Zc(a,this));return this.scope};c.vd=function(a,b){c.types[a]=b};c.create=function(a,b,d){return a in c.types?new c.types[a](b,d):null};c.prototype.Ta=function(){};
c.prototype.Ci=function(a,b){b=qc(this.ba[a],b);b instanceof Array&&(b=b.slice(0));return b};c.prototype.wb=function(){var a={},b;for(b in this.ba)this.ba.hasOwnProperty(b)&&(a[b]=this.ja(b));return a};c.prototype.Gc=function(a){for(var b in a)this.setProperty(b,a[b])};c.prototype.vh=function(a){return a in this.ba};c.prototype.ad=function(a){return this.vh(a)||"$"===a[0]||"_"===a[0]};c.prototype.setProperty=function(a,b){b=this.Ci(a,b);this.ad(a)?(bd("%s:%s set %s=%s",this.id,this.type(),a,"string"===
typeof b?b.substr(0,100):b),this.ba[a]=b):bd("Property '%s' not valid for %s",a,this.type());return b};c.prototype.ja=function(a){a=this.ba[a];a instanceof Array&&(a=a.slice(0));return a};c.prototype.Ua=function(){return 0};c.prototype.removeChild=function(){throw Error("BaseNode removechild called.");};c.prototype.xl=function(){throw Error("BaseNode insertChild called.");};c.prototype.Cb=function(){throw Error("BaseNode getChild called.");};c.prototype.ne=function(a){for(var b=0;b<this.Ua();b++)if(a===
this.Cb(b))return b;return-1};c.types={};return c}();var dd=function(c){function a(b,d){b=c.call(this,b,d)||this;b.rect=new F(0,0,1,1);b.Zj=!1;b.Aa=new F(0,0,1,1);b.Dc=0;b.log=u.create("GraphicsNode");b.Gb|=1;b.ba.matrix=new I;b.ba.layer="default";b.Sm(a.va);return b}__extends(a,c);a.prototype.Sm=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.ba[b]=a[b])};a.prototype.clip=function(){};a.prototype.Ta=function(){};a.prototype.se=function(){return!1!==this.ja("lockEditMode")};a.prototype.tl=function(){return null};a.prototype.Lk=function(){};a.prototype.vs=
function(){return!1};a.prototype.St=function(){return!1};a.prototype.qg=function(){return"text"in this.ba};a.prototype.jc=function(){var a=this.ja("layer");return a?""+a:"default"};a.prototype.io=function(){return null!==this.parent&&null!==this.parent.parent&&"GroupNode"===this.parent.type()};a.prototype.type=function(){return"BaseNode"};a.prototype.De=function(a){return{matrix:a.multiply(this.Na())}};a.prototype.Na=function(){return this.ja("matrix")};a.prototype.Qc=function(){return this.Na().inverse()};
a.prototype.Ot=function(a){this.setProperty("matrix",a)};a.prototype.Ci=function(a,d){d=c.prototype.Ci.call(this,a,d);"matrix"===a&&"string"===typeof d?d=new I(d):"opacity"===a&&(d=parseFloat(d));return d};a.prototype.ad=function(a){switch(a){case "customData":case "tag":case "locked":case "lockSize":case "lockRotation":case "lockPosition":case "lockEditMode":case "rotationHandles":case "lockAspectRatio":case "zIndex":case "snap":case "opacity":case "shadow":case "type":return!0}return c.prototype.ad.call(this,
a)};a.prototype.Wk=function(){var a=new Gc(this.Aa);a.transform(this.Na());return a};a.prototype.Bd=function(){return this.ja("zIndex")||0};a.prototype.transform=function(a){this.Ot(a.multiply(this.Na()))};a.prototype.format=function(){};a.prototype.Db=function(a,d,e){a=this.Qc().apply(a,d);d=this.Qc().sb();d=.5*(d.x+d.y);return this.hidden()||this.ja("locked")||!this.Aa.cd(a.x,a.y,e*d)?null:this};a.prototype.Lf=function(a){this.Zj=a};a.prototype.hidden=function(){return this.Zj};a.prototype.Qh=function(){};
a.prototype.Kl=function(){};a.prototype.Nl=function(){};a.prototype.tj=function(a){if(a.tj){var b={"zwibbler:id":""+this.id};if("tag"in this.ba){var e=this.ba.tag;"string"!==typeof e&&(e=JSON.stringify(e));b["zwibbler:tag"]=e}a.tj(b)}};a.prototype.sj=function(a){a.sj&&a.sj()};a.prototype.la=function(a){a.save();this.tj(a);var b=this.ba.matrix;a.transform(b.m11,b.m21,b.m12,b.m22,b.Ea,b.Fa);"erase"===this.ba.strokeStyle?a.Pd?a.strokeStyle=a.Pd:(a.strokeStyle="#000000",a.globalCompositeOperation="destination-out"):
a.strokeStyle=this.ba.strokeStyle;a.fillStyle=this.ba.fillStyle;a.lineWidth=this.ba.lineWidth;this.ba.shadow&&cd(this.ba.shadow,a);"opacity"in this.ba&&(a.globalAlpha=this.ba.opacity);this.pf(a);this.sj(a);a.restore()};a.prototype.Br=function(a,d){d=d?function(b){a.fillStyle=b;a.fill()}:function(b){a.strokeStyle=b;a.stroke()};a.Pd?(a.globalCompositeOperation="destination-out",--a.lineWidth,d("#000000"),a.globalCompositeOperation="source-over",a.fillStyle=a.Pd,a.lineWidth+=2,d(a.Pd),--a.lineWidth):
(a.globalCompositeOperation="destination-out",d("#000000"),a.globalCompositeOperation="source-over")};a.prototype.pf=function(){};a.prototype.resolve=function(){return!1};a.prototype.Pr=function(a,d,e,c){this.Bi||(this.Bi={});var b=this.Bi[a];if(!b||b.iu!==c){b&&c===b.iu||(b={iu:c,value:c},this.Bi[a]=b);a=/url\(([^\)]+)\)/.exec(c);var f;a&&(f=a[1]);var l=this;f&&(b.value="rgba(0, 0, 0, 0.2)",e.add(this.id,"image",f,null,function(a){l.log("Got image response.");b.value=d.createPattern(a,"repeat")||
"magenta";e.Kf(l.id)}))}};a.prototype.Xr=function(a){return this.Bi&&(a=this.Bi[a])?a.value:"magenta"};a.prototype.Hn=function(){return""};a.prototype.Ue=function(){};a.prototype.$k=function(){};a.prototype.al=function(){return null};a.prototype.Kt=function(){};a.va={fillStyle:"#cccccc",strokeStyle:"#000000",lineWidth:2,shadow:!1};return a}($c),ed=/ *(\d+)(px)? +(\d+)(px)? +(\d+)(px)? +(.+)/i;
function cd(c,a){void 0===a&&(a={});a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.shadowColor="rgba(0,0,0,0.0)";if("string"===typeof c){if(c=ed.exec(c))a.shadowOffsetX=parseFloat(c[1]),a.shadowOffsetY=parseFloat(c[3]),a.shadowBlur=parseFloat(c[5]),a.shadowColor=c[7]}else c&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)")};var fd=function(){function c(){this.text="";this.font="10px Arial";this.Nr="Arial";this.fontSize=10;this.lines=[];this.cq="top";this.Ri="left";this.Zi=this.bold=!1;this.textDecoration="";this.log=u.create("TextBox");this.rect=new F(0,0,0,this.fontSize)}c.prototype.bm=function(a,b,d,e,c){this.Nr=a;this.fontSize=b;this.bold=d;this.Zi=e;this.textDecoration=c};c.prototype.Nf=function(a){this.text=a};c.prototype.jp=function(a,b){switch(a){case "left":case "center":case "right":this.Ri=a;break;case null:break;
default:this.log("Unknown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.cq=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.format=function(a,b,d){this.font=""+this.fontSize+'px "'+this.Nr+'"';this.bold&&(this.font="bold "+this.font);this.Zi&&(this.font="italic "+this.font);this.lines.length=0;var e,c=0;a.font=this.font;var h=0;this.rect.width=0;if(0===b){var k=this.text.split("\n");for(e=0;e<k.length;e++){var l=k[e];c=a.measureText(l).width;
h+=this.fontSize;this.lines.push({x:0,y:h,width:c,text:l});this.rect.width=Math.max(this.rect.width,c)}}else{l=k=0;var n=!1;for(e=0;e<this.text.length;e++){var q=this.text.charAt(e);c=a.measureText(this.text.substr(k,e-k+1)).width;"\n"===q?n=!0:c>b?l?(e=l,n=!0):e>k&&(--e,n=!0):" "===q&&(l=e);n&&(c=" "===this.text.charAt(e)?a.measureText(this.text.substr(k,e-k)).width:a.measureText(this.text.substr(k,e-k+1)).width,h+=this.fontSize,this.lines.push({x:0,y:h,width:c,text:this.text.substr(k,e-k+1)}),k=
e+1,l=0,n=!1,this.rect.width=Math.max(this.rect.width,c))}if(c||"\n"===this.text.charAt(this.text.length-1))h+=this.fontSize,this.lines.push({x:0,y:h,width:c,text:this.text.substr(k,e-k)}),this.rect.width=Math.max(this.rect.width,c)}this.rect.x=0;this.rect.y=0;this.rect.height=h;if("center"===this.Ri)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width/2-a.width/2;else if("right"===this.Ri)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width-a.width;b&&"center"===this.Ri?
this.rect.x=b/2-this.rect.width/2:b&&"right"===this.Ri&&(this.rect.x=b-this.rect.width);d&&"middle"===this.cq?this.rect.y=d/2-this.rect.height/2:d&&"bottom"===this.cq&&(this.rect.y=d-this.rect.height)};c.prototype.la=function(a,b,d){this.fillText(a,b,d);this.xr(a,b,d)};c.prototype.xr=function(a,b,d){var e;if(0<=this.textDecoration.indexOf("underline")){a.save();a.beginPath();var c=1;for(e=0;e<this.lines.length;e++){var h=this.lines[e];a.moveTo(h.x+b,h.y+d+c);a.lineTo(h.x+b+h.width,h.y+d+c)}a.strokeStyle=
a.fillStyle;a.lineWidth=1;a.stroke();a.beginPath();a.restore()}if(0<=this.textDecoration.indexOf("line-through")){a.save();a.beginPath();c=.25*-this.fontSize;for(e=0;e<this.lines.length;e++)h=this.lines[e],a.moveTo(h.x+b,h.y+d+c),a.lineTo(h.x+b+h.width,h.y+d+c);a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.restore()}};c.prototype.fillText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.fillText(c.text,this.rect.x+c.x+b,
this.rect.y+c.y+d)}};c.prototype.strokeText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.strokeText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};return c}();var gd=function(c){function a(b,d){b=c.call(this,b,d)||this;b.Za=new fd;b.$n=0;b.border={lineWidth:0,vc:"#000000"};b.width=0;b.height=0;b.OB=0;b.PB=0;b.log=u.create("TEXT",!0);b.Sm(a.Cu);b.ba.text="lorum ipsum dolor";return b}__extends(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.Rn=function(){return void 0!==this.ja("width")?2:this.ja("wrap")?1:0};a.prototype.De=function(a){var b=c.prototype.De.call(this,a);2===this.Rn()&&(a=a.sb(),this.log("Scale %s",a),1E-8>Math.abs(a.x-a.y)&&
(b.fontSize=this.ba.fontSize*a.x,b.padding=(this.ba.padding||0)*a.x));return b};a.prototype.ad=function(a){switch(a){case "scaleFont":case "padding":case "width":case "height":return!0}return c.prototype.ad.call(this,a)};a.prototype.setProperty=function(a,d){switch(a){case "fillStyle":case "textFillStyle":this.ba.textFillStyle=d;this.ba.fillStyle=d;return;case "border-color":a=this.qj(this.ja("border")||"");this.setProperty("border",a.lineWidth+"px "+d);return;case "border-width":a=this.qj(this.ja("border")||
"");this.setProperty("border",d+"px "+a.vc);return}c.prototype.setProperty.call(this,a,d)};a.prototype.wb=function(){var a=c.prototype.wb.call(this);a["border-color"]=this.ja("border-color");a["border-width"]=this.ja("border-width");return a};a.prototype.vh=function(a){switch(a){case "border":return!0}return c.prototype.vh.call(this,a)};a.prototype.ja=function(a){switch(a){case "border-color":return this.qj(this.ja("border")||"").vc;case "border-width":return this.qj(this.ja("border")||"").lineWidth}return c.prototype.ja.call(this,
a)};a.prototype.format=function(a){var b=this.ba.matrix,e=b.apply(0,0),c=b.apply(1,0);e=e.Wb(c);c=this.ja("wrap");this.ja("scaleFont");var h=this.ba.text;!c&&h.length&&10===h.charCodeAt(h.length-1)&&(h=h.substr(0,h.length-1));this.Za.Nf(h);b=b.sb();this.Za.bm(this.ba.fontName,this.ba.fontSize,this.ba.bold,this.ba.italic,this.ba.textDecoration);this.Za.jp(this.ba.textAlign,"top");switch(this.Rn()){case 0:this.Za.format(a,0,0);e=this.Za.rect.width;a=this.Za.rect.height;this.Aa=new F(0,-(0+this.ja("fontSize")),
e,a);break;case 1:c=this.ba.baseWidth;void 0===c&&(this.Za.format(a,0,0),c=Math.max(this.Za.rect.width,10),500<c&&(c=500),this.ba.baseWidth=c,this.log("Formatting text for first time; baseWidth=%s",c));e=Math.ceil(e*c);this.Za.format(a,e,0);a=this.Za.rect.height;this.Aa=new F(0,0,c,a);break;case 2:e=this.ja("width")||0;c=this.ja("height")||0;this.Za.format(a,e*b.x,0);this.Aa=new F(0,0,e||this.Za.rect.width,c||this.Za.rect.height);break;default:throw Error("TextNode: Bad Mode "+this.Rn());}this.Aa.height+=
.3*this.ba.fontSize/b.y;a=this.ja("padding")||0;this.Aa.Ed(2*a,2*a);a=this.ja("lineWidth")+0;this.Aa.Ed(a/b.x,a/b.y);a=new Gc(this.Aa);a.transform(this.Na());this.rect=a.dr();this.$n=this.rect.height;this.border=this.ba.border?this.qj(this.ba.border):{lineWidth:0,vc:"#000000"}};a.prototype.qj=function(a){var b={lineWidth:0,vc:"#000000"};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=r.Gi(a[e]))b.vc=c.toString()}else b.lineWidth=c}return b};a.prototype.Na=function(){return!1===
this.ja("scaleFont")?c.prototype.Na.call(this).mm():c.prototype.Na.call(this)};a.prototype.la=function(a){if(0!==this.ba.text.length){a.save();this.tj(a);"opacity"in this.ba&&(a.globalAlpha=this.ba.opacity);var b=this.ba.background;if(b||this.border.lineWidth)a.save(),this.Na().jf(a),b&&(a.fillStyle=b,a.fillRect(this.Aa.x,this.Aa.y,this.Aa.width,this.Aa.height)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.vc,a.lineWidth=this.border.lineWidth,a.rect(this.Aa.x,this.Aa.y,this.Aa.width,
this.Aa.height),b=this.Qc(),b.mm().multiply(b).jf(a),a.stroke()),a.restore();this.ja("wrap")?this.Na().mm().jf(a):this.Na().jf(a);a.strokeStyle=this.ba.strokeStyle;a.fillStyle=this.ba.fillStyle;a.lineWidth=this.ba.lineWidth;b=0;var e=this.Na().sb(),c=this.Aa.height*e.y;if(this.ba.wrap||!1===this.ja("scaleFont"))switch(this.log("Available: %s rect: %s",c,this.Za.rect),this.ba.verticalAlign){case "bottom":b+=c-this.Za.rect.height;break;case "middle":b+=(c-this.Za.rect.height)/2}else b=-(0+this.ja("fontSize"));
"center"===this.ba.textAlign&&this.log("xshift is %s, urect=%s scaleX=%s tw=%s",0,this.Aa,e.x,this.Za.rect.width);this.ba.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");0<this.ba.lineWidth&&this.Za.strokeText(a,0,b);this.Za.fillText(a,0,b);this.Za.xr(a,0,b);this.sj(a);a.restore()}};a.Cu={textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:"#000000",wrap:!1,textAlign:"left",bold:!1,italic:!1,background:"rgba(0,0,0,0.0)",textDecoration:""};
return a}(dd);dd.vd("TextNode",gd);var hd=function(){function c(a,b){this.oa=a;this.ia=b;this.qA=!0;this.log=u.create("MoveSegment")}c.prototype.la=function(a){a.moveTo(this.ia.x,this.ia.y)};c.prototype.ff=function(){return this.fd()};c.prototype.fd=function(){return{x:1,y:0}};return c}(),id=function(){function c(a,b,d,e,c){this.oa=a;this.ia=b;this.yp=e;this.bf=c;this.log=u.create("LineSegment");this.Kg=0;this.Ka=new D(0,0);this.Pa=new D(0,0);this.length=0;this.from=new D(0,0);this.ia=b;this.oa=a;this.bf=c;this.yp=e;d.next();this.Tl=
d.next();this.Ul=d.next();this.moveTo=this.Lg=null;this.format()}c.prototype.format=function(){var a=G(this.oa.ia.x,this.oa.ia.y,this.ia.x,this.ia.y);this.Kg=this.length=a;var b=this.oa.ia.clone();this.oa instanceof c&&this.bf&&(this.bf=Math.min(this.bf,a/2,this.oa.length/2),a=sc(this.oa.ia.x,this.oa.ia.y,this.ia.x,this.ia.y),b.x+=a.x*this.bf,b.y+=a.y*this.bf,this.oa.lA(this.bf),this.Kg-=this.bf);this.from=b;null===this.Lg&&(this.Lg=this.ia);a=this.Kg/10*this.yp;10<a&&(a=10);var d=b.x,e=b.y,f=this.ia.x,
h=this.ia.y;d+=a;e+=a;this.Ka=new D(d+this.Tl*(f+a-d),e+this.Tl*(h+a-e));d=b.x-a;f=this.ia.x-a;e=b.y-a;h=this.ia.y-a;this.Pa=new D(d+this.Ul*(f-d),e+this.Ul*(h-e))};c.prototype.lA=function(a){var b=sc(this.from.x,this.from.y,this.ia.x,this.ia.y),d=this.ia.clone();d.x-=b.x*a;d.y-=b.y*a;this.Lg=d;this.Kg-=a;a=this.Kg/10*this.yp;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,h=d.y;b+=a;e+=a;this.Ka=new D(b+this.Tl*(c+a-b),e+this.Tl*(h+a-e));this.log("RECALC ctrl1=%s",this.Ka);b=this.from.x-a;c=d.x-
a;e=this.from.y-a;h=d.y-a;this.Pa=new D(b+this.Ul*(c-b),e+this.Ul*(h-e))};c.prototype.Dj=function(a){this.oa=a;this.format();this.oa instanceof c&&(this.moveTo=this.oa.Lg)};c.prototype.la=function(a){null!==this.Lg&&(this.bf&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.oa.ia.x,this.oa.ia.y,this.from.x,this.from.y)),a.bezierCurveTo(this.Ka.x,this.Ka.y,this.Pa.x,this.Pa.y,this.Lg.x,this.Lg.y))};c.prototype.ff=function(){return this.oa?sc(this.oa.ia.x,this.oa.ia.y,this.Ka.x,
this.Ka.y):this.fd()};c.prototype.fd=function(){for(var a=this.Pa,b=G(this.Pa.x,this.Pa.y,this.ia.x,this.ia.y),d=this.oa;20>b&&d instanceof c;)a=d.Pa,d=d.oa,b+=G(a.x,a.y,this.ia.x,this.ia.y);return sc(a.x,a.y,this.ia.x,this.ia.y)};return c}(),jd=function(){function c(a,b,d){this.zp=d;this.ia=b;this.oa=a;this.zp=d;var e=G(a.ia.x,a.ia.y,b.x,b.y);e||(e=1);var c=(b.x-a.ia.x)/e,h=(b.y-a.ia.y)/e;this.Pa=new D(b.x-e*d*c,b.y-e*d*h);if((b=a.Pa)&&a.oa){var k=sc(a.oa.ia.x,a.oa.ia.y,a.ia.x,a.ia.y),l=G(a.oa.ia.x,
a.oa.ia.y,a.ia.x,a.ia.y);c=.5*(c+k.x);h=.5*(h+k.y);b.x=a.ia.x-l*d*c;b.y=a.ia.y-l*d*h}this.Ka=new D(a.ia.x+e*d*c,a.ia.y+e*d*h);this.length=e}c.prototype.Dj=function(a){this.oa=a;var b=a.Pa,d=(this.ia.x-a.ia.x)/this.length,e=(this.ia.y-a.ia.y)/this.length,c=this.zp;if(b&&a.oa){var h=sc(a.oa.ia.x,a.oa.ia.y,a.ia.x,a.ia.y),k=G(a.oa.ia.x,a.oa.ia.y,a.ia.x,a.ia.y);d=.5*(d+h.x);e=.5*(e+h.y);b.x=a.ia.x-k*c*d;b.y=a.ia.y-k*c*e}this.Ka=new D(a.ia.x+this.length*c*d,a.ia.y+this.length*c*e)};c.prototype.la=function(a){a.bezierCurveTo(this.Ka.x,
this.Ka.y,this.Pa.x,this.Pa.y,this.ia.x,this.ia.y)};c.prototype.ff=function(){return this.oa?sc(this.oa.ia.x,this.oa.ia.y,this.Ka.x,this.Ka.y):{x:1,y:0}};c.prototype.fd=function(){return 0<this.zp?sc(this.Pa.x,this.Pa.y,this.ia.x,this.ia.y):sc(this.oa.ia.x,this.oa.ia.y,this.ia.x,this.ia.y)};return c}(),kd=function(){function c(a,b,d){this.oa=a;this.control=b;this.ia=d}c.prototype.la=function(a){a.quadraticCurveTo(this.control.x,this.control.y,this.ia.x,this.ia.y)};c.prototype.ff=function(){return this.oa?
sc(this.oa.ia.x,this.oa.ia.y,this.control.x,this.control.y):{x:1,y:0}};c.prototype.fd=function(){return sc(this.control.x,this.control.y,this.ia.x,this.ia.y)};return c}(),ld=function(){function c(a,b,d,e){this.oa=a;this.control=b;this.ia=d;this.$e=e}c.prototype.la=function(a){a.arcTo(this.control.x,this.control.y,this.ia.x,this.ia.y,this.$e)};c.prototype.ff=function(){return{x:1,y:0}};c.prototype.fd=function(){return sc(0,0,1,0)};return c}(),md=function(){function c(a,b,d,e,c,h,k){this.oa=a;this.Sd=
b;this.ia=d;this.$e=e;this.Cp=c;this.sw=h;this.Sv=k}c.prototype.la=function(a){a.arc(this.Sd.x,this.Sd.y,this.$e,this.Cp,this.sw,0!==this.Sv)};c.prototype.ff=function(){return{x:1,y:0}};c.prototype.fd=function(){return sc(0,0,1,0)};return c}(),nd=function(){function c(a,b,d,e){this.Ka=b;this.Pa=d;this.Ka=b;this.Pa=d;this.ia=e;this.oa=a}c.prototype.la=function(a){a.bezierCurveTo(this.Ka.x,this.Ka.y,this.Pa.x,this.Pa.y,this.ia.x,this.ia.y)};c.prototype.ff=function(){return this.oa?sc(this.oa.ia.x,this.oa.ia.y,
this.Ka.x,this.Ka.y):{x:1,y:0}};c.prototype.fd=function(){return sc(this.Pa.x,this.Pa.y,this.ia.x,this.ia.y)};return c}(),od=function(){function c(a,b,d,e){this.oa=a;this.Ka=b;this.Pa=d;this.ia=e}c.prototype.la=function(a){if(this.oa){var b=[];this.oa.Pa&&b.push(this.oa.Pa);this.Ka&&b.push(this.Ka);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.ia.x,this.ia.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,this.ia.x,this.ia.y)}};c.prototype.Dj=function(a){this.oa=a};c.prototype.ff=
function(){return this.oa&&this.oa.Pa?sc(this.oa.ia.x,this.oa.ia.y,this.Ka.x,this.Ka.y):{x:1,y:0}};c.prototype.fd=function(){return this.Ka?sc(this.Ka.x,this.Ka.y,this.ia.x,this.ia.y):{x:1,y:0}};return c}(),pd=function(){function c(a,b,d,e,c){this.oa=a;this.si=b;this.ia=d;this.log=u.create("SEGMENT");this.oa=a;this.si=b;c*=2;var f=2*e.next()-1;e.next();e=this.oa.fd();if(!this.oa.qA&&e){var k=G(a.ia.x,a.ia.y,b.x,b.y);this.Ka=new D(a.ia.x+.5522847498*e.x*k,a.ia.y+.5522847498*e.y*k)}else this.Ka=new D(a.ia.x+
.5522847498*(b.x-a.ia.x),a.ia.y+.5522847498*(b.y-a.ia.y));this.Pa=new D(d.x-.5522847498*(d.x-b.x)*(1-f*c),d.y-.5522847498*(d.y-b.y)*(1-f*c));this.ia=d}c.prototype.Dj=function(a){this.oa=a;var b=this.oa.fd();if(b){var d=G(a.ia.x,a.ia.y,this.si.x,this.si.y);this.Ka=new D(a.ia.x+.5522847498*b.x*d,a.ia.y+.5522847498*b.y*d)}else this.Ka=new D(a.ia.x+.5522847498*(this.si.x-this.oa.ia.x),a.ia.y+.5522847498*(this.si.y-this.oa.ia.y))};c.prototype.la=function(a){a.bezierCurveTo(this.Ka.x,this.Ka.y,this.Pa.x,
this.Pa.y,this.ia.x,this.ia.y)};c.prototype.ff=function(){return this.oa?sc(this.oa.ia.x,this.oa.ia.y,this.Ka.x,this.Ka.y):{x:1,y:0}};c.prototype.fd=function(){return sc(this.Pa.x,this.Pa.y,this.ia.x,this.ia.y)};return c}();var qd=function(){function c(a){this.dj=this.cj=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.fp=a;this.reset()}c.prototype.reset=function(){this.dj=this.cj=this.fp};c.prototype.next=function(){this.dj=36969*(this.dj&65535)+(this.dj>>16);this.cj=18E3*(this.cj&65535)+(this.cj>>16);return((this.dj<<16)+this.cj)/4294967295/2+.5};return c}();var rd=function(){function c(a){this.ma=a;this.n=0;this.xb=new D(0,0)}c.prototype.next=function(a){if(0===this.ma.length)return null;if(0===this.n)return this.xb=this.ma[0].clone(),this.n+=1,this.xb.clone();for(;this.n<this.ma.length;){var b=this.xb.Wb(this.ma[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.xb.x+=(this.ma[this.n].x-this.xb.x)*a/b,this.xb.y+=(this.ma[this.n].y-this.xb.y)*a/b,this.xb.clone()}return null};return c}(),sd=function(){function c(a){this.pd=a;this.$o=
!0;this.ma=[];this.log=u.create("WaveAddon");this.$e=a.ja("waveRadius")}c.prototype.format=function(){var a=this.pd.Um(!1).Op(J.ym).gf();this.log("Format cloud; %s points",a.length);this.ma=this.eB(a,this.$e)};c.prototype.eB=function(a,b){var d=new rd(a),e=1,c=[];if(2>a.length)return c;var h=0;for(var k=1;k<a.length;k++)h+=G(a[k-1].x,a[k-1].y,a[k].x,a[k].y);b=h/Math.round(h/(2*b)+.5)/2;for(h=[];;){k=d.next(2*b);if(!k)break;h.push(k)}h.push(a[a.length-1]);d=h[0];c.push(d);for(a=1;a<h.length;a++){k=
h[a];var l=sc(d.x,d.y,k.x,k.y);var n=b,q=new D(l.y*e,-1*l.x*e);d=new D(d.x+(l.x+q.x)*n,d.y+(l.y+q.y)*n);c.push(d);c.push(k);e*=-1;d=k}for(a=2;a<c.length-1;a+=2)b=c[a-1],e=c[a+1],c[a].x=b.x+(e.x-b.x)/2,c[a].y=b.y+(e.y-b.y)/2;return c};c.prototype.la=function(a){a.beginPath();a.moveTo(this.ma[0].x,this.ma[0].y);for(var b=1;b<this.ma.length-1;b+=2)a.quadraticCurveTo(this.ma[b].x,this.ma[b].y,this.ma[b+1].x,this.ma[b+1].y)};return c}();var J=function(c){function a(b,d){b=c.call(this,b,d)||this;b.za=[];b.$f=0;b.ee=[];b.Ap=[];b.cu=!1;b.inverse=new I;b.origin=new D(0,0);b.dd=[];b.Hd=new Cc;b.js=!1;b.backgroundImage=null;b.Qf=null;b.log=u.create("PATHNODE");b.log("New PathNode Created");b.Sb=new gd("",d);b.Sb.setProperty("text",b.ba.text);b.Sm(a.va);b.ba.closed=!1;b.ba.commands=[];b.ba.seed=0;return b}__extends(a,c);a.prototype.moveTo=function(b,d){var e=this.ba.commands;e.push(a.Vg);e.push(b);e.push(d)};a.prototype.ov=function(b,d,
e,c,h,k){var f=this.ba.commands;f.push(a.Zh);f.push(h);f.push(k);f.push(b);f.push(d);f.push(e);f.push(c)};a.prototype.type=function(){return"PathNode"};a.prototype.qg=function(){return!0};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "bold":case "fontName":case "fontSize":case "italic":case "text":case "textAlign":case "textDecoration":case "wrap":this.ba[a]=d;this.Sb.setProperty(a,d);break;case "textFillStyle":this.Sb.setProperty("fillStyle",d);this.ba[a]=
d;break;case "textBackground":this.Sb.setProperty("background",d);this.ba[a]=d;break;case "cloudRadius":case "waveRadius":case "doubleLine":case "doubleLineDashSide":case "spotHighlight":case "verticalAlign":this.ba[a]=d;break;case "backgroundImage":this.ba[a]=d,this.backgroundImage=null}};a.prototype.ja=function(a){switch(a){case "textAlign":return this.ba[a]||"center"}return c.prototype.ja.call(this,a)};a.prototype.$k=function(b){for(var d=0,e=this.ba.commands,c=b/3|0,h=0;h<c;h++)d+=a.ib[e[d]]+
1;h=b%3*2+1;c=e[d+h];d=e[d+h+1];this.log("getEditHandle(%s) = (%s, %s)",b,c,d);this.Na().apply(c,d)};a.prototype.Ue=function(b,d,e){for(var c=0,h=this.ba.commands,k=b/3|0,l=0;l<k;l++)c+=a.ib[h[c]]+1;k=this.inverse.apply(d,e);l=b%3*2+1;h[c+l]=k.x;h[c+l+1]=k.y;if(0===b&&this.ba.closed){for(b=null;c<h.length;)k=a.ib[h[c]],2<=k&&(b=c),c+=k+1;b&&(c=b,k=this.inverse.apply(d,e),h[c+1]=k.x,h[c+2]=k.y)}};a.prototype.Hn=function(){return"commands"};a.prototype.rz=function(b){for(var d=this.ba.commands,e=0,
c=0;c<b/3;c++)e+=a.ib[d[e]]+1;d.splice(e,a.ib[d[e]]+1)};a.prototype.Nw=function(){return this.ja("arrowXOffset")||this.ja("arrowSize")};a.prototype.format=function(b,d){var e=this,c=null;this.za.length=0;this.inverse=this.ba.matrix.inverse();var h=new D(0,0),k=this.ba.commands,l=null,n=this.ba.matrix,q=new qd(this.ba.seed);this.Ap.length=0;for(var v=null,x=null,w=0;w<k.length;){switch(k[w++]){case a.Vg:h=n.apply(k[w++],k[w++]);x=new hd(l,h);this.za.push(x);null===c&&(c=h);this.Ap.push(h);v=null;break;
case a.Be:l&&(h=n.apply(k[w++],k[w++]),this.za.push(new id(l,h,q,this.ba.sloppiness,this.ba.roundRadius)),this.Ap.push(h));break;case a.Wg:if(l){h=n.apply(k[w++],k[w++]);var y=n.apply(k[w++],k[w++]);this.za.push(new kd(l,y,h))}break;case a.xm:if(l){h=n.apply(k[w++],k[w++]);y=n.apply(k[w++],k[w++]);var B=k[w++];this.za.push(new ld(l,y,h,B))}break;case a.wm:if(l){h=n.apply(k[w++],k[w++]);y=n.apply(k[w++],k[w++]);B=k[w++];var E=k[w++],L=k[w++],H=k[w++];this.za.push(new md(l,y,h,B,E,L,H))}break;case a.Zh:l&&
(h=n.apply(k[w++],k[w++]),B=n.apply(k[w++],k[w++]),y=n.apply(k[w++],k[w++]),this.za.push(new nd(l,B,y,h)));break;case a.sq:l&&(h=n.apply(k[w++],k[w++]),B=n.apply(k[w++],k[w++]),y=n.apply(k[w++],k[w++]),this.za.push(new od(l,B,y,h)));break;case a.Tj:l&&(h=n.apply(k[w++],k[w++]),this.za.push(new jd(l,h,this.ba.smoothness)));break;case a.zm:l&&(h=n.apply(k[w++],k[w++]),B=n.apply(k[w++],k[w++]),this.za.push(new pd(l,B,h,q,this.ba.sloppiness)));break;case a.Wc:this.ba.closed=!0;v&&l&&v!==l&&v.Dj&&x&&(v.Dj(l),
l.ia=x.ia);break;default:w++}l=this.za[this.za.length-1];null!==v||l instanceof hd||(v=l)}this.origin=c||new D(0,0);this.$f=this.za.length;this.Gw(q);this.rect.x=this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;this.dd=Hc(this.ba.dashes||"");h=this.dd.length?a.ym:a.ou;this.Hd=this.Um(!0).Op(h);c=0+this.ja("shapeWidth");0<c&&(this.Hd=this.Pv(this.Hd,c));this.rect=this.Hd.qk(h);c=this.rect.width-2*(this.ba.lineWidth/2+1);k=this.ba.lineWidth;l=this.Hd.clone();l.transform(this.Qc());
this.Aa=l.qk(h);h=this.Na().sb();this.Aa.Ed(Math.ceil(k/h.x),Math.ceil(k/h.y));this.rect.Ed(k+1,k+1);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);if(""!==this.ba.text){h=this.rect.Sd();this.Sb.setProperty("textAlign",this.ba.textAlign||"center");this.Sb.setProperty("baseWidth",c);this.Sb.format(b,d);c=h.x-this.Sb.rect.x-this.Sb.rect.width/2;k=0;switch(this.ba.verticalAlign){default:case "middle":k=
h.y-this.Sb.rect.y-this.Sb.$n/2;break;case "top":k=this.rect.y-this.Sb.rect.y;break;case "bottom":k=this.rect.bottom()-this.Sb.$n-this.Sb.rect.y}this.Sb.transform(new uc(c,k));this.Sb.format(b,d)}this.cu=0===r.me(this.ba.fillStyle).values[3]&&!this.backgroundImage&&!this.ba.spotHighlight;this.Pr("fill",b,d,this.ba.fillStyle);this.ee.length=0;0<this.ba.cloudRadius?this.ee.push(new Tc(this)):0<this.ba.waveRadius?this.ee.push(new sd(this)):this.ba.doubleLine&&this.ee.push(new td(this));for(w=0;w<this.ee.length;w++)this.ee[w].format(b);
(b=this.ja("backgroundImage"))&&null===this.backgroundImage&&d.add(this.id,"image",b,null,function(a){e.backgroundImage=a;d.Kf(e.id)});b=/url\(([^\)]+)\)/.exec(this.ja("strokeStyle"));var z;b&&(z=b[1]);!z||null!==this.Qf&&this.Qf.src===z?!z&&this.Qf&&(this.Qf=null):d.add(this.id,"image",z,null,function(a){e.Qf=a;d.Kf(e.id)})};a.prototype.hl=function(){return this.Hd};a.prototype.Gw=function(a){function b(b,d){b=b.clone();l&&(b.x+=d.x*h*.5,b.y+=d.y*h*.5);var f=b.x-d.x*h;var n=b.y-d.y*h;var q=f+d.y*
c/2;var v=n-d.x*c/2;f+=-d.y*c/2;n+=d.x*c/2;e.za.push(new hd(e.za[e.za.length-1],new D(f,n)));e.za.push(new jd(e.za[e.za.length-1],b,k));e.za.push(new jd(e.za[e.za.length-1],new D(q,v),k));"solid"===e.ba.arrowStyle&&e.za.push(new id(e.za[e.za.length-1],new D(f,n),a,e.ba.smoothness,0))}if(this.js=0<this.ba.arrowSize&&!this.ba.closed&&0<this.za.length){var e=this,c=this.ba.arrowSize+1.5*this.ba.lineWidth,h=this.ba.arrowXOffset,k=this.ba.smoothness,l=this.ba.doubleLine;null===h&&(h=c);var n=this.za[this.za.length-
1];b(n.ia,n.fd());this.ba.doubleArrow&&b(this.za[0].ia,tc(this.za[1].ff()))}};a.prototype.close=function(){this.ba.commands.push(a.Wc)};a.prototype.lv=function(){var a=this.za[this.za.length-1];a&&8>=G(a.ia.x,a.ia.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.Pv=function(a,d){this.log("ConvertToRects: width=%s",d);var b=0;a=a.fa;for(var c=0,h=0,k,l,n=new Cc;b<a.length;){this.log("cmd %s %s %s",a[b],a[b+1],a[b+2]);switch(a[b]){case Cc.Yc:c=a[b+1];h=a[b+2];break;case Cc.Xc:k=a[b+1];l=a[b+
2];this.log("(%s,%s-%s,%s)",c,h,k,l);if(0<G(c,h,k,l)){var q=sc(c,h,k,l),v=q.y*d/2;q=-q.x*d/2;n.moveTo(c+v,h+q);n.lineTo(k+v,l+q);n.lineTo(k-v,l-q);n.lineTo(c-v,h-q);n.closePath()}c=k;h=l}b+=Cc.$c[a[b]]}return n};a.prototype.clip=function(a){if(this.ba.closed){var b=new Cc;this.log("Clipping to a path");for(var e=0;e<this.za.length;e++)this.za[e].la(b);b.closePath();0>b.ji()&&(b=b.yz());b.la(a)}};a.prototype.la=function(a){this.ba.spotHighlight?this.log("Not drawing node %s due to spothighlight",this.id):
c.prototype.la.call(this,a)};a.prototype.pf=function(a){var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,b.m22,b.Ea,b.Fa);a.beginPath();a.lineCap="round";b=!0;var e;for(e=0;e<this.ee.length;e++)this.ee[e].$o&&(b=!1);this.Qf&&(b=!1);if(b)for(e=0;e<this.za.length;e++)this.za[e].la(a);for(e=0;e<this.ee.length;e++)this.ee[e].la(a);if(!b&&0<this.ba.arrowSize)for(e=this.$f;e<this.za.length;e++)this.za[e].la(a);if(this.ba.closed){a.closePath();if(this.backgroundImage){a.fillStyle=
a.createPattern(this.backgroundImage,"no-repeat")||"magenta";e=Math.max(this.rect.width/this.backgroundImage.naturalWidth,this.rect.height/this.backgroundImage.naturalHeight);var c=this.rect.width-this.backgroundImage.naturalWidth*e,h=this.rect.height-this.backgroundImage.naturalHeight*e;a.translate(this.rect.x+c/2,this.rect.y+h/2);a.scale(e,e);a.fill();a.scale(1/e,1/e);a.translate(-this.rect.x-c/2,-this.rect.y-h/2)}else a.fillStyle=this.Xr("fill"),a.fill();a.shadowColor="rgba(0,0,0,0.0)"}b&&(this.dd.length&&
0<this.ba.lineWidth?(a.beginPath(),this.Hd.Kk(a,this.dd),a.lineCap="butt"):0<0+this.ja("shapeWidth")&&(a.beginPath(),this.Hd.la(a)));if(this.Qf){if(c=this.Hd.gf(),b=this.Qf,!(2>c.length||(e=0,c=Sc(c),h=c.next(),h.done)))for(var k=h.value.Hh,l=b.width;!h.done;){h=c.next(l);if(h.done)break;var n=h.value.Hh,q=h.value.length,v=e%b.width;e+=q;l-=q;0>=l&&(l+=b.width);var x=Math.atan2(n.y-k.y,n.x-k.x);a.save();a.translate(k.x,k.y);a.rotate(x);a.translate(0,-b.height/2);a.drawImage(b,v,0,q,b.height,0,0,q,
b.height);a.restore();k=n}}else 0<this.ba.lineWidth&&a.stroke();if(this.ba.arrowSize&&"solid"===this.ba.arrowStyle){a.beginPath();for(e=this.$f;e<this.za.length;e++)this.za[e].la(a);a.fillStyle=this.ba.strokeStyle;a.fill()}else if(this.ba.arrowSize&&this.dd.length){a.beginPath();for(e=this.$f;e<this.za.length;e++)this.za[e].la(a);0<this.ba.lineWidth&&a.stroke()}""!==this.ba.text&&this.Sb.la(a);a.restore()};a.prototype.Db=function(a,d,e){if(this.hidden()||this.ja("locked"))return null;e=Math.max(12+
this.ba.shapeWidth/2+this.ba.lineWidth/2,e);if(a>=this.rect.x-e&&a<this.rect.x+e+this.rect.width&&d>=this.rect.y-e&&d<this.rect.y+e+this.rect.height)if(this.ba.closed&&!this.cu){if(this.Hd.gz(a,d,e))return this}else if(this.Hd.kt(a,d,e)||""!==this.ba.text&&this.Sb.Db(a,d,e))return this;return null};a.prototype.Um=function(a){var b=new Cc;if(0<this.ba.arrowSize&&!a)for(a=0;a<this.$f;a++)this.za[a].la(b);else for(a=0;a<this.za.length;a++)this.za[a].la(b);this.ba.closed&&b.closePath();return b};a.prototype.lineTo=
function(b,d){var e=this.ba.commands;e.push(a.Be);e.push(b);e.push(d)};a.prototype.ui=function(b,d){var e=this.ba.commands;e.push(a.Tj);e.push(b);e.push(d)};a.prototype.se=function(){return!1!==this.ba.editable&&!0!==this.ba.lockEditMode};a.prototype.St=function(){var b=this.ba.commands;return 6===b.length&&b[3]===a.Be};a.prototype.tl=function(a,d,e){e*=8;if(a>=this.origin.x-e&&a<this.origin.x+e&&d>=this.origin.y-e&&d<this.origin.y+e)return 0;for(var b=0;b<this.$f;b++){var c=this.za[b];if(a>=this.za[b].ia.x-
e&&a<this.za[b].ia.x+e&&d>=this.za[b].ia.y-e&&d<this.za[b].ia.y+e)return 3*b;if(c.control){if(a>=c.control.x-e&&a<c.control.x+e&&d>=c.control.y-e&&d<c.control.y+e)return 3*b+1}else if(c.Ka){if(a>=c.Ka.x-e&&a<c.Ka.x+e&&d>=c.Ka.y-e&&d<c.Ka.y+e)return 3*b+1;if(c.Pa&&a>=c.Pa.x-e&&a<c.Pa.x+e&&d>=c.Pa.y-e&&d<c.Pa.y+e)return 3*b+2}}return null};a.prototype.al=function(b){var d=this.ba.commands;b/=3;var e=0,c=!1,h=0,k;for(k=0;k<d.length;){var l=d[k];if(l===a.Wc){c=!0;break}h+=1;k+=a.ib[d[k]]+1}0===b&&c&&
(b=h-1);for(k=0;k<d.length;e++){c=null;switch(d[k]){case a.Vg:c="move_to";break;case a.Be:c="line_to";break;case a.Wg:c="quadratic_to"}if(b===e)return c;k+=a.ib[d[k]]+1}return null};a.Au=function(b,d,e){d/=3;var c=0,h=[],k=new D(0,0),l=!1,n=0,q;for(q=0;q<b.length;){var v=b[q];if(v===a.Wc){l=!0;break}n+=1;q+=a.ib[b[q]]+1}0===d&&l&&(d=n-1);for(q=0;q<b.length;c++){v=b[q];l=!1;d===c&&(v===a.Wg&&"line_to"===e?(h.push(a.Be,b[q+1],b[q+2]),l=!0):v===a.Be&&"quadratic_to"===e&&(h.push(a.Wg,b[q+1],b[q+2],(k.x+
b[q+1])/2,(k.y+b[q+2])/2),l=!0));k=new D(b[q+1],b[q+2]);if(!l)for(v=0;v<1+a.ib[b[q]];v++)h.push(b[q+v]);q+=a.ib[b[q]]+1}return h};a.prototype.vs=function(){return!0};a.prototype.Lk=function(a,d,e){function b(b,d,e){a.beginPath();a.rect(b-c,d-c,2*c,2*c);a.fillStyle=e?"#0050B7":"#ffffff";a.fill();a.stroke()}a.save();a.lineWidth=1*d;a.strokeStyle="#000";a.lineWidth=1;a.shadowBlur=3*d;a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowColor="rgba(0,0,0,0.2)";a.strokeStyle="#ccc";a.fillStyle="#ffffff";var c=
6*d;b(this.origin.x,this.origin.y,0===e);for(d=1;d<this.$f;d++){var k=this.za[d];a.beginPath();if(k.control)a.arc(k.control.x,k.control.y,c,0,2*Math.PI),a.arc(k.control.x,k.control.y,2*c,0,2*Math.PI),e===3*d+1?a.fill():a.stroke();else if(k instanceof nd||k instanceof od){var l=k.Ka;var n=k.Pa;var q=k.oa.ia;l&&(a.moveTo(q.x,q.y),a.lineTo(l.x,l.y),a.moveTo(l.x+c,l.y),a.arc(l.x,l.y,c,0,2*Math.PI),e===3*d+1?a.fill():a.stroke());a.beginPath();a.moveTo(k.ia.x,k.ia.y);a.lineTo(n.x,n.y);a.moveTo(n.x+c,n.y);
a.arc(n.x,n.y,c,0,2*Math.PI);e===3*d+2?a.fill():a.stroke()}b(this.za[d].ia.x,this.za[d].ia.y,e===3*d)}a.restore()};a.qu=function(a){var b=new M,e=0;for(a=a.fa;e<a.length;){switch(a[e]){case Cc.Yc:b.moveTo(a[e+1],a[e+2]);break;case Cc.Xc:b.lineTo(a[e+1],a[e+2]);break;case Cc.lf:b.bezierCurveTo(a[e+1],a[e+2],a[e+3],a[e+4],a[e+5],a[e+6]);break;case Cc.nf:b.quadraticCurveTo(a[e+1],a[e+2],a[e+3],a[e+4]);break;case Cc.Wc:b.close()}e+=Cc.$c[a[e]]}return b.ac()};a.va={strokeStyle:"#000000",fillStyle:"#ffffff",
fontName:"Arial",fontSize:20,lineWidth:2,dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1};a.ou=8;a.ym=2;a.Vg=0;a.Be=1;a.Wg=2;a.xm=3;a.Zh=4;a.Tj=5;a.zm=6;a.Wc=7;a.sq=8;a.wm=9;a.tB=.5522847498;a.ib=[];return a}(dd);J.ib[J.Vg]=2;J.ib[J.Be]=2;J.ib[J.Wg]=4;J.ib[J.xm]=5;J.ib[J.Zh]=6;J.ib[J.Tj]=2;J.ib[J.zm]=4;J.ib[J.Wc]=0;J.ib[J.sq]=6;J.ib[J.wm]=8;
var M=function(){function c(a){void 0===a&&(a=[]);this.fa=a}c.prototype.beginPath=function(){};c.prototype.sf=function(a,b,d){for(var e=0,c=0;c<a;c++)e+=J.ib[this.fa[e]]+1;this.fa[e+1]=b;this.fa[e+2]=d};c.prototype.moveTo=function(a,b){this.fa.push(J.Vg);this.fa.push(a);this.fa.push(b)};c.prototype.lineTo=function(a,b){this.fa.push(J.Be);this.fa.push(a);this.fa.push(b)};c.prototype.ui=function(a,b){this.fa.push(J.Tj);this.fa.push(a);this.fa.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.fa.push(J.Wg);
this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b)};c.prototype.dg=function(a,b,d,e){this.fa.push(J.zm);this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b)};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){this.fa.push(J.Zh);this.fa.push(c);this.fa.push(h);this.fa.push(a);this.fa.push(b);this.fa.push(d);this.fa.push(e)};c.prototype.arc=function(a,b,d,e,c,h){void 0===h&&(h=!0);var f=(new vc(-c,a,b)).apply(a+d,b);this.fa.push(J.wm);this.fa.push(f.x);this.fa.push(f.y);this.fa.push(a);
this.fa.push(b);this.fa.push(d);this.fa.push(e);this.fa.push(c);this.fa.push(h?1:0)};c.prototype.arcTo=function(a,b,d,e,c){this.fa.push(J.xm);this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b);this.fa.push(c)};c.prototype.Sr=function(){for(var a=[],b=0;b<this.fa.length;){for(var d=this.fa[b],e=0;e<J.ib[d];e+=2)a.push(new D(this.fa[b+1+e],this.fa[b+1+e+1]));b+=J.ib[d]+1}a=F.$h(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.KA=function(a,b){for(var d=0;d<this.fa.length;){for(var e=
this.fa[d],c=0;c<J.ib[e];c+=2)this.fa[d+1+c]+=a,this.fa[d+2+c]+=b;d+=J.ib[e]+1}};c.prototype.translate=function(){throw Error("Not implemented: translate");};c.prototype.scale=function(){throw Error("Not implemented: scale");};c.prototype.rotate=function(){throw Error("Not implemented: rotate");};c.prototype.closePath=function(){this.fa.push(J.Wc)};c.prototype.close=function(){this.closePath()};c.prototype.ac=function(){return this.fa};return c}();M.prototype.change=M.prototype.sf;
M.prototype.moveTo=M.prototype.moveTo;M.prototype.lineTo=M.prototype.lineTo;M.prototype.curveTo=M.prototype.ui;M.prototype.quadraticCurveTo=M.prototype.quadraticCurveTo;M.prototype.cornerTo=M.prototype.dg;M.prototype.bezierCurveTo=M.prototype.bezierCurveTo;M.prototype.arc=M.prototype.arc;M.prototype.arcTo=M.prototype.arcTo;M.prototype.getBoundingBox=M.prototype.Sr;M.prototype.translateAll=M.prototype.KA;M.prototype.closePath=M.prototype.closePath;M.prototype.close=M.prototype.close;
M.prototype.toArray=M.prototype.ac;dd.vd("PathNode",J);M.prototype.beginPath=M.prototype.beginPath;M.prototype.change=M.prototype.sf;M.prototype.moveTo=M.prototype.moveTo;M.prototype.lineTo=M.prototype.lineTo;M.prototype.curveTo=M.prototype.ui;M.prototype.quadraticTo=M.prototype.SB;M.prototype.cornerTo=M.prototype.dg;M.prototype.bezierTo=M.prototype.ov;M.prototype.arc=M.prototype.arc;M.prototype.arcTo=M.prototype.arcTo;M.prototype.getBoundingBox=M.prototype.Sr;M.prototype.translate=M.prototype.translate;
M.prototype.closePath=M.prototype.closePath;M.prototype.close=M.prototype.close;M.prototype.toArray=M.prototype.ac;var td=function(){function c(a){this.pd=a;this.$e=0;this.$o=!0;this.pl=!1;this.path=new Cc;this.Rl=new Cc;this.log=u.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.pd.ja("doubleLine"));var a=this.pd.Um(!1).Op(J.ym),b=this.pd.Nw();if(0<b){var d=a.tv();d>b&&(a=a.wv(d-b))}a=a.gf();b=this.pd.ja("doubleLine");this.path=new Cc;this.Rl=new Cc;d=this.pd.ja("doubleLineDashSide");this.pl=!1;"outer"===d?(Oc(this.path,a,b,!0,!1),Oc(this.Rl,a,b,!1,!0),
this.pl=!0):"inner"===d?(Oc(this.path,a,b,!1,!0),Oc(this.Rl,a,b,!0,!1),this.pl=!0):Oc(this.path,a,b,!0,!0)};c.prototype.la=function(a){a.beginPath();this.pd.dd.length&&this.pl?(this.Rl.Kk(a,this.pd.dd),this.path.la(a)):this.pd.dd.length?this.path.Kk(a,this.pd.dd):this.path.la(a)};return c}();u.create("Dialog");
function ud(c,a){function b(){var a=e.offsetWidth,b=e.offsetHeight,d=A.nl();A(e).em({left:d.x+d.width/2-a/2,top:d.y+d.height/2-b/2})}function d(a){A.Df(a.target)||q&&setTimeout(function(){w.hide()},0)}void 0===a&&(a={});var e=A.ic(c);if(!e)throw Error("Zwibbler.Dialog: Bad element passed in: "+c);c=a.overlayColour||"transparent";var f=null===e.parentNode;f&&document.body.appendChild(e);"static"===A(e).qe("position")&&(e.style.position="absolute");var h=A(e).qe("display");"none"===h&&(h="block");e.style.display=
"none";var k=new bb(c);k.insertBefore=e;var l=a.showNear||null,n=a.showHow||"",q=!1,v=vd(e),x=!1,w={hide:function(){k.Qe();e.style.display="none";if(w.onhide)w.onhide();window.removeEventListener("resize",b)},isShown:function(){return"none"!==A(e).qe("display")},show:function(a,d,c,f){void 0===c&&(c=!1);void 0===f&&(f=!0);var x=0,v=0,y="",B="";"number"===typeof a&&"number"===typeof d?(x=a,v=d,a=!0):(y=a||l,B=d||n,a=!1);d=A.Yr()+1;e.style.zIndex=d.toString();k.zIndex=d;e.style.display=h;e.style.visibility=
"hidden";if(a)setTimeout(function(){var a=e.offsetWidth,b=e.offsetHeight,d=A.nl(),c={left:x,top:v};c.left=Math.min(c.left,d.x+d.width-a-2);c.top=Math.min(c.top,d.y+d.height-b-3);A(e).em(c);e.style.visibility="visible";if(w.onshow)w.onshow()},0);else if(y&&B)if(y=A.ic(y)){var E=A(y).Yb();setTimeout(function(){e.style.visibility="visible";var a=e,b={left:E.left,top:E.top},d=B.toLowerCase().split(" ");2!==d.length&&(d=["tl","tl"]);0<=d[0].indexOf("b")&&(b.top+=E.height);0<=d[0].indexOf("r")&&(b.left+=
E.width);0<=d[0].indexOf("c")&&(b.left+=E.width/2);0<=d[1].indexOf("b")&&(b.top-=a.offsetHeight);0<=d[1].indexOf("r")&&(b.left-=a.offsetWidth);0<=d[1].indexOf("c")&&(b.left-=a.offsetWidth/2);a.style.position="absolute";d=A.nl();var c=a.offsetHeight;b.left=Math.min(b.left,d.x+d.width-a.offsetWidth);b.top=Math.min(b.top,d.y+d.height-c);A(a).em(b)},0)}else{if(w.onshow)w.onshow()}else window.addEventListener("resize",b),setTimeout(function(){e.style.visibility="visible";b();if(w.onshow)w.onshow()},0);
var L=e.querySelector("[z-focus]");L&&setTimeout(function(){L.focus()},0);f&&k.show(w.hide);q=c},destroy:function(){x||(x=!0,w.isShown()&&w.hide(),k.Qe(),window.removeEventListener("resize",b),e.removeEventListener("click",d),v(),f&&A(e).remove())},onshow:a.onshow||function(){},onhide:a.onhide||function(){}};e.addEventListener("click",d);return w}
function vd(c){function a(a){"touchstart"===a.type?(b=a.changedTouches[0].pageX,d=a.changedTouches[0].pageY):"touchend"===a.type&&10>G(b,d,a.changedTouches[0].pageX,a.changedTouches[0].pageY)&&setTimeout(function(){c.dispatchEvent(new Event("click"))},100)}var b=-1,d=-1;c.addEventListener("touchstart",a);c.addEventListener("touchend",a);return function(){c.removeEventListener("touchstart",a);c.removeEventListener("touchend",a)}};var wd=u.create("FitCurve");
function xd(c){function a(a,b){H.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y);wd("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)}function b(a,b){return a.x*b.x+a.y*b.y}function d(a){var b=1-a;return 3*a*b*b}function e(a){return 3*a*a*(1-a)}function f(a,b){var d=a.x-b.x;a=a.y-b.y;return Math.sqrt(d*d+a*a)}function h(a){return a.x*a.x+a.y*a.y}function k(a,b){var d=Math.sqrt(h(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function l(a,b,d){void 0===
d&&wd("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function n(a,b){return{x:a.x+b.x,y:a.y+b.y}}function q(a,b){return{x:a.x*b,y:a.y*b}}function v(a,b){return{x:a.x-b.x,y:a.y-b.y}}function x(a,c,h,x,w,y){var B,z=[],E=[[],[]],K=[];var L=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var W=h-c+1;for(B=0;B<W;B++){var H={x:w.x,y:w.y};var U={x:y.x,y:y.y};k(H,d(x[B]));k(U,e(x[B]));z[B]=[H,U]}E[0][0]=0;E[0][1]=0;E[1][0]=0;E[1][1]=0;K[0]=0;for(B=K[1]=0;B<W;B++)E[0][0]+=b(z[B][0],z[B][0]),E[0][1]+=b(z[B][0],z[B][1]),
E[1][0]=E[0][1],E[1][1]+=b(z[B][1],z[B][1]),H=1-x[B],U=x[B],H=v(a[c+B],n(q(a[c],H*H*H),n(q(a[c],d(x[B])),n(q(a[h],e(x[B])),q(a[h],U*U*U))))),K[0]+=b(z[B][0],H),K[1]+=b(z[B][1],H);x=E[0][0]*E[1][1]-E[1][0]*E[0][1];B=E[0][0]*K[1]-E[0][1]*K[0];K=K[0]*E[1][1]-K[1]*E[0][1];0===x&&(x=E[0][0]*E[1][1]*1E-11);E=K/x;K=B/x;if(0>E||0>K)return E=f(a[h],a[c])/3,L[0]=a[c],L[3]=a[h],l(L[0],k(w,E),L[1]),l(L[3],k(y,E),L[2]),L;L[0]=a[c];L[3]=a[h];l(L[0],k(w,E),L[1]);l(L[3],k(y,K),L[2]);return L}function w(a,b,d){var e;
var c=[];for(e=0;e<=a;e++)c[e]={x:b[e].x,y:b[e].y};for(e=1;e<=a;e++)for(b=0;b<=a-e;b++)c[b].x=(1-d)*c[b].x+d*c[b+1].x,c[b].y=(1-d)*c[b].y+d*c[b+1].y;return c[0]}function y(a){var b=Math.sqrt(Math.sqrt(h(a)));0!==b&&(a.x/=b,a.y/=b);return a}function B(a,b,d,e,c){var f,k=(d-b+1)/2;var l=0;for(f=b+1;f<d;f++){var n=w(3,e,c[f-b]);n=v(n,a[f]);n=h(n);n>=l&&(l=n,k=f)}return{Is:l,Ut:k}}function E(b,d,e,c,h,n){var q;var z=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var H=n*n;if(2===e-d+1)n=f(b[e],b[d])/3,z[0]=
b[d],z[3]=b[e],l(z[0],k(c,n),z[1]),l(z[3],k(h,n),z[2]),a(3,z);else{var K=[0];for(q=d+1;q<=e;q++)K[q-d]=K[q-d-1]+f(b[q],b[q-1]);for(q=d+1;q<=e;q++)K[q-d]/=K[e-d];var W=K;z=x(b,d,e,W,c,h);q=B(b,d,e,z,W);K=q.Is;q=q.Ut;if(K<n)a(3,z);else{if(K<H||L)for(H=0;4>H;H++){q=b;K=d;var U=e;var wa=z;var La=[];for(z=K;z<=U;z++){var Jf=La,wg=z-K,V,xb=wa,Pb=q[z],Qb=W[z-K],Xa=[];var hb=[];var Rb=w(3,xb,Qb);for(V=0;2>=V;V++)Xa[V]={x:0,y:0},Xa[V].x=3*(xb[V+1].x-xb[V].x),Xa[V].y=3*(xb[V+1].y-xb[V].y);for(V=0;1>=V;V++)hb[V]=
{x:0,y:0},hb[V].x=2*(Xa[V+1].x-Xa[V].x),hb[V].y=2*(Xa[V+1].y-Xa[V].y);V=w(2,Xa,Qb);hb=w(1,hb,Qb);Jf[wg]=Qb-((Rb.x-Pb.x)*V.x+(Rb.y-Pb.y)*V.y)/(V.x*V.x+V.y*V.y+(Rb.x-Pb.x)*hb.x+(Rb.y-Pb.y)*hb.y)}U=La;z=x(b,d,e,U,c,h);q=B(b,d,e,z,U);K=q.Is;q=q.Ut;if(K<n||L){a(3,z);return}W=U}U={x:0,y:0};H=v(b[q-1],b[q]);K=v(b[q],b[q+1]);U.x=(H.x+K.x)/2;U.y=(H.y+K.y)/2;H=U=y(U);E(b,d,q,c,H,n);H.x=-H.x;H.y=-H.y;E(b,q,e,H,h,n)}}}var L=!0;void 0===L&&(L=!1);var H=new Cc;H.moveTo(c[0].x,c[0].y);(function(a,b,d){var e=v(a[1],
a[0]);e=y(e);var c=b-1;c=v(a[c-1],a[c]);c=y(c);E(a,0,b-1,e,c,d)})(c,c.length,25);return H};function yd(c,a,b,d,e,f){var h=!1;c.save();switch(b){case 0:case 3:var k=a.height;var l=a.width;break;default:k=a.width,l=a.height}switch(b){case 2:h=!0}c.translate(a.x,a.y);c.fillStyle="rgba(0, 0, 0, 0.2)";c.fillStyle="#ccc";c.fillRect(0,0,a.width,a.height);c.lineWidth=1;c.fillStyle="black";c.strokeStyle="black";c.font="10px sans-serif";a=Math.ceil(50/e);b=f/e;var n=Math.ceil(b/a)*a;f=n;c.beginPath();if(h)for(b=(n-b)*e;b<l;)c.moveTo(0,b),c.lineTo(k,b),h=f.toString()+d,c.fillText(h,0,b+1+10),f+=a,
b+=e*a;else for(b=(n-b)*e;b<l;)c.moveTo(b,k),c.lineTo(b,0),h=f.toString()+d,c.fillText(h,b+1,10),f+=a,b+=e*a;c.stroke();c.restore()};var Bd=function(c){function a(a,d,e){void 0===e&&(e=kc()?new zd:new Ad);var b=c.call(this)||this;b.md=d;b.yr=e;b.jj=!0;b.width=32;b.height=500;b.$B=0;b.Tb=new F(0,0,0,0);b.Nb=!1;b.pg="auto";b.DB="#fcfcfc";b.EB="#808080";b.borderWidth=0;b.wf=0;b.vf=100;b.eq=10;b.position=5;b.offset=0;b.log=u.create("SCROLLBAR",!0);b.jj=!0;b.canvas=jc(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.canvas.classList.add("zwibbler-scrollbar");b.canvas.classList.add("zwibbler-passthrough");
b.ra=b.canvas.getContext("2d");a.addEventListener(b.canvas,"mousedown",function(a){b.Eb(a)});a.addEventListener(document.body,"mousemove",function(a){b.yb(a)});a.addEventListener(document.body,"mouseup",function(a){b.Pb(a)});a.addEventListener(b.canvas,"touchstart",function(a){b.Jo(a)});a.addEventListener(document.body,"touchmove",function(a){b.Jo(a)});a.addEventListener(document.body,"touchend",function(a){b.Jo(a)});b.format();return b}__extends(a,c);a.prototype.wd=function(a){a.appendChild(this.canvas)};
a.prototype.Mt=function(a){this.pg=a;this.la()};a.prototype.moveTo=function(a,d){this.canvas.style.left=""+a+"px";this.canvas.style.top=""+d+"px"};a.prototype.Mf=function(a,d){this.width=a;this.height=d;this.canvas.width=this.width;this.canvas.height=d;this.format();this.la()};a.prototype.Qe=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.ay=function(){return"block"===this.canvas.style.display};a.prototype.Qt=function(a,d,e,c){this.wf=
a;this.vf=d-a;this.eq=e;this.position=c;this.format();this.la()};a.prototype.format=function(){var a=this.md?this.width:this.height;var d=this.eq/this.vf*a;a*=(this.position-this.wf)/this.vf;this.Tb=this.md?new F(a,0,d,this.height):new F(0,a,this.width,d);this.Tb.x=Math.round(this.Tb.x);this.Tb.y=Math.round(this.Tb.y);this.Tb.width=Math.round(this.Tb.width);this.Tb.height=Math.round(this.Tb.height)};a.prototype.la=function(){var a=this.ng()-this.yr.gs();if(this.md)var d=0;else d=a,a=0;d={md:this.md,
rect:{x:d,y:a,width:this.width-d,height:this.height-a},Md:{x:this.Tb.x+d,y:this.Tb.y+a,width:this.Tb.width-d,height:this.Tb.height-a},pg:this.pg};this.ra.clearRect(0,0,this.ra.canvas.width,this.ra.canvas.height);this.yr.la(this.ra,d)};a.prototype.Fr=function(a){var b=A(this.canvas).Yb(),e=0,c=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)e=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||"mousemove"===a.type)e=a.pageX,
c=a.pageY;return new D(e-b.left,c-b.top)};a.prototype.Jo=function(a){switch(a.type){case "touchstart":this.Eb(a);break;case "touchend":this.Pb(a);break;case "touchmove":this.yb(a)}};a.prototype.lt=function(a){a=this.md?a.x/this.width*this.vf+this.wf:a.y/this.height*this.vf+this.wf;a=Math.min(a,this.vf-this.eq+this.wf);return a=Math.max(a,this.wf)};a.prototype.Eb=function(a){a.preventDefault();a=this.Fr(a);this.Tb.cd(a.x,a.y)?this.md?(this.offset=a.x-this.Tb.x,a.x-=this.offset):(this.offset=a.y-this.Tb.y,
a.y-=this.offset):(this.position=this.lt(a),this.offset=0,this.md?this.Tb.x=(this.position-this.wf)/this.vf*this.width:this.Tb.y=(this.position-this.wf)/this.vf*this.height,this.sa("scroll",this.position),this.la());this.Nb=!0};a.prototype.yb=function(a){this.Nb&&(this.Nb&&"mousemove"===a.type&&0===a.buttons?this.Nb=!1:(a.preventDefault(),a=this.Fr(a),this.md?a.x-=this.offset:a.y-=this.offset,this.position=this.lt(a),this.sa("scroll",this.position),this.format(),this.la()))};a.prototype.Pb=function(){this.Nb&&
(this.Nb=!1)};a.prototype.ng=function(){return this.md?this.height:this.width};a.AB=0;a.vB=1;a.rB=2;a.yB=3;return a}(Lb),Ad=function(){function c(){}c.prototype.gs=function(){return 16};c.prototype.la=function(a,b){a.fillStyle="#e6e6e6";a.beginPath();a.rect(b.rect.x,b.rect.y,b.rect.width,b.rect.height);a.fill();a.beginPath();a.fillStyle="auto"===b.pg?"#b9b9b9":b.pg;a.fillRect(b.Md.x,b.Md.y,b.Md.width,b.Md.height)};return c}(),zd=function(){function c(){}c.prototype.gs=function(){return 10};c.prototype.la=
function(a,b){a.fillStyle="auto"===b.pg?"rgba(0,0,0,0.5)":b.pg;a.beginPath();b.md?Dc(a,b.Md.x,b.Md.y-1,b.Md.width,b.Md.height,4.5):Dc(a,b.Md.x-1,b.Md.y,b.Md.width,b.Md.height,4.5);a.fill()};return c}();u.create("SNAPPER");function Cd(c){switch(c){case 33:return"n-resize";case 34:return"e-resize";case 36:return"s-resize";case 40:return"w-resize";case 25:return"nw-resize";case 19:return"ne-resize";case 28:return"sw-resize";case 22:return"se-resize";case 1:case 4:case 8:case 2:case 64:return"move"}return"default"}function Dd(c,a,b){return{id:c,hc:2,x:a.x+a.width,sc:a.y,tc:a.y+a.height,order:b}}function Ed(c,a,b){return{id:c,hc:4,x:a.y+a.height,sc:a.x,tc:a.x+a.width,order:b}}
var Fd=function(){function c(){this.rg=[];this.Wh=[];this.So=[];this.order=0}c.prototype.clear=function(){this.rg.length=0;this.Wh.length=0;this.order=this.So.length=0};c.prototype.Qq=function(a,b){this.So.push({id:b,rect:a,order:this.order++});this.rg.push({id:b,hc:1,x:a.y,sc:a.x,tc:a.x+a.width,order:this.order});this.rg.push(Ed(b,a,this.order));this.Wh.push({id:b,hc:8,x:a.x,sc:a.y,tc:a.y+a.height,order:this.order});this.Wh.push(Dd(b,a,this.order));this.order++};c.prototype.rA=function(a,b){var d=
8;void 0===d&&(d=10);var e=this.pk(this.Wh,{id:b,hc:8,x:a.x,sc:a.y,tc:a.y+a.height,order:0},Number.MAX_VALUE);e=this.pk(this.Wh,Dd(b,a,0),e);var c=this.pk(this.rg,{id:b,hc:1,x:a.y,sc:a.x,tc:a.x+a.width,order:0},Number.MAX_VALUE);c=this.pk(this.rg,Ed(b,a,0),c);return{x:Math.abs(e)<d?e:0,y:Math.abs(c)<d?c:0}};c.prototype.Sn=function(a,b){var d=10;void 0===d&&(d=10);var e=[];this.Zt(e,this.Wh,a,b,d);this.Zt(e,this.rg,b,a,d);d=0;for(var c=this.So;d<c.length;d++){var h=c[d];h.rect.cd(a,b)&&e.push({hc:64,
id:h.id,order:h.order})}e.sort(function(a,b){return b.order-a.order});return e};c.prototype.Zt=function(a,b,d,e,c){for(var f=c*c,k=0;k<b.length;k++){var l=b[k],n=Math.abs(d-l.x),q=Number.MAX_VALUE,v=0;if(!(n>c||e<l.sc-c||e>l.tc+c)){if(e>l.sc+c&&e<l.tc-c){var x=n*n;x<q&&(q=x,v=l.hc)}x=.5*(l.sc+l.tc);x=n*n+(e-x)*(e-x);x<f&&(q=x,v=l.hc|32);b===this.rg&&(x=n*n+(e-l.sc)*(e-l.sc),x<q&&(q=x,v=l.hc|24),x=n*n+(e-l.tc)*(e-l.tc),x<q&&(q=x,v=l.hc|18));q<f&&a.push({id:l.id,hc:v,order:l.order})}}};c.prototype.pk=
function(a,b,d){for(var c=0;c<a.length;c++){var f=a[c],h=f.x-b.x;Math.abs(h)>Math.abs(d)||b.id===f.id||50>(b.tc<f.sc?f.sc-b.tc:b.sc>f.tc?b.sc-f.tc:0)&&(d=h)}return d};return c}();var Gd=u.create("SvgFile"),Ld=function(){function c(){this.rect=new F(0,0,0,0);this.sv={};this.src="";this.ready=!1;this.Kb=[];this.dt=0}c.prototype.Vy=function(a){return __awaiter(this,void 0,void 0,function(){var b,d=this;return __generator(this,function(c){switch(c.label){case 0:if(a===this.src&&this.ready)return[2];this.src=a;this.ready=!1;return[4,Wa({url:a,responseType:"document"})];case 1:b=c.sent();if(this.src!==a)throw Error("Aborted due to URL change");Hd(b.responseXML.documentElement,function(a){return d.dz(a)});
this.dt=this.Kb.length;this.ready=!0;return[2]}})})};c.prototype.Va=function(a){var b;this.Kb.length=this.dt;(b=this.Kb).push.apply(b,Id(a))};c.prototype.dz=function(a){if(a instanceof Element){switch(a.tagName.toUpperCase()){case "SVG":this.Ld=a;var b=a.getAttribute("viewBox");if(b){var d=[];var c=0;for(b=b.split(" ");c<b.length;c++){var f=parseFloat(b[c]);isNaN(f)||d.push(f)}if(4!==d.length)throw Error("Invalid viewBox");this.rect.x=d[0];this.rect.y=d[1];this.rect.width=d[2];this.rect.height=d[3]}break;
case "STYLE":(d=this.Kb).push.apply(d,Id(a.textContent))}(d=a.getAttribute("id"))&&(this.sv[d]=a);return!0}};c.prototype.la=function(a,b,d){function c(a){var b=h.Ow(a,l);switch(a.tagName.toUpperCase()){case "SVG":for(var d=a.firstElementChild;null!==d;d=d.nextElementSibling)c(d);break;case "G":k.save();k.Va(b);for(d=a.firstElementChild;null!==d;d=d.nextElementSibling)c(d);k.restore();break;case "PATH":f(b,function(){b.d&&Lc(k,b.d)});break;case "CIRCLE":f(b,function(){var b=Jd(a,"cx cy r");k.arc(b.cx,
b.cy,b.r,0,2*Math.PI,!1)});break;case "LINE":f(b,function(){var b=Jd(a,"x1 y1 x2 y2");k.moveTo(b.x1,b.y1);k.lineTo(b.x2,b.y2)});break;case "RECT":f(b,function(){var b=Jd(a,"x y width height rx ry");a.hasAttribute("ry")?a.hasAttribute("rx")||(b.rx=b.ry):b.ry=b.rx;k.rect(b.x,b.y,b.width,b.height,b.rx,b.ry)})}}function f(a,b){k.save();d||k.beginPath();k.Va(a);k.De();b();d||(k.fill(),k.stroke());k.restore()}var h=this;void 0===b&&(b=null);void 0===d&&(d=!1);var k=new Kd(a);k.Va({stroke:"none",fill:"#000000",
"stroke-width":"1"});b&&k.Va(b);var l={};c(this.Ld)};c.prototype.Ow=function(a,b){var d={},c;for(c in b)d[c]=b[c];if(b=a.getAttribute("class"))for(var f=0,h=this.Kb;f<h.length;f++)for(var k=h[f],l=0,n=k.Iz.split(",");l<n.length;l++)if("."+b===n[l])for(c in k.$q)d[c]=k.$q[c];for(c=0;c<a.attributes.length;c++)d[a.attributes[c].name]=a.attributes[c].value;return d};return c}();function Hd(c,a){for(c=[c];c.length;){var b=c.pop();if(a(b))for(b=b.firstChild;null!==b;b=b.nextSibling)c.push(b)}}
function Jd(c,a){var b={},d=0;for(a=a.split(" ");d<a.length;d++){var e=a[d];b[e]=parseFloat(c.getAttribute(e)||"")||0}return b}function Id(c){var a=[];for(c=new Md(c);;){for(var b={},d={value:""},e=c,f=d,h="";e.match(".");){h+=".";var k={value:""};if(!e.Hs(k))break;h+=k.value;if(!e.match(","))break;h+=","}f.value=h;if(0<h.length&&c.match("{"))Nd(c,b),c.match("}"),a.push({Iz:d.value,$q:b});else break}return a}
function Nd(c,a){for(;;){var b={value:""},d={value:""},e=c.Ma;if(c.Hs(b)&&c.match(":")&&c.py(d))c.match(";"),a[b.value]=d.value;else{c.Ma=e;break}}}
var Md=function(){function c(a,b){void 0===b&&(b=0);this.input=a;this.Ma=b}c.prototype.match=function(a){this.Dl();return this.Ma+a.length<=this.input.length&&this.input.substr(this.Ma,a.length)==a?(this.Ma+=a.length,!0):!1};c.prototype.Dl=function(){for(;this.Ma<this.input.length;this.Ma++){var a=this.input[this.Ma];if(" "!=a&&"\n"!=a)break}};c.prototype.Gd=function(a){this.Dl();for(var b=this.Ma;this.Ma<this.input.length;this.Ma++){var d=this.input[this.Ma];if(!("0"<=d&&"9">=d||"-"==d||"+"==d||
"."==d||"e"==d||"E"==d))break}if(b==this.Ma)return!1;d=parseFloat(this.input.substr(b,this.Ma-b));if(isNaN(d))return this.Ma=b,!1;a.value=d;return!0};c.prototype.Hs=function(a){this.Dl();for(var b=this.Ma;this.Ma<this.input.length;this.Ma++){var d=this.input[this.Ma];if(!("a"<=d&&"z">=d||"A"<=d&&"Z">=d||"-"==d||this.Ma>b&&"0"<=d&&"9">=d))break}return this.Ma>b?(a.value=this.input.substr(b,this.Ma-b),!0):!1};c.prototype.py=function(a){this.Dl();for(var b=this.Ma;this.Ma<this.input.length&&";"!==this.input[this.Ma];this.Ma++);
a.value=this.input.substr(b,this.Ma-b).trim();return!0};return c}(),Kd=function(){function c(a){this.ra=a;this.Fb={im:1,Sk:1,Tk:"nonzero",opacity:1,ua:new I};this.Gp=[]}c.prototype.save=function(){this.Gp.push(this.Fb);this.Fb={im:this.Fb.im,Sk:this.Fb.Sk,Tk:this.Fb.Tk,opacity:this.Fb.opacity,ua:this.Fb.ua.clone()};this.ra.save()};c.prototype.restore=function(){this.Gp.length&&(this.Fb=this.Gp.pop());this.ra.restore()};c.prototype.translate=function(a,b){this.ra.translate(a,b)};c.prototype.scale=
function(a,b){this.ra.scale(a,b)};c.prototype.rotate=function(a){this.ra.rotate(a)};c.prototype.beginPath=function(){this.ra.beginPath()};c.prototype.closePath=function(){this.ra.closePath()};c.prototype.bezierCurveTo=function(a,b,d,c,f,h){this.ra.bezierCurveTo(a,b,d,c,f,h)};c.prototype.quadraticCurveTo=function(a,b,d,c){this.ra.quadraticCurveTo(a,b,d,c)};c.prototype.arc=function(a,b,d,c,f,h){this.ra.arc(a,b,d,c,f,h)};c.prototype.Va=function(a){for(var b in a)this.set(b,a[b])};c.prototype.set=function(a,
b){var d=!1;switch(a){case "stroke-width":this.ra.lineWidth=parseFloat(b);break;case "fill":"none"===b&&(b="transparent");this.ra.fillStyle=b;break;case "stroke":"none"===b&&(b="transparent");this.ra.strokeStyle=b;break;case "stroke-opacity":this.Fb.im=parseFloat(b);break;case "fill-opacity":this.Fb.Sk=parseFloat(b);break;case "opacity":this.Fb.opacity=parseFloat(b);break;case "stroke-linejoin":this.ra.lineJoin=b;break;case "stroke-miterlimit":this.ra.miterLimit=parseFloat(b);break;case "stroke-linecap":this.ra.lineCap=
b;break;case "style":d=new Md(b);var c={};Nd(d,c);this.Va(c);d=!1;break;case "transform":d=b;c=new Md(d);var f=new I;if(c.match("translate")){var h={value:0},k={value:0};if(!(c.match("(")&&c.Gd(h)&&c.match(",")&&c.Gd(k)&&c.match(")")))throw Error("Can't parse "+d);f.Ea+=h.value;f.Fa+=k.value}else if(c.match("rotate")){var l={value:0};f={value:0};h={value:0};k=!1;c.match("(")&&c.Gd(l)||(k=!0);k||!c.match(",")||c.Gd(f)&&c.match(",")&&c.Gd(h)||(k=!0);if(k||!c.match(")"))throw Error("Can't parse "+d);
f=new vc(l.value/180*Math.PI,f.value,h.value)}else if(c.match("matrix")){l={value:0};var n={value:0},q={value:0},v={value:0};h={value:0};k={value:0};if(!(c.match("(")&&c.Gd(l)&&c.match(",")&&c.Gd(n)&&c.match(",")&&c.Gd(q)&&c.match(",")&&c.Gd(v)&&c.match(",")&&c.Gd(h)&&c.match(",")&&c.Gd(k)&&c.match(")")))throw Error("Can't parse "+d);f.m11=l.value;f.m21=n.value;f.m12=q.value;f.m22=v.value;f.Ea=h.value;f.Fa=k.value}else if(c.match("scale")){h={value:0};if(!c.match("(")||!c.Gd(h)||!c.match(")"))throw Error("Can't parse "+
d);f=f.multiply(new wc(h.value,h.value))}else throw Error("Can't parse transform: "+d);this.Fb.ua=this.Fb.ua.multiply(f);d=!1;break;case "fill-rule":this.Fb.Tk=b;break;case "id":case "d":case "cx":case "cy":case "r":case "rx":case "ry":case "x":case "y":case "width":case "height":case "class":d=!1;break;default:-1===a.indexOf(":")&&console.warn("Unknown SVG style: "+a+"="+b),d=!1}d&&Gd("Apply %s=%s",a,b)};c.prototype.De=function(){this.Fb.ua.jf(this.ra)};c.prototype.fill=function(){var a=this.ra.globalAlpha;
this.ra.globalAlpha=this.ra.globalAlpha*this.Fb.opacity*this.Fb.Sk;this.ra.fill(this.Fb.Tk);this.ra.globalAlpha=a};c.prototype.stroke=function(){var a=this.ra.globalAlpha;this.ra.globalAlpha=this.ra.globalAlpha*this.Fb.opacity*this.Fb.im;this.ra.stroke();this.ra.globalAlpha=a};c.prototype.moveTo=function(a,b){this.ra.moveTo(a,b)};c.prototype.lineTo=function(a,b){this.ra.lineTo(a,b)};c.prototype.rect=function(a,b,d,c,f,h){Dc(this.ra,a,b,d,c,f,h)};return c}();var Od="ontouchstart"in window,Pd="onpointerdown"in window,Qd={touchstart:"down",touchmove:"move",touchend:"up",touchcancel:"up",pointerdown:"down",pointermove:"move",pointerup:"up",mousedown:"down",mousemove:"move",mouseup:"up",pointercancel:"up",wheel:"wheel"},Rd=[],Sd=function(c){function a(a,d,e,f,h,k,l,n,q,v,x,w,y,B,E,L,H,z){void 0===H&&(H=Rd);void 0===z&&(z=0);k=c.call(this,a,d,e,k,n,q)||this;k.type=a;k.pageX=d;k.pageY=e;k.pb=f;k.qb=h;k.startTime=l;k.pointerId=v;k.data=x;k.index=w;k.Ou=y;k.buttons=
B;k.ctrlKey=E;k.shiftKey=L;k.ma=H;k.angle=z;k.scale=0;k.rotation=0;return k}__extends(a,c);a.prototype.clone=function(){return new a(this.type,this.pageX,this.pageY,this.pb,this.qb,this.timestamp,this.startTime,this.target,this.mc,this.pointerId,this.data,this.index,this.Ou,this.buttons,this.ctrlKey,this.shiftKey,this.ma,this.angle)};a.prototype.il=function(){return this.offset({x:this.pageX,y:this.pageY},void 0)};a.prototype.Gn=function(){return this.timestamp-this.startTime};a.prototype.Yk=function(){return G(this.pageX,
this.pageY,this.pb,this.qb)};a.prototype.toString=function(){var a=c.prototype.toString.call(this)+(" "+this.Gn()+"ms "+Math.round(this.Yk())+"px");0!=this.scale&&(a+=" scale="+Math.round(100*(this.scale||0))/100,a+=" "+Math.round(this.rotation||0)+"deg");return a};a.prototype.setData=function(a,d){this.data[a]=d};a.prototype.getData=function(a){return this.data[a]};a.prototype.ax=function(){var a={x:0,y:0,z:0};if("wheel"===this.mc.type){var d=this.mc;a.x=d.deltaX;a.y=d.deltaY;a.x=d.deltaZ}return a};
return a}(function(){function c(a,b,d,c,f,h){this.type=a;this.pageX=b;this.pageY=d;this.timestamp=c;this.target=f;this.mc=h}c.prototype.toString=function(){return"["+this.type+" ("+this.mc.type+")] ("+this.pageX+","+this.pageY+")"};c.prototype.offset=function(a,b){b=A(b).Yb();return{x:a.x-b.left,y:a.y-b.top}};c.prototype.stopPropagation=function(){this.mc.stopPropagation()};c.prototype.preventDefault=function(){this.mc.preventDefault()};return c}()),Td=u.create("TouchListener"),$d=function(c){function a(a,
d){function b(a){f.handleEvent(a)}void 0===d&&(d={});var f=c.call(this)||this;f.da=a;f.options=d;f.te=[];f.eg=[];f.active=[];f.ms={};f.qs=0;f.jj=!0;var h=d.TA?document:a;Od?(f.Xa(a,"touchstart",b),f.Xa(h,"touchmove",b),f.Xa(h,"touchend",b),f.Xa(h,"touchcancel",b)):Pd&&!1!==d.Tq&&(f.Xa(a,"pointerdown",b),f.Xa(h,"pointermove",b),f.Xa(h,"pointerup",b),f.Xa(h,"pointercancel",b));if(Od||!Pd||!1===d.Tq)f.Xa(a,"mousedown",b),f.Xa(h,"mousemove",b),f.Xa(h,"mouseup",b);f.Xa(a,"wheel",b);return f}__extends(a,
c);a.prototype.Xa=function(a,d,c){this.te.push({element:a,event:d,fn:c});"touchmove"===d?a.addEventListener(d,c,{passive:!1,capture:!0===this.options.Xp}):a.addEventListener(d,c,!0===this.options.Xp)};a.prototype.pa=function(a,d){for(var b=0,f=a.split(" ");b<f.length;b++){var h=f[b],k="";switch(h){case "gesturestart":case "gesturechange":case "gestureend":k="gesture";break;case "tap":case "doubletap":k="tap";break;case "swipe":k="swipe";break;case "hold":k="hold";break;case "drag":k="drag"}if(""!==
k&&!this.ms[k]){switch(k){case "gesture":this.eg.push(new Ud(this));break;case "tap":this.eg.push(new Vd(this));break;case "swipe":this.eg.push(new Wd(this));break;case "hold":this.eg.push(new Xd(this));break;case "drag":this.eg.push(new Yd(this))}this.ms[k]=!0;Td("Created new detector "+k+" to handle "+h)}}c.prototype.pa.call(this,a,d)};a.prototype.sa=function(a,d){c.prototype.Pc.call(this,a,d)};a.prototype.Ta=function(){for(var a=0,d=this.te;a<d.length;a++){var c=d[a];c.element.removeEventListener(c.event,
c.fn,!0===this.options.Xp)}a=0;for(d=this.eg;a<d.length;a++)c=d[a],c.Ta&&c.Ta();this.te.length=0;this.eg.length=0;this.active.length=0;this.gb={}};a.prototype.handleEvent=function(a){var b=Qd[a.type],c=(new Date).getTime();switch(a.type){case "touchstart":case "touchend":case "touchmove":case "touchcancel":this.qs=c+800;for(var f=0;f<a.changedTouches.length;f++){var h=a.changedTouches[f];this.Si(a,b,h.identifier,h.pageX,h.pageY,c)}break;case "pointerdown":case "pointerup":case "pointermove":case "pointercancel":f=
Zd(a);"pointermove"===a.type&&a.buttons&&!this.Jr(a.pointerId)&&(Td("Manufactured pointerdown"),this.Si(a,"down",a.pointerId,f.pageX,f.pageY,c));this.Si(a,b,a.pointerId,f.pageX,f.pageY,c);if("pointercancel"===a.type)for(f=this.active.length-1;0<=f;f--)this.Si(a,b,this.active[f].id,a.pageX,a.pageY,c);break;case "mousedown":case "mousemove":case "mouseup":if(c<this.qs)break;case "wheel":f=Zd(a),this.Si(a,b,0,f.pageX,f.pageY,c)}};a.prototype.Si=function(a,d,c,f,h,k){var b=null;switch(d){case "down":b=
this.$u(c,f,h,k,a.buttons);d=new Sd("down",f,h,f,h,k,k,a.target,a,c,b.data,b.index,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;case "move":b=this.Jr(c);d=new Sd("move",f,h,b?b.pb:f,b?b.qb:h,k,b?b.Ab:k,a.target,a,c,b?b.data:{},b?b.index:-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;case "up":b=this.sz(c);d=new Sd("up",f,h,b?b.pb:f,b?b.qb:h,k,b?b.Ab:k,a.target,a,c,b?b.data:{},b?b.index:-1,this.active.length,b?b.buttons:a.buttons,a.ctrlKey,a.shiftKey);break;case "wheel":d=
new Sd(d,f,h,f,h,k,k,a.target,a,c,{},-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;default:return}null!==b&&(b.ig=f,b.jg=h);(b||this.da.contains(a.target))&&this.sa(d.type,d)};a.prototype.Jr=function(a){for(var b=0,c=this.active;b<c.length;b++){var f=c[b];if(f.id===a)return f}return null};a.prototype.$u=function(a,d,c,f,h){for(var b=0;b<this.active.length;b++){var e=this.active[b];if(e.id===a)return e.pb=e.ig=d,e.qb=e.jg=c,e.Ab=f,e.ma=[new D(d,c)],e}this.active.push({index:this.active.length,
id:a,Ab:f,pb:d,qb:c,ig:d,jg:c,ma:[new D(d,c)],data:{},buttons:h});return this.active[this.active.length-1]};a.prototype.sz=function(a){for(var b=0;b<this.active.length;b++)if(this.active[b].id===a)return a=this.active[b],this.active.splice(b,1),a;return null};return a}(Lb);
function Zd(c){if(c.pageX===c.clientX&&c.pageY===c.clientY){var a=document.documentElement.scrollLeft+document.body.scrollLeft,b=document.documentElement.scrollTop+document.body.scrollTop;if(a||b)return{pageX:c.clientX+a,pageY:c.clientY+b}}return c}
function Vd(c){var a=[];c.pa("up",function(b){if(200>b.Gn()&&20>b.Yk()){var d=b.clone();d.type="tap";c.sa("tap",d);a:{for(d=0;d<a.length;d++){var e=a[d];if(300>b.timestamp-e.Ab&&20>G(b.pageX,b.pageY,e.x,e.y)){e.x=b.pageX;e.y=b.pageY;e.Ab=b.timestamp;d=!0;break a}}4===a.length&&a.splice(0,1);a.push({x:b.pageX,y:b.pageY,id:b.pointerId,Ab:b.timestamp});d=!1}d&&(d=b.clone(),d.type="doubletap",c.sa("doubletap",d))}})}
function Yd(c){var a=-1,b=-1;c.pa("down",function(a){a.setData("target",a.mc.target)});c.pa("move",function(d){a!==d.pb&&b!==d.qb&&8<d.Yk()&&(a=d.pb,b=d.qb,d=d.clone(),d.type="drag",c.sa("drag",d))})}
function Ud(c){function a(){for(var a=0,b=0,d=0;d<e.length;d++)Td("Active touch: id:%s %s,%s",e[d].id,e[d].ig,e[d].jg),a+=e[d].ig,b+=e[d].jg;return{x:a/e.length,y:b/e.length}}function b(a,b){for(var d=0,c=0;c<e.length;c++){var f=e[c];d+=Math.sqrt((f.ig-a)*(f.ig-a)+(f.jg-b)*(f.jg-b))}return d/e.length}function d(a,b,d,e,f){a=a.clone();a.type=b;a.pageX=d.x;a.pageY=d.y;a.scale=e;a.rotation=f;c.sa(a.type,a)}var e=[],f=!1,h=0,k=1,l=1,n={x:0,y:0};c.pa("down move up",function(q){e=c.active;switch(q.type){case "down":2<=
e.length&&!f&&(f=!0,n=a(),l=b(n.x,n.y),k=1,h=0,d(q,"gesturestart",n,k,h));break;case "move":if(2<=e.length&&f){n=a();k=b(n.x,n.y)/l;for(var v=n.x,x=n.y,w=0,y=0;y<e.length;y++){var B=Math.atan2(e[y].jg-x,e[y].ig-v)-Math.atan2(e[y].qb-x,e[y].pb-v);B>Math.PI?B-=2*Math.PI:B<=-Math.PI&&(B+=2*Math.PI);w+=B}h=w/e.length/Math.PI*180;d(q,"gesturechange",n,k,h)}break;case "up":f&&2>e.length&&(f=!1,d(q,"gestureend",n,k,h))}})}
function Wd(c){c.pa("up",function(a){var b=a.ma;if(!(200>a.Yk()||1E3<a.Gn()||2>b.length)){for(var d=b[0],e=b[b.length-1],f=1;f<b.length-1;f++)if(40<b[f].tr(d,e))return!1;b=Math.atan2(e.y-d.y,e.x-d.x);Td("Swipe angle %s",Math.round(b/Math.PI*180));a=a.clone();a.type="swipe";a.angle=b;c.sa("swipe",a)}})}function ae(c){this.Hh=c;this.time=(new Date).getTime();this.timeout=0}
var Xd=function(){function c(a){function b(a){var b=d.If[a];b&&(Td("Remove pointer %s",a),clearTimeout(b.timeout),delete d.If[a])}var d=this;this.If={};a.pa("down",function(c){b(c.pointerId);d.If[c.pointerId]=new ae(new D(c.pageX,c.pageY));d.If[c.pointerId].timeout=setTimeout(function(){var b=c.clone();b.type="hold";b.timestamp=(new Date).getTime();a.sa("hold",b)},1E3)});a.pa("move",function(a){var c=a.pointerId;if(c in d.If){var e=d.If[c];20<(new D(a.pageX,a.pageY)).Wb(e.Hh)&&b(c)}});a.pa("up",function(a){b(a.pointerId)})}
c.prototype.Ta=function(){for(var a in this.If)clearTimeout(this.If[a].timeout)};return c}();var be={type:"translate",position:new D(0,0),offset:new D(0,0),sg:""},ce={type:"translate",position:new D(0,0),offset:new D(0,0),sg:""},de={type:"translate",position:new D(0,0),offset:new D(0,0),sg:""};u.create("SelectionHandle");
var ee=function(){function c(a,b,d){this.Pf=a;this.ua=b;this.Aa=d}c.prototype.er=function(){return!0};c.prototype.ll=function(a,b){void 0===a&&(a=this.ua);void 0===b&&(b=1);a=a.sb();return new D(this.Aa.x+this.Aa.width*this.Pf.position.x+this.Pf.offset.x/a.x/b,this.Aa.y+this.Aa.height*this.Pf.position.y+this.Pf.offset.y/a.y/b)};c.prototype.il=function(){var a=this.ll();return this.ua.apply(a.x,a.y)};c.prototype.la=function(a,b,d,c,f){a.save();f*=d;c=c.multiply(this.ua);var e=c.sb();e.x=1/e.x/d;e.y=
1/e.y/d;d=this.ll(c,d);c=c.multiply(new wc(e.x,e.y,d.x,d.y));c.jf(a);(b=b.get(this.Pf.sg))?(f=b.width,c=b.height,a.drawImage(b,d.x-f/2,d.y-c/2,f,c)):this.mn(a,d,f);a.restore()};c.prototype.mn=function(a,b){a.strokeStyle="red";a.lineWidth=1;a.strokeRect(b.x-10,b.y-10,20,20)};c.prototype.Db=function(a,b,d,c,f){var e=a.get(this.Pf.sg);a=this.ll(this.ua,f);b=this.ua.inverse().apply(b,d);d=this.ua.sb();d.x*=f;d.y*=f;e?(c=e.height,f=e.width/2/d.x,c=c/2/d.y):(f=c/d.x,c/=d.y);return(new F(a.x-f,a.y-c,2*f,
2*c)).cd(b.x,b.y,0)};c.prototype.click=function(){return null};return c}(),fe=function(c){function a(a,d,e,f){a=c.call(this,a,d,e)||this;a.origin=f;return a}__extends(a,c);a.prototype.uh=function(a){var b=1,c=1,f=this.ua.inverse(),h=this.il(),k=this.ll();a=f.apply(h.x+a.x,h.y+a.y);k=new D(k.x-this.origin.x,k.y-this.origin.y);a=new D(a.x-this.origin.x,a.y-this.origin.y);a=(a.x*k.x+a.y*k.y)/(k.x*k.x+k.y*k.y);1E-8>Math.abs(k.x)||1E-8>Math.abs(k.y)?1E-8>Math.abs(k.x)?c=a:b=a:c=b=a;return this.ua.multiply(new wc(b,
c,this.origin.x,this.origin.y)).multiply(f)};a.prototype.mn=function(a,d,c){a.beginPath();var b=6;c&&9*b>c&&(b=c/9);a.strokeStyle="#000";a.lineWidth=1;a.shadowBlur=3;a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowColor="rgba(0,0,0,0.2)";a.strokeStyle="#ccc";a.arc(d.x,d.y,b,0,2*Math.PI);a.fillStyle="#ffffff";a.fill();a.stroke();a.shadowColor="rgba(0,0,0,0.0)"};return a}(ee),ge=function(c){function a(a,d,e,f,h){a=c.call(this,a,d,e)||this;a.yk=h;d=a.il();a.origin=a.ua.apply(f.x,f.y);a.Cp=Math.atan2(d.y-
a.origin.y,d.x-a.origin.x);a.yk=h;return a}__extends(a,c);a.prototype.uh=function(a){var b=this.il();a=Math.atan2(b.y+a.y-this.origin.y,b.x+a.x-this.origin.x)-this.Cp;this.yk&&(b=Math.PI/16,a=Math.floor(a/b)*b);return new vc(-a,this.origin.x,this.origin.y)};a.prototype.click=function(){return new vc(Math.PI/2,this.origin.x,this.origin.y)};a.prototype.mn=function(a,d){a.beginPath();a.strokeStyle="#008000";a.lineWidth=3;a.moveTo(d.x,d.y);a.arc(d.x,d.y,6,0,1.5*Math.PI,!1);a.stroke()};return a}(ee),he=
function(c){function a(a,d){return c.call(this,a,d,new F(0,0,0,0))||this}__extends(a,c);a.prototype.uh=function(a){return new uc(a.x,a.y)};return a}(ee),ie=function(c){function a(){return c.call(this,de,new I,new F(0,0,0,0))||this}__extends(a,c);a.prototype.uh=function(){return new I};return a}(ee),je=function(c){function a(a,d,e){return c.call(this,a,d,e)||this}__extends(a,c);a.prototype.er=function(){return!1};a.prototype.click=function(a){this.Pf.gr&&this.Pf.gr(a.pageX,a.pageY);return null};a.prototype.uh=
function(){return new I};return a}(ee);function ke(c,a,b,d){var e=void 0,f=new D(0,0),h=b.sb();f.x=a.x+a.width*c.position.x+c.offset.x/h.x;f.y=a.y+a.height*c.position.y+c.offset.y/h.y;switch(c.type){case "translate":return new he(c,b);case "scale":return e||(e=new D(a.right()-c.position.x*a.width,a.bottom()-c.position.y*a.height)),new fe(c,b,a,e);case "rotate":return e||(e=a.Sd()),new ge(c,b,a,e,d||!1);case "click":return new je(c,b,a)}};var le=function(){function c(a,b,d,c){this.view=a;this.Ih=b;this.Fa=this.Ea=0;this.Nb=!1;this.log=u.create("SELECT");this.Vs(d,c)}c.prototype.mb=function(a){this.log("Gesture detected; aborting select box.");this.view.Ya(this.Ih);return this.Ih.mb?this.Ih.mb(a):!1};c.prototype.lc=function(){this.view.Ym("select")};c.prototype.Eb=function(a,b){return this.Vs(a,b)};c.prototype.Vs=function(a,b){this.Ea=a;this.Fa=b;return this.Nb=!0};c.prototype.yb=function(a,b){if(this.Nb){var d=this;this.view.tt("select",
function(c){c.save();c.strokeStyle="#0050B7";c.lineWidth=2/d.view.scale;c.fillStyle="rgba(0, 80, 183, 0.2)";var e=new F(d.Ea+.5,d.Fa+.5,a-d.Ea,b-d.Fa);c.fillRect(e.x,e.y,e.width,e.height);c.strokeRect(e.x,e.y,e.width,e.height);c.restore()});return!0}return!1};c.prototype.Pb=function(a,b){this.Nb=!1;this.view.lb();this.view.Gz(new F(this.Ea,this.Fa,a-this.Ea,b-this.Fa));this.view.fc();this.view.Ya(this.Ih);return!0};return c}();var me=function(){function c(a,b,d){var c=this;this.view=a;this.ba=b;this.Ay=d;this.state="none";this.scale=1;this.log=u.create("ImageStamp");this.Qa=document.createElement("img");this.url=this.Qa.src=b.url;"scale"in this.ba&&(this.scale=this.ba.scale,delete this.ba.scale);this.Qa.onload=function(){"width"in c.ba&&(c.scale=c.ba.width/c.Qa.naturalWidth,delete c.ba.width)}}c.prototype.Ad=function(){return"imagestamp"};c.prototype.gd=function(){this.log("Entering ImageStampBehaviour");this.view.oc("move")};
c.prototype.lc=function(){this.log("Leaving ImageStampBehaviour");this.view.la()};c.prototype.bb=function(a,b){this.Qa.complete&&(a-=this.Qa.width/2*this.scale,b-=this.Qa.height/2*this.scale);return this.view.bb(new D(a,b))};c.prototype.Eb=function(a,b,d){var c=this;this.log("onMouseDown type %s",d.type);var f=this.bb(a,b);this.view.aa.transaction(function(){c.view.aa.createNode("ImageNode",pc({},c.ba,{url:c.url,layer:c.view.Nc,matrix:(new uc(f.x,f.y)).multiply(new wc(c.scale,c.scale))}))});this.Ay||
(this.log("MultiStamp not set; return to pick mode."),this.view.tb());return!0};c.prototype.yb=function(a,b){this.Qa.complete||this.log("Don't draw; image not loaded.");var d=this.bb(a,b);this.view.scrollIntoView(a,b);var c=this;this.view.la(function(a){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(c.Qa,d.x,d.y,c.Qa.width*c.scale,c.Qa.height*c.scale);a.globalAlpha=b});return!0};c.prototype.Pb=function(){return!0};c.prototype.Xd=function(a){"cancel"===a&&(this.view.tb(),this.view.zc.sa("goto-toolbar"))};
return c}();var ne=function(){function c(a){this.view=a;this.start=new D(0,0);this.Dp=new D(0,0);this.active=!1;this.rect=null;this.log=u.create("PanZoomMixin")}c.prototype.mb=function(a){this.log("onGesture(%s)",a.type);if(!this.view.ga.get("allowZoom"))return!1;if("gesturestart"===a.type)this.start=new D(a.pageX,a.pageY),this.Dp=this.view.Jd(a.pageX,a.pageY),this.rect=this.view.re(),this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.Kh(1/
a.scale);a=new wc(a,a,this.Dp.x,this.Dp.y);a=(new uc(-b/this.view.scale,-d/this.view.scale)).multiply(a);b=this.rect.clone();b.transform(a);this.view.Qg(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}();var oe=function(){function c(a,b){void 0===b&&(b="repeat");this.Qa=a;this.repeat=b}c.prototype.loaded=function(){return this.Qa instanceof HTMLImageElement?this.Qa.complete:!0};c.prototype.setTransform=function(){};return c}(),pe=function(){function c(a,b,d,c){this.vA=[];this.from=new D(a,b);this.ia=new D(d,c)}c.prototype.addColorStop=function(a,b){this.vA.push({offset:a,vc:b})};return c}(),re=function(){function c(){this.stack=[];this.ua=new I;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.lineDashOffset=0;this.miterLimit=10;this.strokeStyle=this.fillStyle="#000000";this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)"}c.prototype.save=function(){this.stack.push({ua:this.ua.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,lineDashOffset:this.lineDashOffset,miterLimit:this.miterLimit,
strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,bg:this.Dq()})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.ua=a.ua,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.lineDashOffset=a.lineDashOffset,
this.miterLimit=a.miterLimit,this.ua=a.ua,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=a.globalAlpha,this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor,this.Hq(a.bg))};c.prototype.drawImage=function(a,b,d,c,f,h,k,l,n){var e=a.width,v=a.height,x=0,w=e,y=v;void 0!==c&&void 0!==f&&void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n?(x=
b,0-d,w=c,y=f,b=h,d=k,e=l,v=n):void 0!==c&&void 0!==f&&(e=c,v=f);this.zq(a,x,0,w,y,b,d,e,v)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,b,d,c,f,h){h&&(h=c,c=f,f=h);for(;0>c;)c+=2*Math.PI;for(;0>f;)f+=2*Math.PI;c>f&&(c-=2*Math.PI);var e=2*Math.PI;var l=c%e;var n=f%e;n===l&&(n+=2*Math.PI);f=[];c=Math.PI/2;h=l<n?1:-1;var q=l;for(e=Math.min(e,Math.abs(n-l));1E-5<e;){l=q+h*Math.min(e,c);var v=(l-q)/2,x=d*Math.cos(v),w=d*Math.sin(v),y=.5522847498*Math.tan(v);
n=x+y*w;x=-w+y*x;w=-x;y=v+q;v=Math.cos(y);y=Math.sin(y);f.push({gB:d*Math.cos(q),sc:d*Math.sin(q),hB:n*v-x*y,tc:n*y+x*v,iB:n*v-w*y,mB:n*y+w*v,jB:d*Math.cos(l),nB:d*Math.sin(l)});e-=Math.abs(l-q);q=l}for(d=0;d<f.length;d++)c=f[d],0===d&&this.moveTo(c.gB+a,c.sc+b),this.bezierCurveTo(c.hB+a,c.tc+b,c.iB+a,c.mB+b,c.jB+a,c.nB+b)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,c){this.beginPath();this.rect(a,b,d,c);this.stroke()};c.prototype.setTransform=function(a,b,d,c,f,h){this.ua=
new I(a,d,b,c,f,h)};c.prototype.transform=function(a,b,d,c,f,h){a=new I(a,d,b,c,f,h);this.ua=this.ua.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};c.prototype.scale=function(a,b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,c){this.beginPath();this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+c);this.lineTo(a,b+c);this.lineTo(a,b);this.closePath()};c.prototype.fillRect=
function(a,b,d,c){this.rect(a,b,d,c);this.fill()};c.prototype.$g=function(a){return qe(a)};c.prototype.createPattern=function(a,b){return new oe(a,b)};c.prototype.createLinearGradient=function(a,b,d,c){return new pe(a,b,d,c)};return c}(),se=function(){function c(a){this.fontFamily="";this.fontSize=10;this.lineHeight=this.fontVariant=this.fontWeight=this.fontStyle="normal";a=qe(a);this.fontFamily=a.fontFamily||"Arial";this.fontSize=parseFloat(a.fontSize);this.fontStyle=a.fontStyle;this.fontWeight=
a.fontWeight;this.fontVariant=a.fontVariant;this.lineHeight=a.lineHeight}c.prototype.toString=function(){var a=this.fontSize+'px "'+this.fontFamily+'"';"bold"===this.fontWeight&&(a="bold "+a);"italic"===this.fontStyle&&(a="italic"+a);return a};return c}();
function qe(c){var a=null,b="10",d="normal",e="normal",f="normal",h="normal",k=!1;c=c.split(/\s+/);a:for(;;){var l=c.shift();if(!l)break;switch(l){case "normal":break;case "italic":case "oblique":d=l;break;case "small-caps":f=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":e=l;break;default:if(k){a=l;c.length&&(a+=" "+c.join(" "));2<a.length&&('"'===a.charAt(0)||"'"===a.charAt(0))&&(a=a.substr(1,a.length-
2));break a}else l=l.split("/"),b=l[0],k=!0,1<l.length&&(h=l[1])}}return{fontStyle:d,fontVariant:f,fontWeight:e,fontSize:b,lineHeight:h,fontFamily:a}};var te=function(){function c(){this.fa=[]}c.prototype.lineTo=function(a,b,d){a.apply(b,d);this.fa.push({pi:"L",Dh:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){a.apply(b,d);this.fa.push({pi:"M",Dh:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,c,f){this.fa.push({pi:"Q",Dh:a.apply(b,d),Ql:a.apply(c,f)})};c.prototype.bezierCurveTo=function(a,b,d,c,f,h,k){this.fa.push({pi:"C",Dh:a.apply(b,d),Ql:a.apply(c,f),Lo:a.apply(h,k)})};c.prototype.closePath=function(){this.fa.push({pi:"Z"})};
c.prototype.Np=function(a){a=a.inverse();for(var b="",d=0;d<this.fa.length;d++){var c=this.fa[d];0<d&&(b+=" ");b+=c.pi;if(c.Dh){var f=a.apply(c.Dh.x,c.Dh.y);b+=f.x+","+f.y;c.Ql&&(f=a.apply(c.Ql.x,c.Ql.y),b+=","+f.x+","+f.y,c.Lo&&(c=a.apply(c.Lo.x,c.Lo.y),b+=","+c.x+","+c.y))}}return b};return c}(),ue=function(c){function a(a){var b=c.call(this)||this;b.ua=new I;b.fa=[];b.path=new te;b.bg="";b.Cc=[];b.Zb=0;b.log=u.create("SvgContext");b.ai=1;b.Xg=2;b.Cm=4;b.log("SVG context rect: %s",a);b.root=new Ra("svg",
{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:zwibbler":"http://zwibbler.com/xml",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.Gk=new Ra("defs",{});b.root.Ge(b.Gk);b.groups=[b.root];return b}__extends(a,c);a.prototype.my=function(){return"clip"+this.Zb++};a.prototype.tj=function(a){a=new Ra("g",a||{});this.en().Ge(a);this.groups.push(a)};a.prototype.sj=function(){var a=this.groups.pop();if(a&&
1===a.children.length){var d=a.children[0];d.Cj(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=d.children;a.text=d.text}};a.prototype.en=function(){return this.groups[this.groups.length-1]};a.prototype.node=function(a,d,c,f){function b(a,b){if(b instanceof oe)c[a]="url(#"+e.rm(b)+")";else if("string"===typeof b){b=r.me(b);var d=b.values[3];1>d&&(b.values[3]=1,c[a+"-opacity"]=""+d);c[a]=b.toString()}}void 0===c&&(c={});var e=this;this.ua.xs()||(c.transform="matrix("+this.ua.m11+" "+
this.ua.m21+" "+this.ua.m12+" "+this.ua.m22+" "+this.ua.Ea+" "+this.ua.Fa+")");d&this.ai?b("fill",this.fillStyle):c.fill="none";d&this.Xg&&(b("stroke",this.strokeStyle),c["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(c["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(c["stroke-linecap"]=this.lineCap));d&this.Cm&&(d=this.$g(this.font),c["font-weight"]=d.fontWeight,c["font-size"]=parseFloat(d.fontSize),c["font-style"]=d.fontStyle,c["font-family"]=d.fontFamily);""!==this.bg&&(c["clip-path"]=
"url(#"+this.bg+")");this.Vu(new Ra(a,c,f))};a.prototype.Vu=function(a){var b=!0,c=null,f={},h,k=this.en();0===k.children.length?b=!1:c=k.children[k.children.length-1];!c||a.name===c.name&&a.text===c.text||(b=!1);if(b&&c)for(h in c.attributes)if(c.attributes.hasOwnProperty(h))if(h in a.attributes){var l=c.attributes[h],n=a.attributes[h];if(l!==n)if(0===h.indexOf("fill")||0===h.indexOf("stroke"))if("none"===l)f[h]=n;else if("none"===n)f[h]=l;else{b=!1;break}else{b=!1;break}}else f[h]=c.attributes[h];
if(b&&c)for(h in a.attributes)a.attributes.hasOwnProperty(h)&&(h in c.attributes||(f[h]=a.attributes[h]));b&&c?c.Cj(f):k.Ge(a)};a.prototype.yl=function(a){if(a===this.Xg){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=this.fillStyle;return a instanceof oe?!0:"string"===typeof a?0<r.me(a).values[3]:!1};a.prototype.Bq=function(a){for(var b=0;b<this.Cc.length;b++)if(this.Cc[b].Ui===a)return this.Cc[b].nj;return null};a.prototype.qm=function(a){var b=this.Bq(a);if(b)return b;b="image"+this.Cc.length;
this.Cc.push({Ui:a,nj:b});var c=document.createElement("canvas"),f=c.getContext("2d");c.width=a.width;c.height=a.height;f.drawImage(a,0,0);c=c.toDataURL();a=new Ra("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":c});this.Gk.Ge(a);return b};a.prototype.rm=function(a){var b=this.Bq(a);if(b)return b;var c=this.qm(a.Qa);b="pattern"+this.Cc.length;this.Cc.push({Ui:a,nj:b});var f=new Ra("pattern",{id:b});"no-repeat"===a.repeat?(f.attributes.width="1",f.attributes.height="1"):"repeat-x"===
a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.Qa.width,f.attributes.height=1E4):("repeat-y"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=1E4):(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.Qa.width),f.attributes.height=a.Qa.height);f.Ge(new Ra("use",{"xlink:href":"#"+c}));this.Gk.Ge(f);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.$t=function(){return Qa(this.toString())};
a.prototype.toBlob=function(){return new Blob([Qa(this.toString())],{type:"image/svg+xml"})};a.prototype.beginPath=function(){this.path=new te};a.prototype.transform=function(a,d,c,f,h,k){a=new I(a,c,d,f,h,k);this.ua=this.ua.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.yl(this.ai)&&this.node("path",this.ai,{d:this.path.Np(this.ua)})};a.prototype.stroke=function(){this.yl(this.Xg)&&this.node("path",this.Xg,{d:this.path.Np(this.ua)})};a.prototype.moveTo=
function(a,d){this.path.moveTo(this.ua,a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(this.ua,a,d)};a.prototype.quadraticCurveTo=function(a,d,c,f){this.path.quadraticCurveTo(this.ua,a,d,c,f)};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){this.path.bezierCurveTo(this.ua,a,d,c,f,h,k)};a.prototype.fillText=function(a,d,c){this.yl(this.ai)&&(this.$g(this.font),this.node("text",this.ai|this.Cm,{x:d,y:c},a))};a.prototype.strokeText=function(a,d,c){this.yl(this.Xg)&&(this.$g(this.font),this.node("text",
this.Xg|this.Cm,{x:d,y:c},a))};a.prototype.zq=function(a,d,c,f,h,k,l,n,q){var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=h;e.drawImage(a,-d,-c);a=b.toDataURL();this.en().Ge(new Ra("image",{transform:"matrix("+this.ua.m11+" "+this.ua.m21+" "+this.ua.m12+" "+this.ua.m22+" "+this.ua.Ea+" "+this.ua.Fa+")",x:k,y:l,width:n,height:q,"xlink:href":a}))};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};
a.prototype.Rh=function(){};a.prototype.Dq=function(){return{name:this.bg}};a.prototype.Hq=function(a){this.bg=a?a.name:""};a.prototype.clip=function(){var a=this.my(),d=new Ra("clipPath",{id:a});d.Ge(new Ra("path",{d:this.path.Np(this.ua)}));this.Gk.Ge(d);this.bg=a;this.path=new te};return a}(re);var ve=u.create("OPENTYPE");function we(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw console.log(Error(a)),Error(a);}
var xe=function(){function c(a,b){this.code=a;this.Zd=b}c.prototype.toString=function(){return(255<this.code?"code=12 "+(this.code&255):""+this.code)+" "+JSON.stringify(this.Zd)};return c}(),ye=function(){function c(a,b,d){void 0===b&&(b=0);void 0===d&&(d=a.length-b);this.Vq=a;this.start=b;this.length=d;this.Ma=0}c.prototype.na=function(a){for(var b=0;a--;)b=256*b+this.Vq[this.Ma++ +this.start];return b};c.prototype.getInt16=function(){var a=this.na(2);a&32768&&(a-=65536);return a};c.prototype.sh=
function(a,b){void 0===b&&(b=1);for(var d="",c=0;c<a;c+=b)d+=String.fromCharCode(this.na(b));return d};c.prototype.lg=function(){return this.getInt16()/16384};c.prototype.seek=function(a){if(a>this.length)throw Error("Seek to invalid location");var b=this.Ma;this.Ma=a;return b};c.prototype.slice=function(a,b){void 0===b&&(b=this.length-a);return new c(this.Vq,a+this.start,b)};c.prototype.ao=function(){var a;void 0===a&&(a=this.Ma);this.seek(a);var b=this.na(2);if(0<b){var d=this.na(1);this.seek(a+
3+d*b);var c=this.na(d);this.seek(a+3+(b+1)*d-1+c)}return a};c.prototype.Nn=function(a){this.seek(a);a=this.na(2);var b=this.na(1);if(4<b)throw Error("Error: This is not an index; offsetSize="+b);return a};c.prototype.Wi=function(a,b){this.seek(a);var d=this.na(2);if(b>=d)throw Error("Tried to read past end of index");var c=this.na(1);this.seek(a+3+c*b);b=this.na(c);var f=this.na(c);return this.slice(a+3+(d+1)*c-1+b,f-b)};c.prototype.sn=function(){return this.Ma>=this.length};c.prototype.Zr=function(a,
b){void 0===a&&(a=!1);void 0===b&&(b=[]);for(b=new xe(0,b);;){if(this.sn())throw Error("Unexpected end of charstring");var d=this.na(1);if(12===d)return b.code=3072|this.na(1),b;if(28>d||a&&29<=d&&31>=d)return b.code=d,b;if(30===d){var c="";a:for(;;){d=this.na(1);for(var f=4;0<=f;f-=4){var h=d>>f&15;switch(h){case 10:c+=".";break;case 11:c+="E";break;case 12:c+="E-";break;case 14:c+="-";break;case 15:break a;case 14:break;default:c+=h.toString()}}}b.Zd.push(parseFloat(c))}else 29===d?(c=this.na(1),
d=this.na(1),f=this.na(1),h=this.na(1),b.Zd.push(c<<24|d<<16|f<<8|h)):28===d?(c=this.na(1),d=this.na(1),b.Zd.push(c<<8|d)):a&&255===d?b.Zd.push(this.na(4)/65536):251<=d?(c=this.na(1),b.Zd.push(256*-(d-251)-c-108)):247<=d?(c=this.na(1),b.Zd.push(256*(d-247)+c+108)):b.Zd.push(d-139)}};return c}(),ze=function(){function c(a){this.Rp=[];var b=this.n=0;for(a=a.split(/([:\[\]\(\)\-\.{}]|\d+)|\s+/);b<a.length;b++){var d=a[b];d&&d.length&&this.Rp.push(d)}}c.prototype.next=function(){return this.Rp[this.n++]};
c.prototype.match=function(a){return this.Rp[this.n]===a?(this.n+=1,!0):!1};c.prototype.value=function(a){var b=this.next(),d=parseFloat(b);return isNaN(d)?a[b]:d};c.prototype.Ai=function(a){this.n=a;return!1};return c}();function Ae(c,a,b,d){if(c.match("{")){for(b={};Be(c,a,b,d););c.match("}");return b}return Ce(c,a,b,d)}
function Be(c,a,b,d){var e=c.n;if(c.match("push")){var f=De(c,b);for(a=a.slice(f);Be(c,a,b,d););return c.match("pop")?!0:!1}f=c.next();return c.match(":")?(c=Ce(c,a,b,d),"_"!==f&&(b[f]=c),!0):c.Ai(e)}
function Ce(c,a,b,d){var e=c.n;if(c.match("[")){var f=De(c,b),h="",k=[];c.match(".")&&(h=c.next(),k={});if(!c.match("]"))return c.Ai(e);e=c.n;for(var l=0;l<f;l++){c.n=e;var n=Ae(c,a,b,d);""===h?k.push(n):k[n[h]]=n}0===f&&Ae(c,a,b,!0);return k}if(c.match("("))return b=De(c,b),c.match(")"),b;if(c.match("uint"))return b=c.value(b)/8,d?0:a.na(b);if(c.match("int"))return c.next(),d?0:a.getInt16();if(c.match("offset"))return a.Ma;if(c.match("date"))return c=1E3*(4294967296*a.na(4)+a.na(4))+Date.UTC(1904,
1,1),new Date(c);if(c.match("fixed"))return d?0:a.na(4)/65536;if(c.match("string")){if(!c.match("("))return c.Ai(e);b=De(c,b);return c.match(")")?d?0:a.sh(b):c.Ai(e)}return c.Ai(e)}function De(c,a){var b=c.value(a);c.match("-")?b-=c.value(a):c.match(":")&&(c=c.value(a),b=b>>c&1);return b}function Ee(c,a){return Ae(new ze(a),c,null,!1)}
var Ge=function(){function c(){this.fonts=[]}c.prototype.add=function(a){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(c){switch(c.label){case 0:return[4,fetch(a)];case 1:return b=c.sent(),[4,b.arrayBuffer()];case 2:return d=c.sent(),[2,this.Uy(new Uint8Array(d))]}})})};c.prototype.pz=function(){this.fonts.length=0};c.prototype.get=function(a){for(var b=0,d=this.fonts;b<d.length;b++){var c=d[b];if(c.kg===a)return c}return null};c.prototype.Uy=function(a){a=
new ye(a);var b=a.na(4);a.seek(0);a=1953784678===b?this.Uu(a):[new Fe(a)];b=0;a:for(;b<a.length;b++){for(var d=a[b],c=0,f=this.fonts;c<f.length;c++)if(f[c].kg===d.kg){ve("Not adding %s; already have it.");continue a}ve("Opened font: %s weight=%s italic=%s",d.kg,d.weight,d.Zi);this.fonts.push(d)}return a};c.prototype.Uu=function(a){var b=Ee(a,"{\n    ttcTag:string(4)\n    majorVersion:uint16\n    minorVersion:uint16\n    numFonts:uint32\n    offsetTable:[numFonts] uint32\n}");ve(JSON.stringify(b,null,
2));ve("Collection contains %s fonts",b.numFonts);var d=[],c=0;for(b=b.offsetTable;c<b.length;c++)d.push(new Fe(a,b[c]));return d};return c}(),Fe=function(){function c(a,b){void 0===b&&(b=0);this.Ba=a;this.td={};this.kg=this.fontFamily="";this.weight=0;this.bold=this.Zi=!1;this.uk=[];this.Wm=null;this.no=[];a.seek(b);this.Vd=Ee(a,"{  \n    scalarType:uint32\n    numTables:uint16\n    searchRange:uint16\n    entrySelector:uint16\n    rangeShift:uint16\n    tables:[numTables.tag] {\n        tag:string(4)\n        checksum:uint32\n        offset:uint32\n        length:uint32\n    }\n}");
ve(JSON.stringify(this.Vd,null,2));for(var d in this.Vd.tables)ve("Table: %s",d);this.tf("head","{\n    version:fixed\n    fontRevision:fixed\n    checksumAdjustment:uint32\n    magicNumber:uint32\n    flags:uint16\n    unitsPerEm:uint16\n    created:date\n    modified:date\n    xMin:int16\n    yMmin:int16\n    xMax:int16\n    yMax:int16\n    macStyle:uint16\n    lowestRectPPEM:uint16\n    fontDirectionHint:uint16\n    indexToLocFormat:uint16\n    glyphDataFormat:uint16\n\n    bold:(macStyle:0)\n    italic:(macStyle:1)\n}");
this.tf("name","{\n    offset:offset\n    format:uint16\n    count:uint16\n    stringOffset:uint16\n    names:[count] {\n        platformID:uint16\n        platformSpecificID:uint16\n        languageID:uint16\n        nameID:uint16\n        length:uint16\n        offset:uint16\n    }\n}");this.tf("cmap","{\n    offset:offset\n    version:uint16\n    numberSubtables:uint16\n    subTables:[numberSubtables] {\n        platformID:uint16\n        platformSpecificID:uint16\n        offset:uint32\n    }\n}");
this.tf("hhea","{\n    version:fixed\n    ascent:int16\n    descent:int16\n    lineGap:int16\n    advanceWidthMax:uint16\n    minLeftSideBearing:int16\n    minRightSideBearing:int16\n    xMaxExtent:int16\n    caretSlopeRise:int16\n    caretSlopeRun:uint16\n    caretOffset:int16\n    reserved:uint64\n    metricDataFormat:int16\n    numOfLongHorMetrics:uint16\n}");this.tf("kern","{\n    version:uint16\n    nTables:uint16\n    tables:[nTables] {\n        version:uint16\n        length:uint16\n        coverage:uint16\n        offset:offset\n        _:[length-6] uint8\n    }\n}");
this.tf("maxp","{\n    version:fixed\n    numGlyphs:uint16\n}");this.tf("OS/2","{\n    version:uint16\n    xAvgCharWidth:int16\n    usWeightClass:uint16\n    usWidthClass:uint16\n}");this.tf("CFF ","{\n    offset:offset\n    major:uint8\n    minor:uint8\n}");this.cz(a,this.td.name);this.Yy(a,this.td.cmap);this.az(a);this.bz(a,this.td.kern);this.Zi=!!this.td.head.italic;this.bold=!!this.td.head.bold;this.weight=this.td["OS/2"].usWeightClass;"CFF "in this.td&&(this.Wm=new He(a.slice(this.td["CFF "].offset)))}
c.prototype.tf=function(a,b){a in this.Vd.tables&&(ve("Decoding %s",a),this.Ba.seek(this.Vd.tables[a].offset),this.td[a]=Ee(this.Ba,b),ve(a+" table:",JSON.stringify(this.td[a],null,2)))};c.prototype.cz=function(a,b){for(var d=0,c=b.names;d<c.length;d++){var f=c[d];a.seek(b.offset+b.stringOffset+f.offset);var h=0===f.platformID||3===f.platformID?a.sh(f.length,2):a.sh(f.length);switch(f.nameID){case 1:this.fontFamily=h;break;case 4:this.kg=h}}};c.prototype.Yy=function(a,b){for(var d=0,c=b.subTables;d<
c.length;d++){var f=c[d],h=f.platformID,k=f.platformSpecificID;f=b.offset+f.offset;a.seek(f);var l=a.na(2),n=a.na(2);ve("CMAP platform "+h+" "+k+" format "+l+" length "+n+" at "+f);switch(l){case 0:this.uk.push(new Ie(a.slice(f,n)));break;case 4:this.uk.push(new Je(a.slice(f,n)))}}};c.prototype.az=function(a){var b=this.Vd.tables.GPOS;b&&this.no.push(new Ke(a.slice(b.offset,b.length)))};c.prototype.bz=function(a,b){if(b){var d=0;for(b=b.tables;d<b.length;d++){var c=b[d];0===c.coverage>>8&&(ve("Format 0 kern table detected"),
this.no.push(new Le(a.slice(c.offset,c.length))))}}};c.prototype.transform=function(a,b){b=this.sb(b);a.scale(b,-b)};c.prototype.pn=function(a,b,d,c){if(this.Wm)this.Wm.pn(a,b,d,c);else if(b=this.qt(b),null!==b)for(var e=0,h=0,k=0,l=0,n;h<b.ma.length;h++){var q=b.ma[h];0===e?(a.moveTo(q.x+d,q.y+c),e=1):1===e?q.Bh?a.lineTo(q.x+d,q.y+c):e=2:(n=b.ma[h-1],q.Bh?(a.quadraticCurveTo(n.x+d,n.y+c,q.x+d,q.y+c),e=1):a.quadraticCurveTo(n.x+d,n.y+c,(n.x+q.x)/2+d,(n.y+q.y)/2+c));h===b.Je[k]&&(2===e&&(n=q,q=b.ma[l],
q.Bh?a.quadraticCurveTo(n.x+d,n.y+c,q.x+d,q.y+c):a.quadraticCurveTo(n.x+d,n.y+c,(n.x+q.x)/2+d,(n.y+q.y)/2+c)),l=h+1,k+=1,e=0)}};c.prototype.qt=function(a){var b=this.kx(a);a=this.Ba;var d=this.Vd.tables.glyf;if(0===b||b>=d.offset+d.length)return null;we(b>=d.offset);we(b<d.offset+d.length);a.seek(b);b={Je:[],mj:a.getInt16(),ma:[],lB:a.getInt16(),pB:a.getInt16(),kB:a.getInt16(),oB:a.getInt16()};we(-1<=b.mj);-1===b.mj?this.jz(a,b):this.lz(a,b);return b};c.prototype.kx=function(a){we("loca"in this.Vd.tables);
var b=this.Vd.tables.loca,d=this.Ba;if(1===this.td.head.indexToLocFormat){b=d.seek(b.offset+4*a);a=d.na(4);var c=d.na(4)}else b=d.seek(b.offset+2*a),a=2*d.na(2),c=2*d.na(2);d.seek(b);return a===c?0:a+this.Vd.tables.glyf.offset};c.prototype.jz=function(a,b){var d,c,f=32;b.Je=[];for(b.ma=[];f&32;){f=a.na(2);var h=a.na(2);var k=1;var l=d=0;var n=1;var q=c=0;if(f&1){var v=a.getInt16();var x=a.getInt16()}else v=a.na(1),x=a.na(1);f&2&&(c=v,q=x);f&8?n=k=a.lg():f&64?(k=a.lg(),n=a.lg()):f&128&&(k=a.lg(),d=
a.lg(),l=a.lg(),n=a.lg());v=a.Ma;if(h=this.qt(h)){var w=b.ma.length;for(x=0;x<h.Je.length;x++)b.Je.push(h.Je[x]+w);for(x=0;x<h.ma.length;x++){w=h.ma[x].x;var y=h.ma[x].y;w=k*w+d*y+c;y=l*w+n*y+q;b.ma.push({x:w,y:y,Bh:h.ma[x].Bh})}}a.seek(v)}b.mj=b.Je.length;f&256&&a.seek(a.na(2)+a.Ma)};c.prototype.lz=function(a,b){function d(b,d,e){for(var f=0,l=0;l<h;l++){var n=k[l];n&d?f=n&e?f+a.na(1):f-a.na(1):~n&e&&(f+=a.getInt16());c[l][b]=f}}b.Je=[];for(var c=b.ma=[],f=0;f<b.mj;f++)b.Je.push(a.na(2));a.seek(a.na(2)+
a.Ma);if(0!==b.mj){var h=Math.max.apply(null,b.Je)+1,k=[];for(f=0;f<h;f++){var l=a.na(1);k.push(l);c.push({x:0,y:0,Bh:0<(l&1)});if(l&8){var n=a.na(1);we(0<n);for(f+=n;n--;)k.push(l),c.push({x:0,y:0,Bh:0<(l&1)})}}d("x",2,16,b.lB,b.kB);d("y",4,32,b.pB,b.oB)}};c.prototype.sb=function(a){return a/this.td.head.unitsPerEm};c.prototype.px=function(a){we("hmtx"in this.Vd.tables);var b=this.Ba,d=this.Vd.tables.hmtx.offset;b.seek(d+4);var c=this.td.hhea.numOfLongHorMetrics;if(a<c){var f=this.Ba.seek(d+4*a);
var h=b.na(2)}else f=b.seek(d+4*(c-1)),h=b.na(2),b.seek(d+4*c+2*(a-c));a=b.getInt16();b.seek(f);return{Sq:h,gy:a}};c.prototype.jx=function(a){for(var b=0,d=this.uk.length-1;0<=d&&!(b=this.uk[d].map(a));d--);return b};c.prototype.nw=function(a,b,d,c,f){a.save();a.translate(d,c);this.transform(a,f);f=[];for(d=0;d<b.length;d++)f.push(new Me(this.jx(b.charCodeAt(d))));d=0;for(c=this.no;d<c.length;d++)c[d].$i(f);for(var e=c=d=0;e<f.length;e++){var k=f[e],l=this.px(k.Ud);ve("Metrics for %s code %s index %s: %s %s",
b.charAt(e),b.charCodeAt(e),k.Ud,l.Sq,l.gy);this.pn(a,k.Ud,d+k.Gh.x,c+k.Gh.y);d+=l.Sq+k.advance.x;c+=k.advance.y}a.restore()};return c}(),Ie=function(){function c(a){this.Ba=a}c.prototype.map=function(a){return 0<=a&&255>=a?(this.Ba.seek(a+6),ve("charCode %s maps to %s",a,this.Ba.na(1)),this.Ba.seek(a+6),this.Ba.na(1)):0};return c}(),Je=function(){function c(a){this.Ba=a;a.seek(6);this.Nh=a.na(2)/2}c.prototype.map=function(a){var b=this;ve("Try to map charcode %s using %s ranges",a,this.Nh);var d=
this.Ba,c=0,f=0,h=Ne(this.Nh-1,function(e){d.seek(14+2*e);var f=d.na(2);d.seek(2*b.Nh+16+2*e);c=d.na(2);return a<c?-1:a>f?1:0});if(0<=h){d.seek(6*this.Nh+16+2*h);f=d.na(2);d.seek(4*this.Nh+16+2*h);var k=d.getInt16();0===f?f=k+a&65535:(d.seek(6*this.Nh+16+2*h+(2*(a-c)+f)),f=d.na(2),0!==f&&(f=f+k&65535))}return f};return c}();function Ne(c,a){for(var b=-1,d;1<c-b;){d=c+b>>1;var e=a(d);if(0==e)return d;0<e?b=d:c=d}return-1}
var He=function(){function c(a){this.Ba=a;this.xn=null;this.wn=[];var b=a.na(1),d=a.na(1),c=a.na(1);ve("CFF Version "+b+"."+d);a.seek(c);a.ao();this.fw=a.ao();this.wA=a.ao();this.zA=a.Ma;b=this.Sp=this.pt(a.Wi(this.fw,0));this.Os=a.Nn(b.CharStrings);ve("CFF Font contains "+this.Os+" glyphs");this.Sp.FDSelect?(this.xn=new Oe(a.slice(b.FDSelect),this.Os),this.kz(a,b)):this.wn.push(b)}c.prototype.pt=function(a){a=Pe(a,{},this);if(a.Private){var b=a.Private[1];Pe(this.Ba.slice(b,a.Private[0]),a,this);
a.Subrs&&(a.Subrs+=b)}return a};c.prototype.sh=function(a){if(a<Qe.length)return Qe[a];a=this.Ba.Wi(this.wA,a-Qe.length);return a.sh(a.length)};c.prototype.kz=function(a,b){b=b.FDArray;var d=a.Nn(b);ve("There are %s items in FDArray",d);for(var c=0;c<d;c++)this.wn.push(this.pt(a.Wi(b,c)))};c.prototype.fs=function(a,b){void 0===b&&(b=-1);if(-1===b){b=this.zA;var d=this.Sp.CharstringType}else d=this.wn[b],b=d.Subrs,d=d.CharstringType;var c=this.Ba.Nn(b);return this.Ba.Wi(b,a+(0===d?0:1240>c?107:33900>
c?1131:32768))};c.prototype.ix=function(a){return this.xn?this.xn.bj(a):0};c.prototype.pn=function(a,b,d,c){a.translate(d,c);var e=this.Sp.CharStrings,h=this.ix(b);Re(this.Ba.Wi(e,b),a,h,this);a.translate(-d,-c)};return c}(),Se=0,Te=1,N=2,Ue=3,Ve={};function O(c,a,b,d){var e=b instanceof Array;Ve[a]={name:c,nr:d,type:e?b:[b],fn:function(a,d){a[c]=e||b===Ue?d:d[0]}}}O("version",0,Se);O("Notice",1,Se);O("Copyright",12,Se);O("FullName",2,Se);O("FamilyName",3,Se);O("Weight",4,Se);
O("isFixedPitch",3073,Te,!1);O("ItalicAngle",3074,N,0);O("UnderlinePosition",3075,N,-100);O("UnderlineThickness",3076,N,50);O("PaintType",3077,N,0);O("CharstringType",3078,N,2);O("FontMatrix",3079,Ue,[.001,0,0,.001,0,0]);O("UniqueID",13,N);O("FontBBox",5,Ue,[0,0,0,0]);O("StrokeWidth",3080,N,0);O("XUID",14,Ue);O("charset",15,N,0);O("Encoding",16,N,0);O("CharStrings",17,N,0);O("Private",18,[N,N]);O("SyntheticBase",3092,N);O("PostSCript",3093,Se);O("BaseFontName",3094,Se);O("BaseFontBlend",3095,Se);
O("ROS",3102,[Se,Se]);O("CIDFontVersion",3103,N,0);O("CIDFontRevision",3104,N,0);O("CIDFontType",3105,N,0);O("CIDCount",3106,N);O("FDArray",3108,N);O("FDSelect",3109,N);O("FontName",3110,Se);O("BlueValues",6,N);O("OtherBlues",7,N);O("FamilyBlues",8,N);O("FamilyOtherBlues",9,N);O("BlueScale",3081,N,.039625);O("BlueShift",3082,8);O("BlueFuzz",3073,1);O("StdHW",10,N);O("StdVW",11,N);O("StemSnapH",3084,N);O("StemSnapV",3085,N);O("ForceBold",3086,Te,!1);O("LanguageGroup",3089,N,0);
O("ExpansionFactor",3090,N,.6);O("initialRandomSeed",3091,N,0);O("Subrs",19,N);O("defaultWidthX",20,N);O("NominalWidthX",21,N);
function Pe(c,a,b){for(;!c.sn();){var d=c.Zr();if(d.code in Ve){var e=Ve[d.code],f=[],h=0;a:for(;h<e.type.length;h++){var k=e.type[h];if(h>=d.Zd.length)throw Error("Not enough operands for instruction:"+d);var l=d.Zd[h];switch(k){case Se:f.push(b.sh(l));break;case Te:f.push(!!l);break;case Ue:f=d.Zd;break a;case N:f.push(l)}}e.fn(a,f)}else ve("Uknown dict opcode: %s",d.code)}for(var n in Ve)e=Ve[n],!e.nr||e.name in a||(a[e.name]=e.nr);return a}
function Re(c,a,b,d,e){for(e=e||{first:!0,width:0,lj:0,stack:[],x:0,y:0,Rg:!1,pb:0,qb:0};!c.sn();){switch(c.Zr(!0,e.stack).code){case 1:case 3:e.stack.length&1&&We(e);break;case 4:1<e.stack.length&&We(e);e.y+=e.stack[0];Xe(e,a);break;case 5:for(var f=0;f+1<e.stack.length;f+=2)e.x+=e.stack[f],e.y+=e.stack[f+1],a.lineTo(e.x,e.y);break;case 6:for(f=0;f<e.stack.length;f+=2)e.x+=e.stack[f],a.lineTo(e.x,e.y),f+1<e.stack.length&&(e.y+=e.stack[f+1],a.lineTo(e.x,e.y));break;case 7:for(f=0;f<e.stack.length;f+=
2)e.y+=e.stack[f],a.lineTo(e.x,e.y),f+1<e.stack.length&&(e.x+=e.stack[f+1],a.lineTo(e.x,e.y));break;case 8:Ye(e,a);break;case 10:Re(d.fs(e.stack.pop(),b),a,b,d,e);continue;case 11:return;case 14:e.stack.length&&We(e);e.Rg&&a.lineTo(e.pb,e.qb);break;case 18:case 23:e.stack.length&1&&We(e);e.lj+=e.stack.length>>1;break;case 19:case 20:e.stack.length&1&&We(e);e.lj+=e.stack.length>>1;f=e.lj+7>>3;for(var h=0;h<f;h++)c.na(1);break;case 21:e.stack.length&1&&We(e);e.x+=e.stack[0];e.y+=e.stack[1];Xe(e,a);
break;case 22:2===e.stack.length&&We(e);e.x+=e.stack[0];Xe(e,a);break;case 24:Ye(e,a);e.y+=e.stack.pop();e.x+=e.stack.pop();a.lineTo(e.x,e.y);break;case 25:for(f=0;f<e.stack.length-6;f+=2)e.x+=e.stack[f],e.y+=e.stack[f+1],a.lineTo(e.x,e.y);Ye(e,a,f);break;case 26:var k=e.stack.length&1;k&&(e.x+=e.stack[0]);for(;k<e.stack.length;k+=4){f=e.x;h=e.y+=e.stack[k+0];var l=e.x+=e.stack[k+1],n=e.y+=e.stack[k+2],q=e.x,v=e.y+=e.stack[k+3];a.bezierCurveTo(f,h,l,n,q,v)}break;case 27:if(k=e.stack.length&1)e.y+=
e.stack[0];for(;k<e.stack.length;k+=4)f=e.x+=e.stack[k+0],h=e.y,l=e.x+=e.stack[k+1],n=e.y+=e.stack[k+2],q=e.x+=e.stack[k+3],v=e.y,a.bezierCurveTo(f,h,l,n,q,v);break;case 29:Re(d.fs(e.stack.pop(),-1),a,b,d,e);continue;case 30:Ze(e,!1,a);break;case 31:Ze(e,!0,a);break;case 3075:case 3076:case 3077:case 3081:case 3082:case 3083:case 3084:case 3086:case 3087:case 3090:case 3092:case 3093:case 3094:case 3095:case 3096:case 3098:case 3099:case 3100:case 3101:case 3102:case 3106:case 3107:case 3108:case 3109:throw Error("Not implemented.");
}e.stack.length=0}}function Xe(c,a){c.Rg&&a.lineTo(c.pb,c.qb);c.pb=c.x;c.qb=c.y;c.Rg=!0;a.moveTo(c.x,c.y)}function Ye(c,a,b){for(void 0===b&&(b=0);b+5<c.stack.length;b+=6){var d=c.x+=c.stack[b+0],e=c.y+=c.stack[b+1],f=c.x+=c.stack[b+2],h=c.y+=c.stack[b+3],k=c.x+=c.stack[b+4],l=c.y+=c.stack[b+5];a.bezierCurveTo(d,e,f,h,k,l)}}
function Ze(c,a,b){for(var d=0;d+1<c.stack.length;d+=4){var e=d==c.stack.length-5;if(a){var f=c.x+=c.stack[d+0],h=c.y,k=c.x+=c.stack[d+1],l=c.y+=c.stack[d+2],n=e?c.x+=c.stack[d+4]:c.x;e=c.y+=c.stack[d+3]}else f=c.x,h=c.y+=c.stack[d+0],k=c.x+=c.stack[d+1],l=c.y+=c.stack[d+2],n=c.x+=c.stack[d+3],e=e?c.y+=c.stack[d+4]:c.y;b.bezierCurveTo(f,h,k,l,n,e);a=!a}}function We(c){c.first?(c.width=c.stack.shift(),c.first=!1):(ve("Warning; already have width"),c.stack.shift())}
var Oe=function(){function c(a){this.Ba=a;this.Js=0;this.format=a.na(1);ve("Reading FDSelect format %s",this.format);if(3!==this.format&&0!==this.format)throw Error("Can't read format "+this.format+" FDSelect");3===this.format&&(this.Js=a.na(2))}c.prototype.bj=function(a){var b=this;if(0===this.format)return this.Ba.seek(1+a),this.Ba.na(1);var d=-1;Ne(this.Js,function(c){b.Ba.seek(3+3*c);c=b.Ba.na(2);d=b.Ba.na(1);var e=b.Ba.na(2);return a<c?-1:a>=e?1:0});return d};return c}(),Qe=".notdef space exclam quotedbl numbersign dollar percent ampersand quoteright \nparenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven \neight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U\nV W X Y Z bracketleft backslash bracketright asciicircum underscore quoteleft a b c d e f g h i j k \nl m n o p q r s t u v w x y z braceleft bar braceright asciitilde exclamdown cent sterling fraction\nyen florin section currency quotesingle quotedblleft guillemotleft guilsinglleft guilsinglright fi\nfl endash dagger daggerdbl periodcentered paragraph bullet quotesinglbase quotedblbase quotedblright\nguillemotright ellipsis perthousand questiondown grave acute circumflex tilde macron breve dotaccent \ndieresis ring cedilla hungarumlaut ogonek caron emdash AE ordfeminine Lslash Oslash OE ordmasculine \nae dotlessi lslash oslash oe germandbls onesuperior logicalnot mu trademark Eth onehalf plusminus \nThorn onequarter divide brokenbar degree thorn threequarters twosuperior registered minus eth \nmultiply threesuperior copyright Aacute Acircumflex Adieresis Agrave Aring Atilde Ccedilla Eacute \nEcircumflex Edieresis Egrave Iacute Icircumflex Idieresis Igrave Ntilde Oacute Ocircumflex \nOdieresis Ograve Otilde Scaron Uacute Ucircumflex Udieresis Ugrave Yacute Ydieresis Zcaron aacute \nacircumflex adieresis agrave aring atilde ccedilla eacute ecircumflex edieresis egrave iacute \nicircumflex idieresis igrave ntilde oacute ocircumflex odieresis ograve otilde scaron uacute \nucircumflex udieresis ugrave yacute ydieresis zcaron exclamsmall Hungarumlautsmall dollaroldstyle \ndollarsuperior ampersandsmall Acutesmall parenleftsuperior parenrightsuperior twodotenleader \nonedotenleader zerooldstyle oneoldstyle twooldstyle threeoldstyle fouroldstyle fiveoldstyle \nsixoldstyle sevenoldstyle eightoldstyle nineoldstyle commasuperior threequartersemdash \nperiodsuperior questionsmall asuperior bsuperior centsuperior dsuperior esuperior isuperior \nlsuperior msuperior nsuperior osuperior rsuperior ssuperior tsuperior ff ffi ffl parenleftinferior \nparenrightinferior Circumflexsmall hyphensuperior Gravesmall Asmall Bsmall Csmall Dsmall Esmall \nFsmall Gsmall Hsmall Ismall Jsmall Ksmall Lsmall Msmall Nsmall Osmall Psmall Qsmall Rsmall Ssmall \nTsmall Usmall Vsmall Wsmall Xsmall Ysmall Zsmall colonmonetary onefitted rupiah Tildesmall \nexclamdownsmall centoldstyle Lslashsmall Scaronsmall Zcaronsmall Dieresissmall Brevesmall Caronsmall \nDotaccentsmall Macronsmall figuredash hypheninferior Ogoneksmall Ringsmall Cedillasmall \nquestiondownsmall oneeighth threeeighths fiveeighths seveneighths onethird twothirds zerosuperior \nfoursuperior fivesuperior sixsuperior sevensuperior eightsuperior ninesuperior zeroinferior \noneinferior twoinferior threeinferior fourinferior fiveinferior sixinferior seveninferior \neightinferior nineinferior centinferior dollarinferior periodinferior commainferior Agravesmall \nAacutesmall Acircumflexsmall Atildesmall Adieresissmall Aringsmall AEsmall Ccedillasmall Egravesmall \nEacutesmall Ecircumflexsmall Edieresissmall Igravesmall Iacutesmall Icircumflexsmall Idieresissmall \nEthsmall Ntildesmall Ogravesmall Oacutesmall Ocircumflexsmall Otildesmall Odieresissmall OEsmall \nOslashsmall Ugravesmall Uacutesmall Ucircumflexsmall Udieresissmall Yacutesmall Thornsmall \nYdieresissmall 001.000 001.001 001.002 001.003 Black Bold Book Light Medium Regular Roman Semibold".split(/\s+/);
function Me(c){this.Ud=c;this.Gh={x:0,y:0};this.advance={x:0,y:0}}
var Ke=function(){function c(a){this.Om=[];this.ns=Ee(a,"{\n    majorVersion:uint16\n    minorVersion:uint16\n    scriptListOffset:uint16\n    featureListOffset:uint16\n    lookupListOffset:uint16\n    featureVariationsOffset:uint16\n\n    push scriptListOffset\n    scriptCount:uint16\n    scriptRecords:[scriptCount] {\n        tag:string(4)\n        scriptOffset:uint16\n        push scriptOffset\n        defaultLangSys:uint16\n        langSysCount:uint16\n        langSysRecords:[langSysCount] {\n            langSysTag:string(4)\n            langSysOffset:uint16\n            push langSysOffset\n            lookupOrder:uint16\n            requiredFeatureIndex:uint16\n            featureIndexCount:uint16\n            featureIndices:[featureIndexCount] uint16\n            pop\n        }\n        pop\n    }\n    pop\n\n    push lookupListOffset\n    lookupCount:uint16\n    lookups:[lookupCount] {\n        offset:uint16\n        push offset\n        lookupType:uint16\n        lookupFlag:uint16\n        subTableCount:uint16\n        subTables:[subTableCount] {\n            offset:uint16\n            push offset\n            posFormat:uint16\n            coverageOffset:uint16\n        }\n        pop\n    }\n    pop\n\n    push featureListOffset\n    featureCount:uint16\n    featureRecords[featureCount] {\n        featureTag:string(4)\n        featureOffset:uint16\n        push featureOffset\n        featureParams:uint16\n        lookupIndexCount:uint16\n        lookupListIndicies:[lookupIndexCount] uint16\n        pop\n    }\n    pop\n}");for(var b=
this.ns.lookupListOffset,d=0,c=this.ns.lookups;d<c.length;d++){var f=c[d],h=b+f.offset,k=f.lookupType;ve("Lookup type %s has %s subtables",k,f.subTables.length);var l=0;for(f=f.subTables;l<f.length;l++){var n=f[l],q=h+n.offset;2===k&&1===n.posFormat?this.Om.push(new $e(a.slice(q))):2===k&&2===n.posFormat&&this.Om.push(new af(a.slice(q)))}}}c.prototype.$i=function(a){for(var b=0,d=this.Om;b<d.length;b++)d[b].$i(a)};return c}(),bf=function(){function c(a){this.Ba=a;this.sl=4;this.format=a.na(2);this.count=
a.na(2);ve("CoverageTable format %s count %s",this.format,this.count)}c.prototype.En=function(a){var b=this,d=-1;1===this.format?Ne(this.count,function(c){b.Ba.seek(b.sl+2*c);c=b.Ba.na(2);if(a<c)return-1;if(a>c)return 1;d=c;return 0}):Ne(this.count,function(c){b.Ba.seek(b.sl+6*c);c=b.Ba.na(2);b.Ba.na(2);var e=b.Ba.na(2);if(a<c)return-1;if(a>c)return 1;d=e+a-c;return 0});return d};return c}(),cf=function(c){function a(a){var b=c.call(this,a)||this;b.Wt=0;1===b.format&&(b.Wt=b.count,b.count=a.na(2),
b.sl+=2);return b}__extends(a,c);a.prototype.Ur=function(a){return Math.max(0,this.En(a-this.Wt))};return a}(bf);function df(c,a,b){b&1&&(a.Gh.x=c.getInt16());b&2&&(a.Gh.y=c.getInt16());b&4&&(a.advance.x=c.getInt16());b&8&&(a.advance.y=c.getInt16());b&16&&c.getInt16();b&32&&c.getInt16();b&64&&c.getInt16();b&128&&c.getInt16()}
var ef=function(){function c(){}c.prototype.$i=function(a){for(var b=0;b<a.length-1;b++)b+=this.bj(a[b],a[b+1])};return c}(),$e=function(c){function a(a){var b=c.call(this)||this;b.Ba=a;a.na(2);var e=a.na(2);b.bn=new bf(a.slice(e));b.Qj=a.na(2);b.Rj=a.na(2);b.count=a.na(2);b.nz=2*ff(b.Qj)+2*ff(b.Rj)+2;return b}__extends(a,c);a.prototype.bj=function(a,d){var b=this,c=this.bn.En(a.Ud);if(-1===c)return 0;this.Ba.seek(10+2*c);this.Ba.seek(this.Ba.na(2));var h=this.Ba.Ma;c=this.Ba.na(2);return 0<=Ne(c,
function(c){b.Ba.seek(h+c*b.nz);c=b.Ba.na(2);if(c<d.Ud)return-1;if(c>d.Ud)return 1;df(b.Ba,a,b.Qj);df(b.Ba,d,b.Rj);return 0})?1:0};return a}(ef),af=function(c){function a(a){var b=c.call(this)||this;b.Ba=a;a.na(2);b.bn=new bf(a.slice(a.na(2)));b.Qj=a.na(2);b.Rj=a.na(2);b.Bv=new cf(a.slice(a.na(2)));b.Cv=new cf(a.slice(a.na(2)));b.HB=a.na(2);b.Av=a.na(2);b.st=2*ff(b.Qj)+2*ff(b.Rj);return b}__extends(a,c);a.prototype.bj=function(a,d){if(-1===this.bn.En(a.Ud))return 0;var b=this.Bv.Ur(a.Ud),c=this.Cv.Ur(d.Ud);
this.Ba.seek(16+b*this.st*this.Av+c*this.st);df(this.Ba,a,this.Qj);df(this.Ba,d,this.Rj);return 1};return a}(ef),Le=function(c){function a(a,d){void 0===d&&(d=a.na(2));var b=c.call(this)||this;b.Ba=a;b.count=d;ve("Kern table has %s entries",b.count);return b}__extends(a,c);a.prototype.bj=function(a,d){var b=this,c=a.Ud<<16|d.Ud,h=0;Ne(this.count,function(a){b.Ba.seek(8+6*a);a=b.Ba.na(4);if(c<a)return-1;if(c>a)return 1;a=b.Ba.getInt16();d.Gh.x+=a;d.advance.x+=a;h=1;return 0});return h};return a}(ef);
function ff(c){c-=c>>1&1431655765;c=(c&858993459)+(c>>2&858993459);return 16843009*(c+(c>>4)&252645135)>>24};var gf=function(){function c(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c;this.Cc=[];this.fonts={};this.images=[];this.lm={};this.Zb=1;this.Jv=!0;this.page={};this.log=u.create("PdfWriter");this.pj=this.object("Pages",{Kids:[],Count:0});this.xv=this.object("Catalog",{Pages:this.pj._id+" 0 R"});this.Rh()}c.prototype.Yx=function(){if(null!==c.Im)return c.Im;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.Im=
b;this.log("JPEG supported: %s",b);return b};c.prototype.Rh=function(a,b,d,c){void 0===a&&(a=this.x);void 0===b&&(b=this.x);void 0===d&&(d=this.width);void 0===c&&(c=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,c);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+c],Parent:this.pj._id+" 0 R"});this.pj.Kids.push(this.page._id+" 0 R");this.pj.Count+=1;this.lm={}};c.prototype.object=function(a,b){var d=this.Cc.length+1;a&&(b.Type=a);b._id=d;this.Cc.push(b);return b};c.prototype.Zu=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.Jv){var b=yb.Vf("LZWEncoder");b.ku(a);b.flush();a=b.ph().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.UA=function(a){if(!(a in this.fonts)){var b="F"+this.Zb;this.Zb+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.Wj("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.hu=function(a,b){var d=""+a+"-"+b;if(!(d in this.lm)){var c="gs"+this.Zb;this.Zb+=1;var f=this.object("ExtGState",{_name:c});b?f.ca=this.Id(a):f.CA=this.Id(a);this.lm[d]=c;this.Wj("ExtGState",f)}return this.lm[d]};c.prototype.Wj=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.Hm=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].Ui===a&&b===this.images[d].os)return this.images[d].nj;return null};c.prototype.qm=function(a,b){var d,c=this.Hm(a);if(!c){var f="I"+this.Zb;this.Zb+=1;b instanceof HTMLCanvasElement?c=b:(c=document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0));b=c.getContext("2d").getImageData(0,0,c.width,c.height);var h=!1;if(this.Yx()){this.log("Using JPEG encoding");var k="[/DCTDecode]";var l=yb.Vf("");
for(d=0;d<b.data.length;d+=4)h=h||255>b.data[d+3];d=c.toDataURL("image/jpeg");var n=atob(d.split(",")[1]);for(d=0;d<n.length;d++)l.rb(n.charCodeAt(d))}else{this.log("Using LZW encoding");k="[/LZWDecode]";l=yb.Vf("LZWEncoder");for(d=0;d<b.data.length;d+=4)l.rb(b.data[d]),l.rb(b.data[d+1]),l.rb(b.data[d+2]),h=h||255>b.data[d+3];var q="[ <</EarlyChange 0 >> ]"}l.flush();l=l.ph().toString();f=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:l.length,Interpolate:"true",Filter:k,_name:f,_stream:l});q&&(f.DecodeParms=q);if(h){l=yb.Vf("LZWEncoder");for(d=0;d<b.data.length;d+=4)l.rb(b.data[d+3]);l.flush();l=l.ph().toString();q=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:l.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:l});f.SMask=q._id+" 0 R"}this.images.push({Ui:a,os:"",nj:f});c=f}this.Wj("XObject",c);return"/"+c._name};c.prototype.rm=
function(a,b){var d=this.Hm(a.Qa,b.toString());if(!d){d="P"+this.Zb;this.Zb+=1;this.qm(a.Qa,a.Qa);var c=this.Hm(a.Qa),f=new I(a.Qa.width,0,0,-a.Qa.height,0,a.Qa.height);f=b.multiply(f);var h="1",k="1",l=b.sb();l=Math.max(l.x,l.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)h=""+Math.ceil(this.width/a.Qa.width/l);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)k=""+Math.ceil(this.height/a.Qa.height/l);d=this.object("Pattern",{_name:d,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:h,YStep:k,Matrix:"[ "+this.Id(f.m11,f.m21,f.m12,f.m22,f.Ea,f.Fa)+"]",Resources:"<< /XObject << /"+c._name+" "+c._id+" 0 R >> >>"});d._stream="/"+c._name+" Do";this.images.push({Ui:a.Qa,os:b.toString(),nj:d})}this.Wj("Pattern",d);return"/"+d._name};c.prototype.Ig=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.Cc.length;d++)this.Nq(a,b,this.Cc[d],!1);var c=a.join("").length;a.push("xref\n0 "+(this.Cc.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.Cc.length;d++){for(var f=""+b[d];10>f.length;)f="0"+f;a.push(f+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.Cc.length+1)+"\n");a.push("   /Root "+this.xv._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(c+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toBlob=function(){for(var a=this.Ig(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.Nq=function(a,b,d,c){c?a.push("<<\n"):(b.push(a.join("").length),
a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var e in d)if(d.hasOwnProperty(e)&&"Type"!==e&&"_"!==e.charAt(0)){c&&a.push("    ");a.push("   /"+e+" ");var h=d[e];"object"===typeof h&&"[object Array]"===Object.prototype.toString.apply(h)?a.push("[ "+h.join(" ")+" ]"):"object"===typeof h?this.Nq(a,b,h,!0):a.push(h);a.push("\n")}c&&a.push("    ");a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+
"\n"),a.push("endstream\n"));c||a.push("endobj\n")};c.prototype.tw=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.Id=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var c=""+a[d];0<c.indexOf("e")&&(c=a[d].toFixed(20));b.push(c)}return b.join(" ")};c.Im=null;return c}(),hf=function(c){function a(a,d){var b=c.call(this)||this;b.Ew=d;b.path=[];b.x=0;b.y=0;b.ht=[];b.Ag="";b.Gg="";b.Fg=-1;b.Eg=
"";b.Dg="";b.Cg="";b.Bg="";b.zg=-1;b.log=u.create("PDFContext");b.Ye=a.clone();b.Ye.transform(new wc(.75,.75,0,0));b.vb=new gf(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle="#000000";b.strokeStyle="#000000";b.Kq=b.Lu;b.Iq();return b}__extends(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.ht.push({Ag:this.Ag,Gg:this.Gg,Fg:this.Fg,Eg:this.Eg,Dg:this.Dg,Cg:this.Cg,Bg:this.Bg,zg:this.zg})};a.prototype.restore=function(){c.prototype.restore.call(this);
var a=this.ht.pop();a&&(this.stream.push("Q"),this.Ag=a.Ag,this.Gg=a.Gg,this.Fg=a.Fg,this.Eg=a.Eg,this.Dg=a.Dg,this.Cg=a.Cg,this.Bg=a.Bg,this.zg=a.zg)};a.prototype.Rh=function(a){var b=new wc(.75,.75,0,0);a&&(this.Ye=a.clone(),this.Ye.transform(b));this.rn();this.vb.Rh(this.Ye.x,this.Ye.y,this.Ye.width,this.Ye.height);this.Iq();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.Iq=function(){this.log("Start page: %s",this.Ye);this.setTransform(1,0,0,1,0,0);this.Gg=
this.Ag="";this.Fg=-1;this.Bg=this.Cg=this.Dg=this.Eg="";this.zg=-1};a.prototype.rn=function(){this.stream.length&&this.vb.Zu(this.vb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.$t=function(){this.rn();for(var a=this.vb.Ig(),d=new Uint8Array(a.length),c=0;c<a.length;c++)d[c]=a.charCodeAt(c);return d};a.prototype.toString=function(){throw Error("Do not call PdfContext.toString()");};a.prototype.toBlob=function(){this.rn();return this.vb.toBlob()};a.prototype.setTransform=function(a,
d,c,f,h,k){var b=this.Ye.Sd();this.ua=(new I(a,c,d,f,h,k)).multiply(new xc(0,b.x,b.y)).multiply(new wc(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};a.prototype.fill=function(){this.Jm();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.Km();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.ua.apply(a,d);this.path.push(this.vb.Id(b.x,
b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.ua.apply(a,d);this.path.push(this.vb.Id(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){a=this.ua.apply(a,d);c=this.ua.apply(c,f);f=this.ua.apply(h,k);this.path.push(this.vb.Id(a.x,a.y,c.x,c.y,f.x,f.y)+" c");this.x=h;this.y=k};a.prototype.quadraticCurveTo=function(a,d,c,f){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*c,2/3*d+1/3*f,c,f)};a.prototype.fillText=function(a,d,c){this.Kq(a,
d,c,0)};a.prototype.strokeText=function(a,d,c){this.Kq(a,d,c,1)};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.Jm=function(){if(this.Ag!==this.fillStyle){if(this.fillStyle instanceof oe){var a=this.vb.rm(this.fillStyle,this.ua);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=r.me(this.fillStyle).ih(r.RGBA),this.stream.push(this.vb.Id(a.values[0],a.values[1],
a.values[2])+" rg"),a=this.vb.hu(a.values[3],!0),this.stream.push("/"+a+" gs"));this.Ag=this.fillStyle}};a.prototype.Km=function(){function a(a){return"bevel"===a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.Gg!==this.strokeStyle){if(this.strokeStyle instanceof oe){var c=this.vb.rm(this.strokeStyle,this.ua);this.stream.push("/Pattern CS");this.stream.push(c+" SCN")}else"string"===typeof this.strokeStyle&&(c=r.me(this.strokeStyle).ih(r.RGBA),this.stream.push(this.vb.Id(c.values[0],
c.values[1],c.values[2])+" RG"),c=this.vb.hu(c.values[3],!1),this.stream.push("/"+c+" gs"));this.Gg=this.strokeStyle}this.Fg!==this.lineWidth&&(this.Fg=this.lineWidth,this.stream.push(this.vb.Id(72*this.lineWidth/96)+" w"));this.Eg!==this.lineJoin&&(this.Eg=this.lineJoin,this.stream.push(a(this.lineJoin)+" j"));this.Dg!==this.lineCap&&(this.Dg=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.Mu=function(a,d,c,f){var b=this.$g(this.font);if(this.Cg!==b.fontSize||this.Bg!==b.fontFamily){var e=
this.vb.UA(b.fontFamily);this.stream.push(e+" "+this.vb.Id(parseFloat(b.fontSize))+" Tf");this.Cg=b.fontSize;this.Bg=b.fontFamily}this.zg!==f&&(this.stream.push(f+" Tr"),this.zg=f);0===f?this.Jm():this.Km();this.stream.push("BT");d=this.ua.multiply(new I(1,0,0,-1,d,c));this.stream.push(this.vb.Id(d.m11,d.m21,d.m12,d.m22,d.Ea,d.Fa)+" Tm");this.stream.push(this.vb.tw(a)+" Tj");this.stream.push("ET")};a.prototype.Lu=function(a,d,c,f){var b=this.$g(this.font),e=this.Ew.get(b.fontFamily);e?(0===f?this.Jm():
this.Km(),this.beginPath(),e.nw(this,a,d,c,parseFloat(b.fontSize)),0===f?this.fill():this.stroke()):this.Mu(a,d,c,f)};a.prototype.$g=function(a){var b="",c="",f="normal",h="normal",k="normal",l="normal";a=a.split(/\s+/);a:for(;;){var n=a.shift();if(!n)break;switch(n){case "normal":break;case "italic":case "oblique":f=n;break;case "small-caps":k=n;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":h=n;break;
default:if(""===c)n=n.split("/"),c=n[0],1<n.length&&(l=n[1]);else{b=n;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:f,fontVariant:k,fontWeight:h,fontSize:c,lineHeight:l,fontFamily:b}};a.prototype.zq=function(a,d,c,f,h,k,l,n,q){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,c,f,h,k,l,n,q);l+=q;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=h;e.drawImage(a,-d,-c);a=this.vb.qm(a instanceof HTMLImageElement?[a.src,d,c,f,h].join():
a,b);this.stream.push("q");k=this.ua.multiply(new I(n,0,0,-q,k,l));this.stream.push(this.vb.Id(k.m11,k.m21,k.m12,k.m22,k.Ea,k.Fa)+" cm");this.stream.push(a+" Do");this.stream.push("Q")};a.prototype.Ig=function(){return this.vb.Ig()};a.prototype.Dq=function(){return{}};a.prototype.Hq=function(){};a.prototype.clip=function(){for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("W");this.stream.push("n");this.path.length=0};return a}(re);function jf(c){return"string"===typeof c}function kf(c){return"number"===typeof c}function lf(c){return"object"===typeof c};var mf=u.create("CONFIG"),nf=function(){var c;if(document.currentScript&&(c=document.currentScript.getAttribute("src")))return c;if(!document.getElementsByTagName)return"";c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),of={autoGroup:!1,adaptiveBrushWidth:!1,adaptiveLineWidth:!1,angleArcs:0,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,allowSystemClipboard:!0,
allowZoom:!0,autoPickTool:!0,autoPickToolText:!0,autoSnap:0,background:"clear",backgroundImage:null,broadcastMouse:!1,collaborationServer:"wss://zwibbler.com/socket2",clickToDrawShapes:!1,debug:!1,defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:"#000000",defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",defaultRoundRectRadius:10,defaultSmoothness:"smooth",
defaultStrokeStyle:"#000000",defaultText:"Lorum ipsum dolor",defaultTextBackground:"rgba(0,0,0,0.0)",defaultTextAlign:"left",defaultTextDecoration:"none",defaultTextFillStyle:"#000000",defaultTextStrokeStyle:"#000000",defaultTextLineWidth:0,defaultZoom:1,drawShapeStyle:"box",fastDraw:!0,fonts:["Arial","Times New Roman"],gridBlocks:10,gridColour:"#cccccc",gridSpacing:20,imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",
keyDelete:"Delete,Backspace",keyDown:"Down,Ctrl+Down",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",keyMoveDown:"PageDown",keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z,\u2318+Shift+Z,Ctrl+Y",keyRight:"Right,Ctrl+Right",keySelectNone:"ESC",keySelectAll:"Ctrl+A",keySendToBack:"End",keyUndo:"Ctrl+Z,\u2318+Z",keyUngroup:"Ctrl+Shift+G",
keyUp:"Up,Ctrl+Up",keyZoomIn:"+,Shift+=",keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",latency:0,leaveTextToolOnBlur:!1,maximumZoom:0,magnet:!0,minimumZoom:0,multilineText:!1,nudge:10,outsidePageColour:"#808080",pageBorderColour:"rbga(0,0,0,0.0)",pageInflation:20,pagePlacement:"centre",pageSelectorDiv:"",pageShadow:!0,pageView:!1,pasteOffset:10,pasteOffsetX:0,pasteOffsetY:0,persistent:!1,pixelsPerUnit:1,preciseNudge:1,readOnly:!1,scrollbars:!0,setFocus:!0,
scrollbarHandleColour:"auto",showArrowTool:!0,showBackgroundSelector:!1,showBrushTool:!0,showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,showImageSelector:!1,showImageTool:!1,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,showPropertyPanel:!1,showRoundRectTool:!1,showRuler:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,showSmoothnessProperty:!0,
showSquareTool:!0,showTextTool:!0,showToolbar:!0,showUndoRedo:!0,simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:1,symmetry:0,textMode:"interactive",toolbarButtonSize:50,touchRadius:0,useTouch:"auto",units:"",colourPalette:"auto",colourPicker:"wheel",drawCircleStyle:"box",enableArrowKeysNudge:!1,showKeyboardHelp:!0,showMenu:!1},pf={},qf;for(qf in of)pf[qf.toLowerCase()]=qf;
var rf=function(c){function a(a,d){a=c.call(this,a,of,d)||this;a.Dd="";""===a.Dd&&a.set("imageFolder",a.options.imageFolder);"auto"===a.options.useTouch&&mf("Detected touch support: %s","ontouchstart"in window||"onmsgesturechange"in window);mf("Detect clipboard support: %s",a.ho());return a}__extends(a,c);a.prototype.so=function(){var a=bc(),d;for(d in a)this.set(d,a[d])};a.uu=function(a){return a.toLowerCase()in pf};a.prototype.Kr=function(a,d){"debug"===a&&(a="showDebug");if("defaultZoom"===a){if("page"!==
d&&"width"!==d&&!kf(d)&&(d=parseFloat(d),isNaN(d))){mf("Error: Config option %s must be a number or 'page' or 'width'",a);return}}else if("allowSelectBox"!==a)if("imageFolder"===a){var b=this.Ix();""===b?(this.Dd=d.replace("$SCRIPT/",""),this.Dd=this.Dd.replace("$SCRIPT","")):this.Dd=d.replace("$SCRIPT/","$SCRIPT").replace("$SCRIPT",b);""!==this.Dd&&"/"!==this.Dd[this.Dd.length-1]&&(this.Dd+="/");mf("scriptPath=%s imageFolder=%s, result:%s",b,this.options.imageFolder,this.Dd)}else if("broadcastMouse"===
a)"true"===d?d=!0:"false"===d&&(d=!1);else if("string"===typeof d)if("number"===typeof this.options[a]){if(d=parseFloat(d),isNaN(d)){console.log(Error("Config option "+a+" expects a number"));return}}else if("boolean"===typeof this.options[a]||"useTouch"===a&&"auto"!==d)d="1"===d||"true"===d||""===d;return{name:a,value:d}};a.prototype.Ix=function(){var a=nf;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,d+1):""};a.prototype.UB=function(){return this.options.showBrushTool};a.prototype.XB=function(){return this.options.showPropertyPanel};
a.prototype.VB=function(){return this.options.showColourPanel};a.prototype.WB=function(){return this.options.showDebug};a.prototype.YB=function(){return this.options.showToolbar};a.prototype.cb=function(a){return this.get(a)};a.prototype.get=function(a){switch(a){case "useTouch":return this.Vh();default:return c.prototype.get.call(this,a)}};a.prototype.Vh=function(){return"auto"===this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch};a.prototype.Mw=function(){if("auto"===
this.options.allowSelectBox){var a=this.Vh(),d=document.documentElement.offsetHeight,c=window.innerHeight,f=!a||a&&0<c-d+50;mf("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",f,a,d,c);return f}return this.options.allowSelectBox};a.prototype.$w=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();return"sharpest"===a?0:"sharper"===a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.Mn=function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===
a.indexOf("/")?a:this.Dd+a};a.prototype.ic=function(a){return A.ic(this.get(a))};a.prototype.hv=function(a){function b(a){for(var b="",d=0;d<a.length;d++){var c=a.charAt(d);b=c===c.toUpperCase()?b+("-"+c.toLowerCase()):b+c}return b}var c=this,f={keyCut:1,keyCopy:1,keyPaste:1},h;for(h in this.options)this.options.hasOwnProperty(h)&&(0!==h.indexOf("key")||f[h]||a.map(this.options[h],b(h).substr(4)));this.pa("update",function(d,c,e){0!==d.indexOf("key")||f[d]||(d=b(d).substr(4),mf("Unmap keyboard %s=>%s",
e,d),a.MA(e,d),mf("Map keyboard %s=>%s",c,d),a.map(c,d))});this.pa("allowSystemClipboard",function(){var b=!c.ho();b?mf("Not using system clipboard. Mapping cut/copy/paste keys"):mf("Using system clipboard. Ignore keyCut/keyCopy/keyPaste.");a.map(c.options.keyCut,"cut",b);a.map(c.options.keyCopy,"copy",b);a.map(c.options.keyPaste,"paste",b)})};a.prototype.Wr=function(){return"radial"===this.get("drawCircleStyle")||"radial"===this.get("drawShapeStyle")?"circle":"rectangle"};a.prototype.Kh=function(a){var b=
a;0<this.options.maximumZoom&&(a=Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&(a=Math.max(a,this.options.minimumZoom));a!==b&&mf("Zoom restricted to %s",a);return a};a.prototype.ho=function(){var a=document;return this.get("allowSystemClipboard")&&void 0!==a.oncopy&&void 0!==a.oncut&&void 0!==a.onpaste};return a}(dc);var sf=function(c){function a(){var a=c.call(this)||this;a.Jh=[];a.eh=!1;a.canvas=null;a.ga=null;a.log=u.create("FORMAT",!0);return a}__extends(a,c);a.prototype.add=function(a,d,c,f,h){var b;var e=this.Jh;var n=0;for(b=e.length;n<b;n++){var q=e[n];q.type===d&&q.Co===a&&q.url===c&&(q.xp=!0)}this.log("Request URL %s",c.substr(0,64));this.Jh.push({Co:a,type:d,url:c,ft:f||{},uv:h,xp:!1});this.check()};a.prototype.check=function(){for(var a=0;!this.eh&&a<this.Jh.length;)this.Jh[a].xp?this.Jh.shift():(this.Ju(this.Jh[0]),
a+=1);this.eh||this.sa("done")};a.prototype.Ju=function(a){var b=this;b.eh=!0;b.log("Processing request for item %s url=%s",a.Co,a.url.substr(0,64));0===a.type.indexOf("image")&&Eb.load(a.url,function(d,c){null!==d?(b.log("Image request completed for item %s url %s",a.Co,c.substr(0,64)),a.uv(d,c)):b.log("Image request failed for url %s",c);b.eh=!1;a.xp=!0;b.check()})};a.prototype.Nv=function(a,d){this.sa("convert-dom-request",a,d)};a.prototype.Kf=function(a){this.sa("reformat",a)};a.prototype.uz=
function(a){this.sa("redraw",a)};a.prototype.Af=function(){if(null===this.canvas)return new F(0,0,0,0);var a=A(this.canvas).Yb();return new F(a.left,a.top,this.canvas.width,this.canvas.height)};a.prototype.kd=function(a){return this.ga?this.ga.get(a):null};return a}(Lb);function tf(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var uf=function(){function c(a,b,d,c,f){this.view=a;this.handle=b;this.GA=d;new F(0,0,0,0);this.Ia=[];this.ve=[];this.Gl=[];this.Rb=new D(0,0);this.log=u.create("TransformSelectionBehaviour");this.rl=!1;this.bb=0;this.Eb(c,f)}c.prototype.mb=function(a){if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.rl=!0;var b=this.view.Jd(a.pageX,a.pageY,!0),d=b.x;b=b.y;"gesturestart"===a.type&&(this.Rb.x=d,this.Rb.y=
b);var c=d-this.Rb.x,f=b-this.Rb.y,h=a.scale,k=a.rotation;this.view.Zl||(h=1);this.view.Bj||(k=0);k=-k/180*Math.PI;if(0<this.view.ga.get("snap")){var l=Math.PI/16;k=Math.floor(k/l)*l}h=new wc(h,h,this.Rb.x,this.Rb.y);k=new vc(k,this.Rb.x,this.Rb.y);c=(new uc(c,f)).multiply(h).multiply(k);this.nt(c,d,b);"gestureend"===a.type&&this.wa(c,d,b);return!0};c.prototype.Eb=function(a,b){if(this.rl)return!0;this.view.xe(!0);this.Ia=this.view.Bc();this.xw(this.Ia);this.Rb=this.view.bb(new D(a,b),this.bb);this.log("onMouseDown(%s,%s)",
this.Rb.x,this.Rb.y);new F(this.view.Kd.x,this.view.Kd.y,this.view.Kd.width,this.view.Kd.height);return!0};c.prototype.xw=function(a){this.ve=[];for(var b=new I,d=0;d<a.length;d++)this.ve.push(a[d].De(b)),this.Gl.push(this.ve[d]),this.bb=this.bb||a[d].ja("snap")};c.prototype.yb=function(a,b){if(this.rl)return!0;var d=this.view.bb(new D(a,b),this.bb);a=d.x;b=d.y;d=this.handle.uh(new D(d.x-this.Rb.x,d.y-this.Rb.y));this.nt(d,a,b);return!0};c.prototype.nt=function(a,b,d){for(var c=this,f=0;f<this.Ia.length;f++)this.Ia[f].Gc(this.ve[f]),
this.Gl[f]=this.Ia[f].De(a),this.Ia[f].Gc(this.Gl[f]),this.Ia[f].format(this.view.ra,this.view.request);this.view.bu(a);this.view.la(function(){if(c.handle instanceof ge){var a=c.view.ra;a.save();a.beginPath();a.strokeStyle="#0050B7";a.lineWidth=1/c.view.scale;a.moveTo(c.handle.origin.x,c.handle.origin.y);a.lineTo(b,d);a.stroke();a.restore()}})};c.prototype.wa=function(a,b,d){for(var c=this,f=0;f<this.Ia.length;f++)this.Ia[f].Gc(this.ve[f]);f=!1;if(a.ys()){a={docX:b,docY:d,nodes:[]};b=0;for(d=this.Ia;b<
d.length;b++)a.nodes.push({id:d[b].id});f=!1===this.view.Ca.Pc("drop-shape",a)}f||this.view.aa.transaction(function(){for(var a=0;a<c.Ia.length;a++)c.view.aa.$b([c.Ia[a].id],c.Gl[a])});this.Dr()};c.prototype.Pb=function(a,b,d){var c=this;if(this.rl)return!0;var f=a,h=b,k=this.view.bb(new D(a,b),this.bb);a=k.x;b=k.y;this.log("onMouseUp(%s,%s)",a,b);var l=!1;if(k.hd(this.Rb))this.GA?(a=this.view.aa.Db(f,h,this.view.Lb))&&a.se()?(this.log("Didn't move, and has edit mode. Selecting node %s",a.id),this.view.lb(),
this.view.Pg(a)):l=!0:(this.log("Didn't move, but toggleEditNode=false"),l=!0);else return this.log("Moved by %s,%s",a-this.Rb.x,b-this.Rb.y),d=this.handle.uh(new D(k.x-this.Rb.x,k.y-this.Rb.y)),this.wa(d,a,b),!0;if(l){var n=this.handle.click(d);this.log("handle.click returned %s",n);n&&this.view.aa.transaction(function(){c.view.aa.Sf(tf(c.Ia),n)})}this.Dr();return!0};c.prototype.Dr=function(){this.view.bu(new I);this.view.li();this.view.update(!0);this.view.tb()};c.prototype.lc=function(){this.view.xe(!1)};
c.prototype.Ad=function(){return"pick"};return c}();var wf=function(){function c(a,b){this.view=a;this.ba=b;this.Pk=!1;this.Ga=this.yf=this.ka=null;this.fillStyle="#000000";this.Jj=!1;this.ya=new Ib;this.Kp="normal";this.log=u.create("Text");this.multiline=a.ga.get("multilineText");this.Bb=document.createElement("div");a.ga.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.Kp="top")}c.prototype.gd=function(){this.log("Entering text mode");this.view.oc("text")};c.prototype.lc=function(){this.Pk&&this.ti();this.view.oc("default");
this.log("Leaving text mode");this.ka&&this.ka.parentNode&&this.ka.parentNode.removeChild(this.ka);this.ka=null;this.Bb.parentNode&&this.Bb.parentNode.removeChild(this.Bb);this.ya.Ta()};c.prototype.Eb=function(a,b,d){this.log("onMouseDown(%s)",d.type);if(this.Pk){if(d.target===this.ka)return this.log("Ignore click -- its in our own edit box."),this.view.Ok=!0,!1;this.log("Editing somewhere else on mousedown; submit that first.");this.ti();this.view.ga.get("autoPickToolText")&&this.view.tb()}else d=
this.view.aa.Db(a,b,this.view.Lb),this.Ep(d,a,b);this.log("Eating click");return this.view.Ok=!0};c.prototype.ww=function(){if(this.Bb&&this.ka){this.Bb.style.fontSize=this.ka.style.fontSize;this.Bb.style.fontFamily=this.ka.style.fontFamily;this.Bb.style.fontWeight=this.ka.style.fontWeight;this.Bb.style.fontStyle=this.ka.style.fontStyle;this.Bb.style.whiteSpace="pre-line";this.Bb.style.position="absolute";this.Bb.style.visibility="hidden";this.Bb.style.backgroundColor="rgba(0,0,0,0.2)";document.body.appendChild(this.Bb);
this.Bb.style.left="0";for(this.Bb.style.top="0";this.Bb.firstChild;)this.Bb.removeChild(this.Bb.firstChild);this.Bb.appendChild(document.createTextNode(this.ka.value));var a=this.Bb.clientWidth,b=this.ka.clientWidth;b<a&&(b=a,this.view.ga.get("multilineText")&&b>500*this.view.scale&&(b=500*this.view.scale),this.ka.style.width=b+2+"px")}};c.prototype.Ep=function(a,b,d){function c(){z.ka&&(z.log("Set editBox width,height to "+z.ka.scrollWidth+"px, "+z.ka.scrollHeight+"px"),z.ka.style.height=""+z.ka.scrollHeight+
"px",z.ka.style.width=""+z.ka.scrollWidth+"px");K=null}function f(){null===z.Ga&&z.ww()}var h=0,k=0,l=0,n=0,q=0,v=0,x=0;this.Jj=!1;if(a&&"TextNode"===a.type()||a&&"PathNode"===a.type()&&this.view.ga.get("allowTextInShape")||a&&"PathNode"!==a.type()&&a.qg()){this.Ga=a;"top"!==this.Kp&&"TextNode"===a.type()&&this.Ga.Lf(!0);this.view.la();this.yf=new D(a.rect.x,a.rect.y);if(n=a.ja("font")){n=qe(n);var w=n.fontFamily||"arial";var y=parseFloat(n.fontSize)||10;var B="bold"===n.fontWeight;var E="italic"===
n.fontStyle}else w=a.ja("fontName"),y=a.ja("fontSize"),B=a.ja("bold"),E=a.ja("italic");"TextNode"!==a.type()||a.ja("wrap")||(y*=a.Na().sb().y);"TextNode"===a.type()&&(k=a.rect.height);var L=a.ja("textDecoration");h=a.rect.width*this.view.scale;h=Math.max(h,50);h+=7;this.fillStyle=a.ja("textFillStyle")||this.Ja("textFillStyle");var H=a.Na().sb();n=l=a.ja("padding")||0;l*=H.x;n*=H.y;v+=1;--x;k+=2;q=.15*y*H.y;this.log("NodeWidth=%s scale=%s/%s padding=%s/%s, paddingShift=%s editWidth=%s",a.rect.width,
H.x,H.y,l,n,q,h)}else this.Ga=null,this.yf=new D(b,d),w=this.Ja("fontName"),y=this.Ja("fontSize"),B=this.Ja("bold"),E=this.Ja("italic"),L=this.Ja("textDecoration"),this.fillStyle=this.ba.fillStyle||this.Ja("textFillStyle")||this.Ja("fillStyle"),this.Ja("wrap")&&(d-=y);var z=this;this.ka=document.createElement("textarea");this.ka.setAttribute("rows","1");this.ka.style.width=h?""+h+"px":"auto";a=this.view.mh(this.yf.x,this.yf.y);this.ka.classList.add("zwibbler-text-area");this.ka.style.minWidth="0";
this.ka.style.maxWidth="none";this.ka.style.position="absolute";this.ka.style.fontFamily=w;this.ka.style.fontSize=""+y*this.view.scale+"px";this.ka.style.lineHeight="1";this.ka.style.overflow="hidden";this.ka.style.fontWeight=B?"bold":"normal";this.ka.style.fontStyle=E?"italic":"normal";this.ka.style.paddingTop=n+q+"px";this.ka.style.paddingBottom=n-q+"px";this.ka.style.paddingLeft=l+"px";this.ka.style.paddingRight=l+"px";this.ka.style.border="1px dashed #888";this.ka.style.outline="none";this.ka.style.color=
this.fillStyle;this.ka.style.boxSizing="border-box";this.ka.style.backgroundColor=this.Ja("background");this.Ga&&"PathNode"===this.Ga.type()&&(this.ka.style.backgroundColor="white");this.ka.style.textDecoration=L||"none";this.ka.style.textAlign=this.Ja("textAlign");this.ka.style.zIndex=""+(this.view.Bd()+1);this.ka.style.resize="both";k&&(this.log("Set editbox height initially to "+k+"px"),this.ka.style.height=k+"px");k=this.ka.clientHeight;this.log("Using z-index %s",this.ka.style.zIndex);"#ffffff"===
r.me(this.fillStyle).toString()&&(this.ka.style.backgroundColor="#808080");y=this.view.canvas.parentElement;w=A(y).Yb();B=h=0;"top"===this.Kp?(B=A(this.view.canvas.first).Yb(),E=this.view.canvas.width,h=this.ka.clientWidth,h=B.left+E/2-h/2,B=B.top):(h=Math.round(a.x),B=Math.round(a.y));h+=v;B=B-n/2+x;this.ka.style.WebkitTransitionDuration="0";this.ka.style.MozTransitionDuration="0";this.ka.style.msTransitionDuration="0";this.ka.style.OTransitionDuration="0";this.ka.style.transitionDuration="0";vf(this.ka);
this.ka.style.left=h-w.left+"px";this.ka.style.top=B-w.top+"px";y.appendChild(this.ka);"center"===this.Ja("textAlign")&&(null===this.Ga?(v=this.ka.offsetWidth/2,this.ka.style.left=a.x-v-w.left+"px",b-=v):(v=this.ka.offsetWidth/2-this.Ga.rect.width/2,this.ka.style.left=h-v-w.left+"px",this.ka.style.top=B+n/2-w.top+"px"));this.Pk=!0;this.yf=new D(b,d+k);mc(this.ka);this.Ga&&(this.ka.value=this.Ga.ja("text"));var K=null;z.ka&&z.log("editBox scollheight is %s",z.ka.scrollHeight);K=setTimeout(c,0);this.ya.addEventListener(this.ka,
"keydown",function(a){"keydown"===a.type&&(27===a.keyCode&&z.multiline||13===a.keyCode&&a.shiftKey?(z.log("Enter pressed. create text."),z.ti(),z.view.La.zb&&z.view.nA(),z.view.ga.get("autoPickToolText")&&z.view.tb()):27===a.keyCode?(z.log("ESC pressed; cancel."),z.cancel(),z.view.tb(),z.view.zc.sa("goto-toolbar")):13===a.keyCode&&(K||(K=setTimeout(c,0))))});this.ya.addEventListener(this.ka,"input",f);this.ya.addEventListener(this.ka,"propertychange",f);this.view.ga.get("leaveTextToolOnBlur")&&(this.ya.addEventListener(this.ka,
"focus",function(){z.log("Text focus received.")}),this.ya.addEventListener(this.ka,"blur",function(){z.ka&&!z.ka.Yo&&(z.log("Text blur received -- removing=%s",!0===z.ka.Yo),z.ka.Yo=!0,z.ti())}));setTimeout(function(){z.ka&&z.ka.focus()},200);this.ka.focus();this.view.Ca.sa("edit-text-shown",z.ka);this.view.Ca.digest()};c.prototype.uA=function(a){a?this.ti():this.cancel()};c.prototype.cancel=function(){this.ka&&(this.ka.Yo=!0,this.ka.parentNode&&this.ka.parentNode.removeChild(this.ka),this.view.Ca.sa("edit-text-hidden"),
this.view.La.zb&&this.view.zc.sa("goto-canvas"));this.ka=null;this.Pk=!1;this.Ga&&(this.Ga.Lf(!1),this.view.la())};c.prototype.Ja=function(a){if(this.Ga){var b=this.Ga.ja(a);if(b)return b}if(a in this.ba)return this.ba[a];switch(a){case "background":return this.view.ga.get("defaultTextBackground");case "wrap":return this.view.ga.get("multilineText")}return this.view.va[a]};c.prototype.Qi=function(){return{textFillStyle:this.Ja("textFillStyle"),fillStyle:this.Ja("textFillStyle"),bold:this.Ja("bold"),
italic:this.Ja("italic"),textDecoration:this.Ja("textDecoration"),strokeStyle:this.Ja("strokeStyle"),lineWidth:this.Ja("lineWidth"),fontName:this.Ja("fontName"),fontSize:this.Ja("fontSize"),textAlign:this.Ja("textAlign"),"border-width":this.Ja("border-width")||0,"border-color":this.Ja("border-color")||"#000",background:this.Ja("background")||"transparent"}};c.prototype.ti=function(){var a=this;if(this.ka){var b=this.ka.value,d=this.ka.offsetWidth;this.cancel();if(this.Ga&&this.Ga.ja("text")===b&&
!this.Jj)this.log("Text was not changed.");else if(null===this.Ga&&""===b)this.log("No text entered.");else if(this.Ga){this.log("Update text in node %s",this.Ga.id);var c={text:b,textFillStyle:this.fillStyle,textAlign:this.Ja("textAlign"),textDecoration:this.Ja("textDecoration"),fontSize:this.Ja("fontSize")},f;for(f in this.ba)c[f]=this.ba[f];this.view.aa.transaction(function(){a.view.aa.$b([a.Ga.id],c)})}else if(this.yf){this.log("Create new text node.");var h=f=0,k=this.Ja("fontSize");f=k;if("center"===
this.Ja("textAlign")){this.Ja("width");var l=this.Lx(b);h=Math.max(0,(d-l)/2);this.log("tw="+l+" ew="+d+" Offset text by "+h+" to center.")}var n=new uc(this.yf.x+h,this.yf.y+f);this.view.aa.transaction(function(){var d=a.view.aa.createNode("TextNode",pc({text:b,background:a.Ja("background"),fontSize:k,fontName:a.Ja("fontName"),bold:a.Ja("bold"),italic:a.Ja("italic"),textAlign:a.Ja("textAlign"),textFillStyle:a.Ja("textFillStyle"),textDecoration:a.Ja("textDecoration"),strokeStyle:a.Ja("textStrokeStyle"),
lineWidth:a.Ja("textLineWidth"),layer:a.ba.layer||a.view.Nc,wrap:a.view.ga.get("multilineText")},a.ba));a.view.aa.Sf([d],n)})}}};c.prototype.Lx=function(a){var b=new fd;b.bm(this.Ja("fontName"),this.Ja("fontSize"),this.Ja("bold"),this.Ja("italic"),"none");b.Nf(a);a=document.createElement("canvas").getContext("2d");b.format(a,0,0);return b.rect.width};c.prototype.yb=function(){return!1};c.prototype.Xd=function(a){this.log("keyboard: %s",a);"cancel"===a&&null===this.ka&&(this.view.tb(),this.view.zc.sa("goto-toolbar"))};
c.prototype.Wd=function(a){this.log("Set text colour to %s",a);this.Jj=!0;this.fillStyle=a;this.ba.textFillStyle=a;this.ka&&(this.ka.style.color=a,"#ffffff"===r.me(a).toString()?this.ka.style.backgroundColor="#808080":this.ka.style.backgroundColor="#ffffff")};c.prototype.Gf=function(a,b){this.view.sp(a,b)};c.prototype.Xe=function(a,b){"defaultBold"===a?(a="bold",this.ka&&(this.ka.style.fontWeight=b?"bold":"normal")):"defaultItalic"===a?(a="italic",this.ka&&(this.ka.style.fontStyle=b?"italic":"normal")):
"defaultTextBackground"===a?(a="background",this.ka&&(this.ka.style.backgroundColor=b)):"defaultFont"===a?(a="fontName",this.ka&&(this.ka.style.fontFamily=b)):"defaultFontSize"===a?(a="fontSize",this.ka&&(this.ka.style.fontSize=b+"px")):"defaultTextFillStyle"===a?(a="textFillStyle",this.ka&&(this.ka.style.color=b)):"defaultTextDecoration"===a?(a="textDecoration",this.ka&&(this.ka.style.textDecoration=b)):"defaultTextAlign"===a&&(a="textAlign",this.ka&&(this.ka.style.textAlign=b));this.log("Update %s=%s",
a,b);this.Jj=!0;this.ba[a]=b};c.prototype.Ad=function(){return"text"};c.prototype.be=function(a,b){b=qc(this.ba[a],b);this.ba[a]=b;this.Jj=!0;"fillStyle"===a&&(this.ba.textFillStyle=b);if(this.ka)switch(a){case "textFillStyle":case "fillStyle":this.ka.style.color=b;break;case "fontSize":this.ka.style.fontSize=b+"px";break;case "fontName":this.ka.style.fontFamily=b;break;case "bold":this.ka.style.fontWeight=b?"bold":"normal";break;case "italic":this.ka.style.fontStyle=b?"italic":"normal";break;case "textDecoration":this.ka.style.textDecoration=
b;break;case "textAlign":case "background":case "border":this.ka.style[a]=b;break;case "border-width":this.ka.style.borderWidth=b;break;case "border-color":this.ka.style.borderColor=b}};c.prototype.Yn=function(){return["TextNode"]};return c}();
function vf(c){c.addEventListener("input",function(){var a=c.value,b=a.replace(/[\u2018\u2019\u201C\u201D]/g,function(a){return"''\"\"".substr("\u2018\u2019\u201c\u201d".indexOf(a),1)});if(a!==b){a=c.selectionStart;var d=c.selectionEnd;c.value=b;c.selectionStart=a;c.selectionEnd=d}})};u.create("GroupNode");
var xf=function(c){function a(a,d){a=c.call(this,a,d)||this;a.children=[];a.Gb|=2;return a}__extends(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.ne=function(a){for(var b=0;b<this.children.length;b++)if(a===this.children[b])return b;return-1};a.prototype.format=function(a,d){for(var b=0,c=this.children;b<c.length;b++){var h=c[b];Uc(h)&&h.format(a,d)}};a.prototype.Ua=function(){return this.children.length};a.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,
1);return b};a.prototype.xl=function(a,d){this.children.splice(d,0,a)};a.prototype.Cb=function(a){return this.children[a]};return a}(dd);dd.vd("GroupNode",xf);var yf=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.Hk=function(a){var b,d;void 0===d&&(d="");if(!(a instanceof c))throw d||"Assertion failed";d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.ac=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&
b.push(a);return b};c.prototype.DA=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.ed=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();var zf={fontStyle:null,fontWeight:"normal",fontSize:12,fontFamily:"Times New Roman",colour:"black",align:"left",background:"none",underline:!1},Af={fontStyle:"fs",fontWeight:"fw",fontSize:"fh",fontFamily:"ff",colour:"fc",align:"ta",background:"fb",underline:"fu"},Bf=function(){function c(a){this.va=a;this.options={}}c.prototype.LA=function(){var a=new c(this.va),b;for(b in zf)zf.hasOwnProperty(b)&&(a.options[b]=this.get(b));return a};c.prototype.EA=function(){var a={},b;for(b in this.options)this.options.hasOwnProperty(b)&&
(a[b]=this.options[b]);return a};c.prototype.apply=function(a){a.fillStyle=this.get("colour");a.font=this.Vw()};c.prototype.empty=function(){var a=0,b;for(b in this.options)this.options.hasOwnProperty(b)&&(a+=1);return 0===a};c.prototype.Vk=function(a,b){a=c.Vk(a,b);return a.empty()?this:a};c.prototype.Rf=function(a){c.Rf(this.options,a)};c.prototype.set=function(a,b){this.options[a]=b};c.prototype.get=function(a){return a in this.options?this.options[a]:this.va[a]};c.prototype.has=function(a){return a in
this.options};c.prototype.tg=function(a){for(var b in a.options){var d=this.get(b),c=a.get(b);d!==c&&this.set(b,c)}};c.prototype.clone=function(){var a=new c(this.va);a.tg(this);return a};c.prototype.Vw=function(){var a=this.get("fontStyle"),b=this.get("fontWeight"),d=this.get("fontSize"),c=this.get("fontFamily");this.get("colour");var f=[];a&&f.push(a);b&&f.push(b);f.push(d+"px");f.push(c);return f.join(" ")};c.prototype.hd=function(a){if(this===a)return!0;for(var b in this.options)if(!(b in a.options)||
a.options[b]!==this.options[b])return!1;for(b in a.options)if(!(b in this.options))return!1;return!0};c.prototype.Hk=function(a){var b=new c(this.va),d;for(d in zf)zf.hasOwnProperty(d)&&a.get(d)!==this.get(d)&&(b.options[d]=this.get(d));return b};c.prototype.toString=function(){var a=[],b;for(b in this.options)a.push(b+"="+this.options[b]);return a.join(",")};return c}();
(function(c){c.Vk=function(a,b){void 0===b&&(b="");var d=new c(zf);switch(b){case "B":d.set("fontWeight","bold");break;case "I":d.set("fontStyle","italic");break;case "U":d.set("underline",!0)}for(var e in a)if(b=a[e],"textDecoration"===e)d.set("underline",0<=b.indexOf("underline"));else if(""!==b)switch(e){case "fontStyle":case "fontFamily":case "fontWeight":case "background":d.set(e,b);break;case "fontSize":d.set(e,parseFloat(b)||2);break;case "textAlign":d.set("align",b);break;case "color":d.set("colour",
b)}return d};c.Rf=function(a,b){for(var d in a){var c=a[d];switch(d){case "fontStyle":case "fontFamily":case "fontWeight":case "background":b[d]=c;break;case "fontSize":b[d]=c+"px";break;case "align":b.textAlign=c;break;case "colour":b.color=c;break;case "underline":b.textDecoration=c?"underline":""}}return b}})(Bf||(Bf={}));var Cf=Bf;u.create("TEXTWRITER");var Df=function(){function c(){this.Po=null;this.Pl=[]}c.prototype.Fp=function(){};c.prototype.qn=function(){this.Pl.push("\n")};c.prototype.lu=function(a){this.Po=a=this.Po?a.Hk(this.Po):a.LA();a=a.EA();for(var b in a)a.hasOwnProperty(b)&&this.Pl.push("/"+Af[b]+a[b]+";")};c.prototype.mu=function(a){a=a.replace(/\//g,"//");this.Pl.push(a)};c.prototype.toString=function(){return this.Pl.join("")};return c}();
function Ef(c,a){for(var b=0,d="",e="",f="",h=0;h<c.length;h++){var k=c.charAt(h);switch(b){case 0:"/"===k?b=1:d+=k;break;case 1:"/"===k?(d+=k,b=0):(--h,d.length&&(a("text",d.replace(/\/\//g,"/")),d=""),e="",b=2);break;case 2:e+=k;2===e.length&&(b=3,f="");break;case 3:";"===k?(a(e,f),b=0):f+=k}}d.length&&a("text",d.replace(/\/\//g,"/"))};var Ff=u.create("InlineItem"),Gf=function(){function c(a){this.style=a;this.index=0}c.prototype.count=function(){return 1};c.prototype.Va=function(a){Ff("Asked to set %s",a);this.style=this.style.clone();this.style.tg(a);Ff("After merge: %s",this.style)};c.prototype.wl=function(){};c.prototype.split=function(){return null};c.prototype.Hi=function(){return{width:0,height:0,$i:0,qv:!0,Ks:!1}};c.prototype.th=function(){return""};return c}();u.create("TextItem");
var Hf=function(c){function a(a,d){a=c.call(this,a)||this;a.text=d;return a}__extends(a,c);a.prototype.count=function(){return this.text.length};a.prototype.split=function(b){if(0<b&&b<this.text.length){var d=this.text.substr(b);this.text=this.text.substr(0,b);return new a(this.style.clone(),d)}return null};a.prototype.Hi=function(a,d){d=this.text.charAt(d);return{width:a?a.measureText(d).width:0,height:this.style.get("fontSize"),$i:0,qv:" "===d||"-"===d,Ks:"\n"===d}};a.prototype.th=function(a,d){return this.text.substr(a,
d)};return a}(Gf);var If=u.create("TEXTSEQ"),Kf=function(){function c(a){this.style=a;this.children=[];this.length=this.Yg=0;this.Ze=null}c.ci=function(a){var b=new Cf(zf),d=new c(b),e={},f;for(f in Af)Af.hasOwnProperty(f)&&(e[Af[f]]=f);Ef(a,function(a,c){a in e?("fh"===a&&(c=parseFloat(c)),"null"===c&&(c=null),b.set(e[a],c)):"text"===a?d.append([new Hf(b.clone(),c)]):If("Bad key: %s",a)});return d};c.prototype.save=function(a,b,d){var c=!1;this.zs(a,b,function(a,b,e){d.lu(a.style);a=a.th(b,e);b=0;for(e=a.split("\n");b<
e.length;b++){var f=e[b];if(""===f){if(c||d.Fp(),d.qn(),c=!1,"\n"===a)break}else c||(d.Fp(),c=!0),d.mu(f)}});c&&d.qn();return d};c.prototype.append=function(a){this.wl(this.Yg,a)};c.prototype.wl=function(a,b){If("Insert %s item at index %s",b.length,a);var d,c=0;for(d=0;d<this.children.length;d++){var f=this.children[d];var h=f.count();if(c===a){If("Found proper position");break}else if(c+h>a){If("Splitting item from %s..(%s)..%s",f.index,a,f.index+h);this.dk(d,a-c);c=a;d+=1;break}c+=h}for(this.children.splice.apply(this.children,
[d,0].concat(b));d<this.children.length;d++)f=this.children[d],h=f.count(),If("Bump item %s index %s->%s length=%s",d,f.index,c,h),f.index=c,c+=h,If("   item %s: %s/%s",d,f.index,f.count());this.Yg=c;this.length=this.children.length;this.Ze=null};c.prototype.remove=function(a,b){var d=[];if(0===this.children.length)return d;this.Jq(a);this.Jq(a+b);for(var c=this.Ki(a),f,h=c.item.index,k=c.index;k<this.children.length;k++){var l=this.children[k];f=l.count();h+f<=a+b?d.push(l):l.index=h-b;h+=f}this.children.splice(c.index,
d.length);this.length-=d.length;this.Yg-=b;this.Ze=null;return d};c.prototype.count=function(){return this.Yg};c.prototype.Ki=function(a){for(var b=0,d=0;d<this.children.length;d++)if(b+=this.children[d].count(),b>a)return{index:d,item:this.children[d]};if(this.children.length)return{index:this.children.length-1,item:this.children[this.children.length-1]};throw Error("getItemAt() on empty sequence.");};c.prototype.dk=function(a,b){var d=this.children[a];if(b=d.split(b))b.index=d.index+d.count(),this.children.splice(a+
1,0,b),this.length+=1,If("Split %s..%s..%s",d.index,b.index,b.index+b.count());return b};c.prototype.Jq=function(a){var b=this.Ki(a);b&&b.item.index<a&&this.dk(b.index,a-b.item.index)};c.prototype.kl=function(a){return 0===this.length?this.style:this.Ki(a).item.style};c.prototype.es=function(a,b){var d=[],c=0,f=0,h=null,k=0;if(0===b)return d.push({start:a,length:0,style:this.kl(a)}),d;for(var l=0;l<this.children.length;l++){var n=this.children[l];var q=n.count();k+=q;if(k>a){null===h&&(h=n.style,
c=n.index);var v=n.style.hd(h);v&&(f+=q);if(!v||k>=b)d.push({start:c,length:f,style:h}),c=n.index,f=0;if(k>=a+b)break}}return d};c.prototype.eA=function(a){for(var b=0;b<a.length;b++){var d=a[b];this.Va(d.style,d.start,d.length)}};c.prototype.Va=function(a,b,d){var c=0,f=b+d;If("setStyle: %s:%s %s",b,d,a);for(d=0;d<this.children.length;d++){var h=this.children[d],k=h.count();c<b&&b<c+k?this.dk(d,b-c)?k=b-c:(h.Va(a),If("Case 1")):b<=c&&f<c+k&&f>c?(this.dk(d,f-c),k=f-c,h.Va(a),If("Case 2")):b<=c&&c+
k<=f&&(h.Va(a),If("Case 3: fromChar=%s..%s count=%s..%s",b,f,c,c+k));c+=k}};c.prototype.Fz=function(a,b,d){for(var c=b;;){b=this.Hi(null,a);if(d(b)){a+=1;break}else if(0===a)break;--a}for(;;){b=this.Hi(null,c);if(d(b))break;else if(c>=this.Yg-1)break;c+=1}return{start:a,length:c-a}};c.prototype.Gx=function(a,b){return this.Fz(a,b,function(a){return a.Ks})};c.prototype.Hi=function(a,b){if(0===this.length)throw Error("error: expected to have child items");if(null===this.Ze||b<this.Ze.index||b>=this.Ze.index+
this.Ze.count())this.Ze=this.Ki(b).item;return this.Ze.Hi(a,b-this.Ze.index)};c.prototype.th=function(a,b){var d="";this.zs(a,b,function(a,b,c){console.log("Iterate: ",a,b,c);d+=a.th(b,c)});return d};c.prototype.zs=function(a,b,d){var c=a+b;if(0!==b){var f=this.Ki(a);if(f)for(b=f.item,f=f.index;a<c;){var h=Math.min(b.count(),c-a);d(b,a-b.index,h);a+=h;f+=1;if(f===this.children.length)break;b=this.children[f]}}};return c}();var Lf=u.create("SpliceText"),Mf=function(c){function a(a,d,e,f,h){var b=c.call(this)||this;b.Xb=a;b.text=d;b.start=e;b.length=f;b.style=h;b.We=[];return b}__extends(a,c);a.prototype.tg=function(b){if(!(b instanceof a))return!1;Lf("?merge(%s,%s,%s) and (%s,%s,%s)",this.start,this.length,this.text.substr(0,5),b.start,b.length,b.text.substr(0,5));return 0===this.length&&0===b.length&&this.start+this.text.length===b.start&&(null===this.style&&null===b.style||null!=this.style&&null!==b.style&&this.style.hd(b.style))?
(this.text+=b.text,Lf("Merging SpliceTextAction"),!0):0!==this.text.length||0!==b.text.length||this.start!==b.start&&b.start+b.length!==this.start?!1:(this.length+=b.length,this.start<b.start?this.We=this.We.concat(b.We):(this.We=b.We.concat(this.We),this.start=b.start),Lf("Merging Deletes"),!0)};a.prototype.Ac=function(){Lf("Execute SpliceTextAction(del=%s/%s insert %s...)",this.start,this.length,this.text.substr(0,5));this.Xb.fj(this.start);0<this.length&&(Lf("Removing text"),this.We=this.Xb.text.remove(this.start,
this.length));if(0<this.text.length){if(null===this.style)throw Error("style is null");var a=new Hf(this.style,this.text);this.Xb.text.wl(this.start,[a])}};a.prototype.Hc=function(){Lf("Undo SpliceTextAction(del=%s/%s insert %s)",this.start,this.length,this.text);0<this.text.length&&this.Xb.text.remove(this.start,this.text.length);this.We.length&&this.Xb.text.wl(this.start,this.We);this.Xb.fj(this.start)};return a}(ub);var Nf=u.create("UNDO"),Of=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.Xb=a;b.from=d;b.length=e;b.style=f;b.Fo=[];return b}__extends(a,c);a.prototype.Ac=function(){Nf("Do apply style");this.Xb.fj(this.from);this.Fo=this.Xb.text.es(this.from,this.length);this.Xb.text.Va(this.style,this.from,this.length)};a.prototype.Hc=function(){Nf("Undo apply style");console.log(this.Fo);this.Xb.fj(this.from);this.Xb.text.eA(this.Fo)};a.prototype.tg=function(){return!1};return a}(ub);var Pf=u.create("TextEditor"),Qf=function(c){function a(a,d){var b=c.call(this)||this;b.Vc=a;b.va=d;b.ii=0;b.fh=0;b.rf=null;b.sk=0;b.active=!1;b.text=new Kf(d);return b}__extends(a,c);a.prototype.setActive=function(a){this.active=a;Pf("setActive: %s",this.active)};a.prototype.Pi=function(){return Math.min(this.ii,this.fh)};a.prototype.Oi=function(){return Math.max(this.ii,this.fh)};a.prototype.save=function(a,d){void 0===a&&(a=0);void 0===d&&(d=this.text.length);return this.text.save(a,d,new Df).toString()};
a.prototype.sd=function(a,d){void 0===d&&(d=a);this.fh=a;this.ii=d;this.oh("selchange")};a.prototype.lb=function(){this.sd(0,0)};a.prototype.exec=function(a,d){var b=this.fh;switch(a){case "bold":this.km("fontWeight","bold","normal");return;case "italic":this.km("fontStyle","italic","normal");return;case "underline":this.km("underline",!0,!1);return;case "orange":this.km("background","orange","transparent");return;case "undo":Pf("Processing undo");this.Vc.Hc(this);this.sd(b);return;case "redo":Pf("Processing redo");
this.Vc.ae(this);this.sd(b);return;case "font":this.kk("fontFamily",d);return;case "fontSize":"string"===typeof d&&(d=parseFloat(d)||2);this.kk("fontSize",d);return;case "align":this.kk("align",d);break;case "delete":Pf("Delete text");this.Wo(!1);return;case "backspace":Pf("Delete text backspace");this.Wo(!0);return;case "select-none":this.sd(b,b);return}this.Jf()};a.prototype.km=function(a,d,c){var b=this.Pi();b=this.text.es(b,this.Oi()-b);for(var e,k=0;k<b.length&&(e=b[k].style,e.get(a)===d);k++);
this.kk(a,k<b.length?d:c)};a.prototype.us=function(a){var b=this.Pi(),c=this.Oi()-b;a=a.replace("\r","\n");Pf("Delete %s/%s Insert char %s...",b,c,a.substr(0,5));if(this.rf&&this.sk===b&&0===c){var f=this.rf;Pf("Using recording caret style: %s",f)}else f=0===c&&0<b?this.text.kl(b-1):this.text.kl(b);this.Vc.wa(new Mf(this,a,b,c,f),!1,this);this.sd(b+a.length,b+a.length);this.rf=null};a.prototype.kk=function(a,d){if("string"===typeof a){var b=new Cf(zf);b.set(a,d||"")}else b=a;if(b.empty())Pf("apply empty style; ignore");
else{a=this.Pi();d=this.Oi();var c=[];if(b.has("align")){var h=new Cf(zf);h.set("align",b.get("align"));var k=this.text.Gx(a,d);0<k.length&&(Pf("Apply paragraph style to %s:%s %s",k.start,k.start+k.length,b),c.push(new Of(this,k.start,k.length,h)))}Pf("applystyle called set %s:%s %s",a,d,b);a!==d?c.push(new Of(this,a,d-a,b)):(this.rf=null===this.rf||this.sk!==a?this.text.kl(a).clone():this.rf.clone(),this.rf.tg(b),this.sk=a,Pf("Recording new caret style: %s",this.rf));this.Vc.wa(c,!1,this)}};a.prototype.Wo=
function(a){var b=this.Pi(),c=this.Oi()-b;Pf("Delete %s characters (totalCount=%s)",c,this.text.count());c?(this.Vc.wa(new Mf(this,"",b,c,null),!1,this),this.sd(b)):a&&0<b?(this.Vc.wa(new Mf(this,"",b-1,1,null),!1,this),this.sd(b-1)):b<this.text.count()&&this.Vc.wa(new Mf(this,"",b,1,null),!1,this);this.sk=-1};a.prototype.Kx=function(){var a=this.Pi(),d=this.Oi()-a;Pf("getSelectedText()=%s",this.text.th(a,d));return this.text.th(a,d)};a.prototype.vg=function(a){var b=this;if(this.active)switch(Pf("Received clipboard event: %s",
a.type),a.type){case "copy":case "cut":Pf("Cut/Copy to system clipboard.");var c=this.Kx();Pf("text=%s",c);c.length&&(a.clipboardData.setData("text/plain",c),a.preventDefault(),"cut"===a.type&&this.Wo(!1));break;case "paste":for(Pf("There are %s items on the clipboard",a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var f=a.clipboardData.items[c];Pf("Item [%s] type is %s",c,f.type);"text/plain"===f.type&&f.getAsString(function(a){b.us(a)})}}};a.prototype.fj=function(){};a.prototype.Jf=
function(){};return a}(Lb);var Rf=u.create("HTMLTextEditor"),Wf=function(c){function a(a,d,e){void 0===e&&(e={});var b=c.call(this,new vb,(new Cf(zf)).Vk(window.getComputedStyle(d),d.tagName))||this;b.da=d;b.options=e;b.Rc=new Mb;b.jA(a);a.addEventListener(document,"selectionchange",function(){b.Qy()});a.addEventListener(document,"cut",function(a){b.vg(a)});a.addEventListener(document,"copy",function(a){b.vg(a)});a.addEventListener(document,"paste",function(a){b.vg(a)});Sf(b.text,d,b.va);b.Jf();b.pa("reformat",function(){b.Jf()});
return b}__extends(a,c);a.prototype.Uz=function(a){this.da.innerHTML=a;this.text=new Kf(this.va);Sf(this.text,this.da,this.va);A(this.da).clear();a=this.text;var b=this.da,c=this.va;a.save(0,a.count(),new Tf(b,c));this.sd(0,0)};a.prototype.jA=function(a){var b=this;this.Rc.map("ctrl+b,cmd+b","bold");this.Rc.map("ctrl+i,cmd+i","italic");this.Rc.map("ctrl+u,cmd+u","underline");this.Rc.map("ctrl+z,cmd+z","undo");this.Rc.map("ctrl+shift+z,cmd+shift+z","redo");this.Rc.map("delete","delete");this.Rc.map("backspace",
"backspace");this.Rc.pa("*",function(a,d){Rf("Keyboard event: ",a);d.preventDefault();d.stopPropagation();b.exec(a)});this.Rc.Zq(this.da);a.add(function(){b.Rc.detach(b.da)});a.addEventListener(this.da,"keypress",function(a){var d=a.charCode;13===d&&b.options.wp&&!a.shiftKey?b.sa("enter"):(b.us(String.fromCharCode(d)),a.preventDefault(),b.Jf())})};a.prototype.setActive=function(a){c.prototype.setActive.call(this,a);a?(this.da.setAttribute("contenteditable","TRUE"),this.da.focus()):(this.da.setAttribute("contenteditable",
"FALSE"),this.da.blur())};a.prototype.Qy=function(){if(this.active){var a=document.getSelection();if(null===a)this.lb();else if(null===a.focusNode||null===a.anchorNode)this.lb();else if(a.anchorNode===this.da)Rf("Select-all %s..%s",0,this.text.length),c.prototype.sd.call(this,0,this.text.count());else{var d=Uf(this.da,a.anchorNode,a.anchorOffset);a=Uf(this.da,a.focusNode,a.focusOffset);-1!==d&&-1!==a&&(0===this.text.count()&&(a=d=0),a!==this.fh||d!==this.ii)&&(c.prototype.sd.call(this,a,d),Rf("Selected %s..%s",
d,a))}}};a.prototype.sd=function(a,d){void 0===d&&(d=a);Rf("self-set caret position: %s..%s",d,a);c.prototype.sd.call(this,a,d);var b=Vf(this.da,a),f=Vf(this.da,d),h=document.createRange();d<=a?(h.setStart(f.node,f.offset),h.setEnd(b.node,b.offset)):(h.setStart(b.node,b.offset),h.setEnd(f.node,f.offset));if(a=window.getSelection())a.removeAllRanges(),a.addRange(h)};a.prototype.fj=function(a){Rf("Mark for reformat: %s",a);this.oh("reformat")};a.prototype.Jf=function(){A(this.da).clear();var a=this.text,
d=this.da,c=this.va;a.save(0,a.count(),new Tf(d,c));this.options.placeholder&&0===this.text.count()&&(a=A("div").Va({opacity:"0.5"}).Nf(this.options.placeholder).wd(this.da).da,this.va.Rf(a.style));this.sd(this.fh,this.ii)};a.prototype.exec=function(a,d){c.prototype.exec.call(this,a,d);this.Jf()};return a}(Qf);
function Uf(c,a,b){function d(c){if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));if(c===a)return c instanceof Element&&c.children[0]&&"BR"===c.children[0].tagName&&1===b&&--e,h=!0;"DIV"===c.tagName&&(f=!0);for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){if(c===a)return h=!0;c=Xf(c.nodeValue,f);e+=c.length;c.length&&(f=!1)}}var e=0,f=!0,h=!1;for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return h?e+b:-1}
function Vf(c,a){function b(c){d=c;f=0;if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));"DIV"===c.tagName&&(h=!0);for(c=c.firstChild;c&&!b(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){c=Xf(c.nodeValue,h);if(e+c.length>=a)return f=a-e,!0;e+=c.length;c.length&&(h=!1)}}var d=c,e=0,f=0,h=!0;for(c=c.firstChild;c&&!b(c);)c=c.nextSibling;return{node:d,offset:f}}
function Xf(c,a){for(var b="",d=0;d<c.length;d++){var e=c[d];switch(e){case " ":case "\n":case "\r":case "\t":a||(b+=" ",a=!0);break;default:b+=e,a=!1}}return b}
function Sf(c,a,b){function d(a,b){if(a.nodeType===Node.ELEMENT_NODE){switch(a.tagName){case "DIV":case "P":l||(f+="\n"),l=!1}"DIV"===a.tagName&&(n=!0);a instanceof HTMLElement&&(b=b.Vk(a.style,a.tagName));for(a=a.firstChild;a;)d(a,b),a=a.nextSibling}else a.nodeType===Node.TEXT_NODE&&(h.hd(b)||(e(h),h=b),b=Xf(a.nodeValue,n),f+=b,b.length&&(n=!1))}function e(a){f.length&&(k.push(new Hf(a,f)),f="")}var f="",h=b,k=[],l=!0,n=!0;for(a=a.firstChild;a;)d(a,b),a=a.nextSibling;e(h);k.length&&c.append(k)}
var Tf=function(){function c(a,b){this.root=a;this.ij=this.pr=b;this.span=this.ta=null;this.offset=0;this.style=b}c.prototype.lu=function(a){Rf("writeStyle("+a.toString());this.ij=a};c.prototype.Fp=function(){Rf("startLine");this.ta=document.createElement("DIV");this.root.appendChild(this.ta);this.ta.setAttribute("t-off",this.offset.toString());this.ta.style.whiteSpace="pre-wrap";this.style=this.pr;this.ta.style.fontSize=this.ij.get("fontSize")+"px"};c.prototype.qn=function(){Rf("endLine");if(!this.ta)throw Error("Expected div to exist");
null===this.ta.firstChild&&this.ta.appendChild(document.createElement("BR"));this.span=this.ta=null;this.offset+=1};c.prototype.mu=function(a){Rf("writeText("+a+")");if(!this.ta)throw Error("Expected div to exist");null!==this.span&&this.style.hd(this.ij)||(this.span=document.createElement("SPAN"),this.ta.appendChild(this.span),this.ij.Rf(this.span.style),this.style=this.ij);this.span.appendChild(document.createTextNode(a));this.offset+=a.length};return c}();var Yf=function(){function c(){var a=this;this.iz=new Promise(function(b,d){a.resolve=b;a.reject=d})}c.prototype.then=function(a,b){return this.iz.then(a,b)};return c}();function Zf(c,a,b,d){c.fillStyle="#ffffff";c.fillRect(a,b,d,d);c.beginPath();c.strokeStyle="#000000";c.moveTo(a,b);c.lineTo(a+d,b+d);c.moveTo(a+d,b);c.lineTo(a,b+d);c.stroke()}function $f(c,a,b,d){for(var e,f=0;f<d;f+=5){e=0===f/5%2;for(var h=0;h<d;h+=5)c.fillStyle=e?"#000000":"#ffffff",e=!e,c.fillRect(a+h,b+f,5,5)}e=c.createLinearGradient(a+d,b+d,a,b);e.addColorStop(0,"rgba(255, 255, 255, 1.0)");e.addColorStop(1,"rgba(255, 255, 255, 0.0)");c.fillStyle=e;c.fillRect(a,b,d,d)}
function ag(c){for(var a=[],b=[],d=[],e=0,f=0;360>f;f++){var h=new r(r.Ug,[f,1,1,1]);a.push(h);0<f&&(h=a[f-1].cw(h),b.push(h),e+=h)}e/=c;f=0;d.push(a[0]);for(h=1;h<a.length;h++){var k=b[h-1];f+k>=e&&(f-=e,d.push(a[h]));f+=k}d.length=c;return d}
function bg(c,a,b){function d(a,b,d){return A("div",{"zwibbler-color":d}).Va({width:b+"px",height:b+"px",display:"inline-block"}).wd(a)}function e(a,b,c){var e=document.createElement("canvas");e.width=a;e.height=a;b(e.getContext("2d"),0,0,a);a=d(f,a,c);a.da.style.backgroundImage="url("+e.toDataURL()+")";a.da.style.backgroundPosition="center";return a}void 0===b&&(b={});var f=A.ic(c),h=b.columns||16;c=b.rows||h;if(f){var k=new $d(f,{TA:!1});f.addEventListener("contextmenu",function(a){a.preventDefault()});
k.pa("tap hold",function(a){var d="hold"===a.type||1<a.buttons,c=a.target.getAttribute("zwibbler-color")||"";if("opacity-50"===c)b.onOpacity(.5,!d);else if(c)b.onColour(c,!d);a.preventDefault()});e(a,Zf,"transparent");e(a,$f,"opacity-50");for(k=0;1>=k;k+=1/(h-3)){var l=(new r(r.Ug,[0,0,Math.pow(k,1/2.2),1])).toString();d(f,a,l).Va({backgroundColor:l})}h=ag(h);for(k=1;k>1/(c-1);k-=1/c){l=0;for(var n=h;l<n.length;l++){var q=n[l];q.values[1]=1;q.values[2]=Math.pow(k,1/2.2);d(f,a,q.toString()).Va({backgroundColor:q})}}}}
(function(){function c(a,b){var d=this;this.Sl=null;var c=document.createElement("div");c.style.width="320px";c.style.lineHeight="0";c.style.position="absolute";b.appendChild(c);bg(c,20,{onColour:function(a,b){d.Sl&&d.Sl.resolve({type:"colour",value:a,fill:b})}});this.jn=ud(c);a.add(function(){d.jn&&d.jn.destroy()})}c.prototype.show=function(a,b){this.Sl=new Yf;this.jn.show(a,b,!0);return this.Sl};return c})();var cg=new (function(){function c(){this.vn={}}c.prototype.lk=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.lk()?window.localStorage.setItem(a,b):this.vn[a]=""+b};c.prototype.getItem=function(a){return this.lk()?window.localStorage.getItem(a):this.vn[a]};c.prototype.removeItem=function(a){this.lk()?window.localStorage.removeItem(a):delete this.vn[a]};return c}());function dg(c,a){function b(b){d&&clearTimeout(d);d=setTimeout(function(){d=null;a()},arguments.length?b:c)}var d=null;b.cancel=function(){d&&(clearTimeout(d),d=null)};return b};var eg=function(){function c(a,b,d){var c=this;this.view=a;this.options=b;this.mode=d;this.Hf={};this.log=u.create("Brush");this.view.lb(!0);this.yt=function(){return c.Yd()};this.nc=new ne(this.view)}c.prototype.Yd=function(){this.yo(this.pe()/2)};c.prototype.mb=function(a){a=this.nc.mb(a);this.nc.active&&this.reset();return a};c.prototype.gd=function(){this.view.oc("crosshair");this.yo(this.pe()/2);window.addEventListener("resize",this.yt)};c.prototype.lc=function(){this.view.oc("default");this.view.Ym("brush");
window.removeEventListener("resize",this.yt)};c.prototype.reset=function(){this.Hf={}};c.prototype.yo=function(a){var b=document.createElement("canvas");a*=this.view.scale*this.view.Ii();a=Math.ceil(a+1);b.width=2*a+2;b.height=2*a+2;var d=b.getContext("2d");d.beginPath();"round"===(this.options.lineCap||"round")?d.arc(a+1,a+1,a,0,2*Math.PI):d.rect(1,1,2*a-2,2*a-2);d.lineWidth=2;d.strokeStyle="#ffffff";d.stroke();d.lineWidth=1;d.strokeStyle="#000000";d.stroke();b=b.toDataURL();this.view.oc("url("+
b+") "+(a+1)+" "+(a+1)+", auto")};c.prototype.Oh=function(a){this.options.strokeStyle=a};c.prototype.pe=function(){var a=this.options.lineWidth;this.view.ga.get("adaptiveBrushWidth")&&(a/=this.view.scale);return a};c.prototype.dm=function(a){this.options.lineWidth=a;this.yo(this.pe()/2)};c.prototype.Eb=function(a,b,d){if(this.nc.active)return!0;var c="freehand"===this.mode||"brush"===this.mode?new Rc:new Pc;c.Yf(a,b);this.Hf[d.pointerId]=c;return!0};c.prototype.$s=function(a){a.save();var b=this.view.hr(a);
a.lineCap=this.options.lineCap||"round";a.lineJoin="round"===a.lineCap?"round":"bevel";a.lineWidth=this.pe();var d=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);cd(this.options.shadow,a);var c=Hc(this.options.dashes||"");a.beginPath();for(var f in this.Hf)Ic(a,this.Hf[f].Wn(),c);oc(a,this.options.strokeStyle);b&&a.restore();a.globalAlpha=d;a.restore()};c.prototype.yb=function(a,b,d){var c=this;d.pointerId in this.Hf&&(this.Hf[d.pointerId].Yf(a,b),"erase"===this.options.strokeStyle?
this.view.la(function(a){return c.$s(a)}):this.view.tt("brush",function(a){return c.$s(a)}));return!0};c.prototype.Pb=function(a,b,d){this.yb(a,b,d);this.view.Ym("brush");this.wa();return!0};c.prototype.wa=function(){var a,b;this.view.aa.$a();var d="";for(var c in this.Hf){var f=Fc(this.Hf[c].Wn(),.5);if("brush"===this.mode||"freehand"===this.mode){var h=[];1===f.length&&f.push(new D(f[0].x+.1,f[0].y+.1));if(1<f.length){d=a=0;for(b=f.length-1;a<=b;d=a+=1)h.push(f[d].x),h.push(f[d].y);d=this.view.aa.createNode("BrushNode",
pc({points:h,layer:this.view.Nc},this.options,{lineWidth:this.pe()}))}}else{if("shapebrush"===this.mode){f=Fc(f,20);var k;var l=f;if(!(2>l.length)){a=l[0];f=l[l.length-1];h=40>a.Wb(f);for(b=0;b<l.length;b++){var n=l[b];for(k=b+1;k<l.length;k++){var q=l[k];20>Math.abs(n.x-q.x)&&(q.x=n.x);20>Math.abs(n.y-q.y)&&(q.y=n.y)}}n=F.$h(l).Sd();for(b=0;b<l.length;b++)k=l[b],20>Math.abs(k.x-n.x)&&(k.x=n.x),20>Math.abs(k.y-n.y)&&(k.y=n.y);h&&(a.x=f.x,a.y=f.y)}f=l}else if("quadratic"===this.mode){f=Fc(f,10);a=
xd(f);d=a.fa[1];h=a.fa[2];l=a.fa[4];b=a.fa[5];f=a.fa[8];a=a.fa[9];l=((3*l-d)/2+(3*l-f)/2)/2;b=((3*b-h)/2+(3*b-a)/2)/2;k=new Cc;k.moveTo(d,h);k.quadraticCurveTo(l,b,f,a);d=k;h=J.qu(d);d=this.view.aa.createNode("PathNode",pc({commands:h,fillStyle:this.view.Mb,sloppiness:0,layer:this.view.Nc},this.options,{lineWidth:this.pe()}));continue}1===f.length&&"freehand"===this.mode&&f.push(new D(f[0].x+.1,f[0].y+.1));if(1<f.length){h=new M;h.moveTo(f[0].x,f[0].y);a=f[0].hd(f[f.length-1]);d=b=1;for(l=f.length-
1;b<=l;d=b+=1)h.lineTo(f[d].x,f[d].y);a&&h.close();d=this.view.aa.createNode("PathNode",pc({commands:h.ac(),fillStyle:this.view.Mb,sloppiness:0,lockEditMode:"shapebrush"!==this.mode,layer:this.view.Nc},this.options,{lineWidth:this.pe()}))}}}this.view.aa.wa();this.view.lb();c=this.view.aa.ob(d);this.view.ga.get("singleStrokeBrush")?(c&&this.view.Ce(c),this.view.tb()):this.reset();this.view.fc()};c.prototype.Wd=function(a,b){this.options.strokeStyle=a;b?(this.view.Mb=a,this.view.Vb=a,b="fillStyle"):
(this.view.ec=a,b="strokeStyle");this.view.setProperty(b,a)};c.prototype.Gf=function(a){this.view.Vb=lc(this.view.Vb,a);this.options.strokeStyle=lc(this.options.strokeStyle,a);this.view.Mb=this.view.Vb};c.prototype.Xd=function(a){this.log("keyboard: %s",a);switch(a){case "cancel":this.log("ESC pressed. Abort brush and go back to toolbar.");this.view.tb();this.view.zc.sa("goto-toolbar");break;case "undo":this.view.Hc();break;case "redo":this.view.ae()}};c.prototype.Xe=function(a,b){"defaultBrushWidth"===
a?this.dm(b):"defaultBrushColour"===a&&this.Oh(b)};c.prototype.be=function(a,b){switch(a){case "lineWidth":this.dm(b);break;case "strokeStyle":case "fillStyle":this.Oh(b);case "dashes":case "shadow":this.options[a]=b}};c.prototype.Ad=function(){return"circle"===this.mode?"ellipse":this.mode};c.prototype.Qi=function(){return pc({dashes:""},this.options)};c.prototype.Yn=function(){return["BrushNode"]};return c}();var fg=function(){function c(a,b,d,c,f){void 0===d&&(d={});void 0===c&&(c=!1);void 0===f&&(f=!1);this.view=a;this.type=b;this.ba=d;this.wp=c;this.yk=f;this.node=null;this.yn=new D(0,0);this.Al=new D(0,0);this.index=0;this.state="start";this.log=u.create("DRAWLINES");"wrap"in this.ba||(this.ba.wrap=this.view.ga.get("multilineText"));"fontSize"in this.ba||(this.ba.fontSize=this.view.ga.get("defaultFontSize"));this.nc=new ne(this.view);this.view.lb(!0)}c.prototype.gd=function(){this.log("Entering DrawLinesBehaviour");
this.view.oc("crosshair");this.view.ga.Vh()||this.view.cm("click-to-place-first-point-of-line");this.view.la()};c.prototype.reset=function(){this.gd()};c.prototype.mb=function(a){a=this.nc.mb(a);this.nc.active&&this.node&&this.reset();return a};c.prototype.Xd=function(a){"cancel"===a&&(null!==this.node&&this.view.La.zb&&"curve"===this.type&&this.wa(),null!==this.node&&(this.view.aa.$a(),this.view.aa.wc([this.node.id]),this.view.aa.wa(!0)),this.view.La.zb?this.view.zc.sa("goto-toolbar"):this.view.tb())};
c.prototype.done=function(){this.view.vv();this.view.ga.get("autoPickTool")?this.view.tb():this.state="start"};c.prototype.Yf=function(a,b){this.node instanceof J&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.ui(a,b):this.node.lineTo(a,b))};c.prototype.Eb=function(a,b){var d=this.view.bb(new D(a,b));this.log("onMouseDown(%s, %s) state=%s, index=%s",a,b,this.state,this.index);if("start"===this.state){this.yn=d;a={seed:Math.round(65535*Math.random()),strokeStyle:this.view.ec,
lineWidth:this.pe(),sloppiness:this.view.va.sloppiness,smoothness:this.view.va.smoothness};"arrow"===this.type&&(a.arrowSize=this.view.ga.cb("defaultArrowSize"),a.arrowStyle=this.view.ga.cb("defaultArrowStyle"),a.arrowXOffset=this.view.ga.cb("defaultArrowXOffset"));for(var c in this.ba)this.ba.hasOwnProperty(c)&&(a[c]=this.ba[c]);this.view.aa.$a();c=this.view.aa.createNode("PathNode",a);this.view.aa.wa(!0);this.node=this.view.aa.ob(c);this.node.moveTo(d.x,d.y);this.Yf(d.x,d.y);this.index=3;this.view.update();
this.state="predrag"}else if("placing"===this.state)if(c=this.Al.Wb(d),this.log("Mouse moved by %s",c),"arrow"!==this.type&&8>this.yn.Wb(d)&&3<this.index)this.log("Clicked close to start; automatically closing path"),this.node instanceof J&&this.node.close(),this.wa(),this.done();else if(8>this.Al.Wb(d))this.log("Didn't move. Stop drawing."),this.jr(),this.done();else{if(this.wp)return this.wa(),this.done(),!0;this.node&&(this.Yf(d.x,d.y),this.index+=3,this.view.aa.gj(this.node.id),this.view.update())}else return this.log("Invalid state %s",
this.state),!0;this.Al=new D(d.x,d.y);return!0};c.prototype.jr=function(){3<this.index?(this.node instanceof J&&this.node.rz(this.index),this.wa()):this.cancel()};c.prototype.Pb=function(a,b){var d=new D(a,b);d=this.yn.Wb(d);this.log("onMouseUp (%s,%s) %s",a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",d),10<d?(this.wa(),this.done()):(this.state="placing",this.view.cm("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.yb=function(a,b,d){b=this.view.bb(new D(a,
b));a=b.x;b=b.y;if(d.ctrlKey||this.yk){d=this.Al;var c=Math.atan2(b-d.y,a-d.x),f=Math.PI/8;c>=-f&&c<f?b=d.y:c>=f&&c<3*f?(a=Math.max(b-d.y,a-d.x),b=d.y+a,a=d.x+a):c>=3*f&&c<5*f?a=d.x:c>=5*f&&c<7*f?(a=Math.max(b-d.y,d.x-a),b=d.y+a,a=d.x-a):c>=7*f||c<=7*-f?b=d.y:c<5*-f?(a=Math.max(d.y-b,d.x-a),b=d.y-a,a=d.x-a):c<3*-f?a=d.x:(a=Math.max(d.y-b,a-d.x),b=d.y-a,a=d.x+a)}this.node&&(this.node.Ue(this.index,a,b),this.node.format(this.view.ra,this.view.request),this.view.la());return!1};c.prototype.Ov=function(a){for(var b=
0,d=[],c,f,h,k,l,n;b<a.length;){var q=a[b];switch(q){case J.Vg:h=a[b+1];k=a[b+2];d.push(q,h,k);break;case J.Be:c=a[b+1],f=a[b+2],void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n&&d.push(J.Zh,c,f,(l+h)/2,(n+k)/2,(h+c)/2,(k+f)/2),l=h,n=k,h=c,k=f}b+=J.ib[q]+1}return d};c.prototype.wa=function(){var a=this;if(this.node){this.node instanceof J&&this.node.lv();var b=this.node.ja("commands");"linear-bezier"===this.type&&(b=this.Ov(b));this.view.aa.transaction(function(){a.view.aa.$b([a.node.id],{commands:b})});
this.node=null}};c.prototype.cancel=function(){this.node&&(this.view.aa.$a(),this.view.aa.wc([this.node.id]),this.view.aa.wa(!0),this.node=null)};c.prototype.lc=function(){this.jr();this.view.oc("default");this.view.cm("");this.view.la()};c.prototype.Wd=function(a,b){this.ba.strokeStyle=a;b?(this.view.Mb=a,this.view.Vb=a,b="fillStyle",this.log("We are drawing lines. Set strokeStyle instead of fillStyle")):(this.view.ec=a,b="strokeStyle");this.view.setProperty(b,a)};c.prototype.Gf=function(a,b){b?
(this.view.Mb=lc(this.view.Mb,a),this.view.Vb=lc(this.view.Vb,a)):this.view.ec=lc(this.view.ec,a);this.view.sp(a,b)};c.prototype.Ad=function(){return this.type};c.prototype.Qi=function(){var a=this.view.ga.cb("defaultArrowSize");a={arrowSize:"arrow"===this.type?a:0,arrowStyle:this.view.ga.cb("defaultArrowStyle"),arrowXOffset:this.view.ga.cb("defaultArrowXOffset"),fillStyle:this.view.Mb,strokeStyle:this.view.ec,lineWidth:this.pe(),dashes:"",sloppiness:this.view.va.sloppiness,smoothness:this.view.va.smoothness,
layer:this.view.Nc};for(var b in this.ba)this.ba.hasOwnProperty(b)&&(a[b]=this.ba[b]);return a};c.prototype.be=function(a,b){this.ba[a]=b};c.prototype.pe=function(){return this.view.hi(this.view.va.lineWidth)};return c}();var hg=function(){function c(a,b,d,c,f,h,k,l){var e=this;this.view=a;this.nodeType=b;this.ba=d;this.width=c;this.height=f;this.Et=h;this.IA=k;this.state="initial";this.start=new D(0,0);this.end=new D(0,0);this.node=null;this.log=u.create("DrawShape");this.view.xe(!0);"rectangle-tl"===h&&(this.wr=function(a){a.lineWidth=1/e.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(e.start.x,e.start.y,e.end.x-e.start.x,e.end.y-e.start.y);a.stroke()});this.br=null===l?this.view.ga.get("autoPickTool"):l;this.nc=
new ne(this.view);this.view.lb(!0)}c.prototype.wr=function(){};c.prototype.gd=function(){this.log("Entering DrawShapeBehaviour");this.view.oc("crosshair")};c.prototype.lc=function(){this.log("Leaving DrawShapeBehaviour");this.cancel();this.view.xe(!1)};c.prototype.cancel=function(){this.node&&(this.view.aa.$a(),this.view.aa.wc([this.node.id]),this.view.aa.wa(!0),this.view.update(),this.node=null);this.state="initial"};c.prototype.mb=function(a){a=this.nc.mb(a);this.node&&this.nc.active&&(this.view.aa.$a(),
this.view.aa.wc([this.node.id]),this.view.aa.wa(!0),this.node=null,this.state="initial");return a};c.prototype.Xd=function(a){"cancel"===a&&this.view.tb()};c.prototype.Eb=function(a,b){"initial"===this.state&&(this.start=this.view.bb(new D(a,b)),this.state="predraw",this.log("initial -> predraw"));return!0};c.prototype.yb=function(a,b,d){a=this.view.bb(new D(a,b));d=d.ctrlKey;"predraw"===this.state&&10<this.start.Wb(a)&&(this.create(),this.state="drawing",this.log("predraw -> drawing"));"drawing"===
this.state&&(this.transform(this.start,a,d),this.end=a,this.view.update(!1,this.wr));return!0};c.prototype.Pb=function(a,b,d){"predraw"===this.state?this.view.ga.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,d.ctrlKey),this.wa(),this.br&&this.view.tb(),this.state="initial"):this.cancel():"drawing"===this.state&&(this.transform(this.start,this.view.bb(new D(a,b)),d.ctrlKey),this.wa(),this.br&&this.view.tb(),this.state="initial");return!0};c.prototype.create=function(){this.view.aa.$a();
var a=this.view.aa.createNode(this.nodeType,this.ba);this.node=this.view.aa.ob(a);this.view.aa.wa(!0)};c.prototype.transform=function(a,b,d){if(b)if("circle"===this.Et){var c=a;a=a.Wb(b);var f=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.Et)a=a.clone(),b=b.clone(),a.x>b.x&&(f=a.x,a.x=b.x,b.x=f),a.y>b.y&&(f=a.y,a.y=b.y,b.y=f),c=a;else if(f=[a,b],0===f.length)c=new D(0,0);else{c=f[0].x;for(var h=f[0].y,k=1;k<f.length;k++)c+=f[k].x,h+=f[k].y;c=new D(c/f.length,h/f.length)}f=(b.x-a.x)/
this.width;a=(b.y-a.y)/this.height}else c=a,a=f=1;d&&(a=f=Math.min(f,a));d=new uc(c.x,c.y);d=d.multiply(new wc(f,a));this.node&&(this.node.Ot(d),this.view.aa.gj(this.node.id))};c.prototype.wa=function(){var a=this;this.node&&(this.ba.matrix=this.node.Na(),this.view.aa.$a(),this.view.aa.wc([this.node.id]),this.view.aa.wa(!0),this.node=null,this.view.aa.transaction(function(){a.view.aa.createNode(a.nodeType,a.ba)}))};c.prototype.dm=function(a){this.ba.lineWidth=this.view.hi(a)};c.prototype.Wd=function(a,
b){gg.prototype.Wd.call(this,a,b);this.ba[b?"fillStyle":"strokeStyle"]=a};c.prototype.Gf=function(a,b){gg.prototype.Gf.call(this,a,b);b=b?"fillStyle":"strokeStyle";var d=lc(this.ba[b],a);this.log("oldColour=%s+opacity %s = %s",this.ba[b],a,d);this.ba[b]=d};c.prototype.Ad=function(){return this.IA};c.prototype.be=function(a,b){this.ba[a]=b};c.prototype.Qi=function(){return this.ba};c.prototype.Xe=function(a,b){"defaultLineWidth"===a&&this.dm(b)};return c}();var ig=function(){function c(a){this.view=a;this.state="none";this.start=new D(0,0);this.Yt=this.Xt=0;this.log=u.create("PanTool");this.nc=new ne(a)}c.prototype.gd=function(){this.log("Entering PanToolBehaviour");this.view.oc("all-scroll")};c.prototype.lc=function(){this.log("Leaving PanToolBehaviour")};c.prototype.mb=function(a){return this.nc.mb(a)};c.prototype.cs=function(a){return new D(a.pageX,a.pageY)};c.prototype.Eb=function(a,b,d){this.log("onMouseDown type %s",d.type);if(this.view.Xx(d)){var c=
new gg(this.view);this.view.Ya(c);return c.Eb(a,b,d)}this.state="dragging";this.start=this.cs(d);this.Xt=this.view.ub;this.Yt=this.view.kb;return!0};c.prototype.yb=function(a,b,d){if("dragging"!==this.state)return!1;a=this.cs(d);b=this.Yt+a.y-this.start.y;this.view.ub=this.Xt+a.x-this.start.x;this.view.kb=b;this.view.Lc();this.view.la();return!0};c.prototype.Pb=function(){this.state="none";return!0};c.prototype.Ho=function(a,b,d,c){if(!this.view.ga.get("allowZoom"))return this.log("Zooming is disabled."),
!1;this.log("onMouseWheel(%s, %s, %s)",a,b,d);d=0<d?1/1.1:1.1;var e=this.view.ga.Kh(this.view.scale/d);e!==this.view.scale/d&&(d=this.view.scale/e);a=new wc(d,d,a,b);b=this.view.re();b.transform(a);this.view.Qg(b);c.stopPropagation();c.preventDefault();return!0};c.prototype.Xd=function(a){"cancel"===a&&this.view.tb()};c.prototype.Ad=function(){return"pan"};return c}();var jg=u.create("MOVE"),mg=function(){function c(a,b,d,c){var e=this;this.Da=a;this.node=d;this.Fl=c;this.aq=!0;this.placeholder=this.it=null;this.zk="column";this.uo=function(){};this.Of=new Fd;this.Qm=new Hb;this.ie=null;jg("Moving node: %s istool=%s",d.id,c);this.Da.xe(!0);this.Hy=d.da.style.position||"";this.Fy=d.da.style.left||"";this.Iy=d.da.style.top||"";this.Il=d.da.parentElement;this.Jy=A(d.da).qe("zIndex");this.Gy=d.da.nextElementSibling;this.Lv=null!==d.da.getAttribute("confine")||1===
c;this.Jl=d.cl();var h=this.Da.Jd(b.pb,b.qb,!0);this.start=h;if(2===c){a=kg(this.node.da);var k=this.Da.Jd(a.x,a.y,!0);jg("Moving fixture from %s; tl=%s",a,k);a.x=k.x;a.y=k.y;this.node.rect=a;this.Jl=this.node.rect}"IFRAME"===d.da.tagName&&(this.aq=!1);d.da.style.position="absolute";this.aq&&this.Da.Hj.appendChild(d.da);d.da.style.zIndex="1";1===c&&(this.node.rect=new F(h.x-this.node.da.offsetWidth/2,h.y-this.node.da.offsetHeight/2,this.node.da.offsetWidth,this.node.da.offsetHeight),this.Jl=this.node.rect,
this.uo=function(){jg("Got image load event from dragged tool");e.mz(h)},this.node.da.addEventListener("load",this.uo,!0));this.rect=this.node.cl();d.da.classList.add("dragging");this.Da.aa.gc(function(a){var b=a.rect;Wc(a)&&(b=a.cl());e.Of.Qq(b,a.id)});this.yb(h.x,h.y,b)}c.prototype.gd=function(){jg("Entering DragHTMLBehaviour")};c.prototype.mb=function(a){if(this.Da.ga.get("allowZoom")&&"gesturestart"===a.type){jg("Switch to default behaviour");var b=new gg(this.Da);this.Da.Ya(b);b.mb(a);return!0}return!1};
c.prototype.lc=function(){this.Da.xe(!1);this.node.da.style.left=this.Fy;this.node.da.style.top=this.Iy;this.node.da.style.position=this.Hy;this.node.da.style.zIndex=this.Jy;this.node.da.style.transform="";this.node.da.classList.remove("dragging");this.Il?this.aq&&this.Il.insertBefore(this.node.da,this.Gy):A(this.node.da).remove();this.ie&&this.ie.classList.remove("drop");jg("DragHTMLBehaviour.leave()");this.vt();this.node.da.removeEventListener("load",this.uo,!0);this.Qm.cancel()};c.prototype.Mv=
function(a,b){b=kg(b);b.transform(this.Da.ml());a.x<b.x&&(a.x=b.x);a.y<b.y&&(a.y=b.y)};c.prototype.yb=function(a,b,d){var c=this;this.Qm.request(d,function(a){var b=c.Da.Jd(a.pageX,a.pageY),d=b.Ip(c.start),e=c.Jl;c.rect.x=e.x+d.x;c.rect.y=e.y+d.y;c.Lv&&c.Il&&c.Mv(c.rect,c.Il);c.Da.ga.get("magnet")&&(d=c.Of.rA(c.rect,c.node.id),c.rect.x+=d.x,c.rect.y+=d.y);c.node.da.style.left=c.rect.x+"px";c.node.da.style.top=c.rect.y+"px";d=kg(c.node.da);d=c.zw(d);null!==d?c.Xu(d,a.pageX,a.pageY):c.vt();a=c.node.ja("$component");
var f=null,q=kg(c.node.da);A(c.Da.Oe()).query('[z-drop-accept="'+a+'"]',function(a){var b=kg(a),d=Math.min(q.ji(),b.ji());a!==c.node.da&&b.et(q)>.7*d&&(f=a)});a=f;a!==c.ie&&(c.ie&&c.ie.classList.remove("drop"),c.ie=a,c.ie&&c.ie.classList.add("drop"));c.node.da.dispatchEvent(new CustomEvent("zwibbler-dragging",{cancelable:!0,detail:{node:c.node.id,gw:c.rect.x,hw:c.rect.y,width:c.rect.width,height:c.rect.height}}));c.Da.scrollIntoView(b.x,b.y)});return!0};c.prototype.zw=function(a){var b=this.node.ja("$component"),
c=null;A(this.Da.Oe()).query("[container-for]",function(d){lg(d,b)&&kg(d).et(a)>.5*a.ji()&&(c=d)});return c};c.prototype.Xu=function(a,b,c){A(a).qe("flex-direction").startsWith("row")?this.zk="row":this.zk="column";var d=this.zk,f=0,h=null,k,l=new D(b,c),n=null;for(k=a.firstElementChild;k;){if(!k.classList.contains("placeholder")){n=kg(k);n=(new D(n.x,n.y)).Wb(l);if(!h||n<f)h=k,f=n;n=k}k=k.nextElementSibling}h&&h===n&&(n=kg(h),"column"===d&&c>n.y||"row"===d&&b>n.x)&&(h=null);b=h;if(this.placeholder&&
this.placeholder.parentNode){if(a!==this.placeholder.parentElement||b!==this.it)this.it=b,a.insertBefore(this.placeholder,b)}else c={},"column"===this.zk?(c.flex="0 0 "+this.node.da.offsetHeight+"px",c.minWidth=this.node.da.offsetWidth+"px"):(c.flex="0 0 "+this.node.da.offsetWidth+"px",c.minHeight=this.node.da.offsetHeight+"px"),this.placeholder=A("div",{"class":"placeholder"}).Va(c).da,a.insertBefore(this.placeholder,b)};c.prototype.vt=function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)};
c.prototype.Pb=function(a,b,c){this.Qm.cancel();jg("onMouseUp()");if(1===this.Fl&&!kg(this.Da.canvas.first).cd(c.pageX,c.pageY))return jg("Dropped nowhere!"),this.Da.Ya(new gg(this.Da)),!0;a="static";var d=0,f=0,h=0;b=this.Da.aa.Ne();if(this.placeholder&&this.placeholder.parentElement)if("flex"!==A(this.placeholder.parentElement).qe("display")&&(a="absolute"),c=this.Da.aa.Kn(this.placeholder)){b=c;d=this.placeholder;f=this.placeholder.parentElement.firstElementChild;for(h=0;f&&f!==d;)f.getAttribute("nid")&&
h++,f=f.nextElementSibling;h=Math.min(h,c.Ua()-1);jg("Use placeholder, place at %s:%s",b.id,h);d=this.rect.x-c.rect.x;f=this.rect.y-c.rect.y}else jg("Placeholder is not in a NID node");else jg("No placeholder; add to root"),a="absolute",h=-1,d=this.rect.x,f=this.rect.y;this.Da.Ya(new gg(this.Da));this.node.da.dispatchEvent(new CustomEvent("zwibbler-drop",{cancelable:!0,detail:{node:this.node.id,MB:b.id,LB:h,gw:d,hw:f}}))?(this.Da.aa.$a(),0===this.Fl||2===this.Fl?this.Da.aa.Sc(this.node.id,b.id,h):
b&&1===this.Fl&&(c=this.node.wb(),"absolute"===a&&(c["style.position"]="absolute",c["style.left"]=d+"px",c["style.top"]=f+"px"),this.Da.aa.createNode("HTMLNode",c,b.id,h),this.Da.lb(),this.Da.Ce(this.node)),"absolute"===a?this.Da.aa.$b([this.node.id],{"style.left":d+"px","style.top":f+"px","style.position":a}):this.Da.aa.$b([this.node.id],{"style.left":"","style.top":"","style.position":""}),this.ie&&(a=this.Da.Ca.$r(this.ie))&&(a=this.Da.Ca.Tn(a),this.Da.Ca.Tn(this.node.id),a&&a.element&&P.Pc(a.element,
"drop",this.node.Ni(null))),this.Da.aa.wa(!1)):jg("DragHTML was cancelled by element");return!0};c.prototype.mz=function(a){this.node.rect=new F(a.x-this.node.da.offsetWidth/2,a.y-this.node.da.offsetHeight/2,this.node.da.offsetWidth,this.node.da.offsetHeight);this.Jl=this.node.rect};return c}();function kg(c){c=A(c).Yb();return new F(c.left,c.top,c.width,c.height)};function ng(c){for(var a=[],b=0;b<c.length;b++)a.push(String.fromCharCode(c.charCodeAt(b)^"zwibbler3".charCodeAt(b%9)));return a.join("")}for(var og=ng(">2$-"),pg=[115,116,114,111,107,101,84,101,120,116],qg=[],rg=0;rg<pg.length;rg++)qg.push(String.fromCharCode(pg[rg]));
var sg=CanvasRenderingContext2D.prototype[qg.join("")],ug=function(){function c(a,b,d,e,f,h,k,l,n,q,v,x){var w=this;this.jd=a;this.canvas=b;this.aa=d;this.zc=e;this.ga=f;this.language=h;this.Ca=k;this.ya=l;this.Hj=n;this.Rd=q;this.zz=v;this.nu=x;this.ze="none";this.Mj=this.Lj=0;this.scale=1;this.code=this.kb=this.ub=0;this.Kd=new F(0,0,0,0);this.hp=new Gc;this.Aj=this.Bj=this.Zl=!0;this.gp=new I;this.selection=[];this.Mg=[];this.Nc="default";this.va={};this.lo=this.ef=this.Ok=!1;this.Td=1;this.background=
this.Ck=this.ki=null;this.mk={};this.dh=null;this.cr="";this.backgroundRepeat="no-repeat";this.je=this.Ga=null;this.mq=4;this.nq=3*this.mq;this.Tf=this.zi=null;this.Zg=!1;this.Vb=this.Mb=this.ec="#000000";this.kh=5;this.wh="";this.Dc=0;this.Do=new F(0,0,0,0);this.Eo=new F(0,0,0,0);this.La={zb:!1,Nb:!1,Vm:!1,x:100,y:100};this.vl=new Fb;this.ol=[];this.Mk=0;this.Of=new Fd;this.log=u.create("VIEW");this.ps=0;this.As=new F(0,0,0,0);this.ra=this.canvas.get(0);this.canvas.Qu();this.ef=!0===f.get("pageView");
this.oz();this.qa=new gg(this);this.ya.add(function(){w.qa&&w.qa.lc&&w.qa.lc();w.request.oi();w.Cd.oi();w.rc.oi();w.qa={};w.aa.Ta()});this.Cd=new Bd(this.ya,!0);this.Cd.wd(this.canvas.get(0).canvas.parentNode);this.rc=new Bd(this.ya,!1);this.rc.wd(this.canvas.get(0).canvas.parentNode);this.ga.pa("scrollbarHandleColour",function(a){w.Cd.Mt(a);w.rc.Mt(a)});var y=this;this.request=new sf;this.request.canvas=this.canvas.get(0).canvas;this.request.ga=this.ga;this.request.pa("reformat",function(a){w.log("Node %s requests reformat",
a);w.aa.zd(a)&&(w.log("   Reformatting... zoom=%s",w.ze),w.aa.gj(a));w.update();(a=w.aa.ob(a))&&"background"===a.jc()&&w.jh();w.Lh();w.Ca.sa("resource-loaded")});this.request.pa("redraw",function(a){w.log("Node %s requests redraw",a);w.la()});this.request.pa("convert-dom-request",function(a,b){y.Ca.sa("convert-dom-request",b,a)});this.request.pa("mouseevent",function(a){w.au.handleEvent(a)});f.pa("useTouch",function(){w.Tf=null;w.nq=3*y.mq});this.rc.pa("scroll",function(a){y.kb=-a*y.scale;y.Ca.sa("scroll");
w.Up();y.la()});this.Cd.pa("scroll",function(a){y.ub=-a*y.scale;y.la();w.Up();y.Ca.sa("scroll")});this.jh();this.aa=this.Og(d);this.ga.pa("update",function(a,b){w.Xe(a,b)});this.ya.addEventListener(document,"webkitfullscreenchange",function(){kc()&&(w.log("SAFARI WORKAROUND: Disabling requestAnimationFrame."),w.requestAnimationFrame=c.prototype.requestAnimationFrame)});a=document;a.fonts&&this.ya.addEventListener(a.fonts,"loadingdone",function(){w.log("Font loading done, redraw now.");w.la()});this.ud(.5,
0,0,-30,"","rotate");this.ud(0,0,0,0,"","scale");this.ud(1,0,0,0,"","scale");this.ud(1,1,0,0,"","scale");this.ud(0,1,0,0,"","scale");this.ud(.5,0,0,0,"","scale");this.ud(1,.5,0,0,"","scale");this.ud(.5,1,0,0,"","scale");this.ud(0,.5,0,0,"","scale");this.qa=this.tb()}c.prototype.hi=function(a){this.ga.get("adaptiveBrushWidth")&&(a/=this.scale);return a};c.prototype.Nx=function(a){var b,c=!1;for(b=0;b<a.Xl.length;b++){var e=a.Xl[b];e in this.mk&&(this.log("Background node has been removed"),c=!0)}for(b=
0;b<a.ik.length;b++){e=a.ik[b];var f=this.aa.Oa(e,!1);"background"===f.ja("layer")&&(this.log("Background node has been added"),c=!0)}for(b=0;b<a.nm.length;b++)e=a.nm[b],f=this.aa.Oa(e,!1),"background"===f.ja("layer")?(this.log("Background node has been changed"),c=!0):e in this.mk&&(this.log("Node removed from background layer"),c=!0);this.aa.Ne().ja("background")!==this.cr&&(c=!0);c&&this.jh();a.ik.length&&this.Ca.sa("nodes-added",a.ik);a.nm.length&&this.Ca.sa("nodes-changed",a.nm);a.Xl.length&&
this.Ca.sa("nodes-removed",a.Xl,a.ba)};c.prototype.requestAnimationFrame=function(a){a()};c.prototype.Lw=function(){this.log("getActiveLayer() -> %s",Array(this.Lb.entries()));return Array.from(this.Lb).join(",")};c.prototype.am=function(a){this.log("setActiveLayer(%s)",a);a=a.split(",");this.Lb=new Set;for(var b=0;b<a.length;b++)this.Lb.add(a[b]);this.Nc=a[0];this.lb();this.fc();this.la()};c.prototype.Fj=function(a,b){this.aa.Fj(a,b);this.ug(!1);!b&&this.Lb.has(a)&&(this.lb(),this.fc());this.la()};
c.prototype.Og=function(a){var b=this;this.log("setDocument()");this.tb();this.aa.Ta();this.aa=a;this.aa.ct=function(a,c,d,k,l){b.Ll(a,c,d,k,l)};this.scale=1;this.kb=this.ub=0;this.selection=[];this.je=this.Ga=null;this.Dc+=1;this.Kd=new F(0,0,0,0);this.hp=new Gc(this.Kd);this.gp=new I;this.wh="";this.Lb=new Set;this.Lb.add("default");this.Mb="#ffffff";this.Vb=this.ga.cb("defaultBrushColour");this.ec=this.ga.cb("defaultStrokeStyle");this.va.lineWidth=this.ga.cb("defaultLineWidth");this.va.sloppiness=
.5;this.va.fontName=this.ga.cb("defaultFont");this.va.fontSize=this.ga.cb("defaultFontSize");this.va.bold=this.ga.cb("defaultBold");this.va.italic=this.ga.cb("defaultItalic");this.va.smoothness=.3;this.va.textFillStyle=this.ga.cb("defaultTextFillStyle");this.va.textStrokeStyle=this.ga.cb("defaultTextStrokeStyle");this.va.textLineWidth=this.ga.cb("defaultTextLineWidth");this.va.textDecoration=this.ga.cb("defaultTextDecoration");this.va.textAlign=this.ga.cb("defaultTextAlign");this.kh=this.ga.get("defaultBrushWidth");
var c=this.Bf();this.ub=-c.x;this.kb=-c.y;this.Lc();this.aa.Bp=this.ga.get("spotHighlightColour");this.aa.fm=this.ga.get("spotHighlightZIndex");this.aa.format(this.ra,this.request);this.Eo=new F(0,0,0,0);this.Do=new F(0,0,0,0);"none"!==this.ze?this.ce(this.ze):(this.ce(this.ga.get("defaultZoom")),this.la());return a};c.prototype.Xe=function(a,b){var c=!1;switch(a){case "allowResize":this.li();this.la();break;case "defaultBrushColour":this.Vb=b;break;case "defaultFillStyle":this.Mb=this.va.fillStyle=
b;break;case "defaultStrokeStyle":this.ec=b;this.va.strokeStyle=b;break;case "defaultLineWidth":this.va.lineWidth=b;break;case "defaultFont":this.va.fontName=b;break;case "defaultBold":this.va.bold=b;break;case "defaultTextAlign":this.va.textAlign=b;break;case "defaultTextDecoration":this.va.textDecoration=b;break;case "defaultItalic":this.va.italic=b;break;case "defaultFontSize":this.va.fontSize=b;break;case "defaultTextFillStyle":this.va.textFillStyle=b;break;case "defaultTextStokeStyle":this.va.textStrokeStyle=
b;break;case "defaultTextLineWidth":this.va.textLineWidth=b;break;case "defaultBrushWidth":this.kh=b;break;case "defaultZoom":this.ce(b);break;case "pageView":this.ef=b;c=!0;break;case "pagePlacement":case "pageInflation":this.ce(this.ze);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":"background"===a&&(c=this.aa.Ne(),this.aa.Ec([c.id],"background",b));this.dh=null;this.jh();c=!0;this.ug(!1);break;case "pageShadow":case "outsidePageColour":c=!0;break;case "readOnly":!0===
b&&(this.tb(),this.lb(),this.fc(),c=!0);this.aa.Qh(b);break;case "spotHighlightColour":this.aa.Bp=b;c=!0;break;case "spotHighlightZIndex":this.aa.fm=b;c=!0;break;case "showRuler":case "pixelsPerUnit":case "units":c=!0;break;case "scrollbars":c=!0,this.Lc()}this.qa.Xe&&this.qa.Xe(a,b);c&&this.la()};c.prototype.df=function(a,b){this.log("Set default %s=%s",a,b);this.va[a]=qc(this.va[a],b);switch(a){case "fillStyle":this.Vb=this.Mb=b;break;case "strokeStyle":this.Vb=this.ec=b}};c.prototype.ce=function(a){a!==
this.ze&&this.log("Zooming to: %s (scale %s)",a,this.scale);var b=this.Af().width-20;var c=this.aa.Qx()||this.ef;var e=!0;this.ze=a;c||"number"===typeof a||(this.log("WARNING: Cannot zoom to page/width because the document size has not been set."),e="page"===a||"width"===a);if("number"===typeof a)this.scale=a;else if("none"===a||this.aa.empty()||!c)this.scale=1;else{if("page"===a)return c=this.Bf(),this.Qg(c,"centre"===this.ga.get("pagePlacement"),!0),this.ze=a,this.qa.Yd&&this.qa.Yd(),e;"width"===
a&&(c=this.Bf(),this.scale=b/c.width,this.ub=-c.x*this.scale,this.kb=-c.y*this.scale,this.log("RECT=%s scale=%s tx=%s ty=%s",c,this.scale,this.ub,this.kb),this.ze=a)}0>=this.scale&&(this.scale=1);this.Lc();this.la();this.qa.Yd&&this.qa.Yd();return e};c.prototype.Jd=function(a,b,c){void 0===c&&(c=!1);a=this.ml().apply(a,b);c||(a=this.bb(a));return a};c.prototype.mh=function(a,b){return this.ml().inverse().apply(a,b)};c.prototype.Dy=function(a,b,c){return a.Qc().multiply(this.ml()).apply(b,c)};c.prototype.hf=
function(a){return this.Jd(a.pageX,a.pageY,!0)};c.prototype.Xd=function(a,b){if(A.Df(b.target))this.log("Target is text entry -- ignore key command");else if(this.qa.Xd&&this.qa.Xd(a,b),!this.Ox(a,b)){switch(a){case "next-page":this.Fc(this.aa.ab+1);break;case "previous-page":this.Fc(this.aa.ab-1);break;case "zoom-to-page":this.ga.get("allowZoom")&&this.ce("page");break;case "zoom-to-width":this.ga.get("allowZoom")&&this.ce("width")}b.preventDefault();b.stopPropagation()}};c.prototype.Fh=function(a){var b=
a instanceof Sd?a.mc.target:a.target;var c=this.ga.get("readOnly");c=(b=b?A(b):null)&&(!b.matches(".zwibbler-canvas-holder,.zwibbler-canvas-holder *, [z-drag-tool], [z-drag-tool] *, [z-fixture] *")||b.matches(".zwibbler-passthrough, .zwibbler-passthrough *")||c&&b.matches(".zwibbler-dom-node,.zwibbler-dom-node *"));a instanceof Sd&&((c=c&&!a.getData("not-passthrough")&&!this.lo)||"down"!==a.type?"gesturestart"===a.type&&(c=c&&this.Re(a.pb,a.qb)):a.setData("not-passthrough",!0));return c};c.prototype.Re=
function(a,b){a=this.Jd(a,b);return this.re().cd(a.x,a.y)};c.prototype.Xx=function(a){return A(a.target).matches("[z-fixture], [z-fixture] *")};c.prototype.vv=function(){this.ps=(new Date).getTime()+200};c.prototype.oz=function(){function a(a){c.log(a.type)}function b(a){a.stopPropagation();a.preventDefault()}var c=this,e=this,f=new $d(this.jd,{Tq:this.ga.get("allowPointerEvents"),Xp:!0});this.au=f;this.ya.add(function(){f.Ta()});f.pa("gesturestart",function(a){e.log("GestureStart");c.Fh(a)||(e.qa.mb&&
!1!==e.qa.mb(a)?(a.stopPropagation(),a.preventDefault()):e.log("Pass to browser"))});f.pa("gesturechange",function(a){e.qa.mb&&!1!==e.qa.mb(a)?(a.stopPropagation(),a.preventDefault()):e.log("Pass to browser")});f.pa("gestureend",function(a){e.log("GestureEnd");e.qa.mb&&!1!==e.qa.mb(a)?(a.stopPropagation(),a.preventDefault()):e.log("Pass to browser")});var h="onpointerdown"in window,k="ongesturestart"in window,l="onmousedown"in window;this.log("Have TouchEvents: %s","ontouchstart"in window);this.log("Have PointerEvents: %s",
h);this.log("Have GestureEvents: %s",k);this.log("Have MouseEvents: %s",l);h&&!this.ga.get("allowPointerEvents")&&this.log("Configuration does not allow PointerEvents");var n=!1,q;f.pa("down",function(a){e.log(a.toString());c.Fh(a)||(n=!0,e.qa.Eb&&(q=e.hf(a),!1!==e.qa.Eb(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault())),c.Ok||A.Df(a.target)||c.zc.sa("goto-canvas"),c.Ok=!1)});f.pa("move",function(a){c.Fh(a)||(n&&0===a.buttons&&(e.log("MISSED POINTERUP! Fixing."),a.setData("not-passthrough",!1),
v(a)),e.qa.yb&&(q=e.hf(a),!1!==e.qa.yb(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault())))});var v=function(a){if(!c.Fh(a)||c.qa instanceof mg)n=!1,e.log(a.toString()),q=e.hf(a),e.qa.Pb&&!1!==e.qa.Pb(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault())};f.pa("up",v);f.pa("tap",function(a){e.log(a.toString());e.qa.Ml&&(q=e.hf(a),!1!==e.qa.Ml(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});f.pa("drag",function(a){e.log(a.toString());!c.Fh(a)&&e.qa.Ws&&(q=e.hf(a),!1!==e.qa.Ws(q.x,q.y,a)&&
(a.stopPropagation(),a.preventDefault()))});f.pa("doubletap",function(a){e.log("doubletap: "+a.toString());a.startTime<c.ps?e.log("ignoring doubletap: "+a.toString()):(e.log("doubletap: "+a.toString()),e.qa.Go&&(q=e.hf(a),!1!==e.qa.Go(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault())))});this.ya.addEventListener(this.jd,"pointerleave",function(a){e.qa.Xs&&(q=e.hf(a),!1!==e.qa.Xs(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});this.ya.addEventListener(this.jd,"contextmenu",function(a){var b=
e.hf(a);e.qa.Ss&&!1!==e.qa.Ss(b.x,b.y,a)?(a.stopPropagation(),a.preventDefault()):e.log("Pass contextmenu to browser")});this.ya.addEventListener(this.jd,"mouseenter",b);this.ya.addEventListener(this.jd,"mouseleave",b);this.ya.addEventListener(this.jd,"mouseover",b);this.ya.addEventListener(this.jd,"mouseout",b);!window.parent&&this.ga.get("setFocus")&&this.jd.focus();f.pa("wheel",function(a){if(!c.Fh(a)){var b=-40*a.ax().y,d=b/120*32;q=e.hf(a);if((!e.qa.Ho||!1===e.qa.Ho(q.x,q.y,d,a.mc))&&e.rc.ay()){var f=
e.Bf();e.kb=-120>=b?Math.max(e.kb+d,-(f.bottom()*e.scale-e.canvas.height)):Math.min(e.kb+d,-f.y*e.scale);e.Lc();e.la();a.stopPropagation();a.preventDefault()}}});this.ya.addEventListener(this.jd,"drop",a);this.ya.addEventListener(this.jd,"dragenter",a);this.ya.addEventListener(this.jd,"dragleave",a)};c.prototype.vg=function(a){this.log("Received clipboard event: %s",a.type);if(A.Df(a.target))this.log("   ignored due to being in a "+a.target.tagName);else if(this.ga.get("allowSystemClipboard"))if(null===
a.clipboardData)this.log("Ignored; clipboardData is null.");else{var b=this;switch(a.type){case "copy":case "cut":if(!this.ls())break;this.log("Cut to system clipboard.");var c=this.cg(!0,this.ld(!1));a.clipboardData.setData("application/zwibbler",c);a.preventDefault();"cut"===a.type&&this.wi();break;case "paste":if(this.ga.get("readOnly"))this.log("Ignore paste; we are in readOnly mode.");else for(this.log("There are %s items on the clipboard",a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var e=
a.clipboardData.items[c];this.log("Item [%s] type is %s",c,e.type);if(b.Ro(e)){a.preventDefault();break}else if("application/zwibbler"===e.type){this.log("Pasting from system clipboard");e.getAsString(function(a){b.rj(a)});a.preventDefault();break}}}}else this.log("   ignored due to allowSystemClipboard setting.")};c.prototype.Oe=function(){return this.jd};c.prototype.Ro=function(a,b,c){var d=this;if(0!==a.type.indexOf("image/"))return!1;a instanceof Blob||(a=a.getAsFile());if("number"===typeof b&&
"number"===typeof c){b=this.Jd(b,c);var f=b.x;var h=b.y}if(!1===this.Ca.Pc("paste",a,f,h))this.log("paste of file is cancelled by external app.");else{var k=new FileReader;k.readAsDataURL(a);k.onloadend=function(){d.By(k.result,f,h)};return!0}};c.prototype.Ox=function(a,b){if(!this.La.zb)return!1;var c=0,e=0,f=this.ga.get("nudge");switch(a){case "right":c=f;break;case "left":c=-f;break;case "down":e=f;break;case "up":e=-f;break;case "enter":if(this.qa.Ml){this.La.Nb=!1;var h="tap"}else this.La.Nb=
!this.La.Nb,h=this.La.Nb?"down":"up"}if(c||e)h=this.Af(),this.La.x+=c,this.La.x=Math.max(this.La.x,0),this.La.x=Math.min(h.width,this.La.x),this.La.y+=e,this.La.y=Math.max(this.La.y,0),this.La.y=Math.min(h.height,this.La.y),this.la(),h="move";return h?(b.preventDefault(),b.stopPropagation(),this.la(),e=A(this.canvas.first).Yb(),c=this.La.x+e.left-window.pageXOffset,a=this.La.y+e.top-window.pageYOffset,e=this.Jd(c,a),this.log("Simulate a %s at (%s,%s)",h,c,a),b=new Sd(h,c,a,c,a,(new Date).getTime(),
(new Date).getTime(),b.target,b,0,{},0,0,0,!1,!1),"down"!==h&&"tap"!==h||!this.qa.Eb||this.qa.Eb(e.x,e.y,b),"move"===h&&this.qa.yb&&this.qa.yb(e.x,e.y,b),"up"!==h&&"tap"!==h||!this.qa.Pb||this.qa.Pb(e.x,e.y,b),!0):!1};c.prototype.vp=function(a){void 0===a&&(a=!1);this.La.zb=!0;this.La.Nb=!1;this.La.Vm=a;this.log("Showing keyboard cursor, caret=%s",a);this.la()};c.prototype.nA=function(){this.La.zb=!0;this.La.Vm=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");this.La.Nb=
!0;var a=this.Kd.Sd();this.La.x=a.x;this.La.y=a.y;this.tb();this.Ya(new uf(this,new he(be,this.selection[0].Na()),!1,a.x-4,a.y-4))}this.la()};c.prototype.Rx=function(){this.La.zb&&(this.log("Hiding keyboard cursor"),this.La.zb=!1,this.la())};c.prototype.$x=function(a){var b=A(this.canvas.first).Yb(),c=this.rc.ng();var e=a.pageX-b.left;a=a.pageY-b.top;b=this.Af();return this.Tf&&e>b.width-this.Tf.width-c&&a<this.Tf.height};c.prototype.bb=function(a,b){void 0===b&&(b=0);b=b||this.ga.get("snap")||0;
this.ga.get("autoSnap");if(0<b){var c=Math.round(a.x/b)*b;a=Math.round(a.y/b)*b}else c=a.x,a=a.y;return new D(c,a)};c.prototype.xd=function(a,b){void 0===b&&(b=this.ld(!1));this.aa.$a();this.aa.xd(b,a);this.aa.wa()};c.prototype.setProperty=function(a,b){var c=this.ld(!0);this.va[a]=b;if(c.length){this.aa.$a();this.aa.Ec(c,a,b);if("fillStyle"===a)for(var e=0;e<c.length;e++){var f=this.aa.Oa(c[e],!1);f&&(this.log("nodeType=%s closed=%s",f.type(),f.ja("closed")),"PathNode"===f.type()&&!1===f.ja("closed")&&
this.aa.Ec([c[e]],"strokeStyle",b))}this.aa.wa()}0<this.selection.length&&"lineWidth"===a&&"BrushNode"===this.selection[0].type()?this.kh=b:"textFillStyle"===a&&(this.va.textFillStyle=b)};c.prototype.be=function(a,b){this.qa.be&&this.qa.be(a,b);this.qa.Wd&&("strokeStyle"===a?this.qa.Wd(b,!1):"fillStyle"===a&&this.qa.Wd(b,!0))};c.prototype.bl=function(){return this.va.fillStyle};c.prototype.jl=function(){return this.va.strokeStyle};c.prototype.sp=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",
a,b);var c=this.ld(!0);this.aa.$a();b=b?"fillStyle":"strokeStyle";for(var e=0;e<c.length;e++){var f=c[e],h=this.aa.Oa(f);h&&(h=h.ja(b))&&(h=lc(h,a),this.aa.Ec([f],b,h),this.log("   set %s of %s to %s",b,f,h))}this.aa.wa()};c.prototype.group=function(){var a=this;this.aa.transaction(function(){a.aa.group(a.ld(!1))})};c.prototype.Th=function(){var a=this;this.aa.transaction(function(){a.aa.Th(a.ld(!1))})};c.prototype.wi=function(){var a=this;this.aa.transaction(function(){a.aa.wc(a.ld(!1))})};c.prototype.lb=
function(a){void 0===a&&(a=!1);var b=!1;if(0<this.selection.length){b=0;for(var c=this.selection;b<c.length;b++){var e=c[b];Wc(e)&&e.da.classList.remove("zwibbler-selected")}this.Dc+=1;this.selection.length=0;b=!0}null!==this.je&&(this.Ca.sa("selected-edit-handle",null,null),b=!0);this.Ga&&(this.log("Clear edit node."),this.je=this.Ga=null,b=!0);b&&a&&(this.fc(),this.la())};c.prototype.Ce=function(a,b){void 0===b&&(b=!0);this.Pg(null);if(a.Dc!==this.Dc&&this.Lb.has(a.jc())){this.selection.push(a);
a.Dc=this.Dc;if(5===(a.Gb&5))Wc(a)&&(a.da.classList.add("zwibbler-selected"),this.log("Added to selection: %s",a.id));else{if(a.io()){for(var c=a.parent,e=0;e<c.Ua();e++){var f=c.Cb(e);Uc(f)&&this.Ce(f)}Uc(c)&&this.Ce(c)}for(c=0;c<a.Ua();c++)f=a.Cb(c),Uc(f)&&this.Ce(f)}if(this.ga.get("autoGroup")&&b)for(b=0,a=this.aa.Pw(a);b<a.length;b++)this.Ce(a[b],!1)}};c.prototype.selectNodes=function(a){this.lb();for(var b=0;b<a.length;b++)a[b].ja("locked")||"PageNode"===a[b].type()||this.Ce(a[b]);this.fc()};
c.prototype.Hz=function(a,b){var c=this.aa.ob(a,!1);c?c.se()&&(c.vs()?(c!==this.Ga&&this.Pg(c),this.log("Select edit handle %s",b),this.je=b,this.Ca.sa("selected-edit-handle",a,b)):this.log("selectEditHandle: That handle is not selectable.")):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.Gz=function(a){a=this.aa.Dx(a);for(var b=0;b<a.length;b++)this.Ce(a[b])};c.prototype.fc=function(){this.li();this.Ca.oh("selected-nodes");this.la()};c.prototype.Vo=function(){for(var a=0,
b=this.ol;a<b.length;a++){var c=b[a];""!==c.sg&&this.vl.release(c.sg)}this.ol.length=0};c.prototype.ud=function(a,b,c,e,f,h,k){this.ol.push({type:h,position:new D(a,b),offset:new D(c,e),sg:f,gr:k});""!==f&&this.vl.add(f,f)};c.prototype.li=function(){var a;this.Aj=this.Bj=this.Zl=!0;var b=!1;this.Mg.length=0;if(0!==this.selection.length){for(a=0;a<this.selection.length;a++){var c=this.selection[a];if("GroupNode"!==c.type()){0===a?this.Kd=c.rect.clone():this.Kd.Uh(c.rect);this.Kd.Uh(c.rect);if(c.ja("lockSize")||
5===(c.Gb&5))this.Zl=!1;c.ja("lockRotation")&&(this.Bj=!1);c.ja("lockAspectRatio")&&(b=!0);c.ja("lockPosition")&&(this.Aj=!1)}}this.hp=1===this.selection.length?this.selection[0].Wk():new Gc(this.Kd);var e=0<this.ga.get("snap");if(1<this.selection.length){c=new I;a=null;var f=this.Kd}else a=this.selection[0],f=a.Aa,c=a.Na();var h=!1;a&&a.se()&&a.St()&&(this.Pg(a),h=!0);for(var k=0,l=this.ol;k<l.length;k++){var n=l[k];if("scale"===n.type){if(!this.ga.get("allowResize")||!this.Zl)continue;if("scale"===
n.type&&(0!==n.position.x&&1!==n.position.x||0!==n.position.y&&1!==n.position.y)&&b)continue;if(h)continue}else if("rotate"===n.type&&(!this.Bj||h))continue;this.Mg.push(ke(n,f,c,e))}if(this.Bj&&a&&a.ja("rotationHandles"))for(b=a.ja("rotationHandles"),a=0;a<b.length;a+=4)new D(b[a],b[a+1]),h=new D(b[a+2],b[a+3]),this.Mg.push(new ge(ce,c,f,h,e))}};c.prototype.yv=function(){for(var a=0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.aa.zd(this.selection[b].id)&&(a+=
1);this.selection.length!==a&&(this.selection.length=a);this.Ga&&!this.aa.zd(this.Ga.id)&&(this.Ga=null,null!==this.je&&this.Ca.sa("selected-edit-handle",null,null),this.je=null)};c.prototype.jt=function(a,b){return this.selection.length&&this.hp.cd(a,b)};c.prototype.ls=function(){return 0!==this.selection.length||null!==this.Ga};c.prototype.Bc=function(){var a=this.selection.concat();this.Ga&&!this.xh(this.Ga)&&a.push(this.Ga);return a};c.prototype.Cx=function(a){if(0===a.length)return new D(0,0);
for(var b=a[0].rect.clone(),c=1;c<a.length;c++)b.Uh(a[c].rect);return b.Sd()};c.prototype.bs=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b};c.prototype.ml=function(){var a=A(this.canvas.first).Yb();this.ga.get("showRuler")&&(a.left+=20,a.top+=20);return(new I).multiply(new wc(1/this.scale,1/this.scale)).multiply(new uc(-this.ub,-this.kb)).multiply(new uc(-a.left,-a.top))};c.prototype.ld=function(a){var b=this.Bc();a||(b=this.aa.vk(b));return this.bs(b)};c.prototype.Bn=function(a){for(var b=
null,c=0;c<a.length;c++){var e=this.aa.ob(a[c]);e&&0==(e.Gb&2)&&(null===b?b=e.rect.clone():b.Uh(e.rect))}null===b&&(b=new F(0,0,0,0));return b};c.prototype.update=function(a,b){void 0===a&&(a=!1);if(this.aa.format(this.ra,this.request)||a)this.li(),this.la(b)};c.prototype.jh=function(){var a=this,b=this.ga.get("snap"),c=null,e;this.background=this.ki=null;this.backgroundRepeat="no-repeat";this.dh=this.aa.Ne();var f=this.dh.ja("background")||this.ga.get("background");var h=r.Gi(f);this.cr=f;if("grid"===
f){this.backgroundRepeat="repeat";b=this.ga.get("gridBlocks");var k=this.ga.get("gridSpacing"),l=(b||1)*k;c=jc(document.body);c.width=l;c.height=l;f=c.getContext("2d");f.fillStyle="#ffffff";f.fillRect(0,0,l,l);f.beginPath();for(e=0;e<l;e+=k)if(e%l||1>b)f.moveTo(e+.5,0),f.lineTo(e+.5,l);for(e=0;e<l;e+=k)if(e%l||1>b)f.moveTo(0,e+.5),f.lineTo(l,e+.5);f.strokeStyle=this.ga.get("gridColour");f.lineWidth=.5;f.stroke();if(0<b){f.beginPath();for(e=0;e<=l;e+=l)f.moveTo(e,0),f.lineTo(e,l);for(e=0;e<=l;e+=l)f.moveTo(0,
e+.5),f.lineTo(l,e+.5);f.lineWidth=2;f.stroke()}}else h?(this.log("Using background colour %s",h.toString()),this.ki=function(a,b,c,d,e){1>h.values[3]&&(a.globalCompositeOperation="destination-out",a.fillRect(b,c,d,e),a.globalCompositeOperation="source-over");a.fillStyle=h.toString();a.fillRect(b,c,d,e)}):0<b&&"clear"!==f&&(this.backgroundRepeat="repeat",c=jc(document.body),c.width=b,c.height=b,f=c.getContext("2d"),f.beginPath(),f.moveTo(0,0),f.arc(0,0,3,0,2*Math.PI,!1),f.moveTo(b,0),f.arc(b,0,3,
0,2*Math.PI,!1),f.moveTo(b,b),f.arc(b,b,3,0,2*Math.PI,!1),f.moveTo(0,b),f.arc(0,b,3,0,2*Math.PI,!1),f.fillStyle="#c0c0c0",f.fill());this.mk={};var n=[];this.aa.gc(function(b){"background"===b.jc()&&(n.push(b),a.mk[b.id]=!0)});c&&document.body.removeChild(c);this.background=c;if(n.length||this.Ck){f=document.createElement("canvas");k=this.aa.gl();f.width=k.width;f.height=k.height;b=f.getContext("2d");c?(b.fillStyle=b.createPattern(c,this.backgroundRepeat),b.fillRect(0,0,k.width,k.height)):this.Ck?
this.Ck(b,0,0,k.width,k.height):(b.fillStyle=h?h.toString():"white",b.fillRect(0,0,k.width,k.height));n=tg(n,function(a,b){return a.Bd()-b.Bd()});c=0;for(k=n;c<k.length;c++)l=k[c],l.la(b),l.Lf(!0);this.background=f;this.backgroundRepeat="no-repeat";this.ki=null}};c.prototype.Le=function(a,b,c,e,f){this.dh!==this.aa.Ne()&&this.jh();a.Pd=null;this.background?(a.Pd=a.createPattern(this.background,this.backgroundRepeat),a.fillStyle=a.Pd||"magenta",a.fillRect(b,c,e,f)):this.ki?this.ki(a,b,c,e,f):"G_vmlCanvasManager"in
window&&(a.fillStyle="rgba(0, 0, 0, 0.0)",a.fillRect(b,c,e,f));null===a.Pd&&this.dh&&(b=this.dh.ja("background")||"clear",b=r.Gi(b))&&(a.Pd=b.toString())};c.prototype.jw=function(a){var b=this.aa.gl();a.beginPath();a.fillStyle="#FFFFFF";this.ga.get("pageShadow")&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,1.0)");a.rect(0,0,b.width,b.height);a.fill();a.shadowColor="rgba(0,0,0,0.0)";a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.ga.get("pageBorderColour");
a.stroke();this.Le(a,0,0,b.width,b.height)};c.prototype.mp=function(a){a?this.log("Setting a custom background function."):this.log("Clearing custom background function.");this.Ck=a;this.jh()};c.prototype.iw=function(a){if(this.La.zb){var b=this.La.x,c=this.La.y,e=this.Ii();a.save();a.setTransform(e,0,0,e,0,0);a.beginPath();this.La.Vm?(a.moveTo(b-3,c-10),a.lineTo(b+3,c-10),a.moveTo(b-3,c+10),a.lineTo(b+3,c+10),a.moveTo(b,c-10),a.lineTo(b,c+10)):(a.moveTo(b,c-3),a.lineTo(b,c-15),a.moveTo(b,c+3),a.lineTo(b,
c+15),a.moveTo(b-3,c),a.lineTo(b-15,c),a.moveTo(b+3,c),a.lineTo(b+15,c));this.La.Nb&&this.ra.arc(b,c,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle="#000000";a.stroke();a.restore()}};c.prototype.Yd=function(){var a=this.ga.get("showRuler")?20:0,b=A(this.canvas.first).Yb(),c=A(this.canvas.first.parentElement).Yb(),e=this.canvas.width,f=this.canvas.height,h=b.left-c.left;b=b.top-c.top;this.rc.moveTo(h+e-20,b+a);this.rc.Mf(20,f-20);this.Cd.moveTo(h+a,b+f-20);this.Cd.Mf(e-20,20);a=this.canvas.Fn();a!==
this.Td&&(this.Td=a,this.log("Detected DPR change to %s",this.Td),this.qa.Yd&&this.qa.Yd());this.Lh();this.la()};c.prototype.Lh=function(){if(!this.mo()){var a=this.Bf(),b=this.Af();b=new F(0,0,b.width,b.height);a.hd(this.Eo)&&b.hd(this.Do)||!this.ce(this.ze)||(this.Eo=a,this.Do=b)}};c.prototype.hr=function(a){if(this.ef){var b=this.aa.gl();a.save();a.beginPath();a.rect(0,0,b.width,b.height);a.clip()}return this.ef};c.prototype.la=function(a){var b=this;this.mo()||this.canvas.rd(0,"main",function(c,
e){c.globalAlpha=1;b.vr(c,e,a)})};c.prototype.vr=function(a,b,c){if(!this.Ca.lh){var d=this.re(),f=d.x,h=d.y,k=d.width,l=d.height;this.ef&&(a.fillStyle=this.ga.get("outsidePageColour"),a.fillRect(0,0,this.canvas.width,this.canvas.height));a.translate(this.ub,this.kb);a.scale(this.scale,this.scale);this.ga.get("showRuler")&&a.translate(20/this.scale,20/this.scale);var n=new uc(this.ub,this.kb);n=n.multiply(new wc(this.scale,this.scale));a.Yh=n;this.ef?this.jw(a):this.Le(a,f,h,Math.max(k,k-f),Math.max(l,
l-f));this.aa.mA();f=this.hr(a);this.aa.la(a,d);this.Ca.nh&&(a.save(),this.Ca.nh(a),a.restore());0<this.selection.length&&(a.save(),this.kw(a),a.restore());f&&a.restore();this.Ga&&this.Ga.Lk(a,1/this.scale,this.je);""!==this.wh&&this.ga.get("showHints")&&(a.save(),a.font=15/this.scale+"px Arial",a.fillStyle="#000000",a.textBaseline="top",a.fillText(this.wh,0,0),a.restore());this.iw(a);this.qa.Zs&&this.qa.Zs(a);c&&c(a);this.Ca.Pc("draw",a);this.ga.get("showRuler")&&(a.setTransform(b,0,0,b,0,0),c=this.ga.get("pixelsPerUnit")*
this.scale,d=this.ga.get("units"),a.fillStyle="#ccc",a.fillRect(0,0,20,20),yd(a,new F(20,0,this.canvas.width-20,20),0,d,c,-this.ub),yd(a,new F(0,20,20,this.canvas.height-20),2,d,c,-this.kb));a.setTransform(1,0,0,1,0,0);0<this.selection.length&&this.Tf&&this.Tf.naturalWidth&&(c=this.Tf.width,a.drawImage(this.Tf,this.canvas.width-c-this.rc.ng(),0));this.zi&&this.zi.complete&&this.zi.naturalWidth&&(c=this.zi.naturalWidth,a.drawImage(this.zi,this.canvas.width-c-this.rc.ng(),0));a.globalAlpha=1;a.setTransform(b,
0,0,b,0,0);a.beginPath();a.font="20px Arial";k=a.measureText(og).width;b=this.canvas.width/b/k;a.scale(b,b);a.textBaseline="top";a.lineWidth=4/b;a.strokeStyle="rgba(128, 128, 128, 0.1)";sg.call(a,og,0,0)}};c.prototype.tt=function(a,b){var c=this;this.ga.get("fastDraw")?this.canvas.rd(1,a,function(a){a.translate(c.ub,c.kb);a.scale(c.scale,c.scale);c.ga.get("showRuler")&&a.translate(20/c.scale,20/c.scale);b(a)}):this.la(b)};c.prototype.Ym=function(a){this.ga.get("fastDraw")?this.canvas.rd(1,a,function(){}):
this.la()};c.prototype.kw=function(a){a.lineWidth=1/this.scale;a.strokeStyle="#888888";a.beginPath();for(var b=0,c=null,e=0;e<this.selection.length;e++){var f=this.selection[e];var h=f.Na();f.hidden()||(b++,f===this.Ga||Vc(f)||(f=new Cc(f.Aa),f.transform(h),f.Kk(a,[3/this.scale,3/this.scale]),b++,c?c.Uh(f.qk(5)):c=f.qk(5)))}if(0!==b)for(a.stroke(),h=c?Math.min(c.width,c.height):0,e=0;e<this.Mg.length;e++)this.Mg[e].la(a,this.vl,this.scale,this.gp,h)};c.prototype.Pg=function(a){this.Ga=a};c.prototype.Jn=
function(){return this.Ga};c.prototype.bu=function(a){this.gp=a};c.prototype.xh=function(a){return a.Dc===this.Dc};c.prototype.nx=function(a,b){for(var c=this.ga.get("touchRadius")||this.nq,e=null,f=0;f<this.Mg.length;f++){var h=this.Mg[f];if(h.Db(this.vl,a,b,c,this.scale)){e=h;break}}return e};c.prototype.Hc=function(){this.fu(!1)};c.prototype.ae=function(){this.fu(!0)};c.prototype.fu=function(a){if(a?this.aa.Ee():this.aa.Fe())a?this.aa.ae():this.aa.Hc(),a=this.aa.yh,this.log("Most recent change page=%s",
a),a!==this.aa.ab?(this.log("Undo/redo switched page %s->%s",this.aa.ab,a),this.Fc(a)):this.la(),this.ug(!1)};c.prototype.Ll=function(a,b,c,e,f){var d=this;if(b.length&&!a){for(var k=[],l=0;l<b.length;l++){var n=this.aa.ob(b[l],!1);n&&k.push(n)}this.ga.get("autoPickTool")&&this.selectNodes(k)}else if(this.selection.length||this.Ga){k=0;this.Dc+=1;n=this.aa.ab;for(l=0;l<this.selection.length;l++)l!==k&&(this.selection[k]=this.selection[l]),this.aa.zd(this.selection[k].id)&&this.aa.Me(this.selection[k].id)===
n||this.aa.Zx(this.selection[k])?(this.selection[k].Dc=this.Dc,k++):this.log("Node no longer exists; removing from selection %s",this.selection[k]);this.selection.length!==k&&(this.selection.length=k);this.Ga&&!this.aa.zd(this.Ga.id)&&(this.log("EditNode %s no longer exists",this.Ga.id),this.Ga=null,null!==this.je&&this.Ca.sa("selected-edit-handle",null,null),this.je=null);0!==this.selection.length||this.Ga||this.lb();this.fc()}this.aa.format(this.ra,this.request);this.yv();this.li();this.Lh();this.Lc();
this.la();this.Of.clear();this.aa.gc(function(a){5===(a.Gb&5)&&d.Of.Qq(a.rect,a.id)});this.Nx({ik:b,Xl:c,nm:e,ba:f});this.ug(a)};c.prototype.gn=function(){this.cg(!1,this.ld(!0));this.wi()};c.prototype.cg=function(a,b){b=this.aa.Bx(b);var c=this.aa.Ez(b);0<b.length&&(!0!==a&&cg.setItem("clipboard",c),this.log("Reset paste offset to 0"),this.Mj=this.Lj=0);return c};c.prototype.duplicate=function(){var a=this,b=this.ld(!1),c=this.ga.get("pasteOffset"),e=c||this.ga.get("pasteOffsetX"),f=c||this.ga.get("pasteOffsetY");
this.aa.transaction(function(){a.aa.duplicate(b,e,f)})};c.prototype.rj=function(a){var b=this;if(!a){var c=cg.getItem("clipboard");if(c)a=c;else return}var e=this.ga.get("pasteOffset");c=e||this.ga.get("pasteOffsetX");e=e||this.ga.get("pasteOffsetY");this.Lj+=c;this.Mj+=e;this.log("Using paste offset %s,%s",this.Lj,this.Mj);var f=new uc(this.Lj,this.Mj);this.aa.transaction(function(){b.aa.Es(a,f,b.Nc)})};c.prototype.cm=function(a){""!==a?(this.wh=this.language.get(a),this.Ca.sa("hint",this.wh)):(this.wh=
"",this.Ca.sa("hint",""))};c.prototype.tb=function(){return this.Ya(new gg(this))};c.prototype.Tv=function(){return requestAnimationFrame.name.substr(0,2)+"d"};c.prototype.Ya=function(a){this.qa&&this.qa.lc&&this.qa.lc();this.qa=a;a.gd&&a.gd();a.Ad&&this.Ca.sa("tool-changed",a.Ad());10===this.code&&.25>this.zz&&this.be("fillStyle",this.Tv());return a};c.prototype.qh=function(){var a=null;this.qa.Ad&&(a=this.qa.Ad());return a};c.prototype.Lp=function(a){a=new wf(this,a);this.Ya(a);return a};c.prototype.Hp=
function(a){this.qa instanceof wf&&this.qa.uA(a)};c.prototype.Ds=function(a,b,c){this.Ya(new fg(this,"line",a,b,c))};c.prototype.ln=function(a){a.lineWidth=a.lineWidth||this.kh;a.strokeStyle=a.strokeStyle||this.Vb;this.Ya(new eg(this,a,"brush"))};c.prototype.lw=function(a){a.lineWidth=a.lineWidth||this.kh;a.strokeStyle=a.strokeStyle||this.Vb;this.Ya(new eg(this,a,"shapebrush"))};c.prototype.ur=function(a,b){a.lineWidth=a.lineWidth||this.kh;a.strokeStyle=a.strokeStyle||this.Vb;this.Ya(new eg(this,
a,b))};c.prototype.mr=function(a){this.Ya(new fg(this,"curve",a))};c.prototype.gv=function(a,b){this.Ya(new fg(this,"arrow",a,b))};c.prototype.Bf=function(){if(this.ef){var a=this.aa.gl();var b=this.ga.get("pageInflation");a.Ed(b,b)}else a=this.aa.kc();return a};c.prototype.Up=function(){var a=A(this.canvas.first).Yb(),b=A(this.jd).Yb(),c=a.left-b.left;a=a.top-b.top;this.aa.nd.style.transform="translate("+this.ub+"px, "+this.kb+"px) scale("+this.scale+")";this.Hj.style.transform="translate("+(this.ub+
c)+"px, "+(this.kb+a)+"px) scale("+this.scale+")"};c.prototype.Lc=function(){if(!this.mo())if(this.Up(),this.Ca.sa("scroll"),this.ga.get("scrollbars")){var a=this.Af(),b=this.Bf(),c=this.re(),e=!1,f=!1;c.y<=b.y&&c.bottom()>=b.bottom()?this.rc.Qe():(this.rc.show(),this.rc.Qt(Math.min(c.y,b.y),Math.max(c.bottom(),b.bottom()),c.height,-this.kb/this.scale),e=!0);c.x<=b.x&&c.right()>=b.right()?this.Cd.Qe():(this.Cd.show(),this.Cd.Qt(Math.min(c.x,b.x),Math.max(c.right(),b.right()),c.width,-this.ub/this.scale),
f=!0);f&&e?(this.rc.Mf(20,a.height-20),this.Cd.Mf(a.width-20,20)):e?this.rc.Mf(20,a.height):f&&this.Cd.Mf(a.width,20)}else this.rc.Qe(),this.Cd.Qe()};c.prototype.Ph=function(a,b,c){this.log("Set document size %s,%s",a,b);this.aa.$a();this.aa.setProperty("width",a);this.aa.setProperty("height",b);this.aa.wa(c);this.Lc();this.Lh();this.ug(!1)};c.prototype.Hl=function(a,b,c){var d=this;if(this.Aj)if(this.La.zb)this.log("Not nudging; keyboard cursor shown.");else{a*=c/this.scale;b*=c/this.scale;this.log("Nudge selection by %s, %s",
a,b);var f=this.ld(!0),h=new uc(a,b);this.aa.transaction(function(){d.aa.Sf(f,h)});return 0<f.length}else this.log("Can't nudge; selection motion is locked.")};c.prototype.Pj=function(a){var b=new M;var c=new D(-50,-50);var e=new D(50,-50);var f=new D(50,50);var h=new D(-50,50);b.moveTo(c.x,c.y);b.lineTo(e.x,e.y);b.lineTo(f.x,f.y);b.lineTo(h.x,h.y);b.lineTo(c.x,c.y);b.close();a=pc({},{commands:b.ac(),fillStyle:this.Mb,strokeStyle:this.ec,seed:Math.round(65535*Math.random()),lineWidth:this.hi(this.va.lineWidth),
sloppiness:this.va.sloppiness,layer:this.Nc,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},a);this.log("Create an item on layer %s",this.Nc);this.Ya(new hg(this,"PathNode",a,100,100,"rectangle","rectangle",null))};c.prototype.Zp=function(a,b,c,e){var d=new M;for(var h=0;h<=a;h++){var k=50*Math.sin(b),l=50*-Math.cos(b);h&1&&(k*=c,l*=c);"matrix"in e&&(l=e.matrix.apply(k,l),k=l.x,l=l.y);0===h?d.moveTo(k,l):d.lineTo(k,l);b+=2*Math.PI/a}d.close();"matrix"in e&&delete e.matrix;
e=pc({},{commands:d.ac(),fillStyle:this.Mb,strokeStyle:this.ec,seed:Math.round(65535*Math.random()),lineWidth:this.hi(this.va.lineWidth),sloppiness:this.va.sloppiness,layer:this.Nc,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},e);this.log("Create an item on layer %s",this.Nc);this.Ya(new hg(this,"PathNode",e,100,100,this.ga.Wr(),"polygon",null))};c.prototype.Xy=function(){this.Ya(new ig(this))};c.prototype.pm=function(a){var b=new D(0,0);var c=new M;c.moveTo(b.x,b.y-50);
c.dg(b.x+50,b.y-50,b.x+50,b.y);c.dg(b.x+50,b.y+50,b.x,b.y+50);c.dg(b.x-50,b.y+50,b.x-50,b.y);c.dg(b.x-50,b.y-50,b.x,b.y-50);c.closePath();b=c.ac();a=pc({},{commands:b,fillStyle:this.Mb,strokeStyle:this.ec,seed:Math.round(65535*Math.random()),lineWidth:this.hi(this.va.lineWidth),sloppiness:this.va.sloppiness,layer:this.Nc,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},a||{});this.Ya(new hg(this,"PathNode",a,100,100,this.ga.Wr(),"circle",null))};c.prototype.$p=function(a,
b,c,e,f,h){this.Ya(new hg(this,a,b,c,e,f,"shape",h))};c.prototype.WA=function(a,b){this.Ya(new me(this,a,b))};c.prototype.Yp=function(a){var b=this.aa.ob(a,!1);if(!b)return this.log("useEditHandleTool: node %s doesn't exist.",a),!1;if(!b.se())return this.log("useEditHandleTool: nodetype %s has no edit mode",b.type()),!1;this.tb();this.lb();this.fc();this.Pg(b);this.la()};c.prototype.By=function(a,b,c){var d=this,f=document.createElement("img");f.src=a;f.onload=function(){var e=f.naturalWidth,k=f.naturalHeight,
l=d.re(),n=l.Sd();"number"===typeof b&&"number"===typeof c&&(n=new D(b,c));var q=Math.min(1,l.width/e);q=Math.min(q,l.height/k);n.x-=e*q/2;n.y-=k*q/2;var v=(new wc(q,q)).multiply(new uc(n.x,n.y));d.aa.transaction(function(){d.aa.createNode("ImageNode",{url:a,matrix:v})})}};c.prototype.Bd=function(){return A.Yr()};c.prototype.Ky=function(a,b){this.qa.Wd?(this.log("Simulating click of colour %s",a),this.qa.Wd(a,b)):this.log("A colour is not needed for this tool.")};c.prototype.Py=function(a,b){this.qa.Gf?
(this.log("Simulating opacity change %s",a),this.qa.Gf(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.Fc=function(a){this.aa.Fc(a)&&(this.lb(),this.fc(),this.Lh(),this.la(),this.Ca.sa("set-page",a))};c.prototype.op=function(a){this.ef=a;a=this.Bf();this.ub=-a.x;this.kb=-a.y;this.Lc();this.la()};c.prototype.Ft=function(a){var b=this.re(),c=b.width/a;a=b.height/a;b.x-=(c-b.width)/2;b.y-=(a-b.height)/2;b.width=c;b.height=a;this.Qg(b)};c.prototype.tm=function(){this.Ft(this.ga.Kh(1.1*
this.scale)/this.scale)};c.prototype.um=function(){this.Ft(this.ga.Kh(this.scale/1.1)/this.scale)};c.prototype.Ei=function(a,b,c){var d=this;c=c||this.Cx(a);var f=new xc(b,c.x,c.y);this.aa.transaction(function(){d.aa.Sf(d.bs(a),f)})};c.prototype.Mr=function(a,b){this.ls()||this.log("flipSelection: selection is empty");this.Ei(this.Bc(),a,b)};c.prototype.Ii=function(){var a=this.ra;return(window.devicePixelRatio||1)/(a.fB||a.wy||a.zy||a.Ey||a.mv||1)};c.prototype.Dn=function(){return new rc(this.canvas.width,
this.canvas.height)};c.prototype.Af=function(){var a=this.Dn(),b=this.ga.get("showRuler")?20:0;return new F(b,b,a.width-b,a.height-b)};c.prototype.Lz=function(a,b){this.canvas.Mf(a,b)};c.prototype.re=function(){var a=this.Af();0<a.width&&(this.As=new F((0-this.ub)/this.scale,(0-this.kb)/this.scale,a.width/this.scale,a.height/this.scale));return this.As};c.prototype.Qg=function(a,b,c){void 0===b&&(b=!1);void 0===c&&(c=!1);this.log("setViewRect(%s)",a);var d=this.Af(),f=Math.min(d.width/a.width,d.height/
a.height)||1,h=a.x*f,k=a.y*f;this.ub=b?(d.width-a.width*f)/2-h:-h;this.kb=c?(d.height-a.height*f)/2-k:-k;this.ze=this.scale=f;this.Lc();this.la()};c.prototype.Hw=function(a){this.request.eh?(this.log("Formatting in progress; will call function soon"),this.request.once("done",a)):(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.Cl=function(a){!this.Zg&&a?(this.log("Locking updates."),this.Zg=!0):this.Zg&&!a&&(this.log("Resuming updates"),this.Zg=!1,this.Lh(),
this.Lc(),this.la())};c.prototype.mo=function(){this.Zg&&this.log("Updates are locked. Ignoring draw/format request");return this.Zg};c.prototype.ug=function(a){this.Ca.oh("document-changed",{remote:a})};c.prototype.Kh=function(a){return this.ga.Kh(a)};c.prototype.oc=function(a){this.Rd.style.cursor=a;this.lo=0<=a.indexOf("resize")};c.prototype.scrollIntoView=function(a,b){var c=0,e=0,f=this.Bf(),h=this.re();a=this.mh(a,b);b=this.mh(h.x,h.y);var k=this.mh(h.right(),h.bottom());b=new F(b.x,b.y,k.x-
b.x,k.y-b.y);a.x>b.x-50&&a.x<b.x+100&&(c=-25/this.scale);a.y>b.y-50&&a.y<b.y+100&&(e=-25/this.scale);a.x>b.right()-100&&a.x<b.right()+50&&(c=25/this.scale);a.y>b.bottom()-100&&a.y<b.bottom()+50&&(e=25/this.scale);0<c?c=Math.max(0,Math.min(c,f.right()-h.right())):0>c&&(c=Math.max(c,f.x-h.x));0<e?e=Math.min(e,f.bottom()-h.bottom()):0>e&&(e=Math.max(e,f.y-h.y));if(c||e)h.x+=c,h.y+=e,this.Qg(h)};c.prototype.xe=function(a){a?this.nu.classList.add("dragging"):this.nu.classList.remove("dragging")};return c}();
function vg(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname||location.hostname===ng("        \u001d98$").toLowerCase()?1:0}function xg(c,a){if(!(vg()||.04<a)){a=ng("2#=21VJ]i->+ .)7\\p5:F2+/.\\c40V").toLowerCase();var b=document.createElement("img");b.src=a+Pa(Qa("web|1606166860454|"+location.href+"|"+nf+"|"+("1"+c)),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=").replace("=","");b.onload=function(){}}}
function tg(c,a){for(var b=[],d=0;d<c.length;d++)b.push(d);b.sort(function(b,d){var e=a(c[b],c[d]);return 0!==e?e:b-d});for(var e=[],f=0;f<b.length;f++)d=b[f],e.push(c[d]);return e};var yg;(function(c){function a(a){a=1664525*a+1013904223&4294967295;return function(){a=1664525*a+1013904223&4294967295;return a/4294967295+.5}}function b(a){return Math.floor(a*c.random())}c.random=Math.random;c.Jw=a;c.fp=function(b){c.random=a(b)};c.aC=function(){c.random=Math.random};c.JB=b;c.ZB=function(a){for(var c=[],d=0;d<a;d++)c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[b(63)]);return c.join("")}})(yg||(yg={}));var zg=yg;var Dg=function(){function c(a,b,c,e){var d=this;this.Ca=a;this.ta=b;this.log=u.create("APP");this.ya=new Ib;this.Ps=this.Rs=-1;this.Jk=[];this.og=!1;this.cp=this.Vp=null;this.xg=[];this.Ff=null;for(this.vj=0;null!==b.firstChild;)b.removeChild(b.firstChild);b=A(this.ta).qe("position");"absolute"!==b&&"fixed"!==b&&(this.ta.style.position="relative");this.ta.style.overflow="none";this.ta.style.textAlign="left";this.ta.classList.add("zwibbler-main");Q.Cf(".zwibbler-main { font-size: 16px; }\n        .zwibbler-passthrough { cursor: pointer; }\n        .zwibbler-selected {outline: 4px solid rgba(0, 80, 183, 0.2);}\n        .zwibbler-main.dragging .zwibbler-staging iframe,\n        .zwibbler-main.dragging .zwibbler-html-root iframe {\n            pointer-events: none !important;\n        }\n        ");
this.Fk=new Jb(A("div").Va({width:"300px"}).da,this.ya);this.log("Zwibbler built on "+new Date(1606166860454)+" for 'web'");this.ga=new rf(this.ya,c);this.language=new Gb("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.Nt(this.ga.get("language"));this.Rd=A("div").Qd("zwibbler-canvas-holder").Va({position:"absolute",overflow:"hidden",touchAction:"none"}).da;this.ta.appendChild(this.Rd);this.canvas=new fb(this.Rd,100,100);A(this.canvas.first).Qd("zwibbler-main-canvas").Va({outline:"0",position:"absolute",left:"0",top:"0",pointerEvents:"none"});c=this.Oe();this.zc=new Lb;this.Hj=A("DIV").Va({position:"absolute",userSelect:"none",webkitUserSelect:"none",KB:"none",transformOrigin:"left top",left:0,top:0}).Qd("zwibbler-staging").wd(c).da;
this.Mh={ctx:a};e&&(this.Mh.$parent=e);this.vj=zg.Jw((new Date).getTime())();this.view=new ug(c,this.canvas,new Ag(!1,c,this.Mh),this.zc,this.ga,this.language,this.Ca,this.ya,this.Hj,this.Rd,this.vj,this.ta);this.nd=A(this.view.aa.nd).Qd("zwibbler-html-root").Va({position:"absolute",left:"0",top:"0",userSelect:"none",msUserSelect:"none",webkitUserSelect:"none"}).insertBefore(this.canvas.first).da;this.Ht();this.Rc=this.kA();ab.Bu()?(this.log("Using resize observer"),this.Ff=new ab(this.ta,function(){return d.Ca.resize()}),
this.ya.add(function(){d.Ff&&d.Ff.Ta()})):(this.log("Using window resize event"),this.ya.addEventListener(window,"resize",function(){d.Ca.resize()}));window.$&&(this.log("jQuery detected; register for bootstrap events"),window.$(document).bind("shown.bs.modal",function(){d.log("Bootstrap modal shown; resize now");d.Ca.resize()}));e=this.canvas.get(0);b=this.canvas.Fn();e.clearRect(0,0,this.canvas.width*b,this.canvas.height*b);e.globalAlpha=0;this.view.vr(e,b);try{var h=e.getImageData(0,0,this.canvas.width*
b,this.canvas.height*b),k=h.data,l=k[0]*k[3]/255,n=h.width*h.height*4,q=100>h.width||100>h.height?12:0;for(h=0;h<4*n;h+=4){var v=k[h]*k[h+3]/255-l;v>q&&(q=v)}this.view.Mk=Math.round(1.2*q/10);this.log("Spline emulation needed: %s",this.view.Mk)}catch(y){console.log(y)}null!==this.ga.cb("backgroundImage")&&(this.kp(this.ga.cb("backgroundImage")),this.view.aa.Yl());this.ga.pa("update",function(a,b){d.Xe(a,b)});Q.Cf(".zwibbler-progress-notification {\n            position: absolute;\n            top: 0;\n            right: 0;\n            box-shadow: 3px 3px 3px #444;\n            background: #ccc;\n            color: black;\n            border-bottom-left-radius: 4px;\n            font-family: arial,sans;\n        }");
this.ot=A("div").Qd("zwibbler-progress-notification").wd(this.ta).da;a.resize();this.Xe("showDebug",this.ga.get("showDebug"));this.view.ug(!1);this.Ca.sa("set-page",this.view.aa.ab);if(cg.lk()){if(this.ga.get("persistent")&&(a=cg.getItem("zwibbler-document")))try{var x=Bg.ci(a,c,this.Mh);if(x)this.Og(x);else throw Error("Failed to open document.");}catch(y){this.log("Failed to load persistent document: %s",y.message)}this.Vp=dg(1E3,function(){d.ga.get("persistent")&&(d.log("Saving document"),cg.setItem("zwibbler-document",
d.Ca.save()))});this.Ca.pa("document-changed",function(){d.Vp()});this.ya.add(function(){d.Vp.cancel()})}var w=setTimeout(function(){w=0;d.view.code=100*vg()+10+(d.view.Mk?1:0);d.log("Spline contours now %s %s",d.view.code,d.vj)},3E5);this.ya.add(function(){for(w&&clearTimeout(w);d.ta.firstChild;)d.ta.removeChild(d.ta.firstChild);d.Rc.oi();d.zc.oi();A(d.Hj).remove()});this.ya.addEventListener(this.Oe(),"dragstart",function(a){if(a.target instanceof HTMLImageElement){var b=a.target.getAttribute("draggable");
if(!b||"false"===b.toLowerCase())return a.preventDefault(),!1}});xg(this.view.Mk,this.vj)}c.prototype.Ta=function(){this.ya.Ta()};c.prototype.Xe=function(a,b){var c=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "showDebug":b?(this.Fk.show(),this.gi(0,"right",this.Fk.ta)):(this.Fk.Qe(),this.wj(this.Fk.ta));c=!0;break;case "backgroundImage":this.kp(b);break;case "language":this.language.Nt(b);break;case "latency":Eb.Oz(b)}c&&this.ak()};c.prototype.Ht=function(){this.ga.cb("sloppy")||this.view.df("sloppiness",
0);this.view.df("smoothness",this.ga.$w());this.view.df("fillStyle",this.ga.cb("defaultFillStyle"));this.view.df("strokeStyle",this.ga.cb("defaultStrokeStyle"));this.view.df("fontName",this.ga.cb("defaultFont"));this.view.df("fontSize",this.ga.cb("defaultFontSize"));this.view.df("lineWidth",this.ga.cb("defaultLineWidth"));this.view.df("textFillStyle",this.ga.cb("defaultTextFillStyle"))};c.prototype.Og=function(a){this.Rd.insertBefore(a.nd,this.nd);A(this.nd).remove();this.nd=a.nd;A(this.nd).Va({position:"absolute",
left:0,top:0,userSelect:"none",webkitUserSelect:"none"});this.view.Og(a);this.Ht();this.Ca&&(this.view.ug(!1),this.Ca.sa("set-page",a.ab));for(a=0;a<this.Jk.length;a++){var b=this.Jk[a];this.log("Removing old DomElement of type %s",b.tagName);A(b).remove()}this.Jk=[]};c.prototype.Zm=function(){this.view.aa.Yl()};c.prototype.kA=function(){var a=this,b=this;this.og=!1;var c=new Mb;this.ga.hv(c);c.pa("*",function(b,c){a.og?(a.log("have focus, process %s",b),a.view.Xd(b,c)):a.log("Ignore key action -- don't have focus. (%s)",
a.og)});c.Zq(document.body);this.ya.add(function(){a.Rc.detach(a.ta)});this.zc.pa("goto-toolbar",function(){a.cp&&a.cp.focus()});this.zc.pa("goto-canvas",function(){b.focus()});this.ya.addEventListener(this.ta,"blur",function(){a.blur()});this.ga.pa("allowSystemClipboard",function(b){a.log("allowSystemClipboard=>%s",b);a.ga.ho()&&(a.ya.addEventListener(document,"cut",function(b){return a.view.vg(b)}),a.ya.addEventListener(document,"copy",function(b){return a.view.vg(b)}),a.ya.addEventListener(document,
"paste",function(b){return a.view.vg(b)}))});this.ya.addEventListener(document.body,"focus",function(){document.activeElement!==a.Rd&&document.activeElement!==document.body&&(a.log("Someone else has focus. blur."),a.blur())},!0);return c};c.prototype.dA=function(a){this.cp=a};c.prototype.focus=function(){if(!this.og){this.og=!0;this.ta.classList.add("focus");this.log("Set Fake Focus to canvas, %s",this.og);for(var a=0,b=Q.Yi;a<b.length;a++){var c=b[a];c!==this.Ca&&c.blur()}}document.activeElement instanceof
HTMLElement&&document.activeElement!==this.Rd&&(this.log("Blurring active element"),document.activeElement.blur())};c.prototype.blur=function(){"text"!==this.view.qh()&&(this.log("Blur event received -- hide keyboard cursor"),this.view.Rx());this.og=!1;this.ta.classList.remove("focus")};c.prototype.vp=function(a){void 0===a&&(a=!1);this.focus();this.view.vp(a)};c.prototype.createNode=function(a,b,c,e){"layer"in b||(b.layer=this.view.Nc);c||(c=this.view.aa.Xk());this.view.aa.$a();a=this.view.aa.createNode(a,
b,c,e);this.view.aa.wa();return a};c.prototype.transformNode=function(a,b){var c=this;this.view.aa.transaction(function(){c.view.aa.Sf(a,b)});return!0};c.prototype.np=function(a,b,c,e,f,h,k){var d=this,n=new I(b,e,c,f,h,k);this.view.aa.transaction(function(){d.view.aa.Ec(a,"matrix",n)});return!0};c.prototype.Tg=function(a,b,c){var d=this,f=new uc(b,c);this.view.aa.transaction(function(){d.view.aa.Sf(a,f)})};c.prototype.zj=function(a,b,c,e,f){var d=this,k=new wc(b,c,e,f);this.view.aa.transaction(function(){d.view.aa.Sf(a,
k)});return!0};c.prototype.Ke=function(a){this.view.aa.$a();this.view.aa.wc(a);this.view.aa.wa();return!0};c.prototype.kp=function(a){var b=this;this.view.aa.$a();this.view.aa.gc(function(a){"background"===a.jc()&&b.view.aa.wc([a.id])});a&&(a=this.view.aa.createNode("ImageNode",{url:a,locked:!0,tag:"background",layer:"background"}),this.view.aa.xd([a],1));this.view.aa.wa(!0);this.view.lb();this.view.fc()};c.prototype.Rw=function(){var a=null;this.view.aa.gc(function(b){if("background"===b.jc()&&"ImageNode"===
b.type())return a=b.ja("url"),!1});return a};c.prototype.zo=function(){this.Og(new Ag(!1,this.Oe(),this.Mh));null!==this.ga.cb("backgroundImage")&&(this.kp(this.ga.cb("backgroundImage")),this.view.aa.Yl())};c.prototype.ak=function(){var a=!0;void 0===a&&(a=!1);var b=this.ta.clientWidth,c=this.ta.clientHeight;if(a||b!==this.Rs||c!==this.Ps){this.Rs=b;this.Ps=c;for(var e=a=0,f=0,h=0,k=0,l=this.xg;k<l.length;k++){var n=l[k];switch(n.position){case "left":case "right":n.ta.style.top=f+"px";n.ta.style.bottom=
h+"px";break;case "top":case "bottom":n.ta.style.left=a+"px",n.ta.style.right=e+"px"}switch(n.position){case "left":n.ta.style.left=a+"px";a+=n.ta.offsetWidth;break;case "right":n.ta.style.right=e+"px";e+=n.ta.offsetWidth;break;case "top":n.ta.style.top=f+"px";f+=n.ta.offsetHeight;break;case "bottom":n.ta.style.bottom=h+"px",h+=n.ta.offsetHeight}}A(this.Rd).Va({left:a+"px",right:e+"px",top:f+"px",bottom:h+"px"});this.view.Lz(b-e-a,c-h-f);A(this.ot).Va({top:"0",right:e+"px"});this.view.Yd();this.Ca.sa("resize")}else this.log("Ignoring resize; div size did not change.")};
c.prototype.Fm=function(a,b,c){void 0===c&&(c=this.view.aa.ab);var d=this.view.aa.ab;this.view.aa.Fc(c);a.translate(-b.x,-b.y);this.view.Le(a,b.x,b.y,b.width,b.height);this.view.aa.la(a);this.Ca.nh&&this.Ca.nh(a);this.view.aa.Fc(d)};c.prototype.Bt=function(a,b,c){0==c&&(c=b.width);var d=c/b.width,f=1;10===this.view.code&&.25>this.vj&&(f*=.1);if("image/svg+xml"===a||"application/pdf"===a){var h=!1;"image/svg+xml"===a?c=new ue(new F(0,0,b.width,b.height)):(b=this.Ca.rh(0),b=new F(b.x,b.y,b.width,b.height),
c=new hf(new F(0,0,b.width,b.height),Q.fonts),h=!0);c.scale(f,f);if(h)for(f=0;f<this.view.aa.jb();f++)0<f&&(b=this.view.aa.kc(f,Cg),c.Rh(b)),this.Fm(c,b,f);else this.Fm(c,b);return"data:"+a+";base64,"+Pa(c.$t())}h=document.createElement("canvas");h.setAttribute("width",Math.ceil(b.width*d).toString());h.setAttribute("height",Math.ceil(b.height*d).toString());c=h.getContext("2d");c.scale(d*f,d*f);if("image/jpeg"===a||"image/bmp"===a)c.fillStyle="#ffffff",c.fillRect(0,0,b.width,b.height);this.Fm(c,
b);return"image/bmp"===a?nc(h):h.toDataURL(a)};c.prototype.Ec=function(a,b,c){var d=this;this.log("External app setItemProperty %s: %s=%s",a,b,c);this.view.aa.transaction(function(){d.view.aa.Ec(a,b,c)});return!0};c.prototype.$b=function(a,b){var c=this;this.log("External app setNodeProperty %s: %s",a,JSON.stringify(b));this.view.aa.transaction(function(){c.view.aa.$b(a,b)});return!0};c.prototype.fl=function(a,b){var c,e;(c=this.view.aa.Oa(a))&&(e=c.ja(b));this.log("GetItemProperty %s: %s=%s",a,b,
e);return e};c.prototype.dn=function(a){var b,c;if(6>a.length)this.log("newShape: Cannot create shape with fewer than three points.");else{var e=new M;var f=b=0;for(c=a.length-1;b<=c;f=b+=2){var h=this.view.bb(new D(a[f],a[f+1]));if(0===f){e.moveTo(h.x,h.y);var k=h}else e.lineTo(h.x,h.y)}k&&(e.lineTo(k.x,k.y),e.close());return this.Bk(e.ac())}};c.prototype.Bk=function(a){return this.createNode("PathNode",{commands:a,fillStyle:this.view.Mb,strokeStyle:this.view.ec,seed:Math.round(65535*Math.random()),
lineWidth:this.view.va.lineWidth,sloppiness:this.view.va.sloppiness,angleArcs:this.ga.get("angleArcs")})};c.prototype.Zv=function(a){return new eb(this.ot,a)};c.prototype.gi=function(a,b,c){for(var d=0,f=this.xg;d<f.length;d++)if(f[d].ta===c)return;this.ta.appendChild(c);this.xg.push({order:a,ta:c,position:b});c.style.position="absolute";this.xg.sort(function(a,b){return a.order<b.order?-1:1});this.ak()};c.prototype.wj=function(a){for(var b=0;b<this.xg.length;b++)if(this.xg[b].ta===a){this.xg.splice(b,
1);this.ta.removeChild(a);break}this.ak()};c.prototype.Oe=function(){for(var a=this.ta,b=a;b;){if(b instanceof HTMLElement&&(null!==b.getAttribute("zwibbler")||"ZWIBBLER"===b.tagName)){a=b;break}b=b.parentElement}return a};c.prototype.Mm=function(a,b){this.Rc.map(a,function(a){A.Df(a.target)||b(a)})};return c}();var Eg=function(){function c(a,b){this.view=a;this.methods=b;this.log=u.create("CustomToolBehaviour");this.nc=new ne(a)}c.prototype.gd=function(){this.log("Entering CustomToolBehaviour");this.methods.enter&&this.methods.enter()};c.prototype.lc=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.Ml=function(a,b,c){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,c.mc):!1};c.prototype.Eb=function(a,b,c){return this.methods.onMouseDown?
this.methods.onMouseDown(a,b,c.mc):!1};c.prototype.yb=function(a,b,c){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,c.mc):!1};c.prototype.Pb=function(a,b,c){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,c.mc):!1};c.prototype.Xs=function(a,b,c){return this.methods.onMouseLeave?this.methods.onMouseLeave(a,b,c):!1};c.prototype.Go=function(a,b,c){return this.methods.onDoubleClick?this.methods.onDoubleClick(a,b,c.mc):!1};c.prototype.Ss=function(a,b,c){return this.methods.onContextMenu?
this.methods.onContextMenu(a,b,c):!1};c.prototype.Wd=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.Gf=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,b):!1};c.prototype.Xd=function(a,b){this.log("keyboard: %s",a);this.methods.onKeyCommand&&!1===this.methods.onKeyCommand(a,b)||"cancel"!==a||(this.log("ESC pressed. Abort and go back to toolbar."),this.view.tb(),this.view.zc.sa("goto-toolbar"))};c.prototype.Zs=function(a){if(this.methods.onRedraw)this.methods.onRedraw(a)};
c.prototype.mb=function(a){return this.methods.onGesture?this.methods.onGesture(a):this.nc.mb(a)};c.prototype.Ho=function(a,b,c,e){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,b,c,e):!1};c.prototype.Ad=function(){return this.methods.getToolName?this.methods.getToolName():"custom"};return c}();function Fg(c){for(var a=[],b=0;b<c;b++)a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[Math.floor(63*Math.random())]);return a.join("")};var Gg={style:"\n        .zwibbler-builtin-toolbar {\n    background: white;\n    width: 130px;\n    flex: 0 0 auto;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none; \n}\n\n.zwibbler-builtin-toolbar button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    background-color: white;\n    border: none;\n}\n\n.zwibbler-builtin-toolbar button img {\n    margin: 0;\n}\n\n.zwibbler-builtin-toolbar button:hover,\n.zwibbler-builtin-toolbar button.selected {\n    background-color: #9fb3e7;\n}\n",
ul:'<div style="overflow-y: auto;display:flex;overflow-x:hidden;">\n<div class="zwibbler-builtin-toolbar">\n<button \n    z-if="getConfig(\'showPickTool\')"\n    z-click="usePickTool()"\n    z-selected="getCurrentTool()===\'pick\'"\n    title="Pick">\n    <img z-bind:src="getImageUrl(\'wd-pick.png\')">\n</button>\n<button \n    z-if="getConfig(\'showSquareTool\')"\n    z-click="useRectangleTool()"\n    z-selected="getCurrentTool()===\'rectangle\'"\n    title="Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-box.png\')">\n</button>\n<button \n    z-if="getConfig(\'showRoundRectTool\')"\n    z-click="useRoundRectTool()"\n    title="Rounded Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-roundrect.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCircleTool\')"\n    z-click="useCircleTool()"\n    z-selected="getCurrentTool()===\'circle\'"\n    title="Circle">\n    <img z-bind:src="getImageUrl(\'wd-circle.png\')">\n</button>\n<button \n    z-if="getConfig(\'showShapeBrushTool\')"\n    z-click="useShapeBrushTool()"\n    title="Shape brush">\n    <img z-bind:src="getImageUrl(\'wd-shapebrush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showBrushTool\')"\n    z-click="useBrushTool()"\n    z-selected="getCurrentTool()===\'brush\'"\n    title="Brush">\n    <img z-bind:src="getImageUrl(\'wd-brush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showLineTool\')"\n    z-click="useLineTool()"\n    z-selected="getCurrentTool()===\'line\'"\n    title="Lines">\n    <img z-bind:src="getImageUrl(\'wd-line.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCurveTool\')"\n    z-click="useCurveTool()"\n    z-selected="getCurrentTool()===\'curve\'"\n    title="Curves">\n    <img z-bind:src="getImageUrl(\'wd-curve.png\')">\n</button>\n<button \n    z-if="getConfig(\'showArrowTool\')"\n    z-click="useArrowTool()"\n    z-selected="getCurrentTool()===\'arrow\'"\n    title="Arrows">\n    <img z-bind:src="getImageUrl(\'wd-arrow.png\')">\n</button>\n<button \n    z-if="getConfig(\'showTextTool\')"\n    z-selected="getCurrentTool()===\'text\'"\n    z-click="useTextTool()"\n    title="Text">\n    <img z-bind:src="getImageUrl(\'wd-text.png\')">\n</button>\n<button \n    z-if="getConfig(\'showImageTool\')"\n    z-click="insertImage()"\n    title="Insert image...">\n    <img z-bind:src="getImageUrl(\'wd-image.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="bringToFront()"\n    title="Bring to front">\n    <img z-bind:src="getImageUrl(\'wd-moveup.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="sendToBack()"\n    title="Send to back">\n    <img z-bind:src="getImageUrl(\'wd-movedown.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canUndo()"\n    z-click="undo()"\n    title="Undo">\n    <img z-bind:src="getImageUrl(\'wd-undo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canRedo()"\n    z-click="redo()"\n    title="Redo">\n    <img z-bind:src="getImageUrl(\'wd-redo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="copy()"\n    title="Copy">\n    <img z-bind:src="getImageUrl(\'wd-copy.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="paste()"\n    title="Paste">\n    <img z-bind:src="getImageUrl(\'wd-paste.png\')">\n</button>\n<button\n    z-for="button in _zwibblerButtons"\n    z-bind:title="button.name"\n    z-click="_zwibblerButtonClicked(this, button)">\n    <img z-bind:src="getImageUrl(button.image)">\n</button>\n</div>\n</div>\n',
controller:function(c){c._zwibblerButtons=Q.buttons;c._zwibblerButtonClicked=function(a,b){b.onclick.call(a,c)}}};var Hg={style:".zwibbler-page-selector {\n    overflow-y: scroll;\n    background: #888;\n    width: 160px;\n    text-align: center;\n}\n\n.zwibbler-page-selector [z-page] {\n    border: 3px solid transparent;\n    margin: 5px;\n    display: inline-block;\n    box-shadow: 2px 2px 2px rgba(0,0,0,0.2);\n}\n\n.zwibbler-page-selector [z-page].selected {\n    border: 3px solid #9fb3e7;\n}\n",ul:'<div class="zwibbler-page-selector">\n    <button z-if="getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.setCurrentPage(ctx.insertPage(ctx.getCurrentPage()+1))">\n        Add Page\n    </button>\n    <button z-if="ctx.getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.deletePage(ctx.getCurrentPage())">\n        Delete Page\n    </button>\n    <br>\n    <div z-sort="ctx.movePage($from,$to)">\n        <div z-for="page in ctx.getPageCount()"\n            draggable="TRUE"\n            z-sortable\n            z-page="page"\n            z-width="130"\n            z-height="130"\n            z-click="ctx.setCurrentPage(page)"\n            z-selected="page==ctx.getCurrentPage()">\n        </div>\n    </div>\n</div>\n'};var Ig={style:".zwibbler-property-panel {\n    width: 200px;\n    background: #f5f5f5;\n    display:flex;\n    flex-flow: column nowrap;\n    overflow-y: scroll;\n    padding: 10px;\n    font-family: sans-serif;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none;     \n}\n\n.zwibbler-property-panel h3 {\n    margin-bottom: 0.5em;\n}\n\n.zwibbler-property-panel button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    display: block;\n    background-color: white;\n    color: black;\n    border: none;\n    border-radius: 2px;\n    border-bottom: 2px solid #ddd;\n    width: 100%;\n}\n\n.zwibbler-property-panel button[tool] {\n    display: inline-block;\n    width: 60px;\n    height: 60px;\n    font-size: 30px;\n}\n\n.zwibbler-property-panel button.zwibbler-option {\n    border: 0;\n    padding: 10px;\n    border-radius: 3px;\n    background: transparent;\n    text-align: left;\n}\n\n.zwibbler-property-panel button.selected {\n    background: #9fb3e7;\n}\n\n.zwibbler-property-panel button.hover {\n    background: #ddd;\n}\n\n.zwibbler-property-panel hr {\n    border: none;\n    border-top: 1px solid #ccc;\n}\n\n.zwibbler-property-panel select {\n    width: 100%;\n}\n\n.zwibbler-property-panel .colour-picker {\n    padding: 10px 0;\n}\n\n.zwibbler-property-panel [swatch] {\n    border: 1px solid black;\n    display: inline-block;\n    height: 2em;\n    width: 4em;\n    vertical-align:middle;\n    margin-right: 10px;\n}\n",
ul:'<div class="zwibbler-property-panel">\n<h3>Shape options</h3>\n<div z-if="ctx.summary.empty">\n    There are no selected shapes.\n</div>\n<div z-has="AnyNode">\n    <button z-click="ctx.deleteNodes()">Delete</button>                    \n    <button z-click="ctx.bringToFront()">\n        Move to front\n    </button>\n    <button z-click="ctx.sendToBack()">\n        Send to back\n    </button>\n</div>\n<div z-has="fontName" z-if="ctx.getConfig(\'showFontNameProperty\')">\n    <h3>Font</h3>\n    <select z-property="fontName">\n        <option z-for="font in ctx.getConfig(\'fonts\')" z-text="font" z-bind:value="font"></option>\n    </select>\n</div>\n<div z-has="fontSize" z-if="ctx.getConfig(\'showFontSizeProperty\')">\n    <h3>Font size</h3>\n    <select z-property="fontSize">\n        <option value="8">8</option>\n        <option value="10">10</option>\n        <option value="12">12</option>\n        <option value="16">16</option>\n        <option value="20">20</option>\n        <option value="24">24</option>\n        <option value="50">50</option>\n    </select>\n</div>\n<div z-has="fillStyle|strokeStyle|background">\n    <h3>Colours</h3>\n    <div class="colour-picker" z-has="fillStyle">\n        <div swatch z-property="fillStyle" z-colour></div>\n        Fill style\n    </div>\n    <div class="colour-picker" z-has="strokeStyle">\n        <div swatch z-property="strokeStyle" z-colour></div>\n        Outline\n    </div>\n    <div class="colour-picker" z-has="background">\n        <div swatch z-property="background" z-colour></div>\n        Background\n    </div>\n</div>\n<div z-has="arrowSize">\n    <h3>Arrows</h3>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="0">None</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="10">Small</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="15">Large</button>\n    <hr>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="solid">Solid</button>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="open">Open</button>\n</div>\n<div z-has="lineWidth">\n        <h3>Line width</h3> \n        <select z-property="lineWidth">\n            <option value="0">None</option>\n            <option value="1">1</option>\n            <option value="2">2</option>\n            <option value="4">4</option>\n            <option value="8">8</option>\n        </select>\n    </div>\n<div z-has="dashes">\n    <h3>Line style</h3>\n    <button class="zwibbler-option" z-property="dashes" z-value="">Solid</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="3,3">Dots</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="8,2">Dashes</button>\n</div>\n<div z-has="opacity">\n    <h3>Opacity</h3>\n    <input z-property="opacity" type="range" min="0.1" max="1.0" step="0.05">\n</div>              \n'};var Jg=HTMLElement,Kg=Object,Lg;
(function(c){function a(a){return{type:a,match:function(b){return typeof b===a}}}function b(a){return{type:a.name,match:function(b){return b instanceof a}}}function d(a){return{type:""+a,match:function(b){return b===a}}}function e(a){return{type:a.type+"[]",match:function(b){return b instanceof Array&&(0===b.length||a.match(b[0]))}}}function f(a){return{type:a.type+"?",match:function(b){return void 0===b||null===b||a.match(b)}}}c.oq=b;c.BB=d;c.Uf={type:"any",match:function(a){return"undefined"!==typeof a}};
c.Sj=e;c.Ub=f;c.Hb=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var c=0;c<a.length;c++)b.push(a[c].type);return{type:"("+b.join("|")+")",match:function(b){for(var c=0;c<a.length;c++)if(!0===a[c].match(b))return!0;return!1}}};c.Wf=function(a,b){return{type:a,match:function(a){if("object"!==typeof a)return!1;for(var c in b)if(!b[c].match(a[c]))return"The "+c+" member should be a "+b[c].type+", not "+Mg(a[c]);return!0}}};c.Bm=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=
arguments[b];return{type:"("+a.join("|")+")",match:function(b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1}}};c.xB=f(c.Uf);c.bi=d(null);c.String=a("string");c.Zc=f(c.String);c.Number={type:"number",match:function(a){return"number"===typeof a&&isFinite(a)?!0:a+" is not a number."}};c.fb=f(c.Number);c.qq=e(c.Number);c.Function=a("function");c.di=f(c.Function);c.Boolean=a("boolean");c.Nd=f(c.Boolean);c.HTMLElement=b(Jg);c.Object=b(Kg);c.Od=f(c.Object);c.wB=e(c.Object);c.uc={type:"integer",
match:function(a){return"number"===typeof a&&(a|0)===a?!0:a+" is not a whole number."}};c.Uj=f(c.uc);c.vu=e(c.uc);c.ha=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];for(d=0;d<c.length;d++){var e=c[d],f=b[d],h=e.match(f);if(!0!==h)throw console.log("arguments: ",b),Error("Error calling "+a+": "+Ng(d+1)+" argument is '"+Mg(f)+"' but expected '"+e.type+"'. "+(!1===h?"":h)+"'");}}})(Lg||(Lg={}));
function Ng(c){switch(c%10){case 1:return c+"st";case 2:return c+"nd";case 3:return c+"rd"}return c+"th"}function Mg(c){return c instanceof Array?c.length?Mg(c[0])+"[]":"Array":typeof c}var R=Lg;var S=u.create("CONTEXT");function Og(c){return c instanceof Array?c:[c]}
var T=R.String,Pg=R.Ub(T),Qg=R.Hb(T,R.Sj(T)),Rg=R.Ub(Qg),Sg=R.Wf("ExternalRect",{x:R.Number,y:R.Number,width:R.Number,height:R.Number}),Tg=R.Wf("CanvasRenderingContext2D",{moveTo:R.Function}),X=function(){function c(a,b,c){var d=this;this.gb={};this.un={};this.vo=null;this.ah={};this.pc=this.nh=null;this.lh=!1;this.Rk=new Za;this.Gr=new $a;this.globals={};this.sy=new hc(this);this.Ic=Fg(5);this.wg=null;this.ctx=this;this.Rq=!1;this.ap=0;this.Eh=null;this.ir="";this.ea=new Dg(this,a,b,c||this);this.Ys();
var f=this;Q.Yi.push(this);this.ea.ya.add(function(){S("Running ZwibblerContext destructor");d.hm();delete a.zwibbler;delete f.gb;delete f.ea;delete f.nh;for(var b=Q.Yi,c=0;c<b.length;c++)if(b[c]===f){b.splice(c,1);break}d.pc&&d.pc.stop()});this.pa("document-changed",function(a){d.summary=d.Mi();a.remote||d.sa("local-changes")});this.ea.ga.pa("latency",function(a){d.pc&&d.pc.Yz(a)});this.ea.ga.pa("broadcastMouse",function(a){d.sy.Lt(a,d.Ic)});this.Ku();this.pa("selected-nodes",function(){d.summary=
d.Mi()});this.pa("tool-changed",function(){d.summary=d.Mi()});this.summary=this.Mi();this.Xj(Gg,"left","showToolbar");this.Xj(Hg,"right","showPageSelector");this.Xj(Ig,"right","showPropertyPanel");this.Xj(fc,"bottom","showColourPanel")}c.prototype.Mm=function(a,b){R.ha("addKeyboardShortcut",arguments,R.String,R.Function);this.ea.Mm(a,b)};c.prototype.Zf=function(a,b){void 0===b&&(b=!1);R.ha("addRemoteChanges",arguments,R.String,R.Nd);S("Add remote changes: %s reset=%s",a,b);b&&this.ea.Og(new Ag(!0,
this.ea.Oe(),this.ea.Mh));try{this.ea.view.aa.nb.Zf(a),0===this.jb()&&(S("After commit there are 0 pages. Create one!"),this.$a(),this.Xi(0),this.wa(!0))}catch(d){throw console.log(this.ea.view.aa.toString()),console.log(a),console.log(this.ea.view.aa.nb.toString()),b||this.sa("session-error",d),d;}};c.prototype.Kc=function(a,b){R.ha("attach",arguments,R.Object,R.HTMLElement);P.Kc(a,b);P.digest();this.ea.ya.add(function(){S("DESTROYING A PANEL");P.detach(b)});if(!this.Rq&&a instanceof c||a.ctx instanceof
c)this.Rq=!0,this.pa("tool-changed",function(){return P.digest()}),this.ea.ga.pa("update",function(){return P.digest()}),this.pa("document-changed",function(){return P.digest()}),this.pa("selected-nodes",function(){return P.digest()});this.resize()};c.prototype.digest=function(a){R.ha("digest",arguments,R.di);P.digest(a)};c.prototype.Nu=function(){this.Sa("abortTransaction is not implemented. Please contact support.")};c.prototype.ud=function(a,b,c,e,f,h){R.ha("addSelectionHandle",arguments,R.Number,
R.Number,R.Number,R.Number,R.String,R.Hb(R.Function,R.String));switch(h){case "scale":case "rotate":case "translate":var d=h;break;default:if("function"===typeof h){d="click";var l=h}else{this.Sa('addSelectionHandle: action must be "scale", "rotate", "translate", or a function');return}}this.ea.view.ud(a,b,c,e,f,d,l)};c.prototype.hk=function(a,b){R.ha("addToParent",arguments,Qg);var c=this.ea.view.aa.Oa(a);if(c)if(c instanceof xf){var e=Og(b);this.Ae(function(a){a.hk(c.id,e)})}else S("parent is not a group");
else S("addToGroup: Bad node id")};c.prototype.Nm=function(a){R.ha("addToLanguage",arguments,R.String);this.ea.language.Nm(a)};c.prototype.Wu=function(a,b){R.ha("addPage",arguments,R.fb,R.fb);return this.xa()?this.oe():this.Xi(this.jb(),a,b)||0};c.prototype.gi=function(a,b,c){R.ha("addPanel",arguments,R.Number,R.String,R.HTMLElement);this.ea.gi(a,b,c)};c.prototype.bv=function(a,b){function c(a){return e?{start:a.x,length:a.width}:{start:a.y,length:a.height}}void 0===b&&(b=this.Bc());R.ha("alignNodes",
arguments,R.Bm("top","middle","bottom","centre","left","right"),Rg);var e=!0;switch(a){case "top":case "middle":case "bottom":e=!1;break;case "center":a="centre"}switch(a){case "top":case "left":a="start";break;case "middle":case "centre":a="centre";break;case "right":case "bottom":a="end";break;default:this.Sa("Expected left|right|centre|top|middle|bottom but got '"+a+"'")}this.$a();var f=c(this.Un(b)),h=f.start;f=f.length;for(var k=0,l=b;k<l.length;k++){var n=l[k],q=c(this.Un(n)),v=0;switch(a){case "start":v=
h-q.start;break;case "end":v=h+f-q.start-q.length;break;case "centre":v=h+f/2-q.start-q.length/2}e?this.Tg(n,v,0):this.Tg(n,0,v)}this.wa()};c.prototype.kv=function(a,b){R.ha("autoScroll",arguments,R.Number,R.Number);this.ea.view.scrollIntoView(a,b)};c.prototype.$a=function(){this.ea.view.aa.$a()};c.prototype.nk=function(){this.$a()};c.prototype.rv=function(a){void 0===a&&(a=this.Bc());R.ha("bringToFront",arguments,Rg);this.xa()||this.ea.view.xd(0,Og(a))};c.prototype.ip=function(a){R.ha("sendBroadcast",
arguments,R.String);this.pc&&this.pc.ip(a)};c.prototype.tp=function(a,b,c){R.ha("setSessionKey",arguments,R.String,R.Uf,R.Boolean);this.pc&&this.pc.Xz(a,b,c)};c.prototype.Ee=function(){return this.xa()?!1:this.ea.view.aa.Ee()};c.prototype.Fe=function(){return this.xa()?!1:this.ea.view.aa.Fe()};c.prototype.lb=function(){this.ea.view.lb();this.ea.view.fc();this.ea.view.la()};c.prototype.Dv=function(){this.ea.Zm()};c.prototype.Ev=function(a,b){R.ha("clickColour",arguments,R.String,R.Boolean);if(this.xa())return!1;
this.Oh(a,!b)};c.prototype.wa=function(a){void 0===a&&(a=!1);R.ha("commit",arguments,R.Nd);this.ea.view.aa.wa(a)};c.prototype.Iv=function(){this.wa(!0)};c.prototype.wk=function(){this.wa(!1)};c.prototype.cg=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=this.Bc());R.ha("copy",arguments,R.Nd,Rg);return this.ea.view.cg(a,Og(b))};c.prototype.Uv=function(a,b){R.ha("createDataNode",arguments,R.Object,Pg);return this.createNode("DataNode",a,b)};c.prototype.Vv=function(a){R.ha("createGroup",arguments,R.Sj(T));
if(this.xa())return!1;var b;this.Ae(function(c){b=c.group(Og(a))});return b};c.prototype.dc=function(a){void 0===a&&(a={});var b={};if(a instanceof Array)return a.concat();if(!(a instanceof Object))return a;for(var c in a)if(a.hasOwnProperty(c)){var e=a[c];e=Ug(c,e);b[c]=e}return b};c.prototype.Xv=function(a){R.ha("createLogger",arguments,R.String);return u.create(a)};c.prototype.createNode=function(a,b,c,e){R.ha("createNode",arguments,R.String,R.Object,Pg,R.fb);S("createNode(%s)",a);jf(a)||this.Sa("createNode: node type must be string");
var d=this.dc(b);return c?this.ea.createNode(a,d,c,e):this.ea.createNode(a,d)};c.prototype.Wv=function(a,b,c,e){void 0===b&&(b={});R.ha("createHTMLNode",arguments,R.String,R.Od,Pg,R.Uj);if(!Q.Ie[a])throw Error("Component "+a+" not registered");var d=Q.Ie[a].defaults;if(d)for(var h in d)h in b||(b[h]=d[h]);b.$component=a;return this.createNode("HTMLNode",b,c,e)};c.prototype.Bk=function(a){R.ha("createPath",arguments,R.qq);return this.ea.Bk(a)};c.prototype.Xj=function(a,b,c){var d=this,f;this.ea.ga.pa(c,
function(c){c?(f||(a.style&&Q.Cf(a.style),c=document.createElement("div"),c.innerHTML=a.ul,f=c.firstChild,d.Kc(d,f),a.controller&&a.controller(d)),d.ea.gi(1,b,f)):f&&d.ea.wj(f)})};c.prototype.aw=function(a,b){R.ha("createToolbar",arguments,R.Hb(R.String,R.HTMLElement),R.Sj(R.Wf("ToolbarItem",{toolName:R.Zc,onclick:R.di,title:R.Zc,background:R.Zc,image:R.Zc,html:R.Zc})));var c=A.ic(a);if(c){"object"===typeof b&&"[object Array]"===Object.prototype.toString.apply(b)||this.Sa("createToolbar: second parameter must be array");
Q.Cf("a.zwibbler-button {\n            background-repeat: no-repeat;\n            background-position: center;\n            display: inline-block;\n            overflow: hidden;\n        }");for(var e=this,f=function(a,b){b.addEventListener("click",function(b){a.onclick.call(this,e,b)})},h=0;h<b.length;h++){var k=b[h],l=A("a").Qd("zwibbler-button").da;l.setAttribute("href","javascript:void(0)");k.toolName&&A(l).Qd(k.toolName);k.onclick&&f(k,l);k.title&&l.setAttribute("title",k.title);k.background?
l.style.background=k.background:k.image&&(l.style.backgroundImage="url("+k.image+")");k.html&&(l.innerHTML=k.html);c.appendChild(l)}var n;this.pa("tool-changed",function(a){n&&n.classList.remove("zwibbler-selected");(n=c.querySelector("."+a))&&n.classList.add("zwibbler-selected")})}else this.Sa("createToolbar: Could not convert first parameter to an HTML element")};c.prototype.dn=function(a){R.ha("createShape",arguments,R.qq);if(!this.ea.dn(a))return this.Sa("createShape needs an array of at least 6 numbers"),
null};c.prototype.gn=function(){if(this.xa())return!1;var a=this.ea.view.cg(!1,this.ea.view.ld(!0));this.sr();return a};c.prototype.Ta=function(){if(!this.lh){this.Pc("destroy");this.ea.Ta();this.Rk.Ta();this.Gr.Ta();for(var a in this)this.hasOwnProperty(a)&&delete this[a];this.lh=!0}};c.prototype.Ae=function(a){this.ea.view.aa.transaction(a)};c.prototype.Ke=function(a){this.wc(a)};c.prototype.Fu=function(a){for(var b=0;b<a.length;b++)this.ea.view.aa.Oa(a[b],!1)||(a.splice(b,1),--b);return 0<a.length};
c.prototype.wc=function(a){void 0===a&&(a=this.Bc());R.ha("deleteNodes",arguments,Rg);if(this.xa())return!1;S("deleteNodes()");var b=Og(a);this.Fu(b)&&this.Ae(function(a){return a.wc(b)})};c.prototype.bw=function(a){var b=this;void 0===a&&(a=this.oe());R.ha("deletePage",arguments,R.Uj);if(this.xa())return!1;(0>a||a>=this.jb())&&this.Sa("deletePage: Asked to delete "+a+" but there are only "+this.jb()+" pages");if(1===this.jb())this.Ae(function(a){return a.wc(Og(b.An()))});else{var c=this.ea.view.aa.Ne(a).id;
this.Ae(function(a){return a.wc([c])})}};c.prototype.sr=function(){if(this.xa())return!1;this.ea.view.wi()};c.prototype.uf=function(){1===arguments.length&&!1===arguments[0]&&this.ea.view.aa.Fs();return this.ea.view.aa.uf()};c.prototype.dispatchEvent=function(a){R.ha("dispatchEvent",arguments,R.oq(Event));S("dispatchEvent(%s)",a.type);return(a.target||this.ea.Rd).dispatchEvent(a)};c.prototype.wo=function(a,b){var c=this;R.ha("mouseEvent",arguments,R.String,R.Object);if("click"===a){var e=this.wo("down",
b);return e=e||this.wo("up",b)}var f={clientX:(b.pageX||0)-(document.documentElement.scrollLeft+document.body.scrollLeft),clientY:(b.pageY||0)-(document.documentElement.scrollTop+document.body.scrollTop),bubbles:!0,cancelable:!0,buttons:b.buttons};try{e="onpointerdown"in window&&!("ontouchstart"in window)?new PointerEvent("pointer"+a,f):new MouseEvent("mouse"+a,f)}catch(h){return e=document.createEvent("MouseEvent"),e.initMouseEvent("mouse"+a,f.bubbles||!1,f.cancelable||!1,window,0,f.screenX||0,f.screenY||
0,f.clientX||0,f.clientY||0,f.ctrlKey||!1,f.altKey||!1,f.shiftKey||!1,f.metaKey||!1,f.button||0,f.relatedTarget||null),Object.defineProperty(e,"buttons",{get:function(){return f.buttons}}),Object.defineProperty(e,"target",{get:function(){return b.target||c.ea.Rd}}),this.ea.view.au.handleEvent(e),!e.defaultPrevented}return this.dispatchEvent(e)};c.prototype.download=function(a,b,c,e){void 0===e&&(e=0);R.ha("download",arguments,R.String,R.String,R.Ub(Sg),R.fb);"jpeg"===a&&(a="jpg");if("pdf"===a||"svg"===
a||"png"===a||"jpg"===a||"bmp"===a||"zwibbler3"===a){var d="zwibbler3"===a?Bg.Vj(this.ea.view.aa,a,"data-uri"):this.save(a,c,e);this.Gr.Dz(d,b)}else S("unsupported format for download: %s",a)};c.prototype.la=function(a,b){void 0===b&&(b={});R.ha("draw",arguments,Tg,R.Ub(R.Wf("DrawOptions",{page:R.Uj})));var c=b.page||0,e=this.ea.view.aa.ab;var f="page"in b?this.Vn(c):this.rh();this.ea.view.aa.Fc(c);this.ea.view.Le(a,f.x,f.y,f.width,f.height);this.ea.view.aa.la(a);this.ea.view.aa.Fc(e)};c.prototype.pw=
function(a){R.ha("editNodeText",arguments,T);if(this.xa())return!1;var b=this.ea.view.aa.ob(a,!1);if(b)if(b.qg()){var c=this.ea.view.Lp({});c&&c.Ep(b,b.rect.x,b.rect.y)}else S("editNodeText: node %s (%s) cannot contain text.",a,b.type());else S("editNodeText: ExtNodeID %s does not exist.",a)};c.prototype.duplicate=function(){if(this.xa())return!1;this.ea.view.duplicate()};c.prototype.Gm=function(a,b,c){var d=this;if(!(this.lh||this.un[a]||this.Iu(a))){var f=function(){if(!d.lh){d.un[a]=!1;if(a in
d.gb)for(var c=0,e=d.gb[a];c<e.length;c++){var f=e[c];try{var n=f.apply(null,b)}catch(q){console.log("Error in handler for '"+a+"':",q)}}d.digest();return n}};"once"===c&&(this.un[a]=!0);if("now"===c)return f();setTimeout(f,0);return this}};c.prototype.sa=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];R.ha("emit",arguments,R.String);return this.Gm(a,b,"normal")};c.prototype.Pc=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Gm(a,b,"now")};
c.prototype.oh=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Gm(a,b,"once")};c.prototype.pA=function(a){R.ha("skipEvent",arguments,R.String);this.ah[a]=a in this.ah?this.ah[a]+1:1};c.prototype.Iu=function(a){return a in this.ah&&0<this.ah[a]?(S("Skipped %s event",a),--this.ah[a],!0):!1};c.prototype.focus=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=null);R.ha("focus",arguments,R.Nd,R.Ub(R.HTMLElement));this.ea.dA(b);a?this.ea.vp("text"===this.qh()):this.ea.focus()};
c.prototype.blur=function(){this.ea.blur()};c.prototype.Fw=function(a){function b(b){return a(b.id)}R.ha("forEachNode",arguments,R.Function);this.ea.view.aa.Nk(b,this.ea.view.aa.Oa(this.ea.view.aa.root.id),!0);for(var c=0,e=this.ea.view.aa.Di;c<e.length;c++)this.ea.view.aa.Nk(b,e[c],!0)};c.prototype.Bw=function(a){R.ha("findNode",arguments,R.String);var b=this.Ir(a);return b.length?b[0]:null};c.prototype.Ir=function(a){R.ha("findNodes",arguments,R.String);for(var b=this.ea.view.aa.Cw(a),c=[],e=0;e<
b.length;e++)c.push(b[e].id);return c};c.prototype.Dw=function(a,b,c){R.ha("flip",arguments,R.Number,R.fb,R.fb);if(this.xa())return!1;if(3===arguments.length)if("number"!==typeof b||"number"!==typeof c)this.Sa("flip: 2nd and 3rd args must be numbers.");else{var d=new D(b,c);this.ea.view.Mr(a/180*Math.PI,d)}else this.ea.view.Mr(a/180*Math.PI)};c.prototype.Ei=function(a,b,c,e){R.ha("flipNodes",arguments,R.Sj(T),R.Number,R.fb,R.fb);if(this.xa())return!1;var d=this.Lq(Og(a));if("number"===typeof c&&"number"===
typeof e){var h=new D(c,e);this.ea.view.Ei(d,b/180*Math.PI,h)}else this.ea.view.Ei(d,b/180*Math.PI)};c.prototype.Rr=function(a,b,c){var d=this;void 0===c&&(c={});R.ha("generatePalette",arguments,R.Hb(R.String,R.HTMLElement),R.Number,R.Ub(R.Wf("Options",{onColour:R.di,onOpacity:R.di})));c.onColour=c.onColour||c.onColor||function(a,b){d.Oh(a,b)};c.onOpacity=c.onOpacity||function(a,b){d.Pt(a,b)};return bg(a,b,c)};c.prototype.zn=function(){return this.ea.view.Lw()};c.prototype.An=function(){var a=[];
this.ea.view.aa.gc(function(b){a.push(b.id)},this.oe());return a};c.prototype.Qw=function(){return this.ea.Rw()};c.prototype.Bn=function(a){R.ha("getBoundingRectangle",arguments,Qg);return this.Xf(this.ea.view.Bn(Og(a)))};c.prototype.kd=function(a){R.ha("getConfig",arguments,R.String);return this.ea.ga.get(a)};c.prototype.oe=function(){return this.ea.view.aa.ab};c.prototype.Ww=function(){return this.ea.view.bl()};c.prototype.Xw=function(){return this.ea.view.jl()};c.prototype.qh=function(){return this.ea.view.qh()};
c.prototype.Yw=function(a){R.ha("getCustomNode",arguments,T);var b=this.ea.view.aa.Oa(a),c=null;b&&"CustomNode"===b.type()&&(c=b.eb);return c};c.prototype.Zk=function(a,b,c,e){void 0===c&&(c=0);void 0===e&&(e=0);R.ha("getDocumentCoordinates",arguments,R.Number,R.Number,R.fb,R.fb);var d=this.ea.view.Jd(a,b),h=this.Cn();return{x:d.x,y:d.y,width:c/h,height:e/h}};c.prototype.bx=function(a){R.ha("getDocumentProperty",arguments,R.String);return this.ea.view.aa.ja(a)};c.prototype.rh=function(a){void 0===
a&&(a=this.oe());R.ha("getDocumentSize",arguments,R.Uj);var b;this.kd("pageView")&&(b=Cg);return this.Xf(this.ea.view.aa.kc(a,b))};c.prototype.ic=function(){return this.ea.Oe()};c.prototype.bl=function(){return this.ea.view.bl()};c.prototype.ox=function(){for(var a=[],b=0,c=this.ea.view.aa.Xn();b<c.length;b++){var e=c[b];a.push({cid:e.zv,ts:e.Ab})}return a};c.prototype.Mn=function(a){R.ha("getImageUrl",arguments,R.String);return this.ea.ga.Mn(a)};c.prototype.tx=function(a){R.ha("getLanguageString",
arguments,R.String);return this.ea.language.get(a)};c.prototype.Qn=function(){var a=this.ea.view.aa.nb.Sw();if(!a.empty())return this.wg=a,a.toString();this.wg=null;return""};c.prototype.Xf=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.$j=function(a){"object"!==typeof a&&this.Sa("Error: Rectangle object expected.");a=new F(a.x||0,a.y||0,a.width||0,a.height||0);a.wt();return a};c.prototype.fx=function(){return this.Xf(this.ea.view.aa.Tr())};c.prototype.mx=function(a){R.ha("getGroupParent",
arguments,T);var b=this.ea.view.aa.ob(a);return null===b?(S("getGroupParent: No such node %s",a),null):b.io()&&b.parent?b.parent.id:null};c.prototype.lx=function(a){R.ha("getGroupMembers",arguments,T);var b=[],c=this.ea.view.aa.Oa(a);if(!(c&&c instanceof xf))return S("getGroupMembers: Error node %s is not a group.",a),b;if(c.children){var e=0;for(c=c.children;e<c.length;e++)b.push(c[e].id)}return b};c.prototype.qx=function(a,b){return this.fl(a,b)};c.prototype.vx=function(){var a=[],b={};this.ea.view.aa.ed(!1,
function(d){!(c=d.jc())||c in b||(b[c]=1,a.push(c))});var c=this.zn();c in b||a.push(c);return a};c.prototype.ux=function(a){R.ha("getLayerNodes",arguments,R.String);var b=[];this.ea.view.aa.ed(!1,function(c){c.jc()===a&&b.push(c.id)});return b};c.prototype.wx=function(a,b,c){R.ha("getNodeCoordinates",arguments,T,R.Number,R.Number);var d=this.ea.view.aa.ob(a);if(null===d)return this.Sa("Error: node %s does not exist",a),null;d=this.ea.view.Dy(d,b,c);return{x:d.x,y:d.y}};c.prototype.Me=function(a){R.ha("getNodePageNumber",
arguments,T);return this.ea.view.aa.Me(a)};c.prototype.fl=function(a,b){R.ha("getNodeProperty",arguments,T,R.String);return this.ea.fl(a,b)};c.prototype.Un=function(a){R.ha("getNodeRectangle",arguments,Qg);for(var b=Og(a),c=null,e=0;e<b.length;e++){var f=b[e],h=this.ea.view.aa.ob(f);null===h?this.Sa("Error: node %s does not exist",f):(Wc(h)&&this.ea.view.aa.ko(h)?(f=A(h.da).Yb(),f=this.Zk(f.left,f.top,f.width,f.height),f=new F(f.x,f.y,f.width,f.height)):f=h.rect,c?c.Uh(f):c=f.clone())}c||(c=new F(0,
0,0,0));return this.Xf(c)};c.prototype.xx=function(a){R.ha("getNodeScale",arguments,T);var b=this.ea.view.aa.ob(a);if(null===b)return this.Sa("Error: node %s does not exist",a),null;b=b.Na().sb();return{x:b.x,y:b.y}};c.prototype.yx=function(a){R.ha("getNodeTransform",arguments,T);var b=this.ea.view.aa.ob(a);if(null===b)this.Sa("Error: node %s does not exist",a);else return b=b.Na(),[b.m11,b.m21,b.m12,b.m22,b.Ea,b.Fa]};c.prototype.zx=function(a){R.ha("getNodeType",arguments,T);var b=this.ea.view.aa.Oa(a),
c="";b&&(c=b.type(),"CustomNode"===c&&(c=b.ja("nodeType")));return c};c.prototype.Ax=function(a,b){R.ha("getNodeUnderPoint",arguments,R.Number,R.Number);var c=this.ea.view.aa.Db(a,b,this.ea.view.Lb);return c?c.id:this.ea.view.jt(a,b)&&(c=this.Bc(),c.length)?c[0]:null};c.prototype.Ex=function(a,b,c){void 0===c&&(c=0);R.ha("getNodesUnderPoint",arguments,R.Number,R.Number,R.fb);for(var d=[],f=0,h=this.ea.view.aa.Sx(a,b,c);f<h.length;f++)d.push(h[f].id);return d};c.prototype.jb=function(){return this.ea.view.aa.jb()};
c.prototype.Li=function(a){R.ha("getPageNode",arguments,R.uc);(0>a||a>this.jb())&&this.Sa("getPageNode: Invalid page number "+a+". Must be 0.."+this.jb());var b=this.ea.view.aa.Ne(a);return b?b.id:null};c.prototype.Vn=function(a){R.ha("getPageRect",arguments,R.uc);(0>a||a>=this.jb())&&this.Sa("getPageRect: Invalid page number "+a+". Must be 0.."+this.jb());var b=this.kd("pageView")?Cg:new rc(0,0);b=this.ea.view.aa.kc(a,b);return 0===b.width&&0===b.height?this.Zn():this.Xf(this.ea.view.aa.kc(a,Cg))};
c.prototype.hl=function(a){R.ha("getPathData",arguments,T);var b=this.ea.view.aa.ob(a,!1);if(!b||"PathNode"!==b.type())return null;var c=b.hl().clone().gf(),e=[];b.Na();for(b=0;b<c.length;b++){var f=c[b];e.push(f.x);e.push(f.y)}return e};c.prototype.Hx=function(a){R.ha("getPathAsPoints",arguments,T);var b=this.ea.view.aa.Oa(a,!1);if(!b||"PathNode"!==b.type())return null;b=b.hl();for(var c=[],e=[],f=0;f<b.fa.length;){switch(b.fa[f]){case Cc.Yc:e=[{x:b.fa[f+1],y:b.fa[f+2]}];c.push(e);break;case Cc.Xc:e.push({x:b.fa[f+
1],y:b.fa[f+2]})}f+=Cc.$c[b.fa[f]]}return c};c.prototype.Cn=function(){return this.ea.view.scale};c.prototype.Jn=function(){var a=this.ea.view.Jn();return a?a.id:null};c.prototype.ds=function(a,b,c,e){R.ha("getScreenCoordinates",arguments,R.Number,R.Number,R.fb,R.fb);var d=this.ea.view.mh(a,b);if(void 0===c||void 0===e)return{x:d.x,y:d.y};var h=this.ea.view.mh(a+c,b+e);return this.Xf(new F(d.x,d.y,h.x-d.x,h.y-d.y))};c.prototype.Jx=function(){return this.ea.view.je};c.prototype.jl=function(){return this.ea.view.jl()};
c.prototype.al=function(a,b){R.ha("getEditHandleType",arguments,T,R.uc);var c=this.ea.view.aa.ob(a,!1);return c&&c.se()?c.al(b):null};c.prototype.Rz=function(a,b,c){R.ha("setEditHandle",arguments,T,R.uc,R.String);var d=this.ea.view.aa.Oa(a,!1);if(!d)return S("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return S("setEditHandle: node %s is not a PathNode.",a),!1;d=d.ja("commands");d=J.Au(d,b,c);if(!d)return S("setEditHandle: failed"),!1;this.Ec(a,"commands",d);return!0};c.prototype.Bc=
function(a){void 0===a&&(a=!1);R.ha("getSelectedNodes",arguments,R.Nd);return this.ea.view.ld(a)};c.prototype.Mi=function(a){function b(a,b){var c=e.properties[a];void 0!==b&&(e.properties[a]=c!==b&&void 0!==c?null:b);e.empty=!1}function c(a){var c=a.type();e.types[c]=!0;e.types.AnyNode=!0;e.empty=!1;e.nodes.push(a.id);var d=a.wb();"PathNode"===c?(c=d.closed?"PathNode-closed":"PathNode-open",e.types[c]=!0):"HTMLNode"===c&&(e.types[d.$component]=!0);d=a.wb();"TextNode"===c&&(d["border-color"]=a.ja("border-color"),
d["border-width"]=a.ja("border-width"),d.background=a.ja("background")||"transparent",d.textFillStyle=a.ja("fillStyle"));for(var h in d)d.hasOwnProperty(h)&&"matrix"!==h&&("BrushNode"!==c||"fillStyle"!==h)&&("PathNode-open"!==c||"fontSize"!==h&&"fontName"!==h&&"fillStyle"!==h)&&("PathNode-closed"!==c||(f&&d.text||"fontSize"!==h&&"fontName"!==h)&&"arrowSize"!==h&&"arrowStyle"!==h)&&b(h,d[h])}void 0===a&&(a=this.Bc());R.ha("getPropertySummary",arguments,Rg);for(var e={properties:{},types:{},nodes:[],
empty:!0},f=this.ea.ga.get("allowTextInShape"),h=0;h<a.length;h++){var k=this.ea.view.aa.Oa(a[h],!1);k&&Uc(k)&&(c(k),this.ea.view.aa.Nk(c,k))}!e.nodes.length||"opacity"in e.properties||(e.properties.opacity=1);if(this.ea.view.qa.Qi){h=this.ea.view.qa.Qi();for(var l in h)b(l,h[l])}if(this.ea.view.qa.Yn)for(l=0,h=this.ea.view.qa.Yn();l<h.length;l++)e.types[h[l]]=!0;return e};c.prototype.Zn=function(){return this.Xf(this.ea.view.re())};c.prototype.Mx=function(a){R.ha("goToRevision",arguments,R.Hb(R.String,
R.bi));this.lp("readOnly",this.ea.view.aa.locked())};c.prototype.Sa=function(a){for(var b=1;b<arguments.length;b++);b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+1]));b=c.join("");S(b);console.log(b);throw Error(b);};c.prototype.Sy=function(a){R.ha("openFile",arguments,R.Ub(R.Wf("OpenFileArgs",{accept:R.Zc,format:R.Bm("text","data-uri","ArrayBuffer","File"),capture:R.Zc})));a||(a={});switch(a.format){case "ArrayBuffer":case void 0:case "File":case "data-uri":break;
default:throw Error("openFile: requested format not known. Check docs.");}return this.Rk.open({accept:a.accept,format:a.format||"data-uri",capture:a.capture}).then(function(a){return{data:a.data,contentType:a.contentType}})};c.prototype.Vx=function(){var a=this;if(this.xa())return!1;this.Rk.open({accept:"image/*",format:"data-uri"}).then(function(b){Q.Ln(b.data,function(c,e){var d=a.Zn();c=Math.min(d.width/c,d.height/e,1);a.$a();e=a.createNode("ImageNode",{url:b.data,allowCrop:!0});1!==c&&a.zj(e,
c,c);a.wa()})})};c.prototype.Xi=function(a,b,c){R.ha("insertPage",arguments,R.uc,R.fb,R.fb);if(this.xa())return this.oe();var d={background:this.kd("background")};kf(b)&&kf(c)&&(d.width=b,d.height=c);this.Ae(function(b){return b.createNode("PageNode",d,b.root.id,a)});return a};c.prototype.jo=function(a){R.ha("isLayerVisible",arguments,R.String);return this.ea.view.aa.jo(a)};c.prototype.xh=function(a){R.ha("isNodeSelected",arguments,T);var b=this.ea.view.aa.ob(a);return null!==b&&this.ea.view.xh(b)};
c.prototype.Re=function(a,b){R.ha("isPointOverCanvas",arguments,R.Number,R.Number);return this.ea.view.Re(a,b)};c.prototype.load=function(a,b){R.ha("load",arguments,R.String,R.Ub(R.Hb(R.String,R.Object)));void 0===b&&(b=a);var c=Bg.ci(b,this.ea.Oe(),this.ea.Mh);if(c)return this.hm(),this.ea.Og(c),!0;S("load(): Could not open file.");return!1};c.prototype.Cl=function(a){R.ha("lockUpdates",arguments,R.Number);var b=this;kf(a)?(this.vo&&clearTimeout(this.vo),this.vo=setTimeout(function(){b.ea.view.Cl(!1)},
a),b.ea.view.Cl(!0)):this.Sa("lockUpdates: Expected a number")};c.prototype.ej=function(a){R.ha("markChangesSent",arguments,R.String);if(this.wg||a){if(!this.wg||a!==this.wg.toString())throw Error("markChangesSent: does not match last getLocalChanges()");S("Mark changes sent!");this.ea.view.aa.nb.ej(this.wg.fy);this.wg=null}};c.prototype.ty=function(a){void 0===a&&(a=this.Bc());R.ha("moveDown",arguments,Rg);if(this.xa())return!1;this.ea.view.xd(3,Og(a))};c.prototype.uy=function(a,b){R.ha("movePage",
arguments,R.uc,R.uc);if(this.xa())return!1;if(kf(a)&&kf(b)){var c=this.jb();if(0>a||a>=c)this.Sa("From page must be > 0 and less than getPageCount()");else if(0>b||b>=c)this.Sa("From page must be > 0 and less than getPageCount()");else{var e=this.Li(a);null!==e&&this.Ae(function(a){return a.xd([e],4,b)})}}else this.Sa("movePage: needs two valid page numbers.")};c.prototype.vy=function(a){void 0===a&&(a=this.Bc());R.ha("moveUp",arguments,Rg);if(this.xa())return!1;this.ea.view.xd(2,Og(a))};c.prototype.zo=
function(){this.hm();this.ea.zo();this.Ys()};c.prototype.nextPage=function(){this.Ng(Math.min(this.oe()+1,this.jb()-1))};c.prototype.pa=function(a,b){R.ha("on",arguments,R.String,R.Function);"draw"===a?this.nh=b:a in this.gb?this.gb[a].push(b):this.gb[a]=[b];return this};c.prototype.Ly=function(a){R.ha("onComplete",arguments,R.Function);"function"===typeof a||this.Sa("Error: onComplete needs a function argument.");this.ea.view.Hw(a)};c.prototype.Ys=function(){var a=this.ea.ga.get("defaultPaperSize");
S("onNewDocument()");"none"!==a&&this.pp(a)};c.prototype.Ty=function(a){var b=this;R.ha("openFromComputer",arguments,R.String);return this.Rk.open({accept:"."+a,format:"text"}).then(function(a){if("string"===typeof a.data&&b.load(a.data))return b;throw Error("Could not open the file.");})};c.prototype.rj=function(a){R.ha("paste",arguments,R.Zc);if(this.xa())return!1;this.ea.view.rj(a)};c.prototype.ez=function(a){R.ha("pauseSharedSession",arguments,R.Boolean);this.pc&&this.pc.cA(a)};c.prototype.hz=
function(){this.Ng(Math.max(this.oe()-1,0))};c.prototype.print=function(a,b){R.ha("print",arguments,R.Ub(R.Hb(R.uc,R.vu)),R.Ub(Sg));var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=0;e<a.length;e++)if(kf(a[e]))c.push(a[e]);else{this.Sa("print(): pageSpec must be array of numbers");return}else if(!a)for(e=0;e<this.jb();e++)c.push(e);var f=b?this.$j(b):this.$j(this.rh());var h=this.oe(),k=document.createElement("canvas");k.width=f.width;k.height=f.height;var l=k.getContext("2d");
l.translate(-f.x,-f.y);e=window.location.hostname;var n=window.open("about:blank","_blank");n.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.Ng(c[e]),this.ea.view.Le(l,f.x,f.y,f.width,f.height),this.ea.view.aa.la(l),0<e?n.document.write("<div style='page-break-before:always'>"):n.document.write("<div>"),n.document.write("<img style='width:100%' src='"),n.document.write(k.toDataURL()),n.document.write("'></div>"),l.clearRect(f.x,f.y,f.width,
f.height);n.document.write("</body></html>");n.document.close();setTimeout(function(){n.focus();n.print();setTimeout(function(){n.close()},1E3)},1E3);this.Ng(h)};c.prototype.xa=function(){return this.ea.ga.get("readOnly")?(S("readOnly; ignore tool click."),!0):!1};c.prototype.ae=function(){this.ea.view.ae()};c.prototype.rd=function(a){R.ha("redraw",arguments,R.di);this.ea.view.la(a)};c.prototype.removeEventListener=function(a,b){R.ha("removeEventListener",arguments,R.String,R.Function);if(a in this.gb){for(var c=
this.gb[a],e=0;e<c.length;e++)if(c[e]===b){c.splice(e,1);break}0===c.length&&delete this.gb[a]}};c.prototype.removeListener=function(a,b){this.removeEventListener(a,b)};c.prototype.resize=function(){if(!this.ap){var a=this;a.ap=setTimeout(function(){a.lh||(a.ap=0,a.ea.ak())},0)}};c.prototype.save=function(a,b,c){void 0===a&&(a="zwibbler3");void 0===c&&(c=0);R.ha("save",arguments,R.Zc,R.Ub(Sg),R.fb);var d={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",svg:"image/svg+xml",pdf:"application/pdf"},
f=this.$j(b||this.rh());switch(a){case "list":return Bg.Vj(this.ea.view.aa,"list","object");case "png":case "jpeg":case "jpg":case "bmp":case "svg":case "pdf":return this.ea.Bt(d[a],f,c);case "zwibbler3":return Bg.Vj(this.ea.view.aa,"zwibbler3","string");case "image/png":case "image/jpeg":case "image/bmp":var h=this.ea.Bt(a,f,c);h=h.substr(h.indexOf(",")+1);d="";f=0;var k={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,
b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};for(h=h.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");f<h.length;){var l=k[h.charAt(f++)];var n=k[h.charAt(f++)];var q=k[h.charAt(f++)];var v=k[h.charAt(f++)];l=l<<2|n>>4;n=(n&15)<<4|q>>2;var x=(q&3)<<6|v;d+=String.fromCharCode(l);64!==q&&(d+=String.fromCharCode(n));64!==v&&(d+=String.fromCharCode(x))}return d;default:return"Unsupported format: "+
a}};c.prototype.oc=function(a){R.ha("setCursor",arguments,R.String);this.ea.view.oc(a)};c.prototype.be=function(a,b){R.ha("setToolProperty",arguments,R.String,R.Uf);if(this.xa())return!1;this.ea.view.be(a,Ug(a,b))};c.prototype.Lq=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.ea.view.aa.ob(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){R.ha("selectNodes",arguments,Qg);var b=this.Lq(Og(a));this.ea.view.selectNodes(b);this.ea.view.fc();this.ea.view.la()};c.prototype.Jz=
function(a){R.ha("sendToBack",arguments,Rg);if(this.xa())return!1;var b=Og(a||this.Bc());this.Ae(function(a){return a.xd(b,1)})};c.prototype.am=function(a){R.ha("setActiveLayer",arguments,R.String);this.ea.view.am(a)};c.prototype.lp=function(a,b){R.ha("setConfig",arguments,R.String,R.Uf);"defaultPaperSize"===a&&this.pp(b);return this.ea.ga.set(a,b)};c.prototype.Oh=function(a,b){R.ha("setColour",arguments,R.String,R.Boolean);if(this.xa())return!1;this.ea.view.Ky(a,b);return!1};c.prototype.Ng=function(a){R.ha("setCurrentPage",
arguments,R.uc);this.ea.view.Fc(a)};c.prototype.mp=function(a){R.ha("setCustomBackgroundFn",arguments,R.Function);this.ea.view.mp(a)};c.prototype.Pz=function(a,b){R.ha("setDocumentProperty",arguments,R.String,R.Uf);this.ea.view.aa.setProperty(a,b)};c.prototype.Ph=function(a,b){R.ha("setDocumentSize",arguments,R.Hb(R.Number,R.bi),R.Hb(R.Number,R.bi));this.ea.view.Ph(a,b,!0)};c.prototype.It=function(a,b){R.ha("setDocumentSizeInTransaction",arguments,R.Hb(R.Number,R.bi),R.Hb(R.Number,R.bi));this.ea.view.Ph(a,
b,!1)};c.prototype.Jt=function(a,b){R.ha("setDomElement",arguments,T,R.HTMLElement);var c=this.ea.view.aa.Oa(a);c?("DomNode"!==c.type()&&this.Sa("setDomElement: Node %s is not a DomNode. It is %s",a,c.type()),c.Sz(b),this.ea.Jk.push(b)):this.Sa("setDomElement: Node %s does not exist",a)};c.prototype.Qz=function(a,b){return this.Jt(a,b)};c.prototype.Ku=function(){var a=this;S("Setting up dragdrop");this.ea.ya.addEventListener(document,"dragover",function(b){a.ea.view.Re(b.pageX,b.pageY)?b.preventDefault():
S("Ignore drag event -- not over canvas")});this.ea.ya.addEventListener(document,"drop",function(b){b.preventDefault();if(!a.ea.view.Re(b.pageX,b.pageY))S("Ignore drop event -- not over canvas");else if(a.kd("readOnly"))S("Ignore drop event -- readOnly mode");else if(b.dataTransfer){if(b.dataTransfer.items)for(var c=0;c<b.dataTransfer.items.length;c++){if("file"===b.dataTransfer.items[c].kind){a.ea.view.Ro(b.dataTransfer.items[c],b.pageX,b.pageY);break}}else for(c=0;c<b.dataTransfer.files.length;){a.ea.view.Ro(b.dataTransfer.files[c],
b.pageX,b.pageY);break}try{var e=JSON.parse(b.dataTransfer.getData("text"))}catch(l){return}if("object"===typeof e&&e["zwibbler-src"]){var f=parseFloat(e["zwibbler-width"]),h=e["zwibbler-src"],k=e["zwibbler-props"];S("DragDrop received with src=%s size=%s",h,f);h&&Q.Ln(h,function(c,d){var e=1;f&&(e=f/c);var l=a.Zk(b.pageX,b.pageY);l.x-=c*e/2;l.y-=d*e/2;a.nk();k.url=h;c=a.createNode("ImageNode",k);a.zj(c,e,e);a.Tg(c,l.x,l.y);a.wk();a.gu()})}}})};c.prototype.ex=function(a){R.ha("getDomElement",arguments,
T);var b=this.ea.view.aa.Oa(a);return b?Vc(b)?b.da:(this.Sa("getDomElement: Node %s is not a DomNode. It is %s",a,b.type()),null):(this.Sa("getDomElement: Node %s does not exist",a),null)};c.prototype.$r=function(a){for(R.ha("getNodeFromElement",arguments,R.HTMLElement);a;){var b=a.getAttribute("nid");if(b)return b;a=a.parentElement}return null};c.prototype.Tn=function(a){R.ha("getNodeObject",arguments,T);var b=this.ea.view.aa.Oa(a);return b?b.Ni({ctx:this}):null};c.prototype.Zz=function(a,b){R.ha("setLayerName",
arguments,R.String,R.String);jf(a)&&jf(b)?(this.zn()===a&&this.am(b),this.ea.view.aa.ed(!1,function(c){c.jc()===a&&c.setProperty("layer",b)})):this.Sa("setLayerName() needs string arguments.")};c.prototype.aA=function(a,b){R.ha("setPageBackground",arguments,R.uc,R.String);var c=this.Li(a);c&&this.Ec(c,"background",b)};c.prototype.pp=function(a,b){R.ha("setPaperSize",arguments,R.Hb(R.Number,R.String),R.fb);var c=null,e=null,f=!0,h=!1;if(2===arguments.length)if(kf(arguments[0])&&kf(arguments[1])){var k=
arguments[0];c=arguments[1]}else jf(arguments[0])&&"boolean"===typeof arguments[1]?(e=arguments[0],h=arguments[1]):f=!1;else if(1===arguments.length&&jf(arguments[0]))for(var l=arguments[0].split(" "),n=0;n<l.length;n++)"landscape"===l[n]?h=!0:"portrait"===l[n]?h=!1:e=l[n];if(!1===f)return S("Bad arguments to setPaperSize()."),!1;if(null===e)return this.Ph(k,c),!0;switch(e.toLowerCase()){case "letter":k=816;c=1056;break;case "legal":k=816;c=1344;break;case "11x17":k=1056;c=1632;break;case "tabloid":k=
1056;c=1632;break;case "a0":k=841/25.4*96;c=1189/25.4*96;break;case "a1":k=594/25.4*96;c=841/25.4*96;break;case "a2":k=420/25.4*96;c=594/25.4*96;break;case "a3":k=297/25.4*96;c=420/25.4*96;break;case "a4":k=210/25.4*96;c=297/25.4*96;break;case "none":c=k=null;break;default:return S("Invalid paper size: %s",e),!1}h&&(e=k,k=c,c=e);this.Ph(k,c);return!0};c.prototype.Wz=function(a,b,c){this.Ec(a,b,c)};c.prototype.$b=function(a,b){R.ha("setNodeProperties",arguments,Qg,R.Object);if(this.xa())return!1;this.ea.$b(Og(a),
this.dc(b))};c.prototype.Ec=function(a,b,c){R.ha("setNodeProperty",arguments,Qg,R.String,R.Uf);if(this.xa())return!1;c=Ug(b,c);var d={};d[b]=c;this.$b(a,d)};c.prototype.$z=function(a,b){R.ha("setNodeVisibility",arguments,Qg,R.Boolean);for(var c=Og(a),e=0;e<c.length;e++){var f=this.ea.view.aa.ob(c[e],!0);if(f&&(f.Lf(!b),Vc(f))){var h=f.parent;Vc(h)&&h.Ej(h.ne(f),b)}}this.ea.view.la()};c.prototype.Pt=function(a,b){R.ha("setOpacity",arguments,R.Number,R.Boolean);if(this.xa())return!1;this.ea.view.Py(a,
b)};c.prototype.bA=function(a,b,c){R.ha("setPageSize",arguments,R.uc,R.Number,R.Number);kf(a)&&kf(b)&&kf(c)||this.Sa("setPageSize(): requires pageNo, width, height");var d=this.Li(a);d?this.$b(d,{width:b,height:c}):this.Sa("setPageSize: no such page %s",a)};c.prototype.op=function(a){R.ha("setPageView",arguments,R.Boolean);this.ea.view.op(a)};c.prototype.Gc=function(a){R.ha("setProperties",arguments,R.Object);if(!this.xa()){this.$b(this.Bc(),a);for(var b in a){var c=a[b];this.be(b,c);"lineWidth"===
b&&"brush"===this.qh()?this.lp("defaultBrushWidth",Ug(b,c)):this.ea.view.df(b,Ug(b,c))}}};c.prototype.setProperty=function(a,b){R.ha("setProperty",arguments,R.String,R.Uf);var c={};c[a]=b;this.Gc(c)};c.prototype.gA=function(a){R.ha("setViewRectangle",arguments,Sg);0!==a.width&&0!==a.height||this.Sa("setViewRect: width and height must be non-zero.");this.ea.view.Qg(this.$j(a))};c.prototype.ce=function(a,b,c){R.ha("setZoom",arguments,R.Hb(R.String,R.Number),R.fb,R.fb);if(kf(a)||"page"===a||"width"===
a)if(1===arguments.length)this.ea.view.ce(a);else if(3===arguments.length&&"number"===typeof a&&kf(b)&&kf(c)){var d=this.Cn()/a,f=this.ea.view.re();f.transform(new wc(d,d,b,c));this.ea.view.Qg(f)}else this.Sa("setZoom: invalid arguments.");else S("setZoom: invalid parameter.")};c.prototype.Fj=function(a,b){void 0===b&&(b=!0);R.ha("showLayer",arguments,R.String,R.Boolean);this.ea.view.Fj(a,b)};c.prototype.bb=function(a,b,c){R.ha("snap",arguments,R.Number,R.Number,R.fb);var d=this.ea.view.bb(new D(a,
b),c);return{x:d.x,y:d.y}};c.prototype.Hp=function(a){this.ea.view.Hp(a)};c.prototype.zl=function(){return Q.zl()};c.prototype.AA=function(){return this.ea.view.aa.toString()};c.prototype.Kj=function(a){R.ha("toggleFullScreen",arguments,R.Ub(R.Hb(R.String,R.HTMLElement)));a?(a=A.ic(a))||this.Sa("toggleFullScreen: can't find element from "+a):a=this.ic();a.style.backgroundColor="#ffffff";Q.Kj(a)};c.prototype.Tg=function(a,b,c){R.ha("translateNode",arguments,Qg,R.Number,R.Number);if(this.xa())return!1;
S("Translate node %s by %s,%s",a,b,c);return this.ea.Tg(Og(a),b,c)};c.prototype.wj=function(a){R.ha("removePanel",arguments,R.HTMLElement);this.ea.wj(a)};c.prototype.Vo=function(){this.ea.view.Vo()};c.prototype.Az=function(a){R.ha("rotateDocument",arguments,R.Number);if(this.xa())return!1;var b=0===Math.round(a/(Math.PI/2))%2;this.nk();for(var c=0;c<this.jb();c++)this.At(c,a);b||(b=this.ea.view.aa.ja("width"),c=this.ea.view.aa.ja("height"),b&&c||!this.kd("pageView")||(b=Cg.width,c=Cg.height),b&&c&&
this.It(c,b));this.wk()};c.prototype.zt=function(a,b,c,e){R.ha("rotateNode",arguments,Qg,R.Number,R.fb,R.fb);if(this.xa())return!1;S("Rotate nodes by %s around (%s,%s)",b/Math.PI*180,c,e);for(var d=4===arguments.length,h=Og(a),k=new D(0,0),l=0;l<h.length;l++){var n=h[l],q=this.ea.view.aa.ob(n);q&&(q||d)?!d&&q&&(n=q.rect.Sd(),k.x+=n.x,k.y+=n.y):S("rotateNode: Node %s does not exist",n)}d?(k.x=c,k.y=e):(k.x/=h.length,k.y/=h.length);d=new vc(b,k.x,k.y);return this.ea.transformNode(h,d)};c.prototype.At=
function(a,b){R.ha("rotatePage",arguments,R.uc,R.Number);a>=this.jb()&&this.Sa("rotatePage: page "+a+" does not exist.");if(!this.xa()){var c=Math.round(b/(Math.PI/2));b=c*Math.PI/2;var e=0===c%2;this.nk();c=this.oe();this.Ng(a);var f=this.An(),h=this.rh(),k=h.width/2,l=h.height/2;this.zt(f,b,k,l);e||this.Tg(f,l-k,k-l);e=this.Li(a);this.$b(e,{width:h.height,height:h.width});this.Ng(c);this.wk()}};c.prototype.zj=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);R.ha("scaleNode",arguments,Qg,
R.Number,R.Number,R.fb,R.fb);if(this.xa())return!1;S("Scale node %s by %s,%s",a,b,c);return this.ea.zj(Og(a),b,c,e,f)};c.prototype.np=function(a,b,c,e,f,h,k){R.ha("setNodeTransform",arguments,Qg,R.Number,R.Number,R.Number,R.Number,R.Number,R.Number);if(this.xa())return!1;S("setNodeTransform(id=%s %s %s %s %s %s %s %s)",a,b,c,e,f,h,k);return this.ea.np(Og(a),b,c,e,f,h,k)};c.prototype.Tt=function(a,b,c){var d=this;R.ha("showColourPicker",arguments,R.String,R.Number,R.Number);if(!this.Eh){var f=document.createElement("div");
f.style.width="320px";f.style.lineHeight="0";f.style.position="absolute";f.style.webkitUserSelect="none";f.style.userSelect="none";f.style.boxShadow="2px 2px 2px rgba(0,0,0.2)";f.style.background="white";this.ic().appendChild(f);var h=this;this.Rr(f,20,{onColour:function(a,b){for(var c=0,d=h.ir.split(",");c<d.length;c++){var e=d[c];if(""===e||"fillStyle"===e&&!b)e="strokeStyle";h.setProperty(e,a)}}});this.Eh=Q.Am(f);this.ea.ya.add(function(){d.Eh&&(d.Eh.destroy(),A(f).remove(),d.Eh=null)})}this.ir=
a;this.Eh.show(b,c,!0)};c.prototype.$v=function(a){void 0===a&&(a=Fg(32));R.ha("createSharedSession",arguments,R.Zc);S("Creating shared session "+a);this.Eq(a,2);return a};c.prototype.Eq=function(a,b){var c=this;S("Attach to shared session %s, creating=%s",a,b);this.pc&&this.pc.stop();this.ea.view.aa.nb.vz();return new Promise(function(d,f){var e=c.ea.ga.get("collaborationServer");"custom"!==e?(e=new Zb(c,e.replace("{name}",a),c.kd("latency")),c.pc=e,e.pa("connected",function(){c.sa("connected");
c.digest()}),e.pa("connect-error",function(){c.sa("connect-error");c.digest()}),e.pa("broadcast",function(a){c.sa("broadcast",a);c.digest()}),e.pa("set-keys",function(a){c.sa("set-keys",a)}),e.start(a,b).then(function(){S("Session resolved");d(a)},function(a){S("Error joining session: %s",a.message);f(a)})):d(a);return a})};c.prototype.by=function(a,b){void 0===a&&(a="");void 0===b&&(b=!1);R.ha("joinSharedSession",arguments,R.Zc,R.Nd);return this.Eq(a,b?0:1).then(function(){S("Successfully connected to session.")},
function(a){console.log("Error connecting to session:",a);throw a;})};c.prototype.hm=function(){this.Bs()};c.prototype.Bs=function(){this.pc&&(this.pc.stop(),this.pc=null,this.sa("disconnected"))};c.prototype.Hc=function(){if(this.xa())return!1;this.ea.view.Hc()};c.prototype.Th=function(a){R.ha("ungroup",arguments,Qg);if(this.xa())return!1;this.Ae(function(b){b.Th(Og(a))})};c.prototype.upload=function(a,b){function c(){}function e(){}void 0===b&&(b="Working");R.ha("upload",arguments,R.oq(HTMLFormElement),
R.Zc);var f=this.ea.Zv(b),h=new XMLHttpRequest,k=new FormData(a);h.upload.addEventListener("progress",function(a){f.update(a.loaded/a.total)},!1);h.addEventListener("load",function(){200===h.status?(f.done(),e(h.response,h)):(f.error("Error"),c(h))},!1);h.addEventListener("error",function(){f.error("Error");c(h)},!1);h.addEventListener("abort",function(){f.error("Aborted");c(h)},!1);h.open(a.method,a.action);h.send(k);var l={success:function(a){e=a;return l},error:function(a){c=a;return l}};return l};
c.prototype.OA=function(a,b){void 0===b&&(b=!1);R.ha("useArrowTool",arguments,R.Od,R.Nd);if(this.xa())return!1;this.ea.view.gv(this.dc(a),b)};c.prototype.PA=function(a,b){R.ha("useBrushTool",arguments,R.Ub(R.Hb(R.String,R.Object)),R.fb);if(this.xa())return!1;2===arguments.length?this.ea.view.ln({lineWidth:b,strokeStyle:a}):1===arguments.length?this.ea.view.ln(this.dc(arguments[0])):this.ea.view.ln({})};c.prototype.QA=function(a){R.ha("useCircleTool",arguments,R.Od);if(this.xa())return!1;this.ea.view.pm(this.dc(a))};
c.prototype.RA=function(a){R.ha("useCurveTool",arguments,R.Od);if(this.xa())return!1;this.ea.view.mr(this.dc(a))};c.prototype.SA=function(a){R.ha("useCustomTool",arguments,R.Object);if(this.xa())return!1;if(lf(a)){var b=new Eg(this.ea.view,a);this.ea.view.Ya(b)}else this.Sa("useCustomTool(): requires an object as argument.")};c.prototype.Yp=function(a){R.ha("useEditHandleTool",arguments,T);if(this.xa())return!1;this.ea.view.Yp(a)};c.prototype.pm=function(a){void 0===a&&(a={});R.ha("useEllipseTool",
arguments,R.Od);if(this.xa())return!1;this.ea.view.pm(this.dc(a))};c.prototype.VA=function(a,b,c){void 0===c&&(c="freehand");R.ha("useFreehandTool",arguments,R.Hb(R.String,R.Object),R.fb,R.Zc);if(this.xa())return!1;if(lf(arguments[0])){var d=this.dc(arguments[0]);c=arguments[1]}else d={strokeStyle:a,lineWidth:b};this.ea.view.ur(d,c)};c.prototype.cB=function(a,b){void 0===b&&(b=!0);R.ha("useStampTool",arguments,R.Hb(R.String,R.Object),R.Nd);if(this.xa())return!1;var c=a;jf(a)?c={url:a}:"url"in c||
this.Sa("useStampTool: missing url in properties");this.ea.view.WA(c,1===arguments.length||!0===b)};c.prototype.XA=function(a,b){R.ha("useLineTool",arguments,R.Ub(R.Object),R.Ub(R.Hb(R.Boolean,R.Wf("LineToolOptions",{singleLine:R.Nd,orthogonal:R.Nd}))));if(this.xa())return!1;if(lf(b)){var c=b.singleLine;var e=b.orthogonal}else c=b;this.ea.view.Ds(this.dc(a),c,e)};c.prototype.YA=function(){this.ea.view.Xy()};c.prototype.gu=function(){this.ea.view.tb()};c.prototype.Zp=function(a,b,c,e){void 0===c&&
(c=1);void 0===e&&(e={});R.ha("usePolygonTool",arguments,R.uc,R.Number,R.fb,R.Od);if(this.xa())return!1;this.ea.view.Zp(a,b,c,this.dc(e))};c.prototype.ZA=function(a){void 0===a&&(a={});R.ha("useQuadraticBezierTool",arguments,R.Od);if(this.xa())return!1;this.ea.view.ur(this.dc(a),"quadratic")};c.prototype.Pj=function(a){void 0===a&&(a={});R.ha("useRectangleTool",arguments,R.Od);if(this.xa())return!1;this.ea.view.Pj(this.dc(a))};c.prototype.$A=function(a){void 0===a&&(a={});R.ha("useRoundRectTool",
arguments,R.Od);if(this.xa())return!1;this.ea.view.Pj(pc({roundRadius:this.ea.ga.get("defaultRoundRectRadius")},a))};c.prototype.aB=function(a,b){R.ha("useShapeBrushTool",arguments,R.Ub(R.Hb(R.Object,R.String)),R.fb);if(this.xa())return!1;var c={};lf(a)?c=this.dc(a):jf(a)&&(c.stokeStyle=a);kf(b)&&(c.lineWidth=b);this.ea.view.lw(c)};c.prototype.$p=function(a,b,c,e,f,h){void 0===f&&(f="rectangle-tl");void 0===h&&(h=null);R.ha("useShapeTool",arguments,R.String,R.Object,R.Number,R.Number,R.Ub(R.Bm("rectangle",
"circle","rectangle-tl")),R.Nd);if(this.xa())return!1;this.ea.view.$p(a,this.dc(b),c,e,f,h)};c.prototype.bB=function(a){R.ha("useSquareTool",arguments,R.Od);if(this.xa())return!1;this.ea.view.Pj(this.dc(a))};c.prototype.dB=function(a){R.ha("useTextTool",arguments,R.Od);if(this.xa())return!1;this.ea.view.Lp(this.dc(a))};c.prototype.tm=function(){this.ea.view.tm()};c.prototype.um=function(){this.ea.view.um()};return c}();
function Ug(c,a){switch(c){case "lineWidth":case "fontSize":case "arrowSize":case "arrowXOffset":case "brightness":case "contrast":case "cloudRadius":case "gamma":case "opacity":case "snap":case "zIndex":"string"===typeof a&&(a=parseFloat(a));break;case "matrix":"[object Array]"===Object.prototype.toString.apply(a)&&"Matrix"===a[0]?(a.splice(0,1),a=new I(a)):a instanceof I||(a=new I(a))}return a}X.prototype.addKeyboardShortcut=X.prototype.Mm;X.prototype.addRemoteChanges=X.prototype.Zf;
X.prototype.attach=X.prototype.Kc;X.prototype.abortTransaction=X.prototype.Nu;X.prototype.addSelectionHandle=X.prototype.ud;X.prototype.addToGroup=X.prototype.hk;X.prototype.addToLanguage=X.prototype.Nm;X.prototype.addPage=X.prototype.Wu;X.prototype.addPanel=X.prototype.gi;X.prototype.alignNodes=X.prototype.bv;X.prototype.autoScroll=X.prototype.kv;X.prototype.begin=X.prototype.$a;X.prototype.beginTransaction=X.prototype.nk;X.prototype.bringToFront=X.prototype.rv;X.prototype.sendBroadcast=X.prototype.ip;
X.prototype.setSessionKey=X.prototype.tp;X.prototype.canRedo=X.prototype.Ee;X.prototype.canUndo=X.prototype.Fe;X.prototype.clearSelection=X.prototype.lb;X.prototype.clearUndo=X.prototype.Dv;X.prototype.clickColour=X.prototype.Ev;X.prototype.commit=X.prototype.wa;X.prototype.commitIrreversibleTransaction=X.prototype.Iv;X.prototype.commitTransaction=X.prototype.wk;X.prototype.copy=X.prototype.cg;X.prototype.createDataNode=X.prototype.Uv;X.prototype.createGroup=X.prototype.Vv;
X.prototype.createLogger=X.prototype.Xv;X.prototype.createNode=X.prototype.createNode;X.prototype.createHTMLNode=X.prototype.Wv;X.prototype.createPath=X.prototype.Bk;X.prototype.createToolbar=X.prototype.aw;X.prototype.createShape=X.prototype.dn;X.prototype.cut=X.prototype.gn;X.prototype.destroy=X.prototype.Ta;X.prototype.deleteNode=X.prototype.Ke;X.prototype.deleteNodes=X.prototype.wc;X.prototype.deletePage=X.prototype.bw;X.prototype.deleteSelection=X.prototype.sr;X.prototype.dirty=X.prototype.uf;
X.prototype.dispatchEvent=X.prototype.dispatchEvent;X.prototype.mouseEvent=X.prototype.wo;X.prototype.download=X.prototype.download;X.prototype.draw=X.prototype.la;X.prototype.editNodeText=X.prototype.pw;X.prototype.duplicate=X.prototype.duplicate;X.prototype.emit=X.prototype.sa;X.prototype.emitNow=X.prototype.Pc;X.prototype.emitOnce=X.prototype.oh;X.prototype.skipEvent=X.prototype.pA;X.prototype.focus=X.prototype.focus;X.prototype.blur=X.prototype.blur;X.prototype.forEachNode=X.prototype.Fw;
X.prototype.findNode=X.prototype.Bw;X.prototype.findNodes=X.prototype.Ir;X.prototype.flip=X.prototype.Dw;X.prototype.flipNodes=X.prototype.Ei;X.prototype.generatePalette=X.prototype.Rr;X.prototype.getActiveLayer=X.prototype.zn;X.prototype.getAllNodes=X.prototype.An;X.prototype.getBackgroundImage=X.prototype.Qw;X.prototype.getBoundingRectangle=X.prototype.Bn;X.prototype.getConfig=X.prototype.kd;X.prototype.getCurrentPage=X.prototype.oe;X.prototype.getCurrentFillColour=X.prototype.Ww;
X.prototype.getCurrentOutlineColour=X.prototype.Xw;X.prototype.getCurrentTool=X.prototype.qh;X.prototype.getCustomNode=X.prototype.Yw;X.prototype.getDocumentCoordinates=X.prototype.Zk;X.prototype.getDocumentProperty=X.prototype.bx;X.prototype.getDocumentSize=X.prototype.rh;X.prototype.getElement=X.prototype.ic;X.prototype.getFillColour=X.prototype.bl;X.prototype.getHistory=X.prototype.ox;X.prototype.getImageUrl=X.prototype.Mn;X.prototype.getLanguageString=X.prototype.tx;
X.prototype.getLocalChanges=X.prototype.Qn;X.prototype.getDrawingRectangle=X.prototype.fx;X.prototype.getGroupParent=X.prototype.mx;X.prototype.getGroupMembers=X.prototype.lx;X.prototype.getItemProperty=X.prototype.qx;X.prototype.getLayers=X.prototype.vx;X.prototype.getLayerNodes=X.prototype.ux;X.prototype.getNodeCoordinates=X.prototype.wx;X.prototype.getNodePageNumber=X.prototype.Me;X.prototype.getNodeProperty=X.prototype.fl;X.prototype.getNodeRectangle=X.prototype.Un;X.prototype.getNodeScale=X.prototype.xx;
X.prototype.getNodeTransform=X.prototype.yx;X.prototype.getNodeType=X.prototype.zx;X.prototype.getNodeUnderPoint=X.prototype.Ax;X.prototype.getNodesUnderPoint=X.prototype.Ex;X.prototype.getPageCount=X.prototype.jb;X.prototype.getPageNode=X.prototype.Li;X.prototype.getPageRect=X.prototype.Vn;X.prototype.getPathData=X.prototype.hl;X.prototype.getPathAsPoints=X.prototype.Hx;X.prototype.getCanvasScale=X.prototype.Cn;X.prototype.getEditNode=X.prototype.Jn;X.prototype.getScreenCoordinates=X.prototype.ds;
X.prototype.getSelectedEditHandle=X.prototype.Jx;X.prototype.getStrokeColour=X.prototype.jl;X.prototype.getEditHandleType=X.prototype.al;X.prototype.setEditHandle=X.prototype.Rz;X.prototype.getSelectedNodes=X.prototype.Bc;X.prototype.getPropertySummary=X.prototype.Mi;X.prototype.getViewRectangle=X.prototype.Zn;X.prototype.goToRevision=X.prototype.Mx;X.prototype.openFile=X.prototype.Sy;X.prototype.insertImage=X.prototype.Vx;X.prototype.insertPage=X.prototype.Xi;X.prototype.isLayerVisible=X.prototype.jo;
X.prototype.isNodeSelected=X.prototype.xh;X.prototype.isPointOverCanvas=X.prototype.Re;X.prototype.load=X.prototype.load;X.prototype.lockUpdates=X.prototype.Cl;X.prototype.markChangesSent=X.prototype.ej;X.prototype.moveDown=X.prototype.ty;X.prototype.movePage=X.prototype.uy;X.prototype.moveUp=X.prototype.vy;X.prototype.newDocument=X.prototype.zo;X.prototype.nextPage=X.prototype.nextPage;X.prototype.on=X.prototype.pa;X.prototype.onComplete=X.prototype.Ly;X.prototype.openFromComputer=X.prototype.Ty;
X.prototype.paste=X.prototype.rj;X.prototype.pauseSharedSession=X.prototype.ez;X.prototype.previousPage=X.prototype.hz;X.prototype.print=X.prototype.print;X.prototype.redo=X.prototype.ae;X.prototype.redraw=X.prototype.rd;X.prototype.removeEventListener=X.prototype.removeEventListener;X.prototype.resize=X.prototype.resize;X.prototype.save=X.prototype.save;X.prototype.setCursor=X.prototype.oc;X.prototype.setToolProperty=X.prototype.be;X.prototype.selectNodes=X.prototype.selectNodes;
X.prototype.sendToBack=X.prototype.Jz;X.prototype.setActiveLayer=X.prototype.am;X.prototype.setConfig=X.prototype.lp;X.prototype.setColour=X.prototype.Oh;X.prototype.setCurrentPage=X.prototype.Ng;X.prototype.setCustomBackgroundFn=X.prototype.mp;X.prototype.setDocumentProperty=X.prototype.Pz;X.prototype.setDocumentSize=X.prototype.Ph;X.prototype.setDocumentSizeInTransaction=X.prototype.It;X.prototype.setDomElement=X.prototype.Jt;X.prototype.setDomNode=X.prototype.Qz;X.prototype.getDomElement=X.prototype.ex;
X.prototype.getNodeFromElement=X.prototype.$r;X.prototype.getNodeObject=X.prototype.Tn;X.prototype.setLayerName=X.prototype.Zz;X.prototype.setPageBackground=X.prototype.aA;X.prototype.setPaperSize=X.prototype.pp;X.prototype.setItemProperty=X.prototype.Wz;X.prototype.setNodeProperties=X.prototype.$b;X.prototype.setNodeProperty=X.prototype.Ec;X.prototype.setNodeVisibility=X.prototype.$z;X.prototype.setOpacity=X.prototype.Pt;X.prototype.setPageSize=X.prototype.bA;X.prototype.setPageView=X.prototype.op;
X.prototype.setProperties=X.prototype.Gc;X.prototype.setProperty=X.prototype.setProperty;X.prototype.setViewRectangle=X.prototype.gA;X.prototype.setZoom=X.prototype.ce;X.prototype.showLayer=X.prototype.Fj;X.prototype.snap=X.prototype.bb;X.prototype.stopEditingText=X.prototype.Hp;X.prototype.isFullscreenSupported=X.prototype.zl;X.prototype.toDebugString=X.prototype.AA;X.prototype.toggleFullscreen=X.prototype.Kj;X.prototype.translateNode=X.prototype.Tg;X.prototype.removePanel=X.prototype.wj;
X.prototype.removeSelectionHandles=X.prototype.Vo;X.prototype.rotateDocument=X.prototype.Az;X.prototype.rotateNode=X.prototype.zt;X.prototype.rotatePage=X.prototype.At;X.prototype.scaleNode=X.prototype.zj;X.prototype.setNodeTransform=X.prototype.np;X.prototype.showColourPicker=X.prototype.Tt;X.prototype.createSharedSession=X.prototype.$v;X.prototype.joinSharedSession=X.prototype.by;X.prototype.stopSharing=X.prototype.hm;X.prototype.leaveSharedSession=X.prototype.Bs;X.prototype.undo=X.prototype.Hc;
X.prototype.ungroup=X.prototype.Th;X.prototype.upload=X.prototype.upload;X.prototype.useArrowTool=X.prototype.OA;X.prototype.useBrushTool=X.prototype.PA;X.prototype.useCircleTool=X.prototype.QA;X.prototype.useCurveTool=X.prototype.RA;X.prototype.useCustomTool=X.prototype.SA;X.prototype.useEditHandleTool=X.prototype.Yp;X.prototype.useEllipseTool=X.prototype.pm;X.prototype.useFreehandTool=X.prototype.VA;X.prototype.useStampTool=X.prototype.cB;X.prototype.useLineTool=X.prototype.XA;
X.prototype.usePanTool=X.prototype.YA;X.prototype.usePickTool=X.prototype.gu;X.prototype.usePolygonTool=X.prototype.Zp;X.prototype.useQuadraticBezierTool=X.prototype.ZA;X.prototype.useRectangleTool=X.prototype.Pj;X.prototype.useRoundRectTool=X.prototype.$A;X.prototype.useShapeBrushTool=X.prototype.aB;X.prototype.useShapeTool=X.prototype.$p;X.prototype.useSquareTool=X.prototype.bB;X.prototype.useTextTool=X.prototype.dB;X.prototype.zoomIn=X.prototype.tm;X.prototype.zoomOut=X.prototype.um;var Vg=u.create("zeact");function Wg(c){"BUTTON"===c.tagName&&(c.getAttribute("type")||c.setAttribute("type","button"))}var P=tb.Vf();P.jk=function(c){c.showPopup=function(a,b){return Xg(c,a,b)};c.hidePopup=function(a){(a=Yg(c,a))&&a.fg&&a.fg.hide()}};
P.Ib("click",function(c,a,b,d){function e(b){var e="touchend"===b.type?b.changedTouches[0]:b;q&&(300<(new Date).getTime()-k||10<G(e.pageX,e.pageY,l,n))?pb("z-click=["+d+"] received "+b.type+", ignore due to lack of corresponding down"):(pb("z-click=["+d+"] received "+b.type),tb.tn(c,d,a,b,h),P.digest(),b.preventDefault())}function f(a){k=(new Date).getTime();a="touchstart"===a.type?a.changedTouches[0]:a;l=a.pageX;n=a.pageY}function h(a,b){a instanceof X&&0<=b.indexOf("Tool")&&(pb("Called %s",b),v=
!0);return a[b]}var k=0,l=0,n=0,q=!1;Wg(a);b="onpointerdown"in window;"ontouchstart"in window?(q=!0,P.Xa(a,"touchstart",f),P.Xa(a,"touchend",e)):b?(q=!0,P.Xa(a,"pointerup",e),P.Xa(a,"pointerdown",f)):(q=!0,P.Xa(a,"mouseup",e),P.Xa(a,"mousedown",f));var v;P.Xa(a,"keydown",function(b){b.target===a&&13===b.keyCode&&(q=v=!1,e(b),v&&c.ctx.focus(!0,a))})});
P.Ib("has",function(c,a,b,d){var e=a.style.display;b=[];var f=0;for(d=d.split("|");f<d.length;f++){var h=d[f];h=h.trim();b.push('("'+h+'" in ctx.summary.types || "'+h+'" in ctx.summary.properties)')}(b=b.join("||"))&&P.Jc(c,a,b,function(b){a.style.display=b?e:"none"})});
P.Ib("property",function(c,a,b,d){var e='ctx.summary.properties["'+d+'"]',f=a.getAttribute("z-value"),h=null!==a.getAttribute("z-colour");P.up(c,function(){P.Jc(c,a,e,function(b){"value"in a&&(a.value=b);null!==f&&A(a).Pp("selected",""+b===f);h&&(a.style.backgroundColor=b)})});"BUTTON"===a.tagName?(Wg(a),P.Xa(a,"click",function(){var b=a.getAttribute("z-value")||"";c.ctx.setProperty(d,b)})):P.Xa(a,"change",function(){var b=tb.gx(c,a);void 0!==b&&c.ctx.setProperty(d,b)})});
function Zg(c){c.hasOwnProperty("$popups")||(c.$popups={});return c.$popups}function Yg(c,a){for(;c;){if(c.$popups&&c.$popups[a])return c.$popups[a];c=c.$parent}}
P.Ib("popup",function(c,a,b,d){if(!a.hasAttribute("z-ignore-popup-hack")){var e=a.parentNode;if(!e)throw Error("z-popup: no parent node?!");var f=document.createComment("z-popup="+d);e.replaceChild(f,a);a.setAttribute("z-ignore-popup-hack","");var h=Zg(c);P.ya(e,function(){a.removeAttribute("z-ignore-popup-hack");e&&e.replaceChild(a,f);if(h[d]){console.log("Destroy popup %s",d);var b=h[d];b.fg&&b.fg.destroy();delete h[d]}});h[d]={da:a,fg:null}}});
function Xg(c,a,b){void 0===b&&(b={});var d=Yg(c,a);if(!d)throw Error("Popup "+a+" not found");Vg("show-popup "+a);var e=d.da;if(d.fg)Vg("Dialog %s already shown by another button",a);else{e=e.cloneNode(!0);b.parent&&b.parent.appendChild(e);b.clickToDismiss=b.clickToDismiss||e.getAttribute("z-click-dismiss");var f="none"!==b.clickToDismiss,h="string"===typeof b.clickToDismiss&&f;P.Kc(c,e);var k=ud(e,{overlayColour:b.overlay||"transparent"});d.fg=k;k.onhide=function(){if(b.onhide)b.onhide();Vg("Popup "+
a+" is hidden.");k&&(k.destroy(),d.fg=null,P.detach(e),A(e).remove())};c=b.showPosition||e.getAttribute("z-show-position")||"";if("centre"===c||"center"===c)k.show(void 0,void 0,h,f);else if(c&&b.refElement)k.show(b.refElement,c,h,f);else if("number"===typeof b.x&&"number"===typeof b.y)k.show(b.x,b.y,h,f);else throw Error("Invalid arguments to showPopup");}}
P.Ib("show-popup",function(c,a,b,d){Wg(a);P.Xa(a,"click",function(b){Xg(c,d,{refElement:a,showPosition:a.getAttribute("z-show-position"),x:b.pageX,y:b.pageY,parent:c.ctx?c.ctx.ic():document.body})})});P.Ib("colour",function(c,a,b){P.Xa(a,"click",function(d){c.ctx.Tt(a.getAttribute(b)||a.getAttribute("z-property")||"",d.pageX,d.pageY)})});
P.Ib("page",function(c,a,b,d){function e(){if(!(k>=f.jb())){var a=f.Vn(k),b=Math.min(l/a.width,n/a.height);1<b&&(b=1);h.width=a.width*b|0;h.height=a.height*b|0;q.save();q.translate(-a.x,-a.y);q.scale(b,b);q.fillStyle="white";q.fillRect(0,0,a.width,a.height);f.la(q,{page:k});q.restore()}}if(!a.qB){var f=c.ctx,h=document.createElement("canvas"),k=mb(c,d)||0,l=parseInt(a.getAttribute("z-width")||"1000000"),n=parseInt(a.getAttribute("z-height")||"1000000");h.style.backgroundColor="white";var q=h.getContext("2d");
for(b=0;b<a.attributes.length;b++)d=a.attributes[b],"z-page"!==d.name&&h.setAttribute(d.name,d.value);a.parentNode&&a.parentNode.replaceChild(h,a);e();var v=dg(100,e);f.pa("document-changed",e);f.pa("resource-loaded",e);f.pa("resize",v);P.ya(h,function(){f.removeEventListener("document-changed",e);f.removeEventListener("resource-loaded",e);f.removeEventListener("resize",v);v.cancel()});for(b=0;b<a.attributes.length;b++)h.setAttribute(a.attributes[b].name,a.attributes[b].value);h.qB=!0;return P.Kc(c,
h).node}},1);P.Ib("sort",function(c,a,b,d){Q.Cf(".zwibbler-sort-highlight { outline: 3px solid orange }");var e=db({parent:a,ar:"z-sortable",Ko:"zwibbler-sort-highlight",Oy:function(a,b){c.$from=a;c.$to=b;mb(c,d);P.digest()}});P.ya(a,function(){e()})});function $g(){pb("Document loaded.");Array.prototype.forEach.call(document.querySelectorAll("zwibbler,[zwibbler]"),function(c){ah(c,null,!1)})}function bh(c,a,b){A(c).matches(a)&&b(c);Array.prototype.forEach.call(c.querySelectorAll(a),b)}
function ah(c,a,b){if(!c.ei&&("ZWIBBLER"===c.tagName&&Q.Cf("zwibbler {display: block}"),b||null===c.getAttribute("z-no-auto-init"))){bh(c,"[z-component]",function(a){var b=a.getAttribute("z-component"),c=a.getAttribute("z-controller"),d=(a.getAttribute("z-properties")||"").split(/[ ,]+/);if(b){if(c&&!(c in Q.controllers)&&"function"!==typeof window.zcontroller)throw Error("While processing component: "+b+" could not find controller function "+c);Q.xk(b,{template:a,properties:d,controller:function(a){a.$parent.ctx&&
!a.ctx&&(a.ctx=a.$parent.ctx)}});a.parentNode.removeChild(a)}});var d,e={};for(b=0;b<c.attributes.length;b++){var f=c.attributes[b];Q.ks(f.name)&&(e[f.name]=f.value)}bh(c,"z-canvas,[z-canvas]",function(b){d=Q.create(b,e,a)});a||(a=d||{});a.$digest=function(a){if(a)P.digest(a);else return new Promise(function(a){P.digest(a)})};a.$watch=function(b,d){P.Jc(a,c,b,d)};a.$apply=function(b){if(b)return mb(a,b);P.digest()};P.jk(a);d?(a.ctx=d,d.Kc(a,c)):P.Kc(a,c);b=c.getAttribute("z-controller")||"";b in Q.controllers?
(pb("Running controller: %s",b),Q.controllers[b](a)):"function"===typeof window[b]?(pb("Running controller: %s",b),window[b](a)):b&&console.log("Controller not found: %s",b);P.digest();return a}}document.addEventListener("DOMContentLoaded",function(){$g()});
P.Ib("editable",function(c,a,b,d){function e(){var b=a.innerHTML;f=b;mb(c,d+"="+JSON.stringify(b));Vg("Text editor no longer selected. Blurring");k.exec("select-none");k.setActive(!1)}if(c.ctx){var f="";P.Jc(c,a,d,function(a){f!==a&&(f=a,k.Uz(a))});var h=new Ib,k=new Wf(h,a,{wp:!0,placeholder:a.getAttribute("placeholder")||""});P.ya(a,function(){h.Ta()});P.Xa(a,"focus",function(){Vg("Got text focus event");k.setActive(!0)});P.Xa(a,"click",function(){Vg("Clicked on text");k.setActive(!0)});P.Xa(a,
"blur",function(){Vg("Got text blur event")});k.pa("selchange",function(){});k.pa("enter",e);c.ctx.pa("selected-nodes",function(){!c.ctx.xh(c.id)&&k.active&&e()})}});P.de("clear-glyph",function(c,a,b){Vg("Drawing colour panel, width=%s tag=%s",JSON.stringify(a),c.tagName);"CANVAS"===c.tagName&&(c.width=a.width,c.height=a.width,"clear"===a.style?Zf(c.getContext("2d"),0,0,a.width):$f(c.getContext("2d"),0,0,a.width),b.resize())});var ch=u.create("HTMLNode");
function dh(c){return function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.da=null;b.children=[];b.Gb|=6;return b}__extends(b,a);b.prototype.Ua=function(){return this.children.length};b.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,1);Vc(b.node)&&b.node.da&&b.node.da.parentNode&&(b.node.da.parentNode?b.node.da.parentNode.removeChild(b.node.da):b.He.parentNode&&b.He.parentNode.removeChild(b.He));return b.node};
b.prototype.Bo=function(a){for(a+=1;a<this.children.length;a++){var b=this.children[a];if(Vc(b.node)&&b.node.da)return b.node.da.parentNode?b.node.da:b.He}return null};b.prototype.xl=function(a,b){this.children.splice(b,0,{node:a,He:document.createComment("node "+a.id)});this.da&&Vc(a)&&a.da&&this.Hu(a.da,this.Bo(b))};b.prototype.Hu=function(a,b){if(b){var c=b.parentNode;if(!c)for(var d=0,e=this.children;d<e.length;d++){var l=e[d];Vc(l.node)&&l.node.da===b&&(c=l.He.parentNode,b=l.He)}if(!c)throw Error("Could not find parent");
c.insertBefore(a,b)}else this.da&&(b=a.getAttribute("z-type")||"",eh(this.da,b).appendChild(a))};b.prototype.Cb=function(a){if(0>a||a>=this.children.length)throw Error("getChild("+a+") but there are only "+this.children.length+" children");return this.children[a].node};b.prototype.Ej=function(a,b){ch("showChild("+a+", "+b+")");if(a>=this.children.length||0>a)throw Error("showChild: Asked to show "+a+" but only "+this.children.length+" children");a=this.children[a];if(Vc(a.node)&&a.node.da){var c=
a.node.da.parentNode||a.He.parentNode;c?b&&!a.node.da.parentNode?c.replaceChild(a.node.da,a.He):!b&&a.node.da.parentNode&&c.replaceChild(a.He,a.node.da):ch("Could not find HTML parent for "+a.node.type())}};return b}(c)}
var gh=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.nn=null;b.xj=null;b.Hg=new F(0,0,0,0);b.Lr=!1;b.Mo={};b.qy=new I;for(var f in b.ba)switch(f){case "layer":case "matrix":break;default:delete b.ba[f]}"ResizeObserver"in window&&(b.xj=new window.ResizeObserver(function(){b.Yd()}));return b}__extends(a,c);a.prototype.type=function(){return"HTMLNode"};a.prototype.Ta=function(){this.da&&!this.Lr&&(P.detach(this.da),A(this.da).remove(),this.xj&&this.xj.unobserve(this.da))};a.prototype.rp=
function(a){this.Mo=a};a.prototype.De=function(a){return{"style.left":parseFloat(this.ba["style.left"]||"0")+a.Ea+"px","style.top":parseFloat(this.ba["style.top"]||"0")+a.Fa+"px"}};a.prototype.setProperty=function(a,d){"matrix"===a||"object"!==typeof d||d instanceof Array?(d=c.prototype.setProperty.call(this,a,d),this.Va(a,d)):this.Gc(fh(d,{},a+"."))};a.prototype.ja=function(a){switch(a){case "lockRotation":return!0}return c.prototype.ja.call(this,a)};a.prototype.Va=function(a,c){"opacity"===a&&(a=
"style.opacity");this.da&&"style."===a.substr(0,6)&&(this.da.style[a.substr(6)]=c||"")};a.prototype.format=function(a,c){var b=this;this.xt=c;ch("FORMAT type %s",this.ba.$component);if(null===this.da){var d=this.ba.$component;ch("Create component element of type %s",d);var h=Zc(this.Mo,this);h=Q.Ak(this.Mo,d,{nid:this.id,"z-type":d},h);if(!h)throw Error("Error: No component registered for "+d);this.nn=Q.Ie[d].draw||null;this.scope=h.scope;this.da=h.node;this.da.style.boxSizing="border-box";this.da.QB=
function(){return!1};this.parent&&Vc(this.parent)&&this.My();this.xj&&this.xj.observe(this.da);for(var k in this.ba)this.Va(k,this.ba[k]);this.da.addEventListener("load",function(){ch("Something loaded; request reformat.");c.sa("reformat",b.id)})}d=this.Na();"style.left"in this.ba&&(this.da.style.left=parseFloat(this.ba["style.left"])+d.Ea+"px");"style.top"in this.ba&&(this.da.style.top=parseFloat(this.ba["style.top"])+d.Fa+"px");for(d=0;d<this.Ua();d++)k=this.Cb(d),Uc(k)&&k.format(a,c)};a.prototype.Yd=
function(){if(this.da){var a=this.da.offsetWidth,c=this.da.offsetHeight;this.Hg.width=a;this.Hg.height=c;this.rect.width=a;this.rect.height=c;this.Aa.width=a;this.Aa.height=c;this.xt&&(this.log("%s size has changed: %sx%s",this,a,c),this.xt.uz(this.id))}};a.prototype.qp=function(a,c){this.rect=a;this.Aa=a.clone();this.Hg=a.clone();this.qy=c};a.prototype.la=function(a){if(!this.hidden())if(this.log("%s: Drawing %sx%s",this,this.Hg.width,this.Hg.height),a.Yh){var b=a.globalCompositeOperation;a.globalCompositeOperation=
"destination-out";var c=this.Hg;this.da&&this.da.classList.contains("zwibbler-selected")&&(c=c.clone(),c.Ed(8,8));a.fillRect(c.x,c.y,c.width,c.height);a.globalCompositeOperation=b;a.strokeStyle="rgba(255,0,0,0.2)";a.lineWidth=3}else this.nn?this.nn(this.scope,a):this.da&&(b="VIDEO"===this.da.tagName?this.da:this.da.querySelector("video"))&&3<=b.readyState&&(c=this.Hg,a.drawImage(b,c.x,c.y,c.width,c.height))};a.prototype.ad=function(){return!0};a.prototype.My=function(){if(this.parent&&Vc(this.parent)&&
this.parent.da){var a=this.parent.ne(this);if(-1===a)throw Error("Child node not found");var c=eh(this.parent.da,this.ba.$component);a=this.parent.Bo(a);c&&this.da&&c.insertBefore(this.da,a)}};a.prototype.cl=function(){if(!this.da)return this.rect;var a=A(this.da).dl();return new F(this.rect.x-a.left,this.rect.y-a.top,this.rect.width+a.left+a.right,this.rect.height+a.top+a.bottom)};a.prototype.qg=function(){return!1};a.prototype.Ci=function(a,d){switch(a){case "style.width":case "style.left":case "style.top":case "style.height":if("number"===
typeof d)return d+"px"}return c.prototype.Ci.call(this,a,d)};a.prototype.se=function(){return!1};return a}(dh(dd));$c.vd("HTMLNode",gh);function eh(c,a){for(var b=c.querySelectorAll("[container-for]"),d=null,e=0;e<b.length;e++)if(lg(b[e],a)){d=b[e];break}if(d){a=d.parentElement;for(b=!0;a;){if(a.getAttribute("nid")){b=a==c;break}a=a.parentElement}if(b)return d}return c}function lg(c,a){return(c=c.getAttribute("container-for"))&&0<=c.indexOf(a)}
function fh(c,a,b){void 0===a&&(a={});void 0===b&&(b="");for(var d in c){var e=c[d];e instanceof Object&&!(e instanceof Array)?fh(e,a,d+"."):a[b+d]=e}return a};var hh=function(c){function a(a,d){d=c.call(this,a,d)||this;d.log=u.create("PAGE",!0);d.da=document.createElement("div");d.da.classList.add("zwibbler-page");d.da.setAttribute("nid",a);return d}__extends(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.setProperty=function(a,d){if(void 0===d)delete this.ba[a];else switch(a){case "width":case "height":case "background":this.ba[a]=d;break;default:c.prototype.setProperty.call(this,a,d)}};a.prototype.kc=function(){return"width"in this.ba&&
"height"in this.ba?new rc(this.ba.width,this.ba.height):null};a.prototype.format=function(){};a.prototype.Db=function(){return null};a.prototype.la=function(){};return a}(dh($c));dd.vd("PageNode",hh);var ih=u.create("LSEQ");function jh(c){return 64*Math.pow(2,c)}
var kh=function(){function c(a,b){this.Wa=a;this.Uc=b}c.prototype.BA=function(){for(var a=1,b=0,c=this.Wa.length-1;0<=c;c--)b+=this.Wa[c]*a,a*=jh(c);return b};c.prototype.toString=function(){return this.encode()};c.prototype.encode=function(){for(var a="",b=0;b<this.Wa.length;b++)0<b&&(a+=" "),a+=""+this.Wa[b].toString(36),this.Uc[b]&&(a+="/"+this.Uc[b]);return a};c.prototype.Rv=function(a,b){for(var d=this.Wa.concat(),e=this.Uc.concat(),f=0;f<Math.min(this.Wa.length,a.Wa.length);f++)if(this.Wa[f]===
a.Wa[f]&&e[f]<=a.Uc[f])e[f]=a.Uc[f];else break;for(f=0;f<Math.min(this.Wa.length,b.Wa.length);f++)if(this.Wa[f]===b.Wa[f]&&e[f]>=b.Uc[f])e[f]=b.Uc[f];else break;return new c(d,e)};c.prototype.depth=function(){return this.Wa.length};c.cc=function(a){var b=[],d=[],e=0;for(a=a.split(" ");e<a.length;e++){var f=a[e].split("/");b.push(parseInt(f[0],36));d.push(f[1]||"")}return new c(b,d)};c.prototype.Ip=function(a){if(a.Wa.length!==this.Wa.length)throw Error("LPath.subtract: lengths must be equal");for(var b=
0,d=[],e=this.Wa.length-1;0<=e;e--){var f=this.Wa[e]-b-a.Wa[e];0>f?(f+=jh(e),b=1):b=0;d.push(f)}d.reverse();return new c(d,this.Uc)};c.prototype.Oq=function(a){for(var b=[],d=this.Wa.length-1;0<=d;d--){var e=this.Wa[d]+a;e>jh(d)?(a=Math.floor(e/jh(d)),e%=jh(d)):a=0;b.push(e)}b.reverse();return new c(b,this.Uc)};c.prototype.yA=function(a){for(var b=[],d=this.Wa.length-1;0<=d;d--){var e=this.Wa[d]-a;0>e?(a=Math.ceil(-e/jh(d)),e+=a*jh(d)):a=0;b.push(e)}b.reverse();return new c(b,this.Uc)};c.prototype.prefix=
function(a,b){for(var d=[],e=[],f=0;f<a;f++)f<this.Wa.length?(d.push(this.Wa[f]),e.push(this.Uc[f])):(d.push(0),e.push(b));e[e.length-1]=b;return new c(d,e)};c.prototype.extend=function(a){var b=this.Wa.slice(),d=this.Uc.slice();b.push(jh(b.length)-1);d.push(a);return new c(b,d)};c.mf=function(a,b,c){void 0===c&&(c=!0);for(var d=0;d<Math.max(a.Wa.length,b.Wa.length);d++){if(d===a.Wa.length)return-1;if(d===b.Wa.length)return 1;var f=a.Wa[d],h=b.Wa[d],k=a.Uc[d],l=b.Uc[d];if(f<h)return-1;if(f>h)return 1;
if(c&&k<l)return-1;if(c&&k>l)return 1}return 0};return c}(),lh=function(){function c(a){this.Tc=a;this.Em={};this.$m=1;this.first=new kh([0],[""]);this.po=new kh([63],["~"])}c.prototype.cv=function(a,b){var c,e=0,f=0,h=this.Tc;this.$m&&(h+=this.$m.toString(36),this.$m++);for(0<=kh.mf(a,b,!1)&&(b=a.extend(h));1>f;)e++,f=b.prefix(e,h).Ip(a.prefix(e,h)).BA()-1;var k=Math.min(f,2);e in this.Em||(this.Em[e]=1==(e&1));if(100<e)throw ih("p=%s q=%s",a,b),Error("Bad depth");void 0===c&&(c=Math.floor(zg.random()*
k)+1);e=(k=this.Em[e])?a.prefix(e,h).Oq(c):a.prefix(e,h).Oq(f+1).yA(c);e=e.Rv(a,b);if(1>c)throw Error("Error r < 1");if(-1!==kh.mf(a,e)||-1!==kh.mf(e,b))throw Error("LSEQ failure: ("+a+") !< ("+e+") !< ("+b+"}) strategy="+k+" r="+c);return e};return c}();var mh=u.create("crdt"),nh=function(){function c(a,b,c){this.od=a;this.Tc=b;this.Nj=c}c.prototype.before=function(a){return this.od<a.od||this.od===a.od&&(this.Tc<a.Tc||this.Tc===a.Tc&&this.Nj<a.Nj)};c.prototype.encode=function(){return this.od.toString(36)+":"+this.Tc+":"+this.Nj.toString(36)};c.prototype.toString=function(){return this.encode()};c.cc=function(a){for(var b=a.split(":"),d,e;3===b.length;){d=parseInt(b[0],36);e=parseInt(b[2],36);if(isNaN(d)||isNaN(e))break;return new c(d,b[1],e)}throw Error("Could not decode Timestamp: "+
a);};return c}(),oh=function(){function c(a,b){void 0===b&&(b=[]);this.Ab=a;this.ops=b}c.prototype.mg=function(){return this.Ab.Tc+"-"+this.Ab.Nj.toString(36)};c.prototype.before=function(a){return this.Ab.before(a.Ab)};c.mf=function(a,b){return a.before(b)?-1:b.before(a)?1:0};c.prototype.clone=function(a){void 0===a&&(a=this.Ab);for(var b=[],d=0,e=this.ops;d<e.length;d++)e[d].clone(b);return new c(a,b)};c.prototype.inverse=function(a){void 0===a&&(a=this.Ab);for(var b=[],d=this.ops.length-1;0<=d;d--)this.ops[d].inverse(b);
return new c(a,b)};c.prototype.toString=function(){for(var a="  "+this.Ab+" --\x3e\n",b=0,c=this.ops;b<c.length;b++)a+="    "+c[b]+"\n";return a};return c}(),ph=function(){function c(a,b){this.$d=a;this.hb=b}c.prototype.encode=function(){return this.$d+":"+this.hb.encode()};c.prototype.toString=function(){return this.encode()};c.cc=function(a){var b=a.split(":");if(2!==b.length)throw Error("Could not decode treepath: "+a);return new c(b[0],kh.cc(b[1]))};return c}(),sh=function(){function c(a,b,c){this.Ha=
a;this.Oc=b;this.ba=c;this.type="c"}c.prototype.encode=function(){var a=JSON.stringify(this.ba);return"C"+this.Ha+";"+this.Oc.encode()+";"+a.length+";"+a+";"};c.prototype.clone=function(a){a.push(new qh(this.Ha))};c.prototype.toString=function(){return"CREATE "+this.Ha+" "+(this.ba.$type||this.ba.type||this.ba.name||"")+" at "+this.Oc+" len="+JSON.stringify(this.ba).length};c.prototype.inverse=function(a){a.push(new rh(this.Ha))};c.cc=function(a,b){var d=/C([^;]+);([^;]+);(\d+);/g;d.lastIndex=b;var e=
d.exec(a);return e&&e.index===b?(b=parseInt(e[3],10),a=JSON.parse(a.substr(d.lastIndex,b)),{sf:new c(e[1],ph.cc(e[2]),a),position:d.lastIndex+b+1}):null};c.prototype.yj=function(a){this.Oc=a.yj(this.Oc)};c.prototype.Ac=function(a){a.createNode(this.Ha,this.Oc,this.ba)};return c}(),th=function(){function c(a){this.Ry=a;this.type="n"}c.prototype.clone=function(a){a.push(this)};c.prototype.inverse=function(a){a.push(this)};c.prototype.encode=function(){return""};c.prototype.Ac=function(){};c.prototype.toString=
function(){return"NULLIFIED "+this.Ry};return c}(),rh=function(){function c(a){this.Ha=a;this.type="d";this.kj=!1}c.prototype.clone=function(a){a.push(new c(this.Ha))};c.prototype.inverse=function(a){a.push(new qh(this.Ha))};c.prototype.encode=function(){return"D"+this.Ha+";"};c.prototype.toString=function(){return"DELETE "+this.Ha};c.cc=function(a,b){var d=/D([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{sf:new c(a[1]),position:d.lastIndex}:null};c.prototype.Ac=function(a){a.Ke(this.Ha)};
return c}(),qh=function(){function c(a){this.Ha=a;this.type="u"}c.prototype.clone=function(a){a.push(new c(this.Ha))};c.prototype.inverse=function(a){a.push(new rh(this.Ha))};c.prototype.encode=function(){return"U"+this.Ha+";"};c.prototype.toString=function(){return"UNDELETE "+this.Ha};c.cc=function(a,b){var d=/U([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{sf:new c(a[1]),position:d.lastIndex}:null};c.prototype.Ac=function(a){a.eu(this.Ha)};return c}(),uh=/^\\*undefined$/;
function vh(c,a){return"undefined"===typeof a?"undefined":"string"===typeof a&&a.match(uh)?"/"+a:a}
var wh=function(){function c(a,b,c){void 0===c&&(c=null);this.Ha=a;this.ba=b;this.ve=c;this.type="s";this.kj=!1;a:{for(var d in b){a=!1;break a}a=!0}if(a)throw Error("Empty properties in constructor");}c.prototype.clone=function(a){a.push(new c(this.Ha,this.ba))};c.prototype.inverse=function(a){if(null===this.ve){if(this.kj)return new th(this);throw Error("SetPropertiesOp was not executed before inversion: "+this);}a.push(new c(this.Ha,this.ve))};c.prototype.encode=function(){var a=JSON.stringify(this.ba,
vh);return"S"+this.Ha+";"+a.length+";"+a+";"};c.prototype.toString=function(){return"SET "+this.Ha+" "+JSON.stringify(this.ba,vh)};c.cc=function(a,b){var d=/S([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){b=parseInt(e[2],10);a=JSON.parse(a.substr(d.lastIndex,b));for(var f in a){var h=f;var k=a[f];k="undefined"===k?void 0:"string"===typeof k&&k.match(uh)?k.substr(1):k;a[h]=k}return{sf:new c(e[1],a,null),position:d.lastIndex+b+1}}return null};c.prototype.Ac=function(a){var b=a.wb(this.Ha);
this.ve={};for(var c in this.ba)this.ve[c]=b[c];a.Gc(this.Ha,this.ba)};return c}(),xh=function(){function c(a,b,c){void 0===c&&(c=null);this.Ha=a;this.Oc=b;this.src=c;this.type="m";this.kj=!1}c.prototype.clone=function(a){a.push(new c(this.Ha,this.Oc,this.src))};c.prototype.inverse=function(a){if(!this.src){if(this.kj)return new th(this);throw Error("moveOp: Must be executed before inversion");}a.push(new c(this.Ha,this.src,this.Oc))};c.prototype.encode=function(){return"M"+this.Ha+";"+this.Oc.encode()+
";"};c.prototype.toString=function(){return"MOVE "+this.Ha+" -> "+this.Oc};c.cc=function(a,b){var d=/M([^;]+);([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{sf:new c(a[1],ph.cc(a[2])),position:d.lastIndex}:null};c.prototype.yj=function(a){this.Oc=a.yj(this.Oc)};c.prototype.Ac=function(a){var b=a.Ia[this.Ha];b&&b.parent&&a.has(this.Oc.$d)?(this.src=new ph(b.parent.Ha,b.hb),a.Sc(this.Ha,this.Oc)):this.kj=!0};return c}();
function yh(c,a){for(var b=-1,d,e;1<c-b;){d=c+b>>1;e=a(d);if(0==e)return d;0>e?b=d:c=d}return c}function zh(c){for(var a=[],b=1;b<arguments.length;b++)a[b-1]=arguments[b];for(b=0;b<a.length;b++){var d=a[b],e;for(e in d)c[e]=d[e]}}
var Ah=function(){function c(a,b){this.Ra=b;this.Ia={};this.Ef=new lh(a);this.gk("0")}c.prototype.gk=function(a){this.Ia[a]={Ha:a,parent:null,hb:new kh([],[]),children:[],index:0,yd:!1,he:null,bq:0}};c.prototype.has=function(a){return a in this.Ia};c.prototype.zd=function(a){a=this.Ia[a];if(!a)return!1;for(;;){if(a.yd)return!1;if(!a.parent)break;a=a.parent}return!0};c.prototype.yj=function(a){if(!this.has(a.$d))return a;mh("Attempt to retarget %s",a);var b=this.Ji(a),c=this.Pn(a.$d,b),e=this.Ji(a);
if(b!==e)throw Error("retarget failed: index="+b+" newIndex="+b+" "+a+"   "+c);mh("Retarget %s -> %s",a,c);return c};c.prototype.Pn=function(a,b){var c=this.Ia[a];if(!c)throw Error("getInsertPath: "+a+" does not exist.");var e=0,f;for(f=0;f<c.children.length&&(c.children[f].yd||(e++,!(e>b)));f++);if(0>f||f>c.children.length)throw Error("getInsertPath: index="+f+" wanted="+b+" but "+a+" has "+c.children.length+" children.");mh("Move "+a+" index="+f+" children.length="+c.children.length);0===c.children.length?
(b=this.Ef.first,e=this.Ef.po):0===f?(b=this.Ef.first,e=c.children[f].hb):f===c.children.length?(b=c.children[c.children.length-1].hb,e=this.Ef.po):(b=0==f?this.Ef.first:c.children[f-1].hb,e=f<c.children.length?c.children[f].hb:this.Ef.po);try{var h=new ph(a,this.Ef.cv(b,e))}catch(k){mh("Path between %s and %s, index=%s children=%s",b,e,f,c.children.length);mh("debug info: index is %s",f);for(a=0;a<c.children.length;a++)mh("Child %s nid=%s lpath %s",a,c.children[a].Ha,c.children[a].hb);throw k;}mh("Path between "+
b+" and "+e+" is "+h.hb);a=this.Ji(h);if(a!==f){mh("debug info: wanted index is %s, got %s",f,a);for(a=0;a<c.children.length;a++)mh("Child %s nid=%s lpath %s",a,c.children[a].Ha,c.children[a].hb);throw Error("getInsertPath() failed; ("+h+") index="+f);}return h};c.prototype.Ji=function(a){var b=this.Ia[a.$d];if(!b)throw Error("getInsertIndex: parent "+a.$d+" does not exist");var c=yh(b.children.length,function(c){return kh.mf(b.children[c].hb,a.hb)});if(0>c||c>b.children.length)throw Error("Asked to insert at "+
a.$d+":"+c+" but parent has "+b.children.length+" children.");return c};c.prototype.createNode=function(a,b,c){if(a in this.Ia)this.eu(a);else{var d=this.Ia[b.$d],f=this.Ji(b),h={Ha:a,parent:d,children:[],hb:b.hb,index:f,yd:!1,he:null,bq:0};this.Ia[a]=h;d.children.splice(f,0,h);d.bq=f-1;this.fr(d.children,f);this.Ra&&this.Ra.createNode(a,b.$d,this.On(h),c)}};c.prototype.fr=function(a,b){if(0<b&&0<=kh.mf(a[b-1].hb,a[b].hb)){mh("debug info: index is %s",b);for(var c=0;c<a.length;c++)mh("Child %s nid=%s lpath %s",
c,a[c].Ha,a[c].hb);throw Error("Error: LPaths out of order. "+a[b-1].hb+" >=  "+a[b].hb);}if(b<a.length-1&&0<=kh.mf(a[b].hb,a[b+1].hb)){mh("debug info: index is %s",b);for(c=0;c<a.length;c++)mh("Child %s nid=%s lpath %s",c,a[c].Ha,a[c].hb);throw Error("Error: LPaths out of order. "+a[b].hb+" >=  "+a[b+1].hb);}};c.prototype.Ke=function(a){(a=this.Ia[a])&&a.parent&&!a.yd&&(a.yd=!0,this.remove(a))};c.prototype.remove=function(a){for(var b=a.children.length-1;0<=b;b--){var c=a.children[b];c.yd||this.remove(c)}this.Ra?
(a.he=this.Ra.wb(a.Ha),this.Ra.Ke(a.Ha)):a.he={}};c.prototype.On=function(a){if(!a.parent)throw Error("Expected parent");for(var b=a.parent,c=0,e=0;e<b.children.length;e++){if(b.children[e]===a)return c;b.children[e].yd||c++}throw Error("node "+a.Ha+" not in parent's child list");};c.prototype.eu=function(a){(a=this.Ia[a])&&a.yd&&a.parent&&(a.yd=!1,this.ut(a))};c.prototype.ut=function(a){if(this.Ra&&this.zd(a.Ha)&&a.parent){if(!a.he)throw Error("Properties should have been saved");this.Ra.createNode(a.Ha,
a.parent.Ha,this.On(a),a.he)}a.he={};var b=0;for(a=a.children;b<a.length;b++){var c=a[b];c.yd||this.ut(c)}};c.prototype.Oa=function(a){a in this.Ia||(this.Ia[a]={Ha:a,yd:!0,children:[],index:0,he:{},hb:this.Ef.first,bq:0,parent:null});return this.Ia[a]};c.prototype.Sc=function(a,b){var c=this.Ia[a];if(c&&c.parent){var e=this.Ia[b.$d];if(e){for(var f=0;f<c.parent.children.length;f++)if(c.parent.children[f]===c){c.parent.children.splice(f,1);break}f=this.Ji(b);c.parent=e;c.hb=b.hb;e.children.splice(f,
0,c);this.fr(e.children,f);this.Ra&&this.zd(a)&&this.Ra.Sc(a,b.$d,this.On(c))}}};c.prototype.Gc=function(a,b){var c=this.Oa(a);this.Ra&&this.zd(a)?this.Ra.Gc(a,b):c.he&&zh(c.he,b)};c.prototype.wb=function(a){var b=this.Ia[a];return b&&b.yd?b.he:this.Ra?this.Ra.wb(a):{}};c.prototype.wa=function(a,b){this.Ra&&this.Ra.wa(a,b)};return c}(),Dh=function(){function c(a,b){this.Tc=b;this.od=0;this.all=[];this.ql={};this.Vc=[];this.next=0;this.fe=!1;this.jy="";this.Sh=[];this.local=[];this.Oj="";this.qo=0;
this.To=!1;this.Ra=new Ah(this.Tc,a)}c.prototype.Ms=function(){var a=(new Date).getTime();a<=this.qo&&(a=this.qo+1);return this.qo=a};c.prototype.Ac=function(a){var b=0;for(a=a.ops;b<a.length;b++){var c=a[b];mh("Executing %s",c);c.Ac(this.Ra)}};c.prototype.locked=function(){return""!==this.jy};c.prototype.createNode=function(a,b,c,e){this.fe||this.fk(new sh(a,this.Ra.Pn(b,c),e));return a};c.prototype.Ke=function(a){this.fe||this.fk(new rh(a))};c.prototype.Sc=function(a,b,c){if(!this.fe){var d=this.Ra.Ia[a];
d&&d.parent&&d.parent.Ha===b&&d.parent.children.indexOf(d)<=c&&c++;this.fk(new xh(a,this.Ra.Pn(b,c)))}};c.prototype.Gc=function(a,b){this.fe||this.fk(new wh(a,b))};c.prototype.wb=function(a){return this.Ra.wb(a)};c.prototype.fk=function(a){this.Sh.push(a);this.locked()||(mh("Executing %s",a),a.Ac(this.Ra))};c.prototype.wa=function(a,b){if(!this.To){if(!this.fe&&this.Sh.length){a=new nh(this.od,this.Tc,this.Ms());a=new oh(a);for(var c=0,e=this.Sh;c<e.length;c++)a.ops.push(e[c]);b||(this.Vc.length=
this.next++,this.Vc.push(a));this.local.push(a);this.all.push(a);this.ql[a.mg()]=!0;this.od++;this.Sh.length=0;this.Oj&&(this.Zf(this.Oj),this.Oj="")}else this.fe&&(this.To=!0,this.Ra.wa(a,b),this.To=!1);this.Sh.length=0}};c.prototype.encode=function(a){for(var b="",c=0;c<a.length;c++){var e=a[c];b+="B"+e.Ab.encode()+";";var f=0;for(e=e.ops;f<e.length;f++)b+=e[f].encode()}return b};c.prototype.Zf=function(a){if(this.locked()||this.Sh.length)this.Oj+=a,mh("Ignore remote changes while "+(this.locked()?
"locked":"uncommitted"));else{var b=0;a=Bh(a);for(var c=0;c<a.length;c++)b=Math.max(b,a[c].Ab.od),this.ql[a[c].mg()]&&(a.splice(c,1),c--);if(0!==a.length){this.od=Math.max(this.od,b)+1;b=a[0];for(c=1;c<a.length;c++)a[c].before(b)&&(b=a[c]);for(var e=this.all.length-1;0<=e&&!this.all[e].before(b);e--);e++;this.fe=!0;for(c=0;c<a.length;c++){var f=a[c];this.all.push(f);this.ql[f.mg()]=!0}this.all.sort(oh.mf);if(this.all[e]!==b){for(c=0;c<this.all.length;c++)c===e&&mh("MergePoint"),mh(this.all[c].toString());
mh("New lists:");for(b=0;b<a.length;b++)mh(a[b].toString());throw Error("Assumption violated");}mh("%s Executing new changes from %s",this.Tc,e);for(c=e;c<this.all.length;c++)this.Ac(this.all[c]);this.wa(!0,!1);this.fe=!1;mh("%s addRemoteChanges done",this.Tc)}}};c.prototype.vz=function(){this.local=this.all.concat()};c.prototype.Sw=function(){return this.local.length?new Ch(this.encode(this.local),this.local[this.local.length-1].mg()):new Ch("","0")};c.prototype.ej=function(a){for(var b=this.local.length-
1;0<=b;b--)if(a===this.local[b].mg()){this.local.splice(0,b+1);break}};c.prototype.Fe=function(){return 0<this.next&&!this.locked()};c.prototype.Ee=function(){return this.next<this.Vc.length&&!this.locked()};c.prototype.Hc=function(){this.Fe()&&this.rt(this.Vc[--this.next],!0)};c.prototype.ae=function(){this.Ee()&&this.rt(this.Vc[this.next++],!1)};c.prototype.Zm=function(){this.next=this.Vc.length=0};c.prototype.rt=function(a,b){this.fe=!0;var c=new nh(this.od,this.Tc,this.Ms());b=b?a.inverse(c):
a.clone(c);c=0;for(a=a.ops;c<a.length;c++){var e=a[c];"m"!==e.type&&"c"!==e.type||e.yj(this.Ra)}this.local.push(b);this.all.push(b);this.ql[b.mg()]=!0;this.od++;this.Ac(b);this.wa(!1,!0);this.fe=!1};c.prototype.Xn=function(){for(var a=[],b=0,c=this.all;b<c.length;b++){var e=c[b];a.push({zv:e.mg(),Ab:e.Ab.Nj})}return a};c.prototype.gk=function(a){this.Ra.gk(a)};return c}(),Ch=function(){function c(a,b){this.Xm=a;this.fy=b}c.prototype.getData=function(){return this.Xm};c.prototype.empty=function(){return 0===
this.Xm.length};c.prototype.toString=function(){return this.Xm};return c}();
function Bh(c){for(var a=[],b=0,d=/B([^;]+);/g;b<c.length;){var e;switch(c[b]){case "B":d.lastIndex=b;if((e=d.exec(c))&&e.index===b)b=nh.cc(e[1]),b=new oh(b),a.push(b),b=d.lastIndex;else throw Error("Could not decode Batch from "+c.substr(b,256));continue;case "C":e=sh.cc(c,b);break;case "D":e=rh.cc(c,b);break;case "U":e=qh.cc(c,b);break;case "S":e=wh.cc(c,b);break;case "M":e=xh.cc(c,b);break;case "\r":case "\t":case "\n":case " ":b+=1;continue;default:throw Error("Could not decode Operation from "+
c.substr(b,256));}if(0===a.length)throw Error("Got change outside of batch");if(null===e)throw Error("change is null while decoding: "+c.substr(b,500));b=e.position;a[a.length-1].ops.push(e.sf)}return a};var Eh=u.create("DOCTREE"),Fh=function(){function c(a,b){this.Se=a;this.Ia={};this.Ia["0"]=b}c.prototype.Yu=function(a,b){if(a in this.Ia)throw Error("Node "+a+" already exists");this.Ia[a]=b};c.prototype.createNode=function(a,b,c,e){Eh("createNode("+a+", "+b+", "+c+")");if(a in this.Ia)throw Error("createNode "+a+" already exists");b=this.Oa(b);if(b.Ua()+1<c)throw Error("Asked to insert at index "+c+" but parent only has "+b.Ua()+" children");e=this.Se.ny(a,e);b.xl(e,c);e.parent=b;this.Ia[a]=e;this.Se.Ts&&
this.Se.Ts(e)};c.prototype.Oa=function(a){if(a in this.Ia)return this.Ia[a];throw Error("nid "+a+" does not exist");};c.prototype.zd=function(a){return a in this.Ia};c.prototype.Ke=function(a){Eh("deleteNode("+a+")");var b=this.Oa(a),c=b.parent;if(!c)throw Error("Parent of "+a+" is null?!");var e=c.ne(b);if(0>e)throw Error("Asked to delete "+a+" but it is not in parent's children");if(0!==b.Ua())throw Error("Asked to delete "+a+" but it still has children.");for(a=b.Ua()-1;0<=a;a--){var f=b.Cb(a);
this.Ke(f.id)}this.Se.Us&&this.Se.Us(b);c.removeChild(e);delete this.Ia[b.id]};c.prototype.Sc=function(a,b,c){Eh("moveNode("+a+", dest="+b+":"+c+")");var d=this.Oa(a),f=this.Oa(b),h=d.parent;if(null===h)throw Error("node "+a+" does not have any parent");a=h.ne(d);if(f.Ua()<(d.parent===f?c+1:c))throw Error("asked to shift node at "+b+":"+c+" but it only has "+f.Ua()+" children");h.removeChild(a);f.xl(d,c);d.parent=f};c.prototype.Gc=function(a,b){if(a in this.Ia){a=this.Oa(a);for(var c in b)a.setProperty(c,
b[c]);this.Se.at&&this.Se.at(a,b)}};c.prototype.wb=function(a){return a in this.Ia?this.Oa(a).wb():{}};c.prototype.wa=function(a){this.Se.Ll&&this.Se.Ll(a)};c.prototype.ed=function(a){for(var b in this.Ia)a(this.Ia[b])};return c}();var Gh=u.create("BRUSH"),Hh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.ma=[];a.dd=[];Gh("New BrushNode created.");a.ba.points=[];a.ba.strokeStyle="#ff00ff";a.ba.lineWidth=10;return a}__extends(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.wb=function(){var a=c.prototype.wb.call(this);a.dashes=a.dashes||"";return a};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");"dashes"===a||"lineCap"===a?this.ba[a]=d:c.prototype.setProperty.call(this,a,d)};
a.prototype.ja=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.ja.call(this,a)};a.prototype.format=function(){var a,c;this.ma.length=0;var e=this.ba.points;var f=a=0;for(c=e.length-1;a<=c;f=a+=2)this.ma.push(new D(e[f],e[f+1]));f=F.$h(this.ma);e=this.Na().sb();a=this.ba.lineWidth;f.Ed(a/e.x,a/e.y);this.Aa=f.clone();f=new Gc(f);f.transform(this.ba.matrix);this.rect=F.$h(f.ma);this.dd=Hc(this.ba.dashes||"")};a.prototype.Db=function(a,c,e){return this.rect.cd(a,c,e)&&(a=this.Qc().apply(a,
c),c=this.Qc().sb(),Bc(this.ma,a.x,a.y,.5*(c.x+c.y)*Math.max(12,e,this.ba.lineWidth/2)))?this:null};a.prototype.pf=function(a){var b,c;var f=this.ba.points;if(0!==f.length){a.save();a.beginPath();var h=this.ja("lineCap")||"round";a.lineCap=h;a.lineJoin="round"===h?"round":"bevel";if(1<this.dd.length)Ic(a,this.ma,this.dd);else for(a.moveTo(f[0],f[1]),h=b=2,c=f.length-1;b<=c;h=b+=2)a.lineTo(f[h],f[h+1]);this.Qc().jf(a);oc(a,this.ba.strokeStyle);a.restore()}};a.zB=!1;return a}(dd);
dd.vd("BrushNode",Hh);function Ih(c){return{m11:c.m11,m12:c.m21,m21:c.m12,m22:c.m22,dx:c.Ea,dy:c.Fa}}
var Jh=function(){function c(a,b){this.node=a;this.request=b}c.prototype.Iw=function(a,b,c){this.node.Pr(b,a,this.request,c)};c.prototype.hx=function(a){return this.node.Xr(a)};c.prototype.Jf=function(){this.request.Kf(this.node.id)};c.prototype.to=function(a,b){this.request.add(this.node.id,"image",a,null,b)};c.prototype.yw=function(a){this.node.Br(a,!0)};c.prototype.xA=function(a){this.node.Br(a,!1)};c.prototype.Uk=function(a,b){return Q.Uk(a,b)};c.prototype.sb=function(){return 1};c.prototype.$y=
function(a){return new se(a)};c.prototype.kd=function(a){return this.request.kd(a)};c.prototype.JA=function(a,b){a=this.node.Na().apply(a,b);return{x:a.x,y:a.y}};return c}(),Kh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.eb=null;a.log=u.create("CUSTOM");a.setProperty("matrix",new I);return a}__extends(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.ad=function(){return!0};a.prototype.setProperty=function(a,d){if(null===this.eb&&"nodeType"===a){a=Q.Dk[d];this.eb=new a(this.id);
for(var b in this.ba)this.setProperty(b,this.ba[b]);this.ba.nodeType=d}else d=c.prototype.setProperty.call(this,a,d),"matrix"===a&&(d=Ih(d)),this.eb&&this.eb.setProperty&&this.eb.setProperty(a,d)};a.prototype.se=function(){return this.eb&&this.eb.hasEditMode?this.eb.hasEditMode():!1};a.prototype.In=function(){var a=[];this.eb&&this.eb.getEditHandles&&(a=this.eb.getEditHandles());for(var c=this.Na(),e=[],f=0;f<a.length;f++){var h=a[f];e.push(c.apply(h.x||0,h.y||0))}return e};a.prototype.Db=function(a,
c,e){a=this.Qc().apply(a,c);c=this.Qc().sb();c=.5*(c.x+c.y);return this.hidden()||this.ja("locked")||!this.Aa.cd(a.x,a.y,e*c)||this.eb&&this.eb.hittest&&!this.eb.hittest(a.x,a.y,e)?null:this};a.prototype.Lk=function(a,c){a.beginPath();for(var b=10/c,d=2/c,h=0,k=this.In();h<k.length;h++){var l=k[h];a.moveTo(l.x+b/c,l.y);a.arc(l.x,l.y,b,0,2*Math.PI,!1)}a.strokeStyle="#0050B7";a.lineWidth=d;a.stroke()};a.prototype.$k=function(){this.In()};a.prototype.tl=function(a,c,e){for(var b=this.In(),d=0;d<b.length;d++)if(20>
b[d].Wb(new D(a,c))/e)return d;return null};a.prototype.Ue=function(a,c,e){this.eb&&this.eb.moveEditHandle&&(c=this.Qc().apply(c,e),this.eb.moveEditHandle(a,c.x,c.y))};a.prototype.ja=function(a){var b;this.eb&&this.eb.getProperty&&(b=this.eb.getProperty(a));void 0===b&&(b=c.prototype.ja.call(this,a));"matrix"===a&&(b=b?b instanceof I?b:new I(b.m11||1,b.m21||0,b.m12||0,b.m22||1,b.dx||0,b.dy||0):new I);return b};a.prototype.Lf=function(a){c.prototype.Lf.call(this,a);this.eb.setHidden&&this.eb.setHidden(a)};
a.prototype.format=function(a,c){this.eb&&(this.Xb||(this.Xb=new Jh(this,c)),"format"in this.eb&&this.eb.format(a,this.Xb),this.eb.getUntransformedRect?(a=this.eb.getUntransformedRect(),this.Aa=new F(a.x||0,a.y||0,a.width||0,a.height||0),this.rect=this.Aa.clone(),this.rect.transform(this.Na())):this.log("Error: NodeType %s missing getUntransformedRect()",this.ba.nodeType))};a.prototype.pf=function(a){this.hidden()||(a.save(),a.getTransform=function(){return a.Yh?Ih(a.Yh):Ih(new I)},this.Xb.getScale=
function(){return a.Yh?a.Yh.sb().x:1},this.eb.draw(a,this.Xb),a.restore())};return a}(dd);dd.vd("CustomNode",Kh);Jh.prototype.formatFill=Jh.prototype.Iw;Jh.prototype.getFill=Jh.prototype.hx;Jh.prototype.reformat=Jh.prototype.Jf;Jh.prototype.loadImage=Jh.prototype.to;Jh.prototype.fillEraser=Jh.prototype.yw;Jh.prototype.strokeEraser=Jh.prototype.xA;Jh.prototype.formatText=Jh.prototype.Uk;Jh.prototype.getScale=Jh.prototype.sb;Jh.prototype.parseFont=Jh.prototype.$y;Jh.prototype.getConfig=Jh.prototype.kd;
Jh.prototype.transformPoint=Jh.prototype.JA;var Lh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.da=null;a.Ek=void 0;a.Qb=new Gc;a.co=new Gc;a.xf=new I;a.readOnly=!1;a.zb=!1;a.le=null;a.width=0;a.height=0;a.qd=null;a.mt="";a.log=u.create("DomNode",!0);a.Xh=-1;a.canvas=null;a.ba.data="";a.ba.locked=!1;a.Gb|=4;return a}__extends(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.Bo=function(){return null};a.prototype.setProperty=function(a,d){if("data"===a)this.da&&(A(this.da).remove(),this.Ek=this.da=null);else if("border"===
a||"lockSize"===a||"lockRotate"===a||"preview"===a){this.ba[a]=d;return}c.prototype.setProperty.call(this,a,d)};a.prototype.Sz=function(a){null!==this.le&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.da&&(this.log("   Remove existing DOM element"),A(this.da).remove()),this.da=a,this.da.style.position="absolute",A(this.da).eo(this.le.canvas),this.width=this.da.offsetWidth||parseFloat(this.da.getAttribute("width")||"0"),this.height=this.da.offsetHeight||parseFloat(this.da.getAttribute("height")||
"0"),A(this.da).remove(),this.Qh(this.readOnly,!0),this.da.style.top="0px",this.da.style.left="0px",this.da.style.boxSizing="border-box",this.da.classList.add("zwibbler-dom-node"),this.da.setAttribute("zwibbler-node-id",""+this.id),this.Lm("transformOrigin","top left"),this.log("element height: %s, %s",this.da.offsetWidth,this.da.offsetHeight),this.le.Kf(this.id))};a.prototype.ic=function(){return this.da};a.prototype.Lm=function(a,c){if(null!==this.da){for(var b=a.charAt(0).toUpperCase()+a.substr(1),
d=["ms","Webkit","O","Moz"],h=0;h<d.length;h++)this.da.style[d[h]+b]=c;this.da.style[a]=c}};a.prototype.Lf=function(a){dd.prototype.Lf.call(this,a);this.da&&(this.da.style.visibility=this.Zj?"hidden":"visible")};a.prototype.Qh=function(a,c){void 0===c&&(c=!1);if(c||this.readOnly!==a)this.readOnly=a,this.da&&this.le&&this.zb&&(this.No(this.Xh),A(this.da).eo(this.le.canvas))};a.prototype.format=function(a,c){var b=this;this.canvas=c.canvas;null===this.da&&this.Ek!==this.ja("data")&&c&&(this.Ek=this.ja("data"),
this.le=c,this.log("DomNode %s requests conversion to DOM element",this.id),this.le.Nv(this.Ek,this.id));if(this.da){this.da.CB=this.id;a=this.Na();var d=a.sb();this.da.style.width=this.width*d.x+"px";this.da.style.height=this.height*d.y+"px";a=a.multiply(new wc(1/d.x,1/d.y));d=this.xf;d=d.multiply(a);d.ys()?(this.Lm("transform",""),this.da.style.left=""+d.Ea+"px",this.da.style.top=""+d.Fa+"px"):(this.da.style.left="0px",this.da.style.top="0px",this.Lm("transform","matrix("+d.m11+","+d.m21+","+d.m12+
","+d.m22+","+d.Ea+","+d.Fa+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=this.height;this.da.style.visibility=this.Zj?"hidden":"visible"}else this.rect.x=0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.Qb=new Gc(this.rect);this.Aa=this.rect.clone();this.rect.transform(this.Na());this.Qb.transform(this.Na());if(a=this.ba.border)this.rect.Ed(a),this.co=this.Qb.clone(),this.co.Ed(a/2),this.Qb.Ed(a);!this.ba.preview||null!==this.qd&&this.mt===this.ba.preview?
this.ba.preview||(this.qd=null):(this.log("Requesting new preview image for %s",this.ba.preview),this.qd=document.createElement("img"),this.mt=this.qd.src=this.ba.preview,this.qd.onload=function(){b.log("Preview image loaded.");c.Kf(b.id)},this.qd.onerror=function(){b.log("Failed to load preview image")})};a.prototype.pf=function(a){var b=a.Yh;b&&this.le&&(b.m11!==this.xf.m11||b.m21!==this.xf.m21||b.m12!==this.xf.m12||b.m22!==this.xf.m22||b.Ea!==this.xf.Ea||b.Fa!==this.xf.Fa)&&(this.log("Moving DOM element as result of draw zooming"),
this.xf=b,this.format(a,this.le));if(this.da){var c=this.ba.border;if(c){var f=this.co;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=c;a.strokeStyle="#cccccc";a.moveTo(f.ma[0].x,f.ma[0].y);a.lineTo(f.ma[1].x,f.ma[1].y);a.lineTo(f.ma[2].x,f.ma[2].y);a.lineTo(f.ma[3].x,f.ma[3].y);a.lineTo(f.ma[0].x,f.ma[0].y);a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle="#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",
0,0);if(this.qd&&this.qd.naturalHeight&&!b&&this.zb){this.log("Drawing preview image %s,%s ->%s,s",this.qd.naturalWidth,this.qd.naturalHeight,this.width,this.height);try{a.drawImage(this.qd,0,0,this.qd.naturalWidth,this.qd.naturalHeight,0,0,this.width,this.height)}catch(h){this.log("Tried to draw image, got error: %s",h.toString())}}else b&&(b=a.globalCompositeOperation,a.globalCompositeOperation="destination-out",a.fillRect(this.Aa.x,this.Aa.y,this.Aa.width,this.Aa.height),a.globalCompositeOperation=
b)};a.prototype.clip=function(a){this.Qb.la(a)};a.prototype.Db=function(a,c,e){return!this.ba.locked&&this.rect.cd(a,c,e)&&this.Qb.cd(a,c,Math.max(3,e))?this:null};a.prototype.Kl=function(){this.da&&this.le&&(this.log("Added DOM NODE %s",this.id),this.No(this.Xh));this.zb=!0};a.prototype.Nl=function(){this.log("Removed DOM NODE %s",this.id);this.da&&A(this.da).remove();this.zb=!1};a.prototype.No=function(a){if(this.da&&this.canvas&&!(0>a)){a!==this.Xh?(this.da.classList.remove("zwibbler-zorder-"+
this.Xh),this.da.classList.add("zwibbler-zorder-"+a),this.Xh=a,this.log("Add class zwibbler-zorder-%s",a)):this.log("order=zorder=%s",this.Xh);var b=null;for(--a;0<=a;a--){var c=this.canvas.parentElement.querySelector(".zwibbler-zorder-"+a);if(c){b=c;this.log("Found element zorder-%s",a);break}this.log("Did not find element zorder-%s",a)}if(this.da.previousSibling!==b||null===b)b?(this.log("Insert after previous."),A(this.da).eo(b)):(this.log("Insert before canvas %s",this.canvas),A(this.da).insertBefore(this.canvas))}};
a.prototype.Ta=function(){this.da&&(this.log("DomNode %s destroyed",this.id),P.detach(this.da))};a.prototype.Kt=function(a){this.No(a)};a.prototype.cl=function(){if(!this.da)return this.rect;var a=A(this.da).dl();return new F(this.rect.x-a.left,this.rect.y-a.top,this.rect.width+a.left+a.right,this.rect.height+a.top+a.bottom)};a.prototype.qp=function(a){this.rect=a;this.Aa=a.clone()};a.prototype.rp=function(){};a.prototype.Ej=function(){throw Error("DomNode: showChild not implemented!");};return a}(dd);
dd.vd("DomNode",Lh);var Mh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.qc=null;a.zf=null;a.scale=1;a.Qb=new Gc;a.hg=[];a.Ob=new F(0,0,100,20);a.Mc=new F(0,0,100,20);a.log=u.create("IMAGE",!0);delete a.ba.fillStyle;delete a.ba.strokeStyle;delete a.ba.lineWidth;a.ba.url="";return a}__extends(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.toString=function(){return c.prototype.toString.call(this)+" url="+this.ja("url").substr(0,64)};a.prototype.setProperty=function(a,d){switch(a){case "url":d!==
this.ba.url&&(this.zf=this.qc=null);break;case "brightness":case "contrast":case "gamma":this.zf=null;break;case "colour":this.zf=null}c.prototype.setProperty.call(this,a,d)};a.prototype.ad=function(a){switch(a){case "url":case "brightness":case "gamma":case "colour":case "allowCrop":case "crop":case "blendMode":case "opacity":case "width":case "height":return!0}return c.prototype.ad.call(this,a)};a.prototype.Nz=function(a){a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);a.width=Math.min(a.width,this.Ob.width);
a.height=Math.min(a.height,this.Ob.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);this.ba.crop=[a.x,a.y,a.width,a.height].join()};a.prototype.Vr=function(a){var b=this.ba.crop;a=new F(0,0,this.Ob.width*a,this.Ob.height*a);b&&(b=b.split(","),a.x=parseFloat(b[0])|0,a.y=parseFloat(b[1])|0,a.width=parseFloat(b[2])|0,a.height=parseFloat(b[3])|0);return a};a.prototype.Bz=function(){var a={brightness:this.ja("brightness"),contrast:this.ja("contrast"),gamma:this.ja("gamma"),vc:this.ja("colour")};
this.zf=void 0!==a.brightness&&void 0!==a.contrast&&void 0!==a.gamma&&this.qc?this.Hr(this.qc,a)||this.qc:void 0!==a.vc&&this.qc?this.Hr(this.qc,{brightness:1,contrast:0,gamma:0,vc:a.vc})||this.qc:this.qc};a.prototype.format=function(a,c){function b(a,b,c){l.hg.push({x:l.Mc.x+a*l.Mc.width,y:l.Mc.y+b*l.Mc.height,md:c})}var d=this;null===this.qc&&"ImageSurface"in window?(this.qc=new window.ImageSurface(this.ba.url),this.Ob=new F(0,0,this.qc.width,this.qc.height)):null===this.qc?(this.Ob=new F(0,0,100,
20),c.add(this.id,"image",this.ba.url,null,function(a){d.log("Got image response.");d.qc=a;return c.Kf(d.id)})):this.Ob=new F(0,0,this.qc.width,this.qc.height);null===this.zf&&this.Bz();if(a=this.ja("width")||0)this.scale=a/this.Ob.width;this.Mc=this.Vr(this.scale);this.rect=this.Mc.clone();if(a=this.ja("boundingPolygon")){for(var h=[],k=0;k<a.length;k+=2)h.push(new D(a[k],a[k+1]));this.Qb=new Gc(h)}else this.Qb=new Gc(this.rect);this.Aa=this.rect.clone();this.Qb.transform(this.ba.matrix);this.rect.transform(this.ba.matrix);
this.hg.length=0;var l=this;b(.5,0,!0);b(1,.5,!1);b(.5,1,!0);b(0,.5,!1)};a.prototype.Wk=function(){return this.Qb};a.prototype.Db=function(a,c,e){return!this.ba.locked&&this.Qb.cd(a,c,Math.max(3,e))?this:null};a.prototype.pf=function(b){var c,e,f=!1;if(this.zf)try{var h=b.globalCompositeOperation,k=b.globalAlpha,l=this.ja("blendMode"),n=this.ja("opacity");l&&(b.globalCompositeOperation=""+l,this.log("Using globalCompsiteOperation=%s (requested %s)",b.globalCompositeOperation,l));void 0!==n&&(b.globalAlpha=
n);var q=this.ja("lineWidth")||0;if(q){b.save();this.Qc().jf(b);var v=this.Qb.clone();v.Ed(q/2);b.beginPath();v.la(b);b.lineWidth=q;b.strokeStyle=this.ja("strokeStyle")||"#000000";b.stroke();b.restore()}var x=this.scale;b.drawImage(this.zf,this.Mc.x/x,this.Mc.y/x,this.Mc.width/x,this.Mc.height/x,this.Mc.x,this.Mc.y,this.Mc.width,this.Mc.height);b.globalAlpha=k;b.globalCompositeOperation=h;if(a.kq){var w=this.Qb.ma;b.save();b.setTransform(1,0,0,1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle="#000000";
b.moveTo(w[0].x,w[0].y);var y=c=1;for(e=w.length-1;c<=e;y=c+=1)b.lineTo(w[y].x,w[y].y);b.closePath();b.stroke();b.restore()}}catch(B){this.log("Error drawing image: %s",B.message),f=B}if(null===this.zf||f)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.Ob.width,this.Ob.height),b.restore()};a.prototype.se=function(){return!0===this.ja("allowCrop")&&!0!==this.ja("lockEditMode")};a.prototype.Lk=function(a,c){a.save();a.beginPath();a.lineWidth=1*c;a.strokeStyle="#0050B7";for(var b=
this.Na(),d=0;d<this.hg.length;d++){var h=this.hg[d],k=b.apply(h.x,h.y),l;if(h.md){var n=20;var q=l=0;var v=3;h=k.x-10;k=k.y-6}else n=0,l=20,q=3,v=0,h=k.x-6,k=k.y-10;for(var x=0;5>x;x++)a.moveTo(h,k),a.lineTo(h+n*c,k+l*c),h+=q*c,k+=v*c}a.stroke();a.restore()};a.prototype.tl=function(a,c,e){var b=this.Na();e*=10;for(var d=0;d<this.hg.length;d++){var k=this.hg[d];k=b.apply(k.x,k.y);if(k.x-e<=a&&a<k.x+e&&k.y-e<=c&&c<k.y+e)return d}return null};a.prototype.$k=function(a){a=this.hg[a];this.Na().apply(a.x,
a.y)};a.prototype.Hn=function(){return"crop"};a.prototype.Ue=function(a,c,e){var b=this.Vr(this.scale);c=this.Qc().apply(c,e);c.x=Math.round(c.x);c.y=Math.round(c.y);0===a?(0>c.y&&(c.y=0),c.y>this.Ob.height&&(c.y=this.Ob.height),b.height-=c.y-b.y,b.y=c.y):1===a?(0>c.x&&(c.x=0),c.x>this.Ob.width&&(c.x=this.Ob.width),b.width=c.x-b.x):2===a?(0>c.y&&(c.y=0),c.y>this.Ob.height&&(c.y=this.Ob.height),b.height=c.y-b.y):3===a&&(0>c.x&&(c.x=0),c.x>this.Ob.width&&(c.x=this.Ob.width),b.width-=c.x-b.x,b.x=c.x);
this.Nz(b)};a.prototype.Hr=function(a,c){var b=a.width,d=a.height;if(!(a instanceof HTMLCanvasElement)){var h=document.createElement("canvas");h.width=b;h.height=d;h.getContext("2d").drawImage(a,0,0);a=h}h="number"===typeof c.brightness?c.brightness:-1;var k="number"===typeof c.contrast?c.contrast:-1,l="number"===typeof c.gamma?c.gamma:-1,n="string"===typeof c.vc?r.me(c.vc):null,q=document.createElement("canvas");this.log("filterSpec: %s",JSON.stringify(c));this.log("brightness=%s contrast=%s gamma=%s w=%s h=%s",
h,k,l,b,d);q.width=b+1;q.height=d;try{var v=a.getContext("2d").getImageData(0,0,b,d).data}catch(B){return this.log("Cannot filter external image."),null}a=q.getContext("2d").getImageData(0,0,b,d);c=a.data;for(b=0;b<v.length;b+=4){d=v[b]/255;var x=v[b+1]/255,w=v[b+2]/255,y=v[b+3];0<=l&&(d=Math.pow(d,l),x=Math.pow(x,l),w=Math.pow(w,l));0<=h&&(d*=h,w*=h,x*=h);0<=k&&(d=d*k-.5*k+.5,x=x*k-.5*k+.5,w=w*k-.5*k+.5);n&&0<y&&(d=n.values[0],x=n.values[1],w=n.values[2]);c[b]=Math.min(255*d|0,255);c[b+1]=Math.min(255*
x|0,255);c[b+2]=Math.min(255*w|0,255);c[b+3]=y}q.getContext("2d").putImageData(a,0,0);return q};a.kq=!1;return a}(dd);dd.vd("ImageNode",Mh);var Nh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.log=u.create("SvgNode",!0);a.Ld=new Ld;a.Qb=new Gc;a.Za=new fd;a.scale=1;delete a.ba.lineWidth;delete a.ba.fillStyle;delete a.ba.strokeStyle;a.ba.url="";return a}__extends(a,c);a.prototype.type=function(){return"SvgNode"};a.prototype.ad=function(a){switch(a){case "url":case "textFillStyle":case "textAlign":case "fontSize":case "fontName":case "bold":case "italic":case "textDecoration":case "text":case "width":case "fillStyle":case "strokeStyle":case "lineWidth":case "fillMode":return!0}return c.prototype.ad.call(this,
a)};a.prototype.qg=function(){return!1};a.prototype.format=function(a,c){var b=this,d=this.ja("url");if(this.Ld.src!==d)this.Ld.Vy(d).then(function(){c.Kf(b.id)},function(a){console.warn("Error opening "+d+": "+a.message)});else if(this.Ld.ready){this.Ld.Va("\n        .fill {\n            fill: "+this.ba.fillStyle+";\n        }\n        \n        .stroke {\n            fill: "+this.ba.strokeStyle+";\n        }");var h=this.ba.text;h&&(this.Za.bm(this.ba.fontName||"sans-serif",this.ba.fontSize||10,
this.ba.bold||!1,this.ba.italic||!1,this.ba.textDecoration||""),this.Za.Nf(h),this.Za.format(a,0,0));this.Aa=this.Ld.rect.clone();this.scale=this.ba.width?this.ba.width/this.Aa.width:1;this.Aa.width*=this.scale;this.Aa.height*=this.scale;this.Qb=new Gc(this.Aa);a=this.Na();this.Qb.transform(a);this.rect=this.Qb.dr()}};a.prototype.ja=function(a){if("custom"===this.ba.fillMode)switch(a){case "fillStyle":return this.ba.fillStyle||"transparent";case "strokeStyle":return this.ba.strokeStyle||"#000";case "lineWidth":return this.ba.lineWidth||
1}return c.prototype.ja.call(this,a)};a.prototype.wb=function(){var a=c.prototype.wb.call(this);"custom"===a.fillMode&&(a.fillStyle=this.ja("fillStyle"),a.strokeStyle=this.ja("strokeStyle"),a.lineWidth=this.ja("lineWidth"));return a};a.prototype.pf=function(a){if(this.Ld.ready){a.scale(this.scale,this.scale);if("custom"===this.ba.fillMode){a.save();a.beginPath();this.Ld.la(a,null,!0);a.fillStyle=this.ja("fillStyle");a.fill();var b=this.Qc();b.mm().multiply(b).jf(a);a.strokeStyle=this.ja("strokeStyle");
a.lineWidth=this.ja("lineWidth")/this.scale;a.stroke();a.restore()}else this.Ld.la(a);a.scale(1/this.scale,1/this.scale);this.ba.text&&(a.beginPath(),a.fillStyle=this.ba.textFillStyle||"#000",this.Za.la(a,this.Ld.rect.x+this.Aa.width/2-this.Za.rect.width/2,this.Ld.rect.y+this.Aa.height/2-this.Za.rect.height/2),a.fill())}};return a}(dd);dd.vd("SvgNode",Nh);var Oh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.ek="UnknownNode";a.width=100;a.height=20;a.Za=new fd;a.log=u.create("UNKNOWN",!0);a.Za.jp("center","middle");return a}__extends(a,c);a.prototype.fA=function(a){this.ek=a;this.Za.Nf(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.ek};a.prototype.setProperty=function(a,c){this.ba[a]=c};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.ek);this.rect=new F(0,0,this.width,
this.height);this.rect.transform(this.ba.matrix);this.Za.format(a,this.width,this.height)};a.prototype.pf=function(a){this.log("Drawing placeholder for for %s",this.ek);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle="#000000";this.Za.la(a,0,0);a.restore()};a.kq=!1;return a}(dd);dd.vd("UnknownNode",Oh);var Ph=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.GB="DataNode";return a}__extends(a,c);a.prototype.type=function(){return"DataNode"};a.prototype.ad=function(){return!0};return a}($c);$c.vd("DataNode",Ph);var Qh=u.create("RootNode"),Rh=function(c){function a(a,d,e){a=c.call(this,a,d)||this;Qh("Root node is constructed: Traits=%s",a.Gb);a.da=e;return a}__extends(a,c);a.prototype.ad=function(){return!0};return a}(dh($c));var Cg=new rc(816,1056),Sh=u.create("DOC"),Ag=function(){function c(a,b,c){this.Tx=c;this.nd=document.createElement("DIV");this.rd=new yf;this.Or=!0;this.Zb="0";this.hj=new yf;this.removedNodes=new yf;this.Xo={};this.gh=new yf;this.fm=0;this.Bp="magenta";this.readOnly=!1;this.kn=new yf;this.Ti=new yf;this.hq=new yf;this.ye=[];this.Ct=this.yh=this.yi=this.ab=0;this.ct=function(){};this.Di=[];this.zh=0;this.nd.setAttribute("nid","0");this.root=new Rh(this.el(),this,this.nd);this.Ra=new Fh(this,this.root);
this.nb=new Dh(this.Ra,Fg(3));a||(this.$a(),this.Fc(this.Xi(0,{})),this.wa(!0));b&&this.Su(b,c);this.Fs()}c.prototype.Su=function(a,b){var c=this;A(a).query("[z-fixture]",function(a){var d=a.getAttribute("z-fixture")||"",e=new gh(d,c);e.da=a;e.Lr=!0;e.rp(b);Sh("Register fixture %s",d);e.da.setAttribute("nid",d);c.nb.gk(d);c.Ra.Yu(d,e);c.Di.push(e)})};c.prototype.empty=function(){return 0===this.root.Ua()};c.prototype.Fs=function(){this.Ct=this.nb.next};c.prototype.uf=function(){return this.Ct!==this.nb.next};
c.prototype.Ta=function(){this.Ra.ed(function(a){a.Ta()})};c.prototype.el=function(){var a=this.Zb;this.Zb=((2147483647*Math.random()|0)+1).toString(36);return a};c.prototype.zd=function(a){return this.Ra.zd(a)};c.prototype.Ts=function(a){Sh("onCreateNode: %s",a);"PageNode"!==a.type()&&(this.hj.add(a.id),this.removedNodes.remove(a.id));a.ja("spotHighlight")&&"PathNode"===a.type()&&this.ye.push(a);this.yh=this.Me(a.id)||0;"DomNode"===a.type()?this.kn.add(a.id):"PageNode"===a.type()&&(this.yi=-1);Uc(a)&&
(a.Kl(),a.Qh(this.readOnly),this.rd.add(a.id),this.hq.add(a.Bd()))};c.prototype.gj=function(a){this.gh.add(a);this.rd.add(a)};c.prototype.Oa=function(a,b){void 0===b&&(b=!1);if(this.Ra.zd(a)){var c=this.Ra.Oa(a);b&&(this.rd.add(a),this.gh.add(a));return c}return null};c.prototype.ob=function(a,b){void 0===b&&(b=!1);return(a=this.Oa(a,b))&&Uc(a)?a:null};c.prototype.Me=function(a){for(a=this.Oa(a,!1);;)if(a)if("PageNode"===a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;
a=this.root.ne(a);return 0<=a?a:null};c.prototype.Bx=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.Oa(a[c],!1);e&&b.push(e)}return b=this.vk(b)};c.prototype.Cw=function(a){var b=[];this.Ra.ed(function(c){c.ja("tag")===a&&b.push(c)});return b};c.prototype.$a=function(){this.zh++;Sh("begin(); nested transactions=%s",this.zh)};c.prototype.wa=function(a){void 0===a&&(a=!1);this.zh=Math.max(this.zh-1,0);Sh("commit(skip=%s); nested transactions=%s",a,this.zh);0===this.zh?(this.nb.wa(!1,a),this.Ra.wa(!1)):
Sh("In a nested transaction; not committing.")};c.prototype.transaction=function(a){this.$a();a(this);this.wa()};c.prototype.Ll=function(a){Sh("onCommit occured");this.ct(a,this.hj.ac(),this.removedNodes.ac(),this.gh.Hk(this.hj).Hk(this.removedNodes).ac(),this.Xo);this.hj=new yf;this.removedNodes=new yf;this.gh=new yf;this.Xo={}};c.prototype.Hc=function(){this.nb.Hc()};c.prototype.ae=function(){this.nb.ae()};c.prototype.Fe=function(){return this.nb.Fe()};c.prototype.Ee=function(){return this.nb.Ee()};
c.prototype.Yl=function(){this.nb.Zm()};c.prototype.format=function(a,b){var c=this,e=[],f;this.Or?this.Ra.ed(function(a){Uc(a)&&e.push(a)}):this.rd.ed(function(a){a=c.Ra.Oa(a);Uc(a)&&e.push(a);return!1});var h=this.vk(e);var k=0;for(f=h.length;k<f;k++){var l=h[k];l.format(a,b)}this.rd.clear();this.Or=!1;this.Kv();return e.length};c.prototype.mw=function(a,b,c){if(0!==this.ye.length&&b===this.fm){a.save();a.beginPath();b=c||this.kc();a.moveTo(b.x,b.y);a.lineTo(b.x,b.bottom());a.lineTo(b.right(),b.bottom());
a.lineTo(b.right(),b.y);a.closePath();c=!1;for(var d=0;d<this.ye.length;d++)this.Me(this.ye[d].id)===this.ab&&(this.ye[d].clip(a),c=!0);c&&(a.clip(),a.fillStyle=this.Bp,a.fillRect(b.x,b.y,b.width,b.height));a.restore()}};c.prototype.Le=function(a,b){b=b||this.kc();var c=this.ja("background");c&&(c=r.Gi(c))&&(a.fillStyle=c.toString(),a.fillRect(b.x,b.y,b.width,b.height))};c.prototype.la=function(a,b){function c(c){f.gc(function(b){f.Ti.contains(b.jc())||b.Bd()!==c||b.hidden()||(b.Kt(k++),b.la(a))});
f.mw(a,c,b)}var e,f=this;this.hq.add(this.fm);var h=this.hq.DA();h.sort(function(a,b){return a-b});var k=0;var l=0;for(e=h.length;l<e;l++)c(h[l])};c.prototype.Db=function(a,b,c,e){var d=null;this.gc(function(f){c.has(f.jc())&&f.Db(a,b,0)&&(!(null===d||d.Bd()<=f.Bd())||e&&e!==f.type()||(d=f))});return d};c.prototype.Sx=function(a,b,c){var d=[],f=0,h={};this.gc(function(e){e.Db(a,b,c)&&(d.push(e),h[e.id]=f,f+=1)});d.sort(function(a,b){return a.Bd()!=b.Bd()?a.Bd()-b.Bd():h[a.id]-h[b.id]});d.reverse();
return d};c.prototype.Dx=function(a){var b=[];this.gc(function(c){a.contains(c.rect)&&b.push(c)});return b};c.prototype.vk=function(a){var b,c=[],e={};var f=0;for(b=a.length;f<b;f++){var h=a[f];if("PageNode"!==h.type()){if(!Uc(h))continue;for(;h.io()&&h.parent;)Sh("Node type %s:%s is a group member",h.id,h.type()),Uc(h.parent)&&(h=h.parent)}h.id in e||(e[h.id]=h,c.push(h))}this.sA(c);return c};c.prototype.ed=function(a,b){function c(d){if(d.Ua()){a&&Uc(d)&&b(d);for(var e=0;e<d.Ua();e++)c(d.Cb(e))}else Uc(d)&&
b(d)}c(this.root)};c.prototype.Nk=function(a,b,c){function d(b){if((Uc(b)||c)&&!1===a(b))return!1;if(0!=(b.Gb&2)){for(var e=[],f=0;f<b.Ua();f++)e.push(b.Cb(f));for(b=0;b<e.length;b++)if(!1===d(e[b]))return!1}}void 0===c&&(c=!1);for(var f=0;f<b.Ua();f++)d(b.Cb(f))};c.prototype.gc=function(a,b){void 0===b&&(b=this.ab);b<this.root.Ua()&&this.Nk(a,this.root.Cb(b||0))};c.prototype.Pw=function(a){var b=!1,c=a.Wk(),e=[];this.gc(function(d){b?d.Wk().Wx(c)&&e.push(d):d===a&&(b=!0)});return e};c.prototype.sA=
function(a){var b=0,c={};this.ed(!0,function(a){c[a.id]=b++});a.sort(function(a,b){return c[a.id]-c[b.id]})};c.prototype.Ez=function(a){var b=[],c=0;a=this.vk(a);for(var e=0;e<a.length;e++)c=this.Gq(a[e],b,c,null);return"zwibblerclip."+JSON.stringify(b)};c.prototype.Gq=function(a,b,c,e){var d=a.wb(),h={},k;for(k in d){var l=d[k];l instanceof I&&(l=["Matrix",l.m11,l.m12,l.m21,l.m22,l.Ea,l.Fa]);h[k]=l}null===e&&a.parent&&"PageNode"!==a.parent.type()&&(e=a.parent.id);b.push({type:"CreateAction",node:a.type(),
parent:e,properties:h});h=c+1;for(e=0;e<a.Ua();e++)h=this.Gq(a.Cb(e),b,h,c);return h};c.prototype.Es=function(a,b,c){var d,f;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var h=[];a=JSON.parse(a);var k={},l=0,n=0;var q=0;for(f=a.length;q<f;q++){var v=a[q];if("GroupAction"===v.type){var x=this.el();k[l++]=x;x=[];var w=0;for(v=v.members;w<v.length;w++)x.push(k[v[w]]);v=this.group(x);k[l++]=v;h.push(v)}else if("CreateAction"===v.type){var y=v.properties;x={};for(d in y)y.hasOwnProperty(d)&&(w=y[d],
"[object Array]"===Object.prototype.toString.apply(w)&&"Matrix"===w[0]&&(w.splice(0,1),w=new I(w)),x[d]=w);y=this.Xk();var B=-1;w=!0;if("parent"in v&&v.parent in k)y=k[v.parent],w=!1;else if("PageNode"===v.node)y=this.root.id,B=this.ab+1+n,n+=1;else if("string"===typeof v.parent){var E=this.Oa(v.parent,!1);E&&this.ko(E)?y=E.id:E&&this.Me(E.id)===this.ab&&(y=E.id)}c&&"default"!==c&&"PageNode"!==v.node&&(x.layer=c);x=this.createNode(v.node,x,y,B);k[l++]=x;("HTMLNode"!==v.node||w)&&h.push(x)}}0!==n||
b.xs()||this.Sf(h,b)};c.prototype.qz=function(a,b){var c="function"!==typeof b?function(a){return a===b}:b;for(var e=0,f=0;f<a.length;f++)c(a[f])?e+=1:e&&(a[f-e]=a[f]);a.length-=e};c.prototype.Us=function(a){var b=this.Me(a.id)||0;this.hj.remove(a.id);this.gh.remove(a.id);this.removedNodes.add(a.id);this.Xo[a.id]=a.wb();Uc(a)&&a.Nl();a.Ta();this.rd.remove(a.id);a.ja("spotHighlight")&&this.qz(this.ye,a);this.kn.remove(a.id);"PageNode"===a.type()?(b===this.ab?(Sh("Removed current page."),this.Fc(Math.min(b,
this.jb()-2)),this.yh=this.ab):b<this.ab&&(this.Fc(this.ab-1),this.yh=this.ab),this.yi=-1):this.yh=b};c.prototype.Tr=function(a){function b(a){if(!k||a.rect.x<c)c=a.rect.x;if(!k||a.rect.right()>e)e=a.rect.right();if(!k||a.rect.y<f)f=a.rect.y;if(!k||a.rect.bottom()>h)h=a.rect.bottom();k=!0}var c=0,e=0,f=0,h=0,k=!1;"number"===typeof a?this.gc(b,a):this.ed(!0,b);return k?new F(c,f,e-c,h-f):new F(0,0,10,10)};c.prototype.Qx=function(){var a=this.Ne(void 0),b=null;a instanceof hh&&(b=a.kc());return b||
this.root.vh("width")};c.prototype.kc=function(a,b){var c=null;if(void 0!==a){var e=this.Ne(a);e instanceof hh&&(c=e.kc())}return c?c.FA():this.ja("width")?new F(0,0,this.ja("width"),this.ja("height")):b?new F(0,0,b.width,b.height):this.Tr(a)};c.prototype.ja=function(a){return this.root.ja(a)};c.prototype.vh=function(){return this.root};c.prototype.setProperty=function(a,b){this.Ec([this.root.id],a,b)};c.prototype.Ec=function(a,b,c){var d={};d[b]=c;this.$a();this.$b(a,d);this.wa()};c.prototype.$b=
function(a,b){var c=this;this.gg(a,function(a){c.nb.Gc(a.id,b)})};c.prototype.at=function(a,b){this.rd.add(a.id);this.gh.add(a.id);this.yh=this.Me(a.id)||0;if("spotHighlight"in b&&"PathNode"===a.type()){for(var c=0;c<this.ye.length;c++)if(this.ye[c]===a){this.ye.splice(c,1);break}b.spotHighlight&&"PathNode"===a.type()?(Sh("Added node %s to spotHighlightNodes",a.id),this.ye.push(a)):Sh("Removed node %s from spotHighlightNodes",a.id)}};c.prototype.Fj=function(a,b){Sh("showLayer(%s, %s)",a,b);b?(this.Ti.remove(a),
this.gc(function(b){if(b.jc()===a){b.Kl();var c=b.parent;Vc(c)&&(b=c.ne(b),c.Ej(b,!0))}})):(this.Ti.add(a),this.gc(function(b){if(b.jc()===a){b.Nl();var c=b.parent;Vc(c)&&(b=c.ne(b),c.Ej(b,!1))}}))};c.prototype.jo=function(a){return!this.Ti.contains(a)};c.prototype.Xi=function(a,b){Sh("Adding page to document with index %s",a);if(a>this.root.Ua())return Sh("Error: Can insert page with index %s",a),-1;this.createNode("PageNode",b,this.root.id,a);return a};c.prototype.jb=function(){return this.root.Ua()};
c.prototype.Fc=function(a){if(a!==this.ab){if(0<=a&&a<this.jb())return Sh("Set current page to %s/%s",a,this.jb()),this.ab=a,!0;Sh("Tried to set page to non-existing %s",a);return!1}};c.prototype.mA=function(){if(this.yi!==this.ab){this.Qp(this.yi,!1);this.Qp(this.ab,!0);this.yi=this.ab;for(var a=0;a<this.jb();a++)this.root.Ej(a,a===this.ab)}};c.prototype.Qp=function(a,b){var c=this;b?this.gc(function(a){"DomNode"!==a.type()||c.Ti.contains(a.jc())||a.Kl()},a):this.kn.ed(function(a){(a=c.ob(a,!1))&&
a.Nl()})};c.prototype.Ne=function(a){void 0===a&&(a=this.ab);return 0===this.root.Ua()?this.root:this.root.Cb(a)};c.prototype.gl=function(){return this.kc(this.ab,Cg)};c.prototype.Qh=function(a){this.ed(!1,function(b){b.Qh(a)})};c.prototype.getRootNode=function(){return this.root};c.prototype.ny=function(a,b){var c=b.$type||b.type||"",e=$c.create(c,a,this);e||(c in Q.Dk?(e=new Kh(a,this),e.setProperty("nodeType",c)):(Sh("Bad node type: %s",c),a=$c.create("UnknownNode",a,this),a.fA(c),e=a));5===(e.Gb&
5)&&e.rp(this.Tx);e.Gc(b);return e};c.prototype.createNode=function(a,b,c,e,f){f||(f=this.el());c||(c=this.Xk());var d=this.Oa(c);if(!d)throw Error("createNode type="+a+": parent "+c+" does not exist");if(void 0===e||-1==e)e=d.Ua();b.$type=a;this.nb.createNode(f,c,e,b);return f};c.prototype.gg=function(a,b){for(var c=0;c<a.length;c++){var e=a[c],f=this.Oa(e);f?b(f):Sh("Node %s does not exist",e)}};c.prototype.wc=function(a){function b(a){for(var d=a.Ua()-1;0<=d;d--)b(a.Cb(d));c.nb.Ke(a.id)}var c=
this;this.gg(a,function(a){a.parent?b(a):Sh("deleteNode(%s): node has no parent",a.id)})};c.prototype.Sf=function(a,b){var c=this;this.gg(a,function(a){Uc(a)&&c.$b([a.id],a.De(b))})};c.prototype.Ue=function(a,b,c,e){var d=this.ob(a,!0);if(d&&d.se()){var h=d.Hn(),k=d.ja(h);d.Ue(b,c,e);b=d.ja(h);d.setProperty(h,k);this.Ec([a],h,b)}};c.prototype.Xk=function(){return this.root.Cb(this.ab).id};c.prototype.group=function(a){var b=this.createNode("GroupNode",{});this.hk(b,a);return b};c.prototype.hk=function(a,
b){var c=this,e=0;this.gg(b,function(b){if(!b.parent)throw Error("Expected node to have a parent");c.nb.Sc(b.id,a,e++)})};c.prototype.Th=function(a){var b=this,c={};this.gg(a,function(a){if(a instanceof xf&&!(a.id in c)&&a.parent){c[a.id]=!0;for(var d=a.parent.Ua(),e=a.Ua()-1;0<=e;e--)b.nb.Sc(a.children[e].id,a.parent.id,d);b.wc([a.id])}})};c.prototype.duplicate=function(a,b,c){function d(a,b){if(!k.has(a.id)){k.add(a.id);var c=a.wb();if(Uc(a)){var e=a.De(h),l;for(l in e)c[l]=e[l]}b=f.createNode(a.type(),
c,b);if(0!=(a.Gb&2))for(c=0;c<a.Ua();c++)d(a.Cb(c),b)}}var f=this,h=new uc(b,c),k=new Set;this.gg(a,function(a){null!==a.parent&&d(a,a.parent.id)})};c.prototype.Sc=function(a,b,c){var d=this.Oa(a);if(null===d)throw Error("moveNode: "+a+" does not exist");var f=this.Oa(b);if(null===f)throw Error("moveNode: New parent "+b+" does not exist");-1===c&&(c=d.parent!==f?f.Ua():f.Ua()-1);if(null===d.parent)throw Error("Expected a parent");f===d.parent&&c===d.parent.ne(d)?Sh("moveNode: Skip moving to the same place"):
this.nb.Sc(a,b,c)};c.prototype.xd=function(a,b,c){var d=this;void 0===c&&(c=-1);this.gg(a,function(a){if(a.parent){var e=a.parent.id,f=a.parent.ne(a);switch(b){case 0:d.Sc(a.id,e,-1);break;case 1:d.Sc(a.id,e,0);break;case 3:0<f&&d.Sc(a.id,e,f-1);break;case 2:f<a.parent.Ua()-1&&d.Sc(a.id,e,f+1);break;case 4:d.Sc(a.id,e,c)}}})};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a,b){void 0===b&&(b="");if(!(a instanceof $c))return b+"NOT A NODE: "+a+"\n";for(var c=
b+" "+a+"\n",e=0;e<a.Ua();e++)c+=this.encode(a.Cb(e),b+"  ");return c};c.prototype.Kn=function(a){if(a instanceof Element)for(;a;){var b=a.getAttribute("nid");if(b&&(b=this.Oa(b))&&5===(b.Gb&5))return b;a=a.parentElement}return null};c.prototype.Kv=function(){this.yq(this.nd,new I,null,0,0)};c.prototype.yq=function(a,b,c,e,f){if(a instanceof HTMLElement){var d=a.offsetLeft-a.scrollLeft,k=a.offsetTop-a.scrollTop;c===a.offsetParent&&(d-=e,k-=f);b=b.multiply(new uc(d,k));c=a.getAttribute("nid")||"0";
(c=this.Oa(c))&&Wc(c)&&(e=new F(0,0,c.da.offsetWidth,c.da.offsetHeight),e.transform(b),c.qp(e,b));for(c=a.firstElementChild;c;)this.yq(c,b,a.offsetParent,a.offsetLeft,a.offsetTop),c=c.nextElementSibling}};c.prototype.Xn=function(){return this.nb.Xn()};c.prototype.locked=function(){return this.nb.locked()};c.prototype.Zx=function(a){return Wc(a)?A(a.da).matches("[z-fixture] *"):!1};c.prototype.ko=function(a){return Wc(a)&&a.da.hasAttribute("z-fixture")};return c}();var Bg=new (function(){function c(){this.log=u.create("serializer");this.iq={pdf:"application/pdf",svg:"image/svg+xml",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp"}}c.prototype.ci=function(a,b,c){if(a instanceof Array)b=this.rs(a,b,c);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.iy(a,b,c);else if(0===a.indexOf("zwibbler3."))a=JSON.parse(a.substr(10)),b=this.rs(a,b,c);else if(0===a.indexOf("zwibblerclip."))b=
new Ag(!1,b,c),b.Es(a,new I,"default"),b.Yl();else{try{Bh(a);var d=!0}catch(f){d=!1}if(d)b=new Ag(!0,b,c),b.nb.Zf(a);else throw Error("Format detection failed.");}}for(a=1;a<b.jb();a++)b.Qp(a,!1);return b};c.prototype.iy=function(a,b,c){function d(a){var b=new I;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Ea=a.dx;b.Fa=a.dy;return b}function f(a,b){switch(a.type){case "Node":var c=[];a=a.children;for(var e=a.length-1;0<=e;e--)try{c.push(f(a[e],b+1))}catch(L){}return 0<b?k.group(c):"";case "PathNode":case "ArrowNode":var h=
a;c=0;"arrowSize"in h&&(c=h.arrowSize,h=h.path);b=d(h.matrix);c={strokeStyle:h.strokeStyle,fillStyle:h.fillStyle,lineWidth:h.lineWidth,smoothness:h.smoothness,sloppiness:h.sloppiness,shadow:h.shadow,arrowSize:c,seed:Math.round(65535*Math.random())};"textNode"in h&&(a=h.textNode,c.fontSize=a.fontSize,c.fontName=a.fontName,c.text=a.text,c.textFillStyle="textFillStyle"in a?a.textFillStyle:a.fillStyle);"path"in h&&(h=h.path);var l=h.startX,n=h.startY;a=h.closed;e=new M;h=h.segments;l=b.apply(l,n);e.moveTo(l.x,
l.y);for(l=0;l<h.length;l++){var q=h[l];switch(q.type){case 1:n=b.apply(q.x,q.y);e.lineTo(n.x,n.y);break;case 2:n=b.apply(q.x,q.y);e.ui(n.x,n.y);break;case 3:n=b.apply(q.x1,q.y1);q=b.apply(q.x,q.y);e.dg(n.x,n.y,q.x,q.y);break;default:throw"Unknown path segment type: "+q.type;}}a&&e.close();c.commands=e.ac();return k.createNode("PathNode",c);case "TextNode":return b=d(a.matrix),b=b.multiply(new uc(0,1.3*a.fontSize)),k.createNode("TextNode",{fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,
fontSize:a.fontSize,matrix:b});default:throw Error("Unknown node type: "+a.type);}}var h=u.create("IMPORT"),k=new Ag(!1,b,c);try{var l=JSON.parse(a)}catch(n){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{l=JSON.parse(a)}catch(q){throw h("Couldn't parse file."),"Couldn't parse file.";}}h("Successfully parsed!");f(l,0);k.wa(!0);return k};c.prototype.rs=function(a,b,c){function d(a,b){if(void 0!==a){var c={};for(e in a)a.hasOwnProperty(e)&&"children"!==e&&"parent"!==e&&"id"!==e&&"type"!==e&&("matrix"===
e?c[e]=new I(a[e]):"__type"===e?c.type=a[e]:c[e]=a[e]);if(a.fixture)var e=a.fixture;else if("id"in a)e=a.id.toString(36);else return;"0"!==b||h||(b=n.Xk());0===a.id||q[a.id]||n.createNode(a.type,c,b,-1,e);if(void 0!==a.children)for(b=0;b<a.children.length;b++)d(a.children[b],e)}}a=JSON.parse(JSON.stringify(a));var f={},h=!1;var k=0;for(var l=a;k<l.length;k++)if("PageNode"===l[k].type){h=!0;break}var n=new Ag(h,b,c),q={};b=0;for(c=n.Di;b<c.length;b++)q[c[b].id]=!0;n.$a();for(b=0;b<a.length;b++){k=
a[b];if("document"===k.type||0===k.id){delete k.type;for(var v in k)n.setProperty(v,k[v])}if("parent"in k){if(!(k.parent in f))throw Error("Error: child "+k.id+" references parent "+k.parent+" before it was defined.");c=f[k.parent];void 0!==c.children?c.children.push(k):c.children=[k]}"GroupNode"!==k.type&&"PageNode"!==k.type||void 0!==k.children||(k.children=[]);f[k.fixture||k.id]=k}d(f[0],"0");for(var x in f)x in q&&d(f[x],"");n.wa(!0);return n};c.prototype.Er=function(a){function b(a,d){var f=
d.id in e,h={type:d.type()};f?h.fixture=d.id:h.id=parseInt(d.id,36);c.push(h);a&&(h.parent=a.id in e?a.id:parseInt(a.id,36));a=d.wb();for(var k in a)a.hasOwnProperty(k)&&(a[k]instanceof I?h[k]=a[k].ac():"inverse"!==k&&("type"===k?h.__type=a[k]:h[k]=a[k]));for(h=0;h<d.Ua();h++)b(d,d.Cb(h))}for(var c=[],e={},f=0,h=a.Di;f<h.length;f++){var k=h[f];e[k.id]=!0}b(null,a.getRootNode());f=0;for(a=a.Di;f<a.length;f++)k=a[f],b(null,k);return c};c.prototype.Vj=function(a,b,c){b in this.iq&&(b=this.iq[b]);if("list"===
b)a=this.Er(a),b="application/json";else if("zwibbler3"===b)a=this.Er(a),a="zwibbler3."+JSON.stringify(a),b="application/octet-stream";else if("image/svg+xml"===b){var d=a.kc();var f=new ue(d);a.Le(f);a.la(f);a=f;b="image/svg+xml"}else if("application/pdf"===b){d=a.kc(0);f=new hf(new F(0,0,d.width,d.height),Q.fonts);var h=a.ab;for(b=0;b<a.jb();b++)0<b&&(d=a.kc(b),f.Rh(d)),f.translate(-d.x,-d.y),a.Fc(b),a.Le(f),a.la(f);a.Fc(h);a=f;b="application/pdf"}else if(!(d="image/png"===b||"image/bmp"===b)&&
(d="image/jpeg"==b)&&(d=document.createElement("canvas"),f=!1,d.width=10,d.height=10,"toDataURL"in d&&(f=0<d.toDataURL("image/jpeg").indexOf("jpeg")),ic("JPEG supported: %s",f),d=f),d)f=document.createElement("canvas"),d=a.kc(),f.width=d.width,f.height=d.height,h=f.getContext("2d"),h.translate(-d.x,-d.y),a.Le(h),a.la(h),a="image/bmp"===b?nc(f):f.toDataURL(b),a=a.split(",")[1],a=atob(a);else throw"Unknown save format: "+b;if("string"===typeof a)if("string"===c)var k=a;else if("data-uri"===c)k="data:"+
b+";base64,"+Pa(Qa(a));else{if("blob"===c)for(c=new Uint8Array(a.length),b=0;b<a.length;b++)c[b]=a.charCodeAt(b)}else if(a.toBlob&&a.toString)"string"===c?k=a.toString():"data-uri"===c?k="data:"+b+";base64,"+Pa(Qa(a.toString())):"blob"===c&&(k=a.toBlob());else if("object"===c)k=a;else throw"Error in ZwibblerDocument.save()";return k};return c}());"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new X(d,c,{});d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Z=function(){function c(){this.Yi=[];this.buttons=[];this.Dk={};this.fonts=new Ge;this.Ie={};this.log=u.create("ZWIBBLER");this.WebSocket=WebSocket;this.Kb=new Ya;this.controllers={};this.su=X}c.prototype.create=function(a,b,c){void 0===c&&(c={});"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);var d=A.ic(a);if(!d)throw alert("Zwibbler.create: Cannot find an element with id "+a),Error("Error in Zwibbler.creawte");return new X(d,b,c)};c.prototype.Pu=function(a){for(var b=
["name","image","onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+b[c]),!1;this.buttons.push(a);return!0};c.prototype.Ru=function(a,b){this.Dk[a]=b};c.prototype.zu=function(a,b){void 0===b&&(b={});return this.Am(a,b)};c.prototype.Am=function(a,b){void 0===b&&(b={});return ud(a,b)};c.prototype.Yv=function(a,b){return this.Ig(a,b)};c.prototype.Ib=function(a,b){P.Ib(a,function(a,c,f,h){b(new rb(P,a,c,f,h))})};c.prototype.Ig=function(a,b,c){function d(){var a=y.kc(),
b=1,d=0,e=0;l&&(a.y=l);v&&(a.height=v-a.y);n&&(a.x=n);q&&(a.width=q-a.x);h&&k?b=Math.min(h/a.width,k/a.height):h?(b=h/a.width,k=a.height*b):k?(b=k/a.height,h=a.width*b):(h=a.width,k=a.height);a.width*b<h&&(d=h/2-a.width*b/2);a.height*b<k&&(e=k/2-a.height*b/2);d-=a.x*b;e-=a.y*b;x.width=Math.ceil(h);x.height=Math.ceil(k);w.translate(d,e);w.scale(b,b);y.la(w);f.log("Drawn.");c(x)}var f=this;void 0===b&&(b={});void 0===c&&(c=function(){});var h=b.width||0,k=b.height||0,l=b.top||0,n=b.left||0,q=b.right||
0,v=b.bottom||0,x=jc(null),w=x.getContext("2d"),y=Bg.ci(a,null,{});if(!y)throw Error("Zwibbler.render: Could not open document");var B=new sf;y.format(w,B);B.pa("reformat",function(a){y.gj(a)});B.eh?B.pa("done",function(){y.format(w,B);d()}):d();return x};c.prototype.save=function(a,b){return new Promise(function(c,e){var d=Bg.ci(a,null,{});if(d){d.vh("background")||d.setProperty("background","white");var h=jc(null).getContext("2d"),k=new sf;k.pa("reformat",function(a){d.gj(a)});k.pa("done",function(){try{d.format(h,
k);var a=Bg.Vj(d,b,"string");c(a)}catch(n){e(n)}});d.format(h,k)}else e(Error("Failed to open document"))})};c.prototype.Zy=function(a){a=r.me(a);return{r:a.values[0],g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.ly=function(a){return(new r(r.RGBA,[a.r,a.g,a.b,a.a])).toString()};c.prototype.Kw=function(a){var b=document.createElement("a");b.href=a;return b.href};c.prototype.nv=function(a){return Pa(Qa(a))};c.prototype.Tu=function(a){var b=this;return this.fonts.add(a).then(function(c){b.Cf('\n@font-face {\n    font-family: "'+
c[0].kg+'";\n    src: url("'+a+'");\n}');return c[0].kg})};c.prototype.yu=function(a){return new M(a)};c.prototype.ru=function(a){var b=new M;Lc(b,a);return b.ac()};c.prototype.Ln=function(a,b){var c=document.createElement("img");c.src=a;c.onload=function(){b&&b(c.naturalWidth,c.naturalHeight,c)}};c.prototype.to=function(a){return new Promise(function(b,c){var d=document.createElement("img");d.src=a;d.onerror=function(){c(Error("Error loading image "+a))};d.onload=function(){b(d)}})};c.prototype.Mz=
function(a,b){return lc(a,b)};c.prototype.HA=function(a){return this.Kj(a)};c.prototype.zl=function(){var a=document.createElement("DIV");return!!(a.requestFullscreen||a.msRequestFullscreen||a.yy||a.webkitRequestFullscreen)};c.prototype.Kj=function(a){var b=A.ic(a);if(!b)throw Error("Zwibbler.toggleFullScreen: "+a+" not found");a=document;this.ws()?document.exitFullscreen?document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.xy?a.xy():a.webkitExitFullscreen&&a.webkitExitFullscreen():
b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.yy?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):console.log("Element does not contain any requestFullscreen methods")};c.prototype.ws=function(){var a=document;return a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?!0:!1};c.prototype.rw=function(){u.qw()};c.prototype.ks=function(a){return rf.uu(a)};c.prototype.Cf=
function(a){this.Kb.bo(a)};c.prototype.controller=function(a,b){this.controllers[a]=b};c.prototype.xk=function(a,b){P.xk(a,b);this.Ie[a]=b};c.prototype.Zw=function(a){return a in this.Ie?JSON.parse(JSON.stringify(this.Ie[a].va||{})):{}};c.prototype.Ak=function(a,b,c,e){void 0===c&&(c={});void 0===e&&(e=null);if("object"!==typeof a||"string"!==typeof b)throw Error("Bad arguments passed to createComponent");return P.Ak(a,b,c,e)};c.prototype.ew=function(a){P.detach(a);A(a).remove()};c.prototype.Kc=function(a,
b){var c=A.ic(a);if(!c)throw Error("Zwibbler.attach: Cannot find element from "+a);return ah(c,b,!0)};c.prototype.detach=function(a){P.detach(a)};c.prototype.av=function(a){return"string"!==typeof a.url?Promise.reject(Error("Zwibbler.ajax: settings.url missing")):Wa({url:a.url,method:a.method,ft:a.params,mimeType:a.mimeType,contentType:a.contentType,withCredentials:a.withCredentials,data:a.data,qr:a.delay}).then(function(a){P.digest();return a},function(a){P.digest();throw a;})};c.prototype.Vz=function(a,
b){var c=bc();c[a]=b;var e;b=[];a=!0;for(e in c)c.hasOwnProperty(e)&&("/"===e.charAt(0)?(a||b.unshift("&"),""!==c[e]&&(b.unshift(encodeURIComponent(c[e])),b.unshift("=")),b.unshift("/"+encodeURIComponent(e.substr(1))),a=!1):(a||b.push("&"),a=!1,b.push(encodeURIComponent(e)),""!==c[e]&&(b.push("="),b.push(encodeURIComponent(c[e])))));window.location.hash=b.join("")};c.prototype.dw=function(){for(var a=0,b=this.Yi.concat();a<b.length;a++)b[a].Ta();this.Kb.Ta();this.fonts.pz();P.Ta();this.buttons.length=
0;this.Dk.length=0};c.prototype.Uk=function(a,b){var c=new fd;b.text&&c.Nf(b.text);if(b.font){var e=qe(b.font);c.bm(e.fontFamily||"arial",parseFloat(e.fontSize),"bold"===e.fontWeight,"italic"===e.fontStyle,b.textDecoration||"")}c.jp(b.halign||null,b.valign||null);c.format(a,b.width||0,b.height||0);return{draw:function(a,b,d){c.la(a,b,d)},width:c.rect.width,height:c.rect.height}};return c}();
document.addEventListener("dragstart",function(c){var a=c.target;if("IMG"===a.tagName){var b={},d=a.getAttribute("zwibbler-props");if(d)try{b=JSON.parse(d)}catch(e){console.log(Error("Could not parse z-property value as JSON:"+d))}a={"zwibbler-src":a.getAttribute("zwibbler-src"),"zwibbler-width":a.getAttribute("zwibbler-width"),"zwibbler-props":b};a["zwibbler-src"]&&c.dataTransfer.setData("text",JSON.stringify(a))}});var Q=new Z,Th=nf;void 0===Th&&(Th=window.location.href);
var Uh=ac(Th,"?").module||"Zwibbler";"function"===typeof define&&define.amd&&define(Uh,["exports"],function(c){c.Zwibbler=Q});window[Uh]=Q;Q.instances=Q.Yi;Z.prototype.addButton=Z.prototype.Pu;Z.prototype.addCustomNode=Z.prototype.Ru;Z.prototype.Popup=Z.prototype.zu;Z.prototype.Dialog=Z.prototype.Am;Z.prototype.createPreview=Z.prototype.Yv;Z.prototype.directive=Z.prototype.Ib;Z.prototype.render=Z.prototype.Ig;Z.prototype.save=Z.prototype.save;Z.prototype.parseColour=Z.prototype.Zy;
Z.prototype.makeColour=Z.prototype.ly;Z.prototype.getAbsoluteUrl=Z.prototype.Kw;Z.prototype.base64Encode=Z.prototype.nv;Z.prototype.addFont=Z.prototype.Tu;Z.prototype.PathCommands=Z.prototype.yu;Z.prototype.CommandsFromSvgPath=Z.prototype.ru;Z.prototype.getImageSize=Z.prototype.Ln;Z.prototype.loadImage=Z.prototype.to;Z.prototype.setColourOpacity=Z.prototype.Mz;Z.prototype.toggleFullScreen=Z.prototype.HA;Z.prototype.isFullscreenSupported=Z.prototype.zl;Z.prototype.toggleFullscreen=Z.prototype.Kj;
Z.prototype.isFullScreen=Z.prototype.ws;Z.prototype.enableConsoleLogging=Z.prototype.rw;Z.prototype.hasConfig=Z.prototype.ks;Z.prototype.injectStyle=Z.prototype.Cf;Z.prototype.controller=Z.prototype.controller;Z.prototype.component=Z.prototype.xk;Z.prototype.createComponent=Z.prototype.Ak;Z.prototype.destroyComponent=Z.prototype.ew;Z.prototype.attach=Z.prototype.Kc;Z.prototype.detach=Z.prototype.detach;Z.prototype.ajax=Z.prototype.av;Z.prototype.setHashValue=Z.prototype.Vz;
Z.prototype.destroyAll=Z.prototype.dw;Z.prototype.formatText=Z.prototype.Uk;Z.prototype.Context=Z.prototype.su;window.Zwibbler=Q;var Vh=u.create("RESIZE"),Wh=function(){function c(a,b,c){this.Da=a;this.node=b;this.hc=c;Vh("Enter resize behaviour");this.rect=b.rect.clone();this.Da.xe(!0)}c.prototype.gd=function(){};c.prototype.lc=function(){this.Da.xe(!1);Vh("Exit RESIZE")};c.prototype.yb=function(a,b,c){this.Da.Jd(c.pageX,c.pageY);b=(c.pageX-c.pb)/this.Da.scale;var d=(c.pageY-c.qb)/this.Da.scale;c=this.rect.clone();a=this.hc;if(a&16){var f=Math.min(Math.abs(b),Math.abs(d));b=Math.sign(b)*f;d=Math.sign(d)*f}switch(a){case 25:case 22:d=
b;break;case 19:case 28:d=-b}a&1&&(c.y+=d,c.height-=d);a&4&&(c.height+=d);a&8&&(c.x+=b,c.width-=b);a&2&&(c.width+=b);this.node.format(this.Da.ra,this.Da.request);this.Da.la();if(this.node.da){a=this.node.da;f=a.offsetParent;b=c.x;for(d=c.y;f instanceof HTMLElement&&f!==this.Da.aa.nd;)b-=f.offsetLeft,d-=f.offsetTop,f=f.offsetParent;f=A(a).dl();a.style.left=b-f.left+"px";a.style.top=d-f.top+"px";a.style.width=c.width-f.ro-f.ep+"px";a.style.height=c.height-f.Tp-f.Tm+"px";this.node.qp(c,this.node.Na())}return!0};
c.prototype.Pb=function(){if(!this.node.da)throw Error("Expected element to be created");this.Da.Ya(new gg(this.Da));A(this.node.da).dl();this.Da.aa.$a();this.Da.aa.$b([this.node.id],{"style.left":this.node.da.style.left,"style.top":this.node.da.style.top,"style.width":this.node.da.style.width,"style.height":this.node.da.style.height});this.Da.aa.wa(!1);return!0};return c}();var Xh=u.create("DefaultBehaviour"),gg=function(){function c(a){this.view=a;this.Dt=1;this.view.cm("");if(this.Vh=this.view.ga.Vh())this.Dt=2;this.nc=new ne(a)}c.prototype.gd=function(){Xh("Entering pick tool.");this.view.oc("default")};c.prototype.lc=function(){Xh("Leaving pick tool.")};c.prototype.mb=function(a){return this.nc.mb(a)};c.prototype.Eb=function(a,b,c){var d;Xh("onMouseDown");if(c.buttons&&1!==c.buttons)return Xh("   -- not main button. ignore."),!1;if(this.view.ga.get("readOnly"))return(d=
this.view.aa.Db(a,b,this.view.Lb))?(Xh("layer=%s active=%s",d.jc(),this.view.Lb),this.view.Ca.sa("node-clicked",d.id,a,b)):Xh("readOnly mode: Ignoring click."),!1;this.view.selection.length&&this.view.$x(c)&&this.view.wi();if(this.view.Ga){d=this.view.Ga;var f=d.tl(a,b,1/this.view.scale*this.Dt);if(null!==f)return this.view.Ya(new Yh(this.view,d,f,a,b,this,c)),!0}if(f=this.view.nx(a,b)){if(!f.er())return f.click(c),this.view.Ca.digest(),!0;this.view.Ya(new uf(this.view,f,!1,a,b));return!0}(d=this.view.aa.Kn(c.target))||
(d=this.view.aa.Db(a,b,this.view.Lb));f=d&&Vc(d);var h=this.view.Of.Sn(a,b);if(d&&this.view.Lb.has(d.jc())&&!this.view.aa.ko(d)){h=d===this.view.Ga;var k=this.view.xh(d);Xh("wasEditNode: %s, wasSelected: %s curselsize=%s",h,k,this.view.selection.length);k||(c.shiftKey||this.view.lb(),this.view.Ce(d),this.view.fc());if(f)return!1;this.view.Ya(new uf(this.view,this.view.Aj?new he(be,d.Na()):new ie,!h&&k,a,b))}else if(this.view.jt(a,b)){if(f)return!1;this.view.Ya(new uf(this.view,this.view.Aj?new he(be,
this.view.selection[0].Na()):new ie,!0,a,b))}else{if(!this.view.ga.Mw())return Xh("Disabled select box -- mobile touch active."),this.view.Pg(null),this.view.lb(),this.view.fc(),this.view.la(),!1;0==h.length&&(this.view.Pg(null),this.view.Ya(new le(this.view,this,a,b)))}return!0};c.prototype.yb=function(a,b,c){a=this.view.Of.Sn(a,b);a.length&&!A.Df(c.mc.target)?this.view.oc(Cd(a[0].hc)):this.view.oc("default");return!1};c.prototype.Pb=function(){Xh("onMouseUp");return!1};c.prototype.Ml=function(a,
b){var c=this.view.aa.Db(a,b,this.view.Lb);c&&this.view.Ca.sa("node-clicked",c.id,a,b);return!1};c.prototype.Ws=function(a,b,c){Xh("Mouse drag!");if(this.nc.active)return!0;if(A.Df(c.getData("target"))&&!this.view.lo||this.view.ga.get("readOnly"))return!1;b=this.view.Jd(c.pb,c.qb,!0);a=this.view.Of.Sn(b.x,b.y);if((b=a.length?this.view.aa.ob(a[0].id):this.view.aa.Db(b.x,b.y,this.view.Lb))&&Wc(b)&&this.view.Lb.has(b.jc())){var d=b.da.hasAttribute("z-fixture");if(!d){d=void 0;var f;if(f=a.length)a:{switch(a[0].hc){case 25:case 33:case 19:case 34:case 22:case 36:case 28:case 40:f=
!0;break a}f=!1}f&&b.da.hasAttribute("z-sizeable")&&!b.ja("lockSize")?d=new Wh(this.view,b,a[0].hc,c.pb,c.qb):!b.ja("lockPosition")&&(d=new mg(this.view,c,b,0));d&&this.view.Ya(d)}}if(!b){a:{for(a=c.mc.target;a;){if(a.hasAttribute("z-drag-to-create")){b={da:a,type:a.getAttribute("z-drag-to-create")};break a}a=a.parentElement}b=null}if(b){a=Q.Zw(b.type);a.$component=b.type;b=b.da;d={};for(f=0;f<b.attributes.length;f++){var h=b.attributes[f].name,k=b.attributes[f].value;if(h.startsWith("z-prop:")){h=
h.substr(7);for(var l=!1,n="",q=0;q<h.length;q++){var v=h[q];"-"===v?l=!0:l?(n+=v.toUpperCase(),l=!1):n+=v.toLowerCase()}h=n;k=tb.tn(d,k,b);a[h]=k}}b=new gh(this.view.aa.el(),this.view.aa);b.Gc(a);b.format(this.view.ra,this.view.request);this.view.Ya(new mg(this.view,c,b,1))}else(b=this.view.aa.Kn(c.target))&&Wc(b)&&((d=b.da.hasAttribute("z-fixture"))||this.view.Ya(new mg(this.view,c,b,2)))}return!1};c.prototype.Xd=function(a,b){Xh("keyboard: %s on target %s",a,b.target.tagName);if(!A.Df(b.target)){var c=
!0,e=this.view.ga.get("nudge");b&&b.ctrlKey&&(e=this.view.ga.get("preciseNudge"));var f=this.view.La.zb;switch(a){case "bring-to-front":this.view.xd(0);break;case "send-to-back":this.view.xd(1);break;case "left":f||this.view.Hl(-1,0,e)||(this.view.ub=Math.min(this.view.ub+16,0),this.view.Lc(),this.view.la());break;case "right":f||this.view.Hl(1,0,e)||(a=this.view.Dn().width,this.view.ub=Math.max(-(a*this.view.scale-a),this.view.ub-16),this.view.Lc(),this.view.la());break;case "up":f||this.view.Hl(0,
-1,e)||(this.view.kb=Math.min(this.view.kb+16,0),this.view.Lc(),this.view.la());break;case "down":f||this.view.Hl(0,1,e)||(a=this.view.Dn().height,this.view.kb=Math.max(-(a*this.view.scale-a),this.view.kb-16),this.view.Lc(),this.view.la());break;case "select-none":this.view.lb();this.view.fc();this.view.la();f&&this.view.zc.sa("goto-toolbar");break;case "select-all":var h=[];this.view.aa.gc(function(a){h.push(a)});this.view.selectNodes(h);this.view.la();f&&this.view.zc.sa("goto-toolbar");break;case "duplicate":this.view.duplicate();
break;case "move-up":this.view.xd(2);break;case "move-down":this.view.xd(3);break;case "delete":this.view.wi();break;case "curve-tool":this.view.mr({});break;case "line-tool":this.view.Ds({},!1,!1);break;case "group":this.view.group();break;case "ungroup":this.view.Th();break;case "undo":this.view.Hc();break;case "redo":this.view.ae();break;case "cut":this.view.gn();break;case "copy":this.view.cg(!1,this.view.ld(!1));break;case "paste":this.view.rj();break;case "zoom-normal":this.view.ga.get("allowZoom")?
this.view.ce(1):Xh("Zooming is disabled.");break;case "zoom-in":this.view.ga.get("allowZoom")?this.view.tm():Xh("Zooming is disabled.");break;case "zoom-out":this.view.ga.get("allowZoom")?this.view.um():Xh("Zooming is disabled.");break;default:c=!1}c&&(b.preventDefault(),b.stopPropagation());return c}};c.prototype.Wd=function(a,b){b?(this.view.Mb=a,this.view.Vb=a,b="fillStyle"):(this.view.ec=a,b="strokeStyle");this.view.setProperty(b,a)};c.prototype.Gf=function(a,b){b?(this.view.Mb=lc(this.view.Mb,
a),this.view.Vb=lc(this.view.Vb,a)):this.view.ec=lc(this.view.ec,a);this.view.sp(a,b)};c.prototype.Go=function(a,b){Xh("onDoubleClick");var c=this.view.aa.Db(a,b,this.view.Lb);Xh("hittest: %s, hasText: %s",null!==c,null!==c&&c.qg());this.view.Ca.sa("double-click",a,b,c?c.id:null);if(c&&"PathNode"===c.type()&&!this.view.ga.get("allowTextInShape"))Xh("Editing text in shape is disabled.");else if(c&&c.qg()&&!this.view.ga.get("readOnly"))Xh("Text double-clicked."),this.view.Lp({}),this.view.qa instanceof
wf&&this.view.qa.Ep(c,a,b);else return!1;return!0};c.prototype.Ad=function(){return"pick"};return c}();var Yh=function(){function c(a,b,c,e,f,h,k){this.view=a;this.node=b;this.handle=c;this.Ih=h;this.qb=this.pb=0;this.log=u.create("MoveEditNode");b.$k(c);this.bb=b.ja("snap")||0;this.Eb(e,f,k)}c.prototype.gd=function(){this.log("Entering MoveEditNode")};c.prototype.lc=function(){this.view.xe(!1);this.log("Leaving MoveEditNode")};c.prototype.Eb=function(a,b){b=this.view.bb(new D(a,b),this.bb);a=b.x;b=b.y;this.log("onMouseDown(%s,%s)",a,b);this.pb=a;this.qb=b;this.view.xe(!0);return!0};c.prototype.yb=
function(a,b){b=this.view.bb(new D(a,b),this.bb);a=b.x;b=b.y;this.node.Ue(this.handle,a,b);this.node.format(this.view.ra,this.view.request);this.view.la();return!1};c.prototype.Pb=function(a,b){var c=this,e=this.view.bb(new D(a,b),this.bb);a=e.x;b=e.y;this.log("onMouseUp(%s,%s)",a,b,this.pb,this.qb);a!==this.pb||b!==this.qb?(this.node.Ue(this.handle,this.pb,this.qb),this.view.aa.transaction(function(){c.view.aa.Ue(c.node.id,c.handle,a,b)})):this.view.Hz(this.node.id,this.handle);this.view.la();this.view.Ya(this.Ih||
new gg(this.view));return!0};return c}();}).call(window);
//# sourceMappingURL=zwibbler-demo.js.map
